import{J as i,O as a,S as d,V as l}from"./chunk-4XOM7E2Z.js";import{M as g,P as u,U as h,g as c,i as o,o as r}from"./chunk-7NWFEXXR.js";var j=(()=>{class n{constructor(e){this.firebaseService=e,this.settingsDoc="app_settings",this.settingsSubject=new c({}),this.settings$=this.settingsSubject.asObservable(),this.unsubscribe=null,this.db=this.firebaseService.db,this.loadSettings()}loadSettings(){let e=i(this.db,"settings",this.settingsDoc);this.unsubscribe=d(e,t=>{if(t.exists()){let s=t.data();this.settingsSubject.next(s),s.huggingFaceToken&&localStorage.setItem("hf_token",s.huggingFaceToken)}else this.settingsSubject.next({})},t=>{console.warn("Settings listener error:",t);let s=localStorage.getItem("hf_token");s&&this.settingsSubject.next({huggingFaceToken:s})})}saveHuggingFaceToken(e){let t=i(this.db,"settings",this.settingsDoc),s=localStorage.getItem("jjm_user_id")||"admin";return o(a(t,{huggingFaceToken:e,gemmaEnabled:!0,updatedAt:new Date,updatedBy:s},{merge:!0})).pipe(g({next:()=>{localStorage.setItem("hf_token",e),console.log("Settings: Hugging Face token saved to database")},error:m=>{console.error("Settings: Error saving token to database:",m),localStorage.setItem("hf_token",e)}}),r(()=>{}))}clearHuggingFaceToken(){let e=i(this.db,"settings",this.settingsDoc),t=localStorage.getItem("jjm_user_id")||"admin";return o(a(e,{huggingFaceToken:"",gemmaEnabled:!1,updatedAt:new Date,updatedBy:t},{merge:!0})).pipe(g({next:()=>{console.log("Settings: Hugging Face token cleared from database")},error:s=>{console.error("Settings: Error clearing token from database:",s)}}),r(()=>{}))}getSettings(){return this.settings$}getHuggingFaceToken(){return this.settingsSubject.value.huggingFaceToken||localStorage.getItem("hf_token")}isGemmaConfigured(){let e=this.getHuggingFaceToken();return!!e&&e.startsWith("hf_")}ngOnDestroy(){this.unsubscribe&&this.unsubscribe()}static{this.\u0275fac=function(t){return new(t||n)(h(l))}}static{this.\u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{j as a};
