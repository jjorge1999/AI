import{a as Q}from"./chunk-XG4H3KSK.js";import{a as K}from"./chunk-DZH2NWN7.js";import{b as R,e as $,h as q,i as G,j as H,n as J}from"./chunk-IQNO2F6Q.js";import{Aa as a,Ba as O,Mb as D,Nb as N,Ob as W,Pa as v,Pb as B,Ra as s,Sb as j,Ta as I,Va as o,Wa as i,Ya as h,Za as _,_a as m,a as L,aa as A,b as E,cb as k,db as l,e as C,eb as u,f as T,fb as y,ia as g,ib as b,ja as d,jb as P,kb as w,mb as z,nb as M,ob as S,pb as V,rb as F}from"./chunk-MNIEKAC2.js";function U(t,c){if(t&1&&(o(0,"option",18),l(1),M(2,"titlecase"),i()),t&2){let e=c.$implicit;s("value",e),a(),y(" ",S(2,2,e)," ")}}function X(t,c){if(t&1&&(o(0,"option",18),l(1),M(2,"titlecase"),i()),t&2){let e=c.$implicit;s("value",e),a(),y(" ",S(2,2,e)," ")}}function Y(t,c){if(t&1&&(o(0,"span",33),l(1),i()),t&2){let e=m().$implicit;a(),y("\u2022 ",e.details,"")}}function Z(t,c){if(t&1&&(o(0,"div",21)(1,"div",22)(2,"span",23),l(3),i(),o(4,"span",24),l(5),i()(),o(6,"div",25)(7,"div",26)(8,"span",27),l(9),i(),o(10,"span",28),l(11),i()(),o(12,"div",29)(13,"span",30),l(14),i(),v(15,Y,2,1,"span",31),i()(),o(16,"div",32),l(17),M(18,"date"),i()()),t&2){let e=c.$implicit,r=m(2);a(3),u(r.getEntityIcon(e.entityType)),a(2),u(r.getActionIcon(e.action)),a(4),u(e.entityName),a(2),u(e.action),a(3),u(e.entityType),a(),s("ngIf",e.details),a(2),y(" ",V(18,7,e==null?null:e.timestamp,"medium")," ")}}function ee(t,c){if(t&1&&(o(0,"div",19),v(1,Z,19,10,"div",20),i()),t&2){let e=m();a(),s("ngForOf",e.paginatedLogs)}}function te(t,c){t&1&&(o(0,"div",34)(1,"p"),l(2,"No activity logs found"),i()())}function ie(t,c){if(t&1&&(o(0,"option",18),l(1),i()),t&2){let e=c.$implicit;s("value",e),a(),u(e)}}function ne(t,c){if(t&1){let e=h();o(0,"button",44),_("click",function(){let n=g(e).$implicit,p=m(3);return d(p.goToPage(n))}),l(1),i()}if(t&2){let e=c.$implicit,r=m(3);I("active",e===r.currentPage),a(),y(" ",e," ")}}function oe(t,c){if(t&1){let e=h();o(0,"div",40)(1,"button",41),_("click",function(){g(e);let n=m(2);return d(n.prevPage())}),l(2," \u2190 Prev "),i(),o(3,"div",42),v(4,ne,2,3,"button",43),i(),o(5,"button",41),_("click",function(){g(e);let n=m(2);return d(n.nextPage())}),l(6," Next \u2192 "),i()()}if(t&2){let e=m(2);a(),s("disabled",e.currentPage===1),a(3),s("ngForOf",e.getPageNumbers()),a(),s("disabled",e.currentPage===e.totalPages)}}function re(t,c){if(t&1){let e=h();o(0,"div",35)(1,"div",36)(2,"label",37),l(3,"Show:"),i(),o(4,"select",38),w("ngModelChange",function(n){g(e);let p=m();return P(p.pageSize,n)||(p.pageSize=n),d(n)}),_("change",function(){g(e);let n=m();return d(n.currentPage=1)}),v(5,ie,2,2,"option",13),i(),o(6,"span"),l(7,"per page"),i()(),v(8,oe,7,3,"div",39),i()}if(t&2){let e=m();a(4),b("ngModel",e.pageSize),a(),s("ngForOf",e.pageSizeOptions),a(3),s("ngIf",e.totalPages>1)}}var ve=(()=>{class t{constructor(e,r){this.loggingService=e,this.dialogService=r,this.logs=[],this.filteredLogs=[],this.subscriptions=new T,this.selectedEntityType="all",this.selectedAction="all",this.currentPage=1,this.pageSize=20,this.pageSizeOptions=[10,20,50,100],this.entityTypes=["all","product","sale","expense","customer"],this.actions=["all","create","update","delete","restock","complete"]}ngOnInit(){this.subscriptions.add(this.loggingService.getLogs().subscribe(e=>{this.logs=e.map(r=>E(L({},r),{timestamp:new Date(r.timestamp?._seconds*1e3||new Date)})),this.applyFilters()}))}ngOnDestroy(){this.subscriptions.unsubscribe()}applyFilters(){this.filteredLogs=this.logs.filter(e=>{let r=this.selectedEntityType==="all"||e.entityType===this.selectedEntityType,n=this.selectedAction==="all"||e.action===this.selectedAction;return r&&n}),this.currentPage=1}get paginatedLogs(){let e=(this.currentPage-1)*this.pageSize,r=e+this.pageSize;return this.filteredLogs.slice(e,r)}get totalPages(){return Math.ceil(this.filteredLogs.length/this.pageSize)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}goToPage(e){this.currentPage=e}getPageNumbers(){return Array(this.totalPages).fill(0).map((e,r)=>r+1)}refreshLogs(){this.loggingService.refreshLogs()}cleanupOldLogs(){return C(this,null,function*(){(yield this.dialogService.confirm("This will delete all logs older than 30 days. Continue?","Cleanup Logs"))&&this.subscriptions.add(this.loggingService.cleanupOldLogs().subscribe({next:e=>C(this,null,function*(){yield this.dialogService.success(`Cleanup completed! Deleted ${e.deletedCount} logs.`),this.refreshLogs()}),error:e=>C(this,null,function*(){console.error("Cleanup error:",e),yield this.dialogService.error("Failed to cleanup logs")})}))})}getActionIcon(e){return{create:"\u2795",update:"\u270F\uFE0F",delete:"\u{1F5D1}\uFE0F",restock:"\u{1F4E6}",complete:"\u2705"}[e]||"\u{1F4DD}"}getEntityIcon(e){return{product:"\u{1F4E6}",sale:"\u{1F4B0}",expense:"\u{1F4B8}",customer:"\u{1F464}"}[e]||"\u{1F4C4}"}static{this.\u0275fac=function(r){return new(r||t)(O(K),O(Q))}}static{this.\u0275cmp=A({type:t,selectors:[["app-activity-logs"]],standalone:!0,features:[z],decls:29,vars:8,consts:[["noLogs",""],[1,"activity-logs-section"],[1,"card"],[1,"header-section"],[1,"icon"],[1,"badge"],[1,"header-actions"],[1,"btn-refresh",3,"click"],[1,"btn-cleanup",3,"click"],[1,"filters-section"],[1,"filter-group"],["for","entityFilter"],["id","entityFilter",1,"filter-select",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","actionFilter"],["id","actionFilter",1,"filter-select",3,"ngModelChange","change","ngModel"],["class","logs-list",4,"ngIf","ngIfElse"],["class","pagination",4,"ngIf"],[3,"value"],[1,"logs-list"],["class","log-item",4,"ngFor","ngForOf"],[1,"log-item"],[1,"log-icon"],[1,"entity-icon"],[1,"action-icon"],[1,"log-info"],[1,"log-header"],[1,"log-entity"],[1,"log-action-badge"],[1,"log-details"],[1,"log-type"],["class","log-description",4,"ngIf"],[1,"log-timestamp"],[1,"log-description"],[1,"empty-state"],[1,"pagination"],[1,"pagination-size"],["for","pageSize"],["id","pageSize",1,"page-size-select",3,"ngModelChange","change","ngModel"],["class","pagination-controls",4,"ngIf"],[1,"pagination-controls"],[1,"pagination-btn",3,"click","disabled"],[1,"pagination-pages"],["class","pagination-page",3,"active","click",4,"ngFor","ngForOf"],[1,"pagination-page",3,"click"]],template:function(r,n){if(r&1){let p=h();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3")(4,"span",4),l(5,"\u{1F4CB}"),i(),l(6," Activity Logs "),o(7,"span",5),l(8),i()(),o(9,"div",6)(10,"button",7),_("click",function(){return g(p),d(n.refreshLogs())}),l(11," \u{1F504} Refresh "),i(),o(12,"button",8),_("click",function(){return g(p),d(n.cleanupOldLogs())}),l(13," \u{1F5D1}\uFE0F Cleanup Old Logs "),i()()(),o(14,"div",9)(15,"div",10)(16,"label",11),l(17,"Entity Type:"),i(),o(18,"select",12),w("ngModelChange",function(f){return g(p),P(n.selectedEntityType,f)||(n.selectedEntityType=f),d(f)}),_("change",function(){return g(p),d(n.applyFilters())}),v(19,U,3,4,"option",13),i()(),o(20,"div",10)(21,"label",14),l(22,"Action:"),i(),o(23,"select",15),w("ngModelChange",function(f){return g(p),P(n.selectedAction,f)||(n.selectedAction=f),d(f)}),_("change",function(){return g(p),d(n.applyFilters())}),v(24,X,3,4,"option",13),i()()(),v(25,ee,2,1,"div",16)(26,te,3,0,"ng-template",null,0,F)(28,re,9,3,"div",17),i()()}if(r&2){let p=k(27);a(8),u(n.filteredLogs.length),a(10),b("ngModel",n.selectedEntityType),a(),s("ngForOf",n.entityTypes),a(4),b("ngModel",n.selectedAction),a(),s("ngForOf",n.actions),a(),s("ngIf",n.paginatedLogs.length>0)("ngIfElse",p),a(3),s("ngIf",n.totalPages>1||n.filteredLogs.length>20)}},dependencies:[j,D,N,W,B,J,G,H,q,R,$],styles:[".activity-logs-section[_ngcontent-%COMP%]{padding:var(--space-lg)}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-lg);flex-wrap:wrap;gap:var(--space-md)}.header-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:var(--space-sm)}.btn-refresh[_ngcontent-%COMP%], .btn-cleanup[_ngcontent-%COMP%]{padding:var(--space-sm) var(--space-md);border:1px solid var(--color-border);background:var(--color-surface);color:var(--color-text);border-radius:var(--radius-md);cursor:pointer;font-size:.875rem;font-weight:500;transition:all var(--transition-base)}.btn-refresh[_ngcontent-%COMP%]:hover{background:var(--color-primary);color:#fff;border-color:var(--color-primary)}.btn-cleanup[_ngcontent-%COMP%]{background:var(--color-danger);color:#fff;border-color:var(--color-danger)}.btn-cleanup[_ngcontent-%COMP%]:hover{background:#dc2626}.filters-section[_ngcontent-%COMP%]{display:flex;gap:var(--space-lg);margin-bottom:var(--space-lg);padding:var(--space-md);background:var(--color-bg);border-radius:var(--radius-md);flex-wrap:wrap}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm)}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text)}.filter-select[_ngcontent-%COMP%]{padding:var(--space-xs) var(--space-sm);border:1px solid var(--color-border);border-radius:var(--radius-md);background:var(--color-surface);color:var(--color-text);font-size:.875rem;cursor:pointer}.logs-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.log-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);padding:8px 12px;background:var(--color-bg);border-radius:var(--radius-sm);border:1px solid var(--color-border);transition:all var(--transition-base)}.log-item[_ngcontent-%COMP%]:hover{background:var(--color-surface);transform:translate(2px)}.log-icon[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:4px;font-size:1rem;min-width:40px;justify-content:center}.entity-icon[_ngcontent-%COMP%]{font-size:1.1rem}.action-icon[_ngcontent-%COMP%]{font-size:.9rem}.log-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row;align-items:center;gap:var(--space-sm);flex-wrap:wrap}.log-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-xs)}.log-entity[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text);font-size:.9rem}.log-action-badge[_ngcontent-%COMP%]{padding:1px 6px;background:var(--color-primary);color:#fff;border-radius:var(--radius-sm);font-size:.7rem;font-weight:500;text-transform:uppercase}.log-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-xs);font-size:.85rem;color:var(--color-text-muted)}.log-type[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:500}.log-description[_ngcontent-%COMP%]{font-style:italic;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:400px}.log-timestamp[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-text-muted);white-space:nowrap}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--space-2xl);color:var(--color-text-muted)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:var(--space-md);margin-top:var(--space-lg);padding-top:var(--space-lg);border-top:1px solid var(--color-border)}.pagination-btn[_ngcontent-%COMP%]{padding:var(--space-sm) var(--space-md);background:var(--color-surface);border:1px solid var(--color-border);color:var(--color-text);border-radius:var(--radius-md);font-size:.875rem;font-weight:500;cursor:pointer;transition:all var(--transition-base)}.pagination-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--color-primary);color:#fff;border-color:var(--color-primary)}.pagination-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text);font-weight:500}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.filters-section[_ngcontent-%COMP%]{flex-direction:column}.log-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.log-timestamp[_ngcontent-%COMP%]{align-self:flex-end}}"]})}}return t})();export{ve as a};
