import{a as Q}from"./chunk-UWMXBSJH.js";import{a as K}from"./chunk-LCS2IJPI.js";import{b as R,e as $,h as q,i as G,j as H,n as J}from"./chunk-FMESHSGB.js";import{$a as n,Ea as a,Fa as O,Ua as u,Ub as D,Vb as N,Wa as s,Wb as W,Xb as B,Ya as I,_a as r,_b as j,a as L,b as E,da as A,db as h,eb as v,fb as m,g as M,i as T,jb as k,kb as l,la as g,lb as _,ma as d,mb as y,pb as C,qb as b,rb as P,tb as z,ub as w,vb as S,wb as V,yb as F}from"./chunk-VTT5FMM4.js";function U(t,c){if(t&1&&(r(0,"option",18),l(1),w(2,"titlecase"),n()),t&2){let e=c.$implicit;s("value",e),a(),y(" ",S(2,2,e)," ")}}function X(t,c){if(t&1&&(r(0,"option",18),l(1),w(2,"titlecase"),n()),t&2){let e=c.$implicit;s("value",e),a(),y(" ",S(2,2,e)," ")}}function Y(t,c){if(t&1&&(r(0,"span",33),l(1),n()),t&2){let e=m().$implicit;a(),y("\u2022 ",e.details,"")}}function Z(t,c){if(t&1&&(r(0,"div",21)(1,"div",22)(2,"span",23),l(3),n(),r(4,"span",24),l(5),n()(),r(6,"div",25)(7,"div",26)(8,"span",27),l(9),n(),r(10,"span",28),l(11),n()(),r(12,"div",29)(13,"span",30),l(14),n(),u(15,Y,2,1,"span",31),n()(),r(16,"div",32),l(17),w(18,"date"),n()()),t&2){let e=c.$implicit,i=m(2);a(3),_(i.getEntityIcon(e.entityType)),a(2),_(i.getActionIcon(e.action)),a(4),_(e.entityName),a(2),_(e.action),a(3),_(e.entityType),a(),s("ngIf",e.details),a(2),y(" ",V(18,7,e==null?null:e.timestamp,"medium")," ")}}function ee(t,c){if(t&1&&(r(0,"div",19),u(1,Z,19,10,"div",20),n()),t&2){let e=m();a(),s("ngForOf",e.paginatedLogs)}}function te(t,c){t&1&&(r(0,"div",34)(1,"p"),l(2,"No activity logs found"),n()())}function ie(t,c){if(t&1&&(r(0,"option",18),l(1),n()),t&2){let e=c.$implicit;s("value",e),a(),_(e)}}function ne(t,c){if(t&1){let e=h();r(0,"button",44),v("click",function(){let o=g(e).$implicit,p=m(3);return d(p.goToPage(o))}),l(1),n()}if(t&2){let e=c.$implicit,i=m(3);I("active",e===i.currentPage),a(),y(" ",e," ")}}function oe(t,c){if(t&1){let e=h();r(0,"div",40)(1,"button",41),v("click",function(){g(e);let o=m(2);return d(o.prevPage())}),l(2," \u2190 Prev "),n(),r(3,"div",42),u(4,ne,2,3,"button",43),n(),r(5,"button",41),v("click",function(){g(e);let o=m(2);return d(o.nextPage())}),l(6," Next \u2192 "),n()()}if(t&2){let e=m(2);a(),s("disabled",e.currentPage===1),a(3),s("ngForOf",e.getPageNumbers()),a(),s("disabled",e.currentPage===e.totalPages)}}function re(t,c){if(t&1){let e=h();r(0,"div",35)(1,"div",36)(2,"label",37),l(3,"Show:"),n(),r(4,"select",38),P("ngModelChange",function(o){g(e);let p=m();return b(p.pageSize,o)||(p.pageSize=o),d(o)}),v("change",function(){g(e);let o=m();return d(o.currentPage=1)}),u(5,ie,2,2,"option",13),n(),r(6,"span"),l(7,"per page"),n()(),u(8,oe,7,3,"div",39),n()}if(t&2){let e=m();a(4),C("ngModel",e.pageSize),a(),s("ngForOf",e.pageSizeOptions),a(3),s("ngIf",e.totalPages>1)}}var ue=(()=>{class t{constructor(e,i){this.loggingService=e,this.dialogService=i,this.logs=[],this.filteredLogs=[],this.subscriptions=new T,this.selectedEntityType="all",this.selectedAction="all",this.currentPage=1,this.pageSize=20,this.pageSizeOptions=[10,20,50,100],this.entityTypes=["all","product","sale","expense","customer"],this.actions=["all","create","update","delete","restock","complete"]}ngOnInit(){this.subscriptions.add(this.loggingService.getLogs().subscribe(e=>{this.logs=e.map(i=>E(L({},i),{timestamp:new Date(i.timestamp?._seconds*1e3||new Date)})),this.applyFilters()}))}ngOnDestroy(){this.subscriptions.unsubscribe()}applyFilters(){this.filteredLogs=this.logs.filter(e=>{let i=this.selectedEntityType==="all"||e.entityType===this.selectedEntityType,o=this.selectedAction==="all"||e.action===this.selectedAction;return i&&o}),this.currentPage=1}get paginatedLogs(){let e=(this.currentPage-1)*this.pageSize,i=e+this.pageSize;return this.filteredLogs.slice(e,i)}get totalPages(){return Math.ceil(this.filteredLogs.length/this.pageSize)}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}goToPage(e){this.currentPage=e}getPageNumbers(){return Array(this.totalPages).fill(0).map((e,i)=>i+1)}refreshLogs(){this.loggingService.refreshLogs()}cleanupOldLogs(){this.dialogService.confirm("This will delete all logs older than 30 days. Continue?","Cleanup Logs").subscribe(e=>{e&&this.subscriptions.add(this.loggingService.cleanupOldLogs().subscribe({next:i=>M(this,null,function*(){this.dialogService.success(`Cleanup completed! Deleted ${i.deletedCount} logs.`).subscribe(),this.refreshLogs()}),error:i=>M(this,null,function*(){console.error("Cleanup error:",i),this.dialogService.error("Failed to cleanup logs").subscribe()})}))})}getActionIcon(e){return{create:"\u2795",update:"\u270F\uFE0F",delete:"\u{1F5D1}\uFE0F",restock:"\u{1F4E6}",complete:"\u2705"}[e]||"\u{1F4DD}"}getEntityIcon(e){return{product:"\u{1F4E6}",sale:"\u{1F4B0}",expense:"\u{1F4B8}",customer:"\u{1F464}"}[e]||"\u{1F4C4}"}static{this.\u0275fac=function(i){return new(i||t)(O(K),O(Q))}}static{this.\u0275cmp=A({type:t,selectors:[["app-activity-logs"]],standalone:!0,features:[z],decls:29,vars:8,consts:[["noLogs",""],[1,"activity-logs-section"],[1,"card"],[1,"header-section"],[1,"icon"],[1,"badge"],[1,"header-actions"],[1,"btn-refresh",3,"click"],[1,"btn-cleanup",3,"click"],[1,"filters-section"],[1,"filter-group"],["for","entityFilter"],["id","entityFilter",1,"filter-select",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","actionFilter"],["id","actionFilter",1,"filter-select",3,"ngModelChange","change","ngModel"],["class","logs-list",4,"ngIf","ngIfElse"],["class","pagination",4,"ngIf"],[3,"value"],[1,"logs-list"],["class","log-item",4,"ngFor","ngForOf"],[1,"log-item"],[1,"log-icon"],[1,"entity-icon"],[1,"action-icon"],[1,"log-info"],[1,"log-header"],[1,"log-entity"],[1,"log-action-badge"],[1,"log-details"],[1,"log-type"],["class","log-description",4,"ngIf"],[1,"log-timestamp"],[1,"log-description"],[1,"empty-state"],[1,"pagination"],[1,"pagination-size"],["for","pageSize"],["id","pageSize",1,"page-size-select",3,"ngModelChange","change","ngModel"],["class","pagination-controls",4,"ngIf"],[1,"pagination-controls"],[1,"pagination-btn",3,"click","disabled"],[1,"pagination-pages"],["class","pagination-page",3,"active","click",4,"ngFor","ngForOf"],[1,"pagination-page",3,"click"]],template:function(i,o){if(i&1){let p=h();r(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3")(4,"span",4),l(5,"\u{1F4CB}"),n(),l(6," Activity Logs "),r(7,"span",5),l(8),n()(),r(9,"div",6)(10,"button",7),v("click",function(){return g(p),d(o.refreshLogs())}),l(11," \u{1F504} Refresh "),n(),r(12,"button",8),v("click",function(){return g(p),d(o.cleanupOldLogs())}),l(13," \u{1F5D1}\uFE0F Cleanup Old Logs "),n()()(),r(14,"div",9)(15,"div",10)(16,"label",11),l(17,"Entity Type:"),n(),r(18,"select",12),P("ngModelChange",function(f){return g(p),b(o.selectedEntityType,f)||(o.selectedEntityType=f),d(f)}),v("change",function(){return g(p),d(o.applyFilters())}),u(19,U,3,4,"option",13),n()(),r(20,"div",10)(21,"label",14),l(22,"Action:"),n(),r(23,"select",15),P("ngModelChange",function(f){return g(p),b(o.selectedAction,f)||(o.selectedAction=f),d(f)}),v("change",function(){return g(p),d(o.applyFilters())}),u(24,X,3,4,"option",13),n()()(),u(25,ee,2,1,"div",16)(26,te,3,0,"ng-template",null,0,F)(28,re,9,3,"div",17),n()()}if(i&2){let p=k(27);a(8),_(o.filteredLogs.length),a(10),C("ngModel",o.selectedEntityType),a(),s("ngForOf",o.entityTypes),a(4),C("ngModel",o.selectedAction),a(),s("ngForOf",o.actions),a(),s("ngIf",o.paginatedLogs.length>0)("ngIfElse",p),a(3),s("ngIf",o.totalPages>1||o.filteredLogs.length>20)}},dependencies:[j,D,N,W,B,J,G,H,q,R,$],styles:[".activity-logs-section[_ngcontent-%COMP%]{padding:var(--space-lg)}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-lg);flex-wrap:wrap;gap:var(--space-md)}.header-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:var(--space-sm)}.btn-refresh[_ngcontent-%COMP%], .btn-cleanup[_ngcontent-%COMP%]{padding:var(--space-sm) var(--space-md);border:1px solid var(--color-border);background:var(--color-surface);color:var(--color-text);border-radius:var(--radius-md);cursor:pointer;font-size:.875rem;font-weight:500;transition:all var(--transition-base)}.btn-refresh[_ngcontent-%COMP%]:hover{background:var(--color-primary);color:#fff;border-color:var(--color-primary)}.btn-cleanup[_ngcontent-%COMP%]{background:var(--color-danger);color:#fff;border-color:var(--color-danger)}.btn-cleanup[_ngcontent-%COMP%]:hover{background:#dc2626}.filters-section[_ngcontent-%COMP%]{display:flex;gap:var(--space-lg);margin-bottom:var(--space-lg);padding:var(--space-md);background:var(--color-bg);border-radius:var(--radius-md);flex-wrap:wrap}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm)}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text)}.filter-select[_ngcontent-%COMP%]{padding:var(--space-xs) var(--space-sm);border:1px solid var(--color-border);border-radius:var(--radius-md);background:var(--color-surface);color:var(--color-text);font-size:.875rem;cursor:pointer}.logs-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.log-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);padding:8px 12px;background:var(--color-bg);border-radius:var(--radius-sm);border:1px solid var(--color-border);transition:all var(--transition-base)}.log-item[_ngcontent-%COMP%]:hover{background:var(--color-surface);transform:translate(2px)}.log-icon[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:4px;font-size:1rem;min-width:40px;justify-content:center}.entity-icon[_ngcontent-%COMP%]{font-size:1.1rem}.action-icon[_ngcontent-%COMP%]{font-size:.9rem}.log-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row;align-items:center;gap:var(--space-sm);flex-wrap:wrap}.log-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-xs)}.log-entity[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text);font-size:.9rem}.log-action-badge[_ngcontent-%COMP%]{padding:1px 6px;background:var(--color-primary);color:#fff;border-radius:var(--radius-sm);font-size:.7rem;font-weight:500;text-transform:uppercase}.log-details[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-xs);font-size:.85rem;color:var(--color-text-muted)}.log-type[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:500}.log-description[_ngcontent-%COMP%]{font-style:italic;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:400px}.log-timestamp[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-text-muted);white-space:nowrap}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--space-2xl);color:var(--color-text-muted)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:var(--space-md);margin-top:var(--space-lg);padding-top:var(--space-lg);border-top:1px solid var(--color-border)}.pagination-btn[_ngcontent-%COMP%]{padding:var(--space-sm) var(--space-md);background:var(--color-surface);border:1px solid var(--color-border);color:var(--color-text);border-radius:var(--radius-md);font-size:.875rem;font-weight:500;cursor:pointer;transition:all var(--transition-base)}.pagination-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--color-primary);color:#fff;border-color:var(--color-primary)}.pagination-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text);font-weight:500}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.filters-section[_ngcontent-%COMP%]{flex-direction:column}.log-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.log-timestamp[_ngcontent-%COMP%]{align-self:flex-end}}"]})}}return t})();export{ue as a};
