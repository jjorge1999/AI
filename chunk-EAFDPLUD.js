import{a as R}from"./chunk-HOF2SGEB.js";import{a as q}from"./chunk-XG4H3KSK.js";import{a as L,b as A,e as F,h as z,i as j,j as B,n as Y}from"./chunk-IQNO2F6Q.js";import{Aa as a,Ba as C,Mb as V,Nb as T,Ob as N,Pa as v,Pb as W,Ra as g,Sb as D,Ta as E,Va as r,Wa as n,Ya as w,Za as h,_a as d,a as b,aa as S,b as P,db as i,e as M,eb as p,fb as y,ia as c,ib as u,ja as m,jb as _,kb as f,mb as O,nb as U,ob as k,pb as I}from"./chunk-MNIEKAC2.js";function G(l,x){l&1&&(r(0,"div",10),i(1," Loading users... "),n())}function H(l,x){if(l&1){let e=w();r(0,"tr")(1,"td")(2,"div",13)(3,"span",14),i(4),n(),i(5),n()(),r(6,"td"),i(7),n(),r(8,"td"),i(9),n(),r(10,"td")(11,"span",15),i(12),U(13,"titlecase"),n()(),r(14,"td"),i(15),U(16,"date"),n(),r(17,"td")(18,"div",16)(19,"button",17),h("click",function(){let t=c(e).$implicit,o=d(2);return m(o.openEditModal(t))}),i(20,"\u270F\uFE0F"),n(),r(21,"button",18),h("click",function(){let t=c(e).$implicit,o=d(2);return m(o.deleteUser(t.id))}),i(22,"\u{1F5D1}\uFE0F"),n()()()()}if(l&2){let e=x.$implicit;a(4),p(e.username.charAt(0).toUpperCase()),a(),y(" ",e.username," "),a(2),p(e.fullName),a(2),p(e.address||"-"),a(2),E("admin",e.role==="admin"),a(),y(" ",k(13,8,e.role)," "),a(3),p(I(16,10,e.createdAt,"mediumDate"))}}function J(l,x){if(l&1&&(r(0,"table",11)(1,"thead")(2,"tr")(3,"th"),i(4,"Username"),n(),r(5,"th"),i(6,"Full Name"),n(),r(7,"th"),i(8,"Address"),n(),r(9,"th"),i(10,"Role"),n(),r(11,"th"),i(12,"Created At"),n(),r(13,"th"),i(14,"Actions"),n()()(),r(15,"tbody"),v(16,H,23,13,"tr",12),n()()),l&2){let e=d();a(16),g("ngForOf",e.users)}}function K(l,x){l&1&&(r(0,"div",19)(1,"p"),i(2,"No users found. (This shouldn't happen as default admin exists)"),n()())}function Q(l,x){l&1&&(r(0,"small",35),i(1,"Only enter if you wish to change it."),n())}function X(l,x){if(l&1){let e=w();r(0,"div",20)(1,"div",21)(2,"h3"),i(3),n(),r(4,"div",22)(5,"label"),i(6,"Username"),n(),r(7,"input",23),f("ngModelChange",function(t){c(e);let o=d();return _(o.currentUser.username,t)||(o.currentUser.username=t),m(t)}),n()(),r(8,"div",22)(9,"label"),i(10,"Full Name"),n(),r(11,"input",24),f("ngModelChange",function(t){c(e);let o=d();return _(o.currentUser.fullName,t)||(o.currentUser.fullName=t),m(t)}),n()(),r(12,"div",22)(13,"label"),i(14,"Address"),n(),r(15,"input",25),f("ngModelChange",function(t){c(e);let o=d();return _(o.currentUser.address,t)||(o.currentUser.address=t),m(t)}),n()(),r(16,"div",22)(17,"label"),i(18,"GPS Coordinates"),n(),r(19,"input",26),f("ngModelChange",function(t){c(e);let o=d();return _(o.currentUser.gpsCoordinates,t)||(o.currentUser.gpsCoordinates=t),m(t)}),n()(),r(20,"div",22)(21,"label"),i(22,"Password"),n(),r(23,"input",27),f("ngModelChange",function(t){c(e);let o=d();return _(o.formPassword,t)||(o.formPassword=t),m(t)}),n(),v(24,Q,2,0,"small",28),n(),r(25,"div",22)(26,"label"),i(27,"Role"),n(),r(28,"select",29),f("ngModelChange",function(t){c(e);let o=d();return _(o.currentUser.role,t)||(o.currentUser.role=t),m(t)}),r(29,"option",30),i(30,"User"),n(),r(31,"option",31),i(32,"Admin"),n()()(),r(33,"div",32)(34,"button",33),h("click",function(){c(e);let t=d();return m(t.closeModal())}),i(35,"Cancel"),n(),r(36,"button",34),h("click",function(){c(e);let t=d();return m(t.saveUser())}),i(37),n()()()()}if(l&2){let e=d();a(3),p(e.isEditing?"Edit User":"Add New User"),a(4),u("ngModel",e.currentUser.username),a(4),u("ngModel",e.currentUser.fullName),a(4),u("ngModel",e.currentUser.address),a(4),u("ngModel",e.currentUser.gpsCoordinates),a(4),u("ngModel",e.formPassword),g("placeholder",e.isEditing?"Leave blank to keep current":"Enter password"),a(),g("ngIf",e.isEditing),a(4),u("ngModel",e.currentUser.role),a(9),p(e.isEditing?"Update":"Create")}}var oe=(()=>{class l{constructor(e,s){this.userService=e,this.dialogService=s,this.users=[],this.isLoading=!1,this.isModalOpen=!1,this.isEditing=!1,this.currentUser={username:"",fullName:"",role:"user"},this.formPassword=""}ngOnInit(){this.loadUsers(),this.userService.loadUsers()}loadUsers(){this.isLoading=!0;let e=localStorage.getItem("jjm_user_id");this.userService.getUsers().subscribe(s=>{e&&e!=="admin"?this.users=s.filter(t=>t.id===e||t.userId===e):this.users=s,this.isLoading=!1})}openAddModal(){this.isEditing=!1,this.formPassword="",this.currentUser={username:"",fullName:"",role:"user"},this.isModalOpen=!0}openEditModal(e){this.isEditing=!0,this.formPassword="",this.currentUser=b({},e),this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}saveUser(){return M(this,null,function*(){if(!this.currentUser.username||!this.currentUser.role){yield this.dialogService.error("Please fill in username and role.","Validation Error");return}if(!this.isEditing&&!this.formPassword){yield this.dialogService.error("Password is required for new users.","Validation Error");return}if(this.isEditing&&this.currentUser.id){let e={id:this.currentUser.id,username:this.currentUser.username,fullName:this.currentUser.fullName,address:this.currentUser.address,gpsCoordinates:this.currentUser.gpsCoordinates,role:this.currentUser.role};this.formPassword&&(e.password=this.formPassword),this.userService.updateUser(e).subscribe(()=>{this.closeModal()})}else{let e=localStorage.getItem("jjm_user_id")||"system",s=P(b({},this.currentUser),{password:this.formPassword,createdBy:e,userId:e});this.userService.addUser(s).subscribe(()=>{this.closeModal()})}})}deleteUser(e){return M(this,null,function*(){(yield this.dialogService.confirm("Are you sure you want to delete this user?","Delete User"))&&this.userService.deleteUser(e).subscribe()})}static{this.\u0275fac=function(s){return new(s||l)(C(R),C(q))}}static{this.\u0275cmp=S({type:l,selectors:[["app-user-management"]],standalone:!0,features:[O],decls:16,vars:4,consts:[[1,"user-management-container"],[1,"page-header"],[1,"header-text"],[1,"subtitle"],[1,"btn-add",3,"click"],[1,"users-list-container"],["class","loading-state",4,"ngIf"],["class","users-table",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"loading-state"],[1,"users-table"],[4,"ngFor","ngForOf"],[1,"user-name-cell"],[1,"avatar"],[1,"role-badge"],[1,"actions"],["title","Edit",1,"btn-icon","edit",3,"click"],["title","Delete",1,"btn-icon","delete",3,"click"],[1,"empty-state"],[1,"modal-overlay"],[1,"modal-card"],[1,"form-group"],["type","text","placeholder","Enter username",3,"ngModelChange","ngModel"],["type","text","placeholder","Enter full name",3,"ngModelChange","ngModel"],["type","text","placeholder","Enter address (Optional)",3,"ngModelChange","ngModel"],["type","text","placeholder","Lat, Lng (Optional)",3,"ngModelChange","ngModel"],["type","text",3,"ngModelChange","ngModel","placeholder"],["class","hint",4,"ngIf"],[3,"ngModelChange","ngModel"],["value","user"],["value","admin"],[1,"modal-actions"],[1,"btn-cancel",3,"click"],[1,"btn-save",3,"click"],[1,"hint"]],template:function(s,t){s&1&&(r(0,"div",0)(1,"header",1)(2,"div",2)(3,"h2"),i(4,"\u{1F465} User Management"),n(),r(5,"p",3),i(6,"Manage system access and roles"),n()(),r(7,"button",4),h("click",function(){return t.openAddModal()}),r(8,"span"),i(9,"+"),n(),i(10," Add User "),n()(),r(11,"div",5),v(12,G,2,0,"div",6)(13,J,17,1,"table",7)(14,K,3,0,"div",8),n(),v(15,X,38,10,"div",9),n()),s&2&&(a(12),g("ngIf",t.isLoading),a(),g("ngIf",!t.isLoading&&t.users.length>0),a(),g("ngIf",!t.isLoading&&t.users.length===0),a(),g("ngIf",t.isModalOpen))},dependencies:[D,V,T,N,W,Y,j,B,L,z,A,F],styles:[".user-management-container[_ngcontent-%COMP%]{padding:var(--space-xl);max-width:1200px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-xl);background:var(--color-surface);padding:var(--space-lg);border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);border:1px solid var(--color-border)}.header-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:var(--color-text)}.subtitle[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--color-text-muted);font-size:.875rem}.btn-add[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);padding:.75rem 1.5rem;background:var(--color-primary);color:#fff;border:none;border-radius:var(--radius-md);font-weight:600;cursor:pointer;transition:all .2s}.btn-add[_ngcontent-%COMP%]:hover{background:var(--color-accent);transform:translateY(-2px);box-shadow:var(--shadow-md)}.users-list-container[_ngcontent-%COMP%]{background:var(--color-surface);border-radius:var(--radius-lg);border:1px solid var(--color-border);overflow:hidden;box-shadow:var(--shadow-sm)}.users-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .users-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--space-md) var(--space-lg);text-align:left;border-bottom:1px solid var(--color-border)}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:var(--color-bg);font-weight:600;color:var(--color-text-muted);font-size:.875rem;text-transform:uppercase;letter-spacing:.5px}.users-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:var(--color-bg)}.user-name-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;font-weight:500}.avatar[_ngcontent-%COMP%]{width:32px;height:32px;background:var(--color-primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:700}.role-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:999px;font-size:.75rem;font-weight:600;background:var(--color-bg);color:var(--color-text);border:1px solid var(--color-border)}.role-badge.admin[_ngcontent-%COMP%]{background:#3b82f61a;color:var(--color-primary);border-color:#3b82f633}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:var(--space-2xl);text-align:center;color:var(--color-text-muted)}.actions[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-icon[_ngcontent-%COMP%]{padding:6px;background:transparent;border:none;cursor:pointer;border-radius:4px;transition:background .2s}.btn-icon[_ngcontent-%COMP%]:hover{background:#0000000d}.btn-icon.delete[_ngcontent-%COMP%]:hover{background:#ef44441a}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal-card[_ngcontent-%COMP%]{background:var(--color-surface);padding:var(--space-xl);border-radius:var(--radius-lg);width:400px;max-width:90%;box-shadow:var(--shadow-xl);animation:_ngcontent-%COMP%_slideUp .3s cubic-bezier(.16,1,.3,1)}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 var(--space-lg) 0;font-size:1.25rem;color:var(--color-text)}.form-group[_ngcontent-%COMP%]{margin-bottom:var(--space-lg)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:var(--space-xs);font-weight:500;font-size:.875rem;color:var(--color-text)}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid var(--color-border);border-radius:var(--radius-md);background:var(--color-bg);color:var(--color-text);font-size:.9375rem}.hint[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:.75rem;color:var(--color-text-muted)}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--space-md);margin-top:var(--space-xl)}.btn-cancel[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:transparent;border:1px solid var(--color-border);color:var(--color-text);border-radius:var(--radius-md);cursor:pointer;font-weight:500}.btn-save[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--color-primary);color:#fff;border:none;border-radius:var(--radius-md);cursor:pointer;font-weight:600}"]})}}return l})();export{oe as a};
