import{a as J}from"./chunk-KSHKVDE3.js";import{a as K}from"./chunk-VYKVMX3Y.js";import{a as Q,b as B,e as j,h as U,i as L,j as Y,m as $,n as G}from"./chunk-ZPQL42FH.js";import{a as F,d as H}from"./chunk-IO3I47CY.js";import{$a as q,Ca as h,Ea as u,Ga as R,Ia as r,Ja as n,Ka as T,La as y,Ma as v,Na as d,O as k,Sa as s,T as I,Ta as b,Ua as C,Va as V,X as E,Xa as _,Ya as f,Za as x,ab as M,c as O,cb as w,da as l,ea as m,pa as D,q as S,sa as c,ta as P,tb as N,ub as A,xb as W,zb as z}from"./chunk-K7VUYT6X.js";var X=(()=>{class a{constructor(e){this.http=e,this.apiUrl=H.apiUrl}addReservation(e){return O(this,null,function*(){let i="RES-"+Date.now()+"-"+Math.floor(Math.random()*1e3),t=e.items.map(o=>{let p={productId:o.productId,productName:o.productName,category:"Reservation",price:o.price,quantitySold:o.quantity,total:o.price*o.quantity,cashReceived:0,change:0,timestamp:new Date().toISOString(),deliveryDate:e.pickupDate.toISOString(),deliveryNotes:`RESERVATION: ${e.customerName} (${e.customerContact}).
${e.notes||""}. Address: ${e.customerAddress||"N/A"}`,customerId:"",pending:!0,reservationStatus:"pending_confirmation",userId:"guest",orderId:i};return S(this.http.post(`${this.apiUrl}/sales`,p))});return yield Promise.all(t),"reservation-submitted"})}static{this.\u0275fac=function(i){return new(i||a)(I(F))}}static{this.\u0275prov=k({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function ne(a,g){if(a&1){let e=y();r(0,"div",5)(1,"div",6),s(2,"\u2705"),n(),r(3,"p"),s(4),n(),r(5,"button",7),v("click",function(){l(e);let t=d();return m(t.successMessage="")}),s(6,"Make Another Reservation"),n()()}if(a&2){let e=d();c(4),b(e.successMessage)}}function ie(a,g){if(a&1&&(r(0,"option",32),s(1),n()),a&2){let e=g.$implicit;u("value",e),c(),b(e)}}function re(a,g){if(a&1&&T(0,"img",47),a&2){let e=d().$implicit;u("src",e.imageUrl,D)("alt",e.name)}}function oe(a,g){a&1&&(r(0,"div",48),s(1,"\u{1F4E6}"),n())}function ae(a,g){if(a&1){let e=y();r(0,"div",33)(1,"div",34),h(2,re,1,2,"img",35)(3,oe,2,0,"div",36),n(),r(4,"div",37)(5,"h4",38),s(6),n(),r(7,"div",39)(8,"span",40),s(9),M(10,"number"),n(),r(11,"span",41),s(12),n()(),r(13,"div",42)(14,"div",43)(15,"button",44),v("click",function(){let t=l(e).$implicit,o=d(2);return m(o.decrementQty(t))}),s(16,"-"),n(),r(17,"input",45),v("input",function(t){let o=l(e).$implicit,p=d(2);return m(p.manualQty(o,t))}),n(),r(18,"button",44),v("click",function(){let t=l(e).$implicit,o=d(2);return m(o.incrementQty(t))}),s(19,"+"),n()(),r(20,"button",46),v("click",function(){let t=l(e).$implicit,o=d(2);return m(o.addToOrder(t))}),s(21,"Add"),n()()()()}if(a&2){let e=g.$implicit,i=d(2);c(2),u("ngIf",e.imageUrl),c(),u("ngIf",!e.imageUrl),c(3),b(e.name),c(3),C("\u20B1",w(10,9,e.price,"1.2-2"),""),c(2),R("low",e.quantity<10),c(),C("Stock: ",e.quantity,""),c(5),u("value",i.getQty(e))("max",e.quantity)}}function se(a,g){if(a&1){let e=y();r(0,"div",58)(1,"div",59)(2,"span",60),s(3),n(),r(4,"span",61),s(5),M(6,"number"),n()(),r(7,"div",62),s(8),M(9,"number"),r(10,"button",63),v("click",function(){let t=l(e).index,o=d(3);return m(o.removeFromOrder(t))}),s(11,"\u2715"),n()()()}if(a&2){let e=g.$implicit;c(3),b(e.product.name),c(2),V("",e.quantity," x \u20B1",w(6,4,e.product.price,"1.2-2"),""),c(3),C(" \u20B1",w(9,7,e.product.price*e.quantity,"1.2-2")," ")}}function ce(a,g){if(a&1){let e=y();r(0,"section",49)(1,"h3"),s(2,"Order Summary"),n(),r(3,"div",50),h(4,se,12,10,"div",51),n(),r(5,"div",52)(6,"span"),s(7,"Total Amount:"),n(),r(8,"span",53),s(9),M(10,"number"),n()(),r(11,"div",11)(12,"label",54),s(13,"Additional Notes"),n(),r(14,"textarea",55),x("ngModelChange",function(t){l(e);let o=d(2);return f(o.notes,t)||(o.notes=t),m(t)}),n()(),r(15,"div",56)(16,"button",57),v("click",function(){l(e);let t=d(2);return m(t.submitReservation())}),s(17),n()()()}if(a&2){let e=d(2);c(4),u("ngForOf",e.orderItems),c(5),C("\u20B1",w(10,5,e.totalAmount,"1.2-2"),""),c(5),_("ngModel",e.notes),c(2),u("disabled",e.isSubmitting),c(),C(" ",e.isSubmitting?"Submitting...":"Confirm Reservation"," ")}}function de(a,g){a&1&&(r(0,"div",64)(1,"p"),s(2,"Your cart is empty. Add items above."),n()())}function le(a,g){if(a&1){let e=y();r(0,"div",8)(1,"section",9)(2,"h3"),s(3,"\u{1F4CB} Customer Information"),n(),r(4,"div",10)(5,"div",11)(6,"label",12),s(7,"Full Name *"),n(),r(8,"input",13),x("ngModelChange",function(t){l(e);let o=d();return f(o.customerName,t)||(o.customerName=t),m(t)}),n()(),r(9,"div",11)(10,"label",14),s(11,"Phone Number *"),n(),r(12,"input",15),x("ngModelChange",function(t){l(e);let o=d();return f(o.customerContact,t)||(o.customerContact=t),m(t)}),n()(),r(13,"div",16)(14,"label",17),s(15,"Delivery Address *"),n(),r(16,"input",18),x("ngModelChange",function(t){l(e);let o=d();return f(o.customerAddress,t)||(o.customerAddress=t),m(t)}),n()(),r(17,"div",16)(18,"label",19),s(19,"Payment Option (Optional)"),n(),r(20,"select",20),x("ngModelChange",function(t){l(e);let o=d();return f(o.paymentOption,t)||(o.paymentOption=t),m(t)}),r(21,"option",21),s(22,"Select Payment Method"),n(),h(23,ie,2,2,"option",22),n()()(),r(24,"h3",23),s(25,"\u{1F69A} Pickup/Delivery Date"),n(),r(26,"div",10)(27,"div",11)(28,"label",24),s(29,"Date *"),n(),r(30,"input",25),x("ngModelChange",function(t){l(e);let o=d();return f(o.pickupDate,t)||(o.pickupDate=t),m(t)}),n()(),r(31,"div",11)(32,"label",26),s(33,"Time"),n(),r(34,"input",27),x("ngModelChange",function(t){l(e);let o=d();return f(o.pickupTime,t)||(o.pickupTime=t),m(t)}),n()()()(),r(35,"section",9)(36,"h3"),s(37,"Select Items"),n(),r(38,"div",28),h(39,ae,22,12,"div",29),n()(),h(40,ce,18,8,"section",30)(41,de,3,0,"div",31),n()}if(a&2){let e=d();c(8),_("ngModel",e.customerName),c(4),_("ngModel",e.customerContact),c(4),_("ngModel",e.customerAddress),c(4),_("ngModel",e.paymentOption),c(3),u("ngForOf",e.paymentOptions),c(7),_("ngModel",e.pickupDate),c(4),_("ngModel",e.pickupTime),c(5),u("ngForOf",e.products),c(),u("ngIf",e.orderItems.length>0),c(),u("ngIf",e.orderItems.length===0)}}var Ce=(()=>{class a{constructor(e,i,t){this.inventoryService=e,this.reservationService=i,this.customerService=t,this.products=[],this.customerName="",this.customerContact="",this.customerAddress="",this.notes="",this.paymentOption="",this.paymentOptions=["Cash on Delivery","Gcash","Bank Transfer"],this.pickupDate="",this.pickupTime="",this.orderItems=[],this.selectedProduct=null,this.selectedQuantity=1,this.isSubmitting=!1,this.successMessage="",this.tempQuantities={}}ngOnInit(){let e=new Date;e.setDate(e.getDate()+1),this.pickupDate=e.toISOString().split("T")[0],this.loadProducts()}loadProducts(){this.inventoryService.getProducts().subscribe(e=>{this.products=e.filter(i=>i.quantity>0)})}getQty(e){return this.tempQuantities[e.id]||1}incrementQty(e){let i=this.getQty(e);i<e.quantity&&(this.tempQuantities[e.id]=i+1)}decrementQty(e){let i=this.getQty(e);i>1&&(this.tempQuantities[e.id]=i-1)}manualQty(e,i){let t=parseInt(i.target.value,10);!isNaN(t)&&t>=1&&t<=e.quantity&&(this.tempQuantities[e.id]=t)}addToOrder(e){let i=this.getQty(e),t=this.orderItems.find(p=>p.product.id===e.id),o=t?t.quantity:0;if(o+i>e.quantity){alert(`Cannot add more. You already have ${o} in cart. Max stock is ${e.quantity}.`);return}t?t.quantity+=i:this.orderItems.push({product:e,quantity:i}),this.tempQuantities[e.id]=1}removeFromOrder(e){this.orderItems.splice(e,1)}get totalAmount(){return this.orderItems.reduce((e,i)=>e+i.product.price*i.quantity,0)}submitReservation(){return O(this,null,function*(){if(this.orderItems.length===0||!this.customerName||!this.customerContact||!this.pickupDate||!this.customerAddress){alert("Please fill in all required fields and add items to your reservation.");return}this.isSubmitting=!0;try{let e=new Date(this.pickupDate+(this.pickupTime?"T"+this.pickupTime:"T00:00:00")),i=`Payment: ${this.paymentOption||"Not Specified"}
Address: ${this.customerAddress}

${this.notes}`,t=null;this.customerService.getCustomers().subscribe(p=>{t=p.find(Z=>Z.phoneNumber===this.customerContact)}),yield new Promise(p=>setTimeout(p,100)),t||this.customerService.addCustomer({name:this.customerName,phoneNumber:this.customerContact,deliveryAddress:this.customerAddress}),yield this.reservationService.addReservation({customerName:this.customerName,customerContact:this.customerContact,customerAddress:this.customerAddress,reservationDate:new Date,pickupDate:e,status:"pending",items:this.orderItems.map(p=>({productId:p.product.id,productName:p.product.name,quantity:p.quantity,price:p.product.price})),totalAmount:this.totalAmount,notes:i});let o={name:this.customerName,phoneNumber:this.customerContact,address:this.customerAddress,gpsCoordinates:"",expiresAt:Date.now()+2*60*60*1e3};localStorage.setItem("chatCustomerInfo",JSON.stringify(o)),localStorage.setItem("chatUserName",this.customerName),this.successMessage="Reservation submitted successfully! We will contact you shortly. You can now chat with us!",this.resetForm()}catch(e){console.error("Error submitting reservation",e),alert("Failed to submit reservation. Please try again.")}finally{this.isSubmitting=!1}})}resetForm(){this.orderItems=[],this.customerName="",this.customerContact="",this.customerAddress="",this.paymentOption="",this.notes="",this.selectedProduct=null,this.pickupTime=""}static{this.\u0275fac=function(i){return new(i||a)(P(J),P(X),P(K))}}static{this.\u0275cmp=E({type:a,selectors:[["app-reservation"]],standalone:!0,features:[q],decls:9,vars:2,consts:[[1,"reservation-page"],[1,"reservation-container"],[1,"reservation-header"],["class","success-alert",4,"ngIf"],["class","reservation-form",4,"ngIf"],[1,"success-alert"],[1,"success-icon"],[1,"btn-primary",3,"click"],[1,"reservation-form"],[1,"form-section"],[1,"form-grid"],[1,"form-group"],["for","name"],["type","text","id","name","placeholder","Enter your name","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","contact"],["type","text","id","contact","placeholder","Phone number","required","",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-group","full-width",2,"grid-column","1 / -1"],["for","address"],["type","text","id","address","placeholder","Street, City, Province","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","payment"],["id","payment",1,"form-input",2,"height","42px",3,"ngModelChange","ngModel"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],[2,"margin-top","var(--space-lg)"],["for","date"],["type","date","id","date","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","time"],["type","time","id","time",1,"form-input",3,"ngModelChange","ngModel"],[1,"product-grid"],["class","product-card",4,"ngFor","ngForOf"],["class","form-section summary-section",4,"ngIf"],["class","empty-cart-msg",4,"ngIf"],[3,"value"],[1,"product-card"],[1,"card-image"],["loading","lazy",3,"src","alt",4,"ngIf"],["class","placeholder-img",4,"ngIf"],[1,"card-content"],[1,"card-title"],[1,"card-meta"],[1,"price"],[1,"stock"],[1,"card-actions"],[1,"qty-control"],["type","button",1,"qty-btn",3,"click"],["type","number","min","1",1,"qty-input-sm",3,"input","value","max"],[1,"btn-add-card",3,"click"],["loading","lazy",3,"src","alt"],[1,"placeholder-img"],[1,"form-section","summary-section"],[1,"order-list"],["class","order-item",4,"ngFor","ngForOf"],[1,"order-total"],[1,"total-price"],["for","notes"],["id","notes","rows","3","placeholder","Any special requests?",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"actions"],[1,"btn-submit",3,"click","disabled"],[1,"order-item"],[1,"item-info"],[1,"item-name"],[1,"item-details"],[1,"item-total"],["title","Remove",1,"btn-remove",3,"click"],[1,"empty-cart-msg"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),s(4,"\u{1F4C5} Make a Reservation"),n(),r(5,"p"),s(6,"Reserve items for pickup or delivery."),n()(),h(7,ne,7,1,"div",3)(8,le,42,10,"div",4),n()()),i&2&&(c(7),u("ngIf",t.successMessage),c(),u("ngIf",!t.successMessage))},dependencies:[z,N,A,W,G,L,Y,Q,U,B,$,j],styles:[".reservation-page[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:var(--space-md);background:var(--color-bg);background-image:radial-gradient(var(--color-border) 1px,transparent 1px);background-size:20px 20px}.reservation-container[_ngcontent-%COMP%]{width:100%;max-width:800px;background:var(--color-surface);border-radius:var(--radius-xl);box-shadow:0 4px 6px #0000001a;overflow:hidden;border:1px solid var(--color-border)}.reservation-header[_ngcontent-%COMP%]{padding:var(--space-xl) var(--space-lg);background:linear-gradient(135deg,var(--color-primary),var(--color-primary-dark));color:#fff;text-align:center}.reservation-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:var(--space-md);color:#fff}.reservation-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{opacity:.9;font-size:1.1rem}.reservation-form[_ngcontent-%COMP%]{padding:var(--space-xl)}.form-section[_ngcontent-%COMP%]{margin-bottom:var(--space-2xl);padding-bottom:var(--space-lg);border-bottom:1px solid var(--color-border)}.form-section[_ngcontent-%COMP%]:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:var(--color-text);margin-bottom:var(--space-md);text-transform:uppercase;letter-spacing:.5px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--space-md)}.form-group[_ngcontent-%COMP%]{margin-bottom:var(--space-md)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:var(--space-xs);color:var(--color-text);font-weight:500}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%], .form-textarea[_ngcontent-%COMP%]{width:100%;padding:var(--space-sm);border:1px solid var(--color-border);border-radius:var(--radius-md);background:var(--color-bg);color:var(--color-text);font-size:1rem;transition:border-color .2s}.form-input[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus, .form-textarea[_ngcontent-%COMP%]:focus{border-color:var(--color-primary);outline:none;box-shadow:0 0 0 3px #2563eb1a}.product-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:var(--space-sm);max-height:500px;overflow-y:auto;padding-right:4px}.product-card[_ngcontent-%COMP%]{background:var(--color-surface);border:1px solid var(--color-border);border-radius:var(--radius-md);overflow:hidden;transition:transform .2s,box-shadow .2s;display:flex;flex-direction:column}.product-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.card-image[_ngcontent-%COMP%]{height:100px;background:var(--color-bg);display:flex;align-items:center;justify-content:center;overflow:hidden}.card-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.placeholder-img[_ngcontent-%COMP%]{font-size:2rem;opacity:.5}.card-content[_ngcontent-%COMP%]{padding:var(--space-sm);flex:1;display:flex;flex-direction:column}.card-title[_ngcontent-%COMP%]{margin:0 0 2px;font-size:.9rem;font-weight:600;color:var(--color-text)}.card-meta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-sm);font-size:.8rem}.price[_ngcontent-%COMP%]{font-weight:700;color:var(--color-primary)}.stock[_ngcontent-%COMP%]{color:var(--color-text-muted)}.stock.low[_ngcontent-%COMP%]{color:var(--color-warning)}.card-actions[_ngcontent-%COMP%]{margin-top:auto;display:flex;flex-direction:column;gap:6px;align-items:stretch}.qty-control[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border:1px solid var(--color-border);border-radius:4px;overflow:hidden;background:var(--color-bg)}.qty-btn[_ngcontent-%COMP%]{background:var(--color-bg);border:none;width:24px;height:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem;z-index:2}.qty-btn[_ngcontent-%COMP%]:hover{background:var(--color-border)}.qty-input-sm[_ngcontent-%COMP%]{width:30px;border:none;text-align:center;font-size:.85rem;padding:0;height:24px;appearance:textfield}.qty-input-sm[_ngcontent-%COMP%]::-webkit-outer-spin-button, .qty-input-sm[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.btn-add-card[_ngcontent-%COMP%]{flex:1;background:var(--color-primary);color:#fff;border:none;border-radius:4px;height:26px;font-weight:600;cursor:pointer;transition:background .2s;font-size:.85rem}.btn-add-card[_ngcontent-%COMP%]:hover{background:var(--color-primary-dark)}.summary-section[_ngcontent-%COMP%]{background:var(--color-bg);padding:var(--space-lg);border-radius:var(--radius-lg)}.order-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--space-sm);margin-bottom:var(--space-lg)}.order-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--space-sm);background:var(--color-surface);border-radius:var(--radius-md);border:1px solid var(--color-border)}.item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.item-name[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text)}.item-details[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-muted)}.item-total[_ngcontent-%COMP%]{font-weight:600;color:var(--color-primary);display:flex;align-items:center;gap:var(--space-sm)}.btn-remove[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;border:none;background:var(--color-danger);color:#fff;font-size:.75rem;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.8;transition:.2s}.btn-remove[_ngcontent-%COMP%]:hover{opacity:1;transform:scale(1.1)}.order-total[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:var(--space-md);border-top:2px dashed var(--color-border);margin-bottom:var(--space-lg);font-size:1.25rem;font-weight:700;color:var(--color-text)}.total-price[_ngcontent-%COMP%]{color:var(--color-primary)}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.btn-submit[_ngcontent-%COMP%]{padding:var(--space-md) var(--space-2xl);background:var(--color-primary);color:#fff;border:none;border-radius:var(--radius-md);font-size:1.1rem;font-weight:600;cursor:pointer;box-shadow:0 4px 6px #0000001a;transition:transform .2s,box-shadow .2s}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 12px #00000026}.btn-submit[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:wait}.empty-cart-msg[_ngcontent-%COMP%]{text-align:center;padding:var(--space-2xl);color:var(--color-text-muted);font-style:italic}.success-alert[_ngcontent-%COMP%]{text-align:center;padding:var(--space-3xl) var(--space-xl)}.success-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:var(--space-md)}.success-alert[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.25rem;color:var(--color-text);margin-bottom:var(--space-xl)}.btn-primary[_ngcontent-%COMP%]{padding:var(--space-md) var(--space-xl);background:var(--color-primary);color:#fff;border:none;border-radius:var(--radius-md);font-weight:600;cursor:pointer}@media (max-width: 640px){.reservation-page[_ngcontent-%COMP%]{padding:0}.reservation-container[_ngcontent-%COMP%]{border-radius:0;min-height:100vh;border:none}.add-item-row[_ngcontent-%COMP%]{flex-wrap:wrap}.btn-add[_ngcontent-%COMP%]{width:100%;margin-bottom:0}}"]})}}return a})();export{Ce as a};
