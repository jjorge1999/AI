import{D as i,I as a,M as h,O as l}from"./chunk-RJGJFETA.js";import{M as c,R as u,g}from"./chunk-X3H5FUR6.js";import{g as o}from"./chunk-7QOE2ANW.js";var S=(()=>{class n{constructor(t){this.firebaseService=t,this.settingsDoc="app_settings",this.settingsSubject=new g({}),this.settings$=this.settingsSubject.asObservable(),this.unsubscribe=null,this.db=this.firebaseService.db,this.loadSettings()}loadSettings(){let t=i(this.db,"settings",this.settingsDoc);this.unsubscribe=h(t,s=>{if(s.exists()){let e=s.data();this.settingsSubject.next(e),e.huggingFaceToken&&localStorage.setItem("hf_token",e.huggingFaceToken)}else this.settingsSubject.next({})},s=>{console.warn("Settings listener error:",s);let e=localStorage.getItem("hf_token");e&&this.settingsSubject.next({huggingFaceToken:e})})}saveHuggingFaceToken(t){return o(this,null,function*(){let s=i(this.db,"settings",this.settingsDoc),e=localStorage.getItem("jjm_user_id")||"admin";try{yield a(s,{huggingFaceToken:t,gemmaEnabled:!0,updatedAt:new Date,updatedBy:e},{merge:!0}),localStorage.setItem("hf_token",t),console.log("Settings: Hugging Face token saved to database")}catch(r){throw console.error("Settings: Error saving token to database:",r),localStorage.setItem("hf_token",t),r}})}clearHuggingFaceToken(){return o(this,null,function*(){let t=i(this.db,"settings",this.settingsDoc),s=localStorage.getItem("jjm_user_id")||"admin";try{yield a(t,{huggingFaceToken:"",gemmaEnabled:!1,updatedAt:new Date,updatedBy:s},{merge:!0}),console.log("Settings: Hugging Face token cleared from database")}catch(e){throw console.error("Settings: Error clearing token from database:",e),e}})}getSettings(){return this.settings$}getHuggingFaceToken(){return this.settingsSubject.value.huggingFaceToken||localStorage.getItem("hf_token")}isGemmaConfigured(){let t=this.getHuggingFaceToken();return!!t&&t.startsWith("hf_")}ngOnDestroy(){this.unsubscribe&&this.unsubscribe()}static{this.\u0275fac=function(s){return new(s||n)(u(l))}}static{this.\u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{S as a};
