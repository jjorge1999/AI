import{a as l,d as p}from"./chunk-HTVRMZMJ.js";import{R as a,W as h,a as i,b as c,l as n,t as m}from"./chunk-MNIEKAC2.js";var C=(()=>{class s{constructor(t){this.http=t,this.apiUrl=p.apiUrl,this.customersSubject=new n([]),this.customers$=this.customersSubject.asObservable()}loadCustomers(){this.fetchCustomers()}loadInitialData(){this.fetchCustomers()}getCurrentUser(){return localStorage.getItem("jjm_user_id")||"guest"}reloadData(){this.loadInitialData()}fetchCustomers(){let t=this.getCurrentUser();!t||t==="guest"||this.http.get(`${this.apiUrl}/customers?userId=${t}`).subscribe({next:e=>this.customersSubject.next(e),error:e=>console.error("Error fetching customers:",e)})}getCustomers(){return this.customers$}getCustomerByName(t){return this.http.get(`${this.apiUrl}/customers?name=${encodeURIComponent(t)}`).pipe(m(e=>e.map(r=>c(i({},r),{phoneNumber:"***",deliveryAddress:"***",gpsCoordinates:"***",userId:"***"}))))}addCustomer(t){let e=c(i({},t),{userId:this.getCurrentUser()});this.http.post(`${this.apiUrl}/customers`,e).subscribe({next:r=>{let o=this.customersSubject.value;this.customersSubject.next([...o,r])},error:r=>console.error("Error adding customer:",r)})}updateCustomer(t,e){this.http.put(`${this.apiUrl}/customers/${t}`,e).subscribe({next:()=>{let o=this.customersSubject.value.map(u=>u.id===t?i(i({},u),e):u);this.customersSubject.next(o)},error:r=>console.error("Error updating customer:",r)})}deleteCustomer(t){this.http.delete(`${this.apiUrl}/customers/${t}`).subscribe({next:()=>{let r=this.customersSubject.value.filter(o=>o.id!==t);this.customersSubject.next(r)},error:e=>console.error("Error deleting customer:",e)})}getCustomerById(t){return this.customersSubject.value.find(e=>e.id===t)}static{this.\u0275fac=function(e){return new(e||s)(h(l))}}static{this.\u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{C as a};
