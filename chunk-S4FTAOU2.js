import{P as a,U as n,g,mc as u,pc as h,qc as p}from"./chunk-BT24UGZY.js";var j=(()=>{class r{constructor(e,t){this.http=e,this.storeService=t,this.apiUrl=h.apiUrl,this.logsSubject=new g([]),this.logs$=this.logsSubject.asObservable()}getCurrentUserId(){return localStorage.getItem("jjm_user_id")||"guest"}fetchLogs(){let e=this.getCurrentUserId(),t=this.storeService.getActiveStoreId();if(!e||e==="guest"||!t){t||this.logsSubject.next([]);return}let i=`${this.apiUrl}/logs?limit=200&userId=${e}&storeId=${t}`;this.http.get(i).subscribe({next:o=>this.logsSubject.next(o),error:o=>console.error("Error fetching logs:",o)})}logActivity(e,t,i,o,d){let l=this.storeService.getActiveStoreId();if(!l){console.warn("Logging skipped: No active store selected.");return}let c={action:e,entityType:t,entityId:i,entityName:o,details:d,userId:this.getCurrentUserId(),storeId:l};console.log("Logging activity:",c),this.http.post(`${this.apiUrl}/logs`,c).subscribe({next:s=>{console.log("Activity logged successfully:",s);let f=this.logsSubject.value;this.logsSubject.next([s,...f])},error:s=>{console.error("Error logging activity:",s),console.error("Failed log data:",c)}})}getLogs(){return this.logs$}refreshLogs(){this.fetchLogs()}cleanupOldLogs(){return this.http.post(`${this.apiUrl}/cleanup-logs`,{})}static{this.\u0275fac=function(t){return new(t||r)(n(u),n(p))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{j as a};
