import{a as Tf}from"./chunk-BLEW7JQR.js";import{a as Sf}from"./chunk-C22AYKM7.js";import{a as Af}from"./chunk-VQ4E3VRM.js";import{a as xf}from"./chunk-YU4DQFE6.js";import{a as mf}from"./chunk-KT3FP3MX.js";import{a as pf}from"./chunk-UO3WJVEX.js";import{a as yf}from"./chunk-34LYPFBA.js";import{a as vf}from"./chunk-PN7KSEND.js";import{a as wf}from"./chunk-OF63JBK6.js";import{a as Cf}from"./chunk-F4W2ZRPF.js";import{a as If}from"./chunk-CSVFG4SI.js";import{a as gf}from"./chunk-KSHKVDE3.js";import"./chunk-YBL43BVC.js";import{a as Ef}from"./chunk-KU7VL7DS.js";import{a as bf}from"./chunk-5TFQBXGH.js";import{a as _f}from"./chunk-VYKVMX3Y.js";import{a as of,b as af,c as cf,d as uf,e as lf,f as hf,m as df,n as ff}from"./chunk-ZPQL42FH.js";import{b as rf,c as sf,d as Ts}from"./chunk-IO3I47CY.js";import{$ as Fd,$a as _t,A as Aa,Aa as Gd,Ab as tf,B as xt,Ba as Hd,Bb as Ba,C as Dd,Ca as fe,Cb as nf,D as Kn,E as Xt,Ea as z,F as xa,Fa as Kd,G as Md,Ga as Me,H as kd,Ha as Na,I as Od,Ia as S,J as mt,Ja as x,K as Nd,Ka as ve,L as Fe,La as Ue,M as De,Ma as ee,Na as F,O as ue,Oa as Va,Pa as bs,Q as Vd,Qa as Cs,R as rt,S as Ra,Sa as N,T as be,Ta as xe,U as G,Ua as je,V as Xr,X as gt,Xa as Wn,Ya as Qn,Z as Ld,Za as Yn,_ as Pa,a as j,aa as ys,b as we,ba as Cn,c as P,ca as vs,d as Sd,da as W,e as Ad,ea as Q,fa as Da,fb as Is,g as Ia,ga as Ud,gb as Wd,h as Ea,ha as Ma,hb as Qd,i as pt,ib as La,j as ye,ja as In,jb as Fa,k as Jt,ka as jd,kb as Ua,l as at,la as ka,lb as Yd,m as J,ma as Bd,n as Yr,na as Zr,nb as ja,o as xd,oa as Oa,ob as Jd,p as Rd,pa as ws,pb as Xd,qa as ei,qb as yt,r as de,ra as ti,rb as Es,s as Ta,sa as M,sb as Zd,t as nt,ta as Qe,tb as ef,u as Pd,ua as zd,ub as Zt,v as Sa,wa as Rt,x as Gn,xa as qd,y as Hn,z as Jr,za as $d,zb as Pt}from"./chunk-K7VUYT6X.js";var $a=class extends Xd{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Ga=class n extends $a{static makeCurrent(){Jd(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=uy();return t==null?null:ly(t)}resetBaseElement(){ni=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Zd(document.cookie,e)}},ni=null;function uy(){return ni=ni||document.querySelector("base"),ni?ni.getAttribute("href"):null}function ly(n){return new URL(n,document.baseURI).pathname}var hy=(()=>{class n{build(){return new XMLHttpRequest}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac})}}return n})(),Ha=new rt(""),Mf=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(s=>s.supports(t)),!r)throw new De(5101,!1);return this._eventNameToPlugin.set(t,r),r}static{this.\u0275fac=function(r){return new(r||n)(be(Ha),be(Rt))}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac})}}return n})(),Ss=class{constructor(e){this._doc=e}},za="ng-app-id",kf=(()=>{class n{constructor(t,r,i,s={}){this.doc=t,this.appId=r,this.nonce=i,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Ba(s),this.resetHostNodes()}addStyles(t){for(let r of t)this.changeUsageCount(r,1)===1&&this.onStyleAdded(r)}removeStyles(t){for(let r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){let t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(let r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(let r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(let r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){let r=this.styleRef;r.get(t)?.elements?.forEach(i=>i.remove()),r.delete(t)}collectServerRenderedStyles(){let t=this.doc.head?.querySelectorAll(`style[${za}="${this.appId}"]`);if(t?.length){let r=new Map;return t.forEach(i=>{i.textContent!=null&&r.set(i.textContent,i)}),r}return null}changeUsageCount(t,r){let i=this.styleRef;if(i.has(t)){let s=i.get(t);return s.usage+=r,s.usage}return i.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){let i=this.styleNodesInDOM,s=i?.get(r);if(s?.parentNode===t)return i.delete(r),s.removeAttribute(za),s;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=r,this.platformIsServer&&a.setAttribute(za,this.appId),t.appendChild(a),a}}addStyleToHost(t,r){let i=this.getStyleElement(t,r),s=this.styleRef,a=s.get(r)?.elements;a?a.push(i):s.set(r,{elements:[i],usage:1})}resetHostNodes(){let t=this.hostNodes;t.clear(),t.add(this.doc.head)}static{this.\u0275fac=function(r){return new(r||n)(be(yt),be(ka),be(Oa,8),be(Zr))}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac})}}return n})(),qa={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Wa=/%COMP%/g,Of="%COMP%",dy=`_nghost-${Of}`,fy=`_ngcontent-${Of}`,py=!0,my=new rt("",{providedIn:"root",factory:()=>py});function gy(n){return fy.replace(Wa,n)}function _y(n){return dy.replace(Wa,n)}function Nf(n,e){return e.map(t=>t.replace(Wa,n))}var Rf=(()=>{class n{constructor(t,r,i,s,a,c,l,d=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=s,this.doc=a,this.platformId=c,this.ngZone=l,this.nonce=d,this.rendererByCompId=new Map,this.platformIsServer=Ba(c),this.defaultRenderer=new ri(t,a,l,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Xr.ShadowDom&&(r=we(j({},r),{encapsulation:Xr.Emulated}));let i=this.getOrCreateRenderer(t,r);return i instanceof As?i.applyToHost(t):i instanceof ii&&i.applyStyles(),i}getOrCreateRenderer(t,r){let i=this.rendererByCompId,s=i.get(r.id);if(!s){let a=this.doc,c=this.ngZone,l=this.eventManager,d=this.sharedStylesHost,p=this.removeStylesOnCompDestroy,m=this.platformIsServer;switch(r.encapsulation){case Xr.Emulated:s=new As(l,d,r,this.appId,p,a,c,m);break;case Xr.ShadowDom:return new Ka(l,d,t,r,a,c,this.nonce,m);default:s=new ii(l,d,r,p,a,c,m);break}i.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(r){return new(r||n)(be(Mf),be(kf),be(ka),be(my),be(yt),be(Zr),be(Rt),be(Oa))}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac})}}return n})(),ri=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(qa[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(Pf(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(Pf(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new De(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=qa[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=qa[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(ti.DashCase|ti.Important)?e.style.setProperty(t,r,i&ti.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&ti.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=ja().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function Pf(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Ka=class extends ri{constructor(e,t,r,i,s,a,c,l){super(e,s,a,l),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let d=Nf(i.id,i.styles);for(let p of d){let m=document.createElement("style");c&&m.setAttribute("nonce",c),m.textContent=p,this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},ii=class extends ri{constructor(e,t,r,i,s,a,c,l){super(e,s,a,c),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=l?Nf(l,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},As=class extends ii{constructor(e,t,r,i,s,a,c,l){let d=i+"-"+r.id;super(e,t,r,s,a,c,l,d),this.contentAttr=gy(d),this.hostAttr=_y(d)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},yy=(()=>{class n extends Ss{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}static{this.\u0275fac=function(r){return new(r||n)(be(yt))}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac})}}return n})(),Df=["alt","control","meta","shift"],vy={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},wy={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},by=(()=>{class n extends Ss{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,r,i){let s=n.parseEventName(r),a=n.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ja().onAndCancel(t,s.domEventName,a))}static parseEventName(t){let r=t.toLowerCase().split("."),i=r.shift();if(r.length===0||!(i==="keydown"||i==="keyup"))return null;let s=n._normalizeKey(r.pop()),a="",c=r.indexOf("code");if(c>-1&&(r.splice(c,1),a="code."),Df.forEach(d=>{let p=r.indexOf(d);p>-1&&(r.splice(p,1),a+=d+".")}),a+=s,r.length!=0||s.length===0)return null;let l={};return l.domEventName=i,l.fullKey=a,l}static matchEventFullKeyCode(t,r){let i=vy[t.key]||t.key,s="";return r.indexOf("code.")>-1&&(i=t.code,s="code."),i==null||!i?!1:(i=i.toLowerCase(),i===" "?i="space":i==="."&&(i="dot"),Df.forEach(a=>{if(a!==i){let c=wy[a];c(t)&&(s+=a+".")}}),s+=i,s===r)}static eventCallback(t,r,i){return s=>{n.matchEventFullKeyCode(s,t)&&i.runGuarded(()=>r(s))}}static _normalizeKey(t){return t==="esc"?"escape":t}static{this.\u0275fac=function(r){return new(r||n)(be(yt))}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac})}}return n})();function Vf(n,e){return Yd(j({rootComponent:n},Cy(e)))}function Cy(n){return{appProviders:[...Ay,...n?.providers??[]],platformProviders:Sy}}function Iy(){Ga.makeCurrent()}function Ey(){return new Ma}function Ty(){return jd(document),document}var Sy=[{provide:Zr,useValue:tf},{provide:Bd,useValue:Iy,multi:!0},{provide:yt,useFactory:Ty,deps:[]}];var Ay=[{provide:Fd,useValue:"root"},{provide:Ma,useFactory:Ey,deps:[]},{provide:Ha,useClass:yy,multi:!0,deps:[yt,Rt,Zr]},{provide:Ha,useClass:by,multi:!0,deps:[yt]},Rf,kf,Mf,{provide:zd,useExisting:Rf},{provide:nf,useClass:hy,deps:[]},[]];var Lf=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static{this.\u0275fac=function(r){return new(r||n)(be(yt))}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var X="primary",vi=Symbol("RouteTitle"),Za=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function tr(n){return new Za(n)}function Ry(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let a=r[s],c=n[s];if(a.startsWith(":"))i[a.substring(1)]=c;else if(a!==c.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function Py(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!vt(n[t],e[t]))return!1;return!0}function vt(n,e){let t=n?ec(n):void 0,r=e?ec(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!qf(n[i],e[i]))return!1;return!0}function ec(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function qf(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function $f(n){return n.length>0?n[n.length-1]:null}function rn(n){return xd(n)?n:Wd(n)?at(Promise.resolve(n)):J(n)}var Dy={exact:Hf,subset:Kf},Gf={exact:My,subset:ky,ignored:()=>!0};function Ff(n,e,t){return Dy[t.paths](n.root,e.root,t.matrixParams)&&Gf[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function My(n,e){return vt(n,e)}function Hf(n,e,t){if(!Tn(n.segments,e.segments)||!Ps(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!Hf(n.children[r],e.children[r],t))return!1;return!0}function ky(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>qf(n[t],e[t]))}function Kf(n,e,t){return Wf(n,e,e.segments,t)}function Wf(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!Tn(i,t)||e.hasChildren()||!Ps(i,t,r))}else if(n.segments.length===t.length){if(!Tn(n.segments,t)||!Ps(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!Kf(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Tn(n.segments,i)||!Ps(n.segments,i,r)||!n.children[X]?!1:Wf(n.children[X],e,s,r)}}function Ps(n,e,t){return e.every((r,i)=>Gf[t](n[i].parameters,r.parameters))}var tn=class{constructor(e=new ae([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=tr(this.queryParams),this._queryParamMap}toString(){return Vy.serialize(this)}},ae=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ds(this)}},En=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=tr(this.parameters),this._parameterMap}toString(){return Yf(this)}};function Oy(n,e){return Tn(n,e)&&n.every((t,r)=>vt(t.parameters,e[r].parameters))}function Tn(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function Ny(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===X&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==X&&(t=t.concat(e(i,r)))}),t}var Sc=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:()=>new ks,providedIn:"root"})}}return n})(),ks=class{parse(e){let t=new nc(e);return new tn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${si(e.root,!0)}`,r=Uy(e.queryParams),i=typeof e.fragment=="string"?`#${Ly(e.fragment)}`:"";return`${t}${r}${i}`}},Vy=new ks;function Ds(n){return n.segments.map(e=>Yf(e)).join("/")}function si(n,e){if(!n.hasChildren())return Ds(n);if(e){let t=n.children[X]?si(n.children[X],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==X&&r.push(`${i}:${si(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=Ny(n,(r,i)=>i===X?[si(n.children[X],!1)]:[`${i}:${si(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[X]!=null?`${Ds(n)}/${t[0]}`:`${Ds(n)}/(${t.join("//")})`}}function Qf(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function xs(n){return Qf(n).replace(/%3B/gi,";")}function Ly(n){return encodeURI(n)}function tc(n){return Qf(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ms(n){return decodeURIComponent(n)}function Uf(n){return Ms(n.replace(/\+/g,"%20"))}function Yf(n){return`${tc(n.path)}${Fy(n.parameters)}`}function Fy(n){return Object.entries(n).map(([e,t])=>`;${tc(e)}=${tc(t)}`).join("")}function Uy(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${xs(t)}=${xs(i)}`).join("&"):`${xs(t)}=${xs(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var jy=/^[^\/()?;#]+/;function Qa(n){let e=n.match(jy);return e?e[0]:""}var By=/^[^\/()?;=#]+/;function zy(n){let e=n.match(By);return e?e[0]:""}var qy=/^[^=?&#]+/;function $y(n){let e=n.match(qy);return e?e[0]:""}var Gy=/^[^&#]+/;function Hy(n){let e=n.match(Gy);return e?e[0]:""}var nc=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new ae([],{}):new ae([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[X]=new ae(e,t)),r}parseSegment(){let e=Qa(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new De(4009,!1);return this.capture(e),new En(Ms(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=zy(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=Qa(this.remaining);i&&(r=i,this.capture(r))}e[Ms(t)]=Ms(r)}parseQueryParam(e){let t=$y(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let a=Hy(this.remaining);a&&(r=a,this.capture(r))}let i=Uf(t),s=Uf(r);if(e.hasOwnProperty(i)){let a=e[i];Array.isArray(a)||(a=[a],e[i]=a),a.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=Qa(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new De(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=X);let a=this.parseChildren();t[s]=Object.keys(a).length===1?a[X]:new ae([],a),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new De(4011,!1)}};function Jf(n){return n.segments.length>0?new ae([],{[X]:n}):n}function Xf(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=Xf(i);if(r===X&&s.segments.length===0&&s.hasChildren())for(let[a,c]of Object.entries(s.children))e[a]=c;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new ae(n.segments,e);return Ky(t)}function Ky(n){if(n.numberOfChildren===1&&n.children[X]){let e=n.children[X];return new ae(n.segments.concat(e.segments),e.children)}return n}function nr(n){return n instanceof tn}function Wy(n,e,t=null,r=null){let i=Zf(n);return ep(i,e,t,r)}function Zf(n){let e;function t(s){let a={};for(let l of s.children){let d=t(l);a[l.outlet]=d}let c=new ae(s.url,a);return s===n&&(e=c),c}let r=t(n.root),i=Jf(r);return e??i}function ep(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Ya(i,i,i,t,r);let s=Qy(e);if(s.toRoot())return Ya(i,i,new ae([],{}),t,r);let a=Yy(s,i,n),c=a.processChildren?ci(a.segmentGroup,a.index,s.commands):np(a.segmentGroup,a.index,s.commands);return Ya(i,a.segmentGroup,c,t,r)}function Os(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function hi(n){return typeof n=="object"&&n!=null&&n.outlets}function Ya(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([l,d])=>{s[l]=Array.isArray(d)?d.map(p=>`${p}`):`${d}`});let a;n===e?a=t:a=tp(n,e,t);let c=Jf(Xf(a));return new tn(c,s,i)}function tp(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=tp(s,e,t)}),new ae(n.segments,r)}var Ns=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Os(r[0]))throw new De(4003,!1);let i=r.find(hi);if(i&&i!==$f(r))throw new De(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Qy(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Ns(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,a)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let c={};return Object.entries(s.outlets).forEach(([l,d])=>{c[l]=typeof d=="string"?d.split("/"):d}),[...i,{outlets:c}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:a===0?(s.split("/").forEach((c,l)=>{l==0&&c==="."||(l==0&&c===""?t=!0:c===".."?e++:c!=""&&i.push(c))}),i):[...i,s]},[]);return new Ns(t,e,r)}var Zn=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function Yy(n,e,t){if(n.isAbsolute)return new Zn(e,!0,0);if(!t)return new Zn(e,!1,NaN);if(t.parent===null)return new Zn(t,!0,0);let r=Os(n.commands[0])?0:1,i=t.segments.length-1+r;return Jy(t,i,n.numberOfDoubleDots)}function Jy(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new De(4005,!1);i=r.segments.length}return new Zn(r,!1,i-s)}function Xy(n){return hi(n[0])?n[0].outlets:{[X]:n}}function np(n,e,t){if(n??=new ae([],{}),n.segments.length===0&&n.hasChildren())return ci(n,e,t);let r=Zy(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new ae(n.segments.slice(0,r.pathIndex),{});return s.children[X]=new ae(n.segments.slice(r.pathIndex),n.children),ci(s,0,i)}else return r.match&&i.length===0?new ae(n.segments,{}):r.match&&!n.hasChildren()?rc(n,e,t):r.match?ci(n,0,i):rc(n,e,t)}function ci(n,e,t){if(t.length===0)return new ae(n.segments,{});{let r=Xy(t),i={};if(Object.keys(r).some(s=>s!==X)&&n.children[X]&&n.numberOfChildren===1&&n.children[X].segments.length===0){let s=ci(n.children[X],e,t);return new ae(n.segments,s.children)}return Object.entries(r).forEach(([s,a])=>{typeof a=="string"&&(a=[a]),a!==null&&(i[s]=np(n.children[s],e,a))}),Object.entries(n.children).forEach(([s,a])=>{r[s]===void 0&&(i[s]=a)}),new ae(n.segments,i)}}function Zy(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let a=n.segments[i],c=t[r];if(hi(c))break;let l=`${c}`,d=r<t.length-1?t[r+1]:null;if(i>0&&l===void 0)break;if(l&&d&&typeof d=="object"&&d.outlets===void 0){if(!Bf(l,d,a))return s;r+=2}else{if(!Bf(l,{},a))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function rc(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(hi(s)){let l=ev(s.outlets);return new ae(r,l)}if(i===0&&Os(t[0])){let l=n.segments[e];r.push(new En(l.path,jf(t[0]))),i++;continue}let a=hi(s)?s.outlets[X]:`${s}`,c=i<t.length-1?t[i+1]:null;a&&c&&Os(c)?(r.push(new En(a,jf(c))),i+=2):(r.push(new En(a,{})),i++)}return new ae(r,{})}function ev(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=rc(new ae([],{}),0,r))}),e}function jf(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function Bf(n,e,t){return n==t.path&&vt(e,t.parameters)}var ui="imperative",Ve=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Ve||{}),it=class{constructor(e,t){this.id=e,this.url=t}},di=class extends it{constructor(e,t,r="imperative",i=null){super(e,t),this.type=Ve.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Sn=class extends it{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=Ve.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Je=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Je||{}),ic=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(ic||{}),nn=class extends it{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Ve.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},An=class extends it{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Ve.NavigationSkipped}},fi=class extends it{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=Ve.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Vs=class extends it{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ve.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sc=class extends it{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ve.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},oc=class extends it{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=Ve.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},ac=class extends it{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ve.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},cc=class extends it{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ve.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},uc=class{constructor(e){this.route=e,this.type=Ve.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},lc=class{constructor(e){this.route=e,this.type=Ve.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},hc=class{constructor(e){this.snapshot=e,this.type=Ve.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},dc=class{constructor(e){this.snapshot=e,this.type=Ve.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},fc=class{constructor(e){this.snapshot=e,this.type=Ve.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},pc=class{constructor(e){this.snapshot=e,this.type=Ve.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var pi=class{},mi=class{constructor(e){this.url=e}};var mc=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new zs,this.attachRef=null}},zs=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){let i=this.getOrCreateContext(t);i.outlet=r,this.contexts.set(t,i)}onChildOutletDestroyed(t){let r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new mc,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Ls=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=gc(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=gc(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=_c(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return _c(e,this._root).map(t=>t.value)}};function gc(n,e){if(n===e.value)return e;for(let t of e.children){let r=gc(n,t);if(r)return r}return null}function _c(n,e){if(n===e.value)return[e];for(let t of e.children){let r=_c(n,t);if(r.length)return r.unshift(e),r}return[]}var Ye=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Xn(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Fs=class extends Ls{constructor(e,t){super(e),this.snapshot=t,xc(this,e)}toString(){return this.snapshot.toString()}};function rp(n){let e=tv(n),t=new ye([new En("",{})]),r=new ye({}),i=new ye({}),s=new ye({}),a=new ye(""),c=new rr(t,r,s,a,i,X,n,e.root);return c.snapshot=e.root,new Fs(new Ye(c,[]),e)}function tv(n){let e={},t={},r={},i="",s=new gi([],e,r,i,t,X,n,null,{});return new Us("",new Ye(s,[]))}var rr=class{constructor(e,t,r,i,s,a,c,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=a,this.component=c,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(de(d=>d[vi]))??J(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(de(e=>tr(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(de(e=>tr(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Ac(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:j(j({},e.params),n.params),data:j(j({},e.data),n.data),resolve:j(j(j(j({},n.data),e.data),i?.data),n._resolvedData)}:r={params:j({},n.params),data:j({},n.data),resolve:j(j({},n.data),n._resolvedData??{})},i&&sp(i)&&(r.resolve[vi]=i.title),r}var gi=class{get title(){return this.data?.[vi]}constructor(e,t,r,i,s,a,c,l,d){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=a,this.component=c,this.routeConfig=l,this._resolve=d}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=tr(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=tr(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Us=class extends Ls{constructor(e,t){super(t),this.url=e,xc(this,t)}toString(){return ip(this._root)}};function xc(n,e){e.value._routerState=n,e.children.forEach(t=>xc(n,t))}function ip(n){let e=n.children.length>0?` { ${n.children.map(ip).join(", ")} } `:"";return`${n.value}${e}`}function Ja(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,vt(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),vt(e.params,t.params)||n.paramsSubject.next(t.params),Py(e.url,t.url)||n.urlSubject.next(t.url),vt(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function yc(n,e){let t=vt(n.params,e.params)&&Oy(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||yc(n.parent,e.parent))}function sp(n){return typeof n.title=="string"||n.title===null}var nv=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=X,this.activateEvents=new In,this.deactivateEvents=new In,this.attachEvents=new In,this.detachEvents=new In,this.parentContexts=G(zs),this.location=G(qd),this.changeDetector=G(Ua),this.environmentInjector=G(ys),this.inputBinder=G(Rc,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){let{firstChange:r,previousValue:i}=t.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new De(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new De(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new De(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new De(4013,!1);this._activatedRoute=t;let i=this.location,a=t.snapshot.component,c=this.parentContexts.getOrCreateContext(this.name).children,l=new vc(t,c,i.injector);this.activated=i.createComponent(a,{index:i.length,injector:l,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=Ld({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[vs]})}}return n})(),vc=class n{__ngOutletInjector(e){return new n(this.route,this.childContexts,e)}constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===rr?this.route:e===zs?this.childContexts:this.parent.get(e,t)}},Rc=new rt("");function rv(n,e,t){let r=_i(n,e._root,t?t._root:void 0);return new Fs(r,e)}function _i(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=iv(n,e,t);return new Ye(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let a=s.route;return a.value._futureSnapshot=e.value,a.children=e.children.map(c=>_i(n,c)),a}}let r=sv(e.value),i=e.children.map(s=>_i(n,s));return new Ye(r,i)}}function iv(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return _i(n,r,i);return _i(n,r)})}function sv(n){return new rr(new ye(n.url),new ye(n.params),new ye(n.queryParams),new ye(n.fragment),new ye(n.data),n.outlet,n.component,n)}var op="ngNavigationCancelingError";function ap(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=nr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=cp(!1,Je.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function cp(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[op]=!0,t.cancellationCode=e,t}function ov(n){return up(n)&&nr(n.url)}function up(n){return!!n&&n[op]}var av=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=gt({type:n,selectors:[["ng-component"]],standalone:!0,features:[_t],decls:1,vars:0,template:function(r,i){r&1&&ve(0,"router-outlet")},dependencies:[nv],encapsulation:2})}}return n})();function cv(n,e){return n.providers&&!n._injector&&(n._injector=Gd(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Pc(n){let e=n.children&&n.children.map(Pc),t=e?we(j({},n),{children:e}):j({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==X&&(t.component=av),t}function wt(n){return n.outlet||X}function uv(n,e){let t=n.filter(r=>wt(r)===e);return t.push(...n.filter(r=>wt(r)!==e)),t}function wi(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var lv=(n,e,t,r)=>de(i=>(new wc(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),wc=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Ja(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=Xn(t);e.children.forEach(s=>{let a=s.value.outlet;this.deactivateRoutes(s,i[a],r),delete i[a]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let a=r.getContext(i.outlet);a&&this.deactivateChildRoutes(e,t,a.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Xn(e);for(let a of Object.values(s))this.deactivateRouteAndItsChildren(a,i);if(r&&r.outlet){let a=r.outlet.detach(),c=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:a,route:e,contexts:c})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Xn(e);for(let a of Object.values(s))this.deactivateRouteAndItsChildren(a,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=Xn(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new pc(s.value.snapshot))}),e.children.length&&this.forwardEvent(new dc(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(Ja(i),i===s)if(i.component){let a=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,a.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let a=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let c=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),a.children.onOutletReAttached(c.contexts),a.attachRef=c.componentRef,a.route=c.route.value,a.outlet&&a.outlet.attach(c.componentRef,c.route.value),Ja(c.route.value),this.activateChildRoutes(e,null,a.children)}else{let c=wi(i.snapshot);a.attachRef=null,a.route=i,a.injector=c,a.outlet&&a.outlet.activateWith(i,a.injector),this.activateChildRoutes(e,null,a.children)}}else this.activateChildRoutes(e,null,r)}},js=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},er=class{constructor(e,t){this.component=e,this.route=t}};function hv(n,e,t){let r=n._root,i=e?e._root:null;return oi(r,i,t,[r.value])}function dv(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function sr(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!Vd(n)?n:e.get(n):r}function oi(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Xn(e);return n.children.forEach(a=>{fv(a,s[a.value.outlet],t,r.concat([a.value]),i),delete s[a.value.outlet]}),Object.entries(s).forEach(([a,c])=>li(c,t.getContext(a),i)),i}function fv(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,a=e?e.value:null,c=t?t.getContext(n.value.outlet):null;if(a&&s.routeConfig===a.routeConfig){let l=pv(a,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new js(r)):(s.data=a.data,s._resolvedData=a._resolvedData),s.component?oi(n,e,c?c.children:null,r,i):oi(n,e,t,r,i),l&&c&&c.outlet&&c.outlet.isActivated&&i.canDeactivateChecks.push(new er(c.outlet.component,a))}else a&&li(e,c,i),i.canActivateChecks.push(new js(r)),s.component?oi(n,null,c?c.children:null,r,i):oi(n,null,t,r,i);return i}function pv(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Tn(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Tn(n.url,e.url)||!vt(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!yc(n,e)||!vt(n.queryParams,e.queryParams);case"paramsChange":default:return!yc(n,e)}}function li(n,e,t){let r=Xn(n),i=n.value;Object.entries(r).forEach(([s,a])=>{i.component?e?li(a,e.children.getContext(s),t):li(a,null,t):li(a,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new er(e.outlet.component,i)):t.canDeactivateChecks.push(new er(null,i)):t.canDeactivateChecks.push(new er(null,i))}function bi(n){return typeof n=="function"}function mv(n){return typeof n=="boolean"}function gv(n){return n&&bi(n.canLoad)}function _v(n){return n&&bi(n.canActivate)}function yv(n){return n&&bi(n.canActivateChild)}function vv(n){return n&&bi(n.canDeactivate)}function wv(n){return n&&bi(n.canMatch)}function lp(n){return n instanceof Rd||n?.name==="EmptyError"}var Rs=Symbol("INITIAL_VALUE");function ir(){return mt(n=>Ta(n.map(e=>e.pipe(xt(1),Od(Rs)))).pipe(de(e=>{for(let t of e)if(t!==!0){if(t===Rs)return Rs;if(t===!1||t instanceof tn)return t}return!0}),Gn(e=>e!==Rs),xt(1)))}function bv(n,e){return nt(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:a}}=t;return a.length===0&&s.length===0?J(we(j({},t),{guardsResult:!0})):Cv(a,r,i,n).pipe(nt(c=>c&&mv(c)?Iv(r,s,n,e):J(c)),de(c=>we(j({},t),{guardsResult:c})))})}function Cv(n,e,t,r){return at(n).pipe(nt(i=>xv(i.component,i.route,t,e,r)),Xt(i=>i!==!0,!0))}function Iv(n,e,t,r){return at(e).pipe(Jr(i=>Pd(Tv(i.route.parent,r),Ev(i.route,r),Av(n,i.path,t),Sv(n,i.route,t))),Xt(i=>i!==!0,!0))}function Ev(n,e){return n!==null&&e&&e(new fc(n)),J(!0)}function Tv(n,e){return n!==null&&e&&e(new hc(n)),J(!0)}function Sv(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return J(!0);let i=r.map(s=>Sa(()=>{let a=wi(e)??t,c=sr(s,a),l=_v(c)?c.canActivate(e,n):Cn(a,()=>c(e,n));return rn(l).pipe(Xt())}));return J(i).pipe(ir())}function Av(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(a=>dv(a)).filter(a=>a!==null).map(a=>Sa(()=>{let c=a.guards.map(l=>{let d=wi(a.node)??t,p=sr(l,d),m=yv(p)?p.canActivateChild(r,n):Cn(d,()=>p(r,n));return rn(m).pipe(Xt())});return J(c).pipe(ir())}));return J(s).pipe(ir())}function xv(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return J(!0);let a=s.map(c=>{let l=wi(e)??i,d=sr(c,l),p=vv(d)?d.canDeactivate(n,e,t,r):Cn(l,()=>d(n,e,t,r));return rn(p).pipe(Xt())});return J(a).pipe(ir())}function Rv(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return J(!0);let s=i.map(a=>{let c=sr(a,n),l=gv(c)?c.canLoad(e,t):Cn(n,()=>c(e,t));return rn(l)});return J(s).pipe(ir(),hp(r))}function hp(n){return Ad(Fe(e=>{if(nr(e))throw ap(n,e)}),de(e=>e===!0))}function Pv(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return J(!0);let s=i.map(a=>{let c=sr(a,n),l=wv(c)?c.canMatch(e,t):Cn(n,()=>c(e,t));return rn(l)});return J(s).pipe(ir(),hp(r))}var yi=class{constructor(e){this.segmentGroup=e||null}},Bs=class extends Error{constructor(e){super(),this.urlTree=e}};function Jn(n){return Yr(new yi(n))}function Dv(n){return Yr(new De(4e3,!1))}function Mv(n){return Yr(cp(!1,Je.GuardRejected))}var bc=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return J(r);if(i.numberOfChildren>1||!i.children[X])return Dv(e.redirectTo);i=i.children[X]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new Bs(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new tn(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let c=s.substring(1);r[i]=t[c]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),a={};return Object.entries(t.children).forEach(([c,l])=>{a[c]=this.createSegmentGroup(e,l,r,i)}),new ae(s,a)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new De(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},Cc={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function kv(n,e,t,r,i){let s=Dc(n,e,t);return s.matched?(r=cv(e,r),Pv(r,e,t,i).pipe(de(a=>a===!0?s:j({},Cc)))):J(s)}function Dc(n,e,t){if(e.path==="**")return Ov(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?j({},Cc):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||Ry)(t,n,e);if(!i)return j({},Cc);let s={};Object.entries(i.posParams??{}).forEach(([c,l])=>{s[c]=l.path});let a=i.consumed.length>0?j(j({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:a,positionalParamSegments:i.posParams??{}}}function Ov(n){return{matched:!0,parameters:n.length>0?$f(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function zf(n,e,t,r){return t.length>0&&Lv(n,t,r)?{segmentGroup:new ae(e,Vv(r,new ae(t,n.children))),slicedSegments:[]}:t.length===0&&Fv(n,t,r)?{segmentGroup:new ae(n.segments,Nv(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new ae(n.segments,n.children),slicedSegments:t}}function Nv(n,e,t,r){let i={};for(let s of t)if(qs(n,e,s)&&!r[wt(s)]){let a=new ae([],{});i[wt(s)]=a}return j(j({},r),i)}function Vv(n,e){let t={};t[X]=e;for(let r of n)if(r.path===""&&wt(r)!==X){let i=new ae([],{});t[wt(r)]=i}return t}function Lv(n,e,t){return t.some(r=>qs(n,e,r)&&wt(r)!==X)}function Fv(n,e,t){return t.some(r=>qs(n,e,r))}function qs(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function Uv(n,e,t,r){return wt(n)!==r&&(r===X||!qs(e,t,n))?!1:Dc(e,n,t).matched}function jv(n,e,t){return e.length===0&&!n.children[t]}var Ic=class{};function Bv(n,e,t,r,i,s,a="emptyOnly"){return new Ec(n,e,t,r,i,a,s).recognize()}var zv=31,Ec=class{constructor(e,t,r,i,s,a,c){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=a,this.urlSerializer=c,this.applyRedirects=new bc(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new De(4002,`'${e.segmentGroup}'`)}recognize(){let e=zf(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(de(t=>{let r=new gi([],Object.freeze({}),Object.freeze(j({},this.urlTree.queryParams)),this.urlTree.fragment,{},X,this.rootComponentType,null,{}),i=new Ye(r,t),s=new Us("",i),a=Wy(r,[],this.urlTree.queryParams,this.urlTree.fragment);return a.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(a),this.inheritParamsAndData(s._root,null),{state:s,tree:a}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,X).pipe(Hn(r=>{if(r instanceof Bs)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof yi?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=Ac(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(de(s=>s instanceof Ye?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return at(i).pipe(Jr(s=>{let a=r.children[s],c=uv(t,s);return this.processSegmentGroup(e,c,a,s)}),kd((s,a)=>(s.push(...a),s)),Aa(null),Md(),nt(s=>{if(s===null)return Jn(r);let a=dp(s);return qv(a),J(a)}))}processSegment(e,t,r,i,s,a){return at(t).pipe(Jr(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,r,i,s,a).pipe(Hn(l=>{if(l instanceof yi)return J(null);throw l}))),Xt(c=>!!c),Hn(c=>{if(lp(c))return jv(r,i,s)?J(new Ic):Jn(r);throw c}))}processSegmentAgainstRoute(e,t,r,i,s,a,c){return Uv(r,i,s,a)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,a):this.allowRedirects&&c?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,a):Jn(i):Jn(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,a){let{matched:c,consumedSegments:l,positionalParamSegments:d,remainingSegments:p}=Dc(t,i,s);if(!c)return Jn(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>zv&&(this.allowRedirects=!1));let m=this.applyRedirects.applyRedirectCommands(l,i.redirectTo,d);return this.applyRedirects.lineralizeSegments(i,m).pipe(nt(w=>this.processSegment(e,r,t,w.concat(p),a,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let a=kv(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),a.pipe(mt(c=>c.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(mt(({routes:l})=>{let d=r._loadedInjector??e,{consumedSegments:p,remainingSegments:m,parameters:w}=c,R=new gi(p,w,Object.freeze(j({},this.urlTree.queryParams)),this.urlTree.fragment,Gv(r),wt(r),r.component??r._loadedComponent??null,r,Hv(r)),{segmentGroup:L,slicedSegments:B}=zf(t,p,m,l);if(B.length===0&&L.hasChildren())return this.processChildren(d,l,L).pipe(de(Y=>Y===null?null:new Ye(R,Y)));if(l.length===0&&B.length===0)return J(new Ye(R,[]));let k=wt(r)===s;return this.processSegment(d,l,L,B,k?X:s,!0).pipe(de(Y=>new Ye(R,Y instanceof Ye?[Y]:[])))}))):Jn(t)))}getChildConfig(e,t,r){return t.children?J({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?J({routes:t._loadedRoutes,injector:t._loadedInjector}):Rv(e,t,r,this.urlSerializer).pipe(nt(i=>i?this.configLoader.loadChildren(e,t).pipe(Fe(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):Mv(t))):J({routes:[],injector:e})}};function qv(n){n.sort((e,t)=>e.value.outlet===X?-1:t.value.outlet===X?1:e.value.outlet.localeCompare(t.value.outlet))}function $v(n){let e=n.value.routeConfig;return e&&e.path===""}function dp(n){let e=[],t=new Set;for(let r of n){if(!$v(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=dp(r.children);e.push(new Ye(r.value,i))}return e.filter(r=>!t.has(r))}function Gv(n){return n.data||{}}function Hv(n){return n.resolve||{}}function Kv(n,e,t,r,i,s){return nt(a=>Bv(n,e,t,r,a.extractedUrl,i,s).pipe(de(({state:c,tree:l})=>we(j({},a),{targetSnapshot:c,urlAfterRedirects:l}))))}function Wv(n,e){return nt(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return J(t);let s=new Set(i.map(l=>l.route)),a=new Set;for(let l of s)if(!a.has(l))for(let d of fp(l))a.add(d);let c=0;return at(a).pipe(Jr(l=>s.has(l)?Qv(l,r,n,e):(l.data=Ac(l,l.parent,n).resolve,J(void 0))),Fe(()=>c++),xa(1),nt(l=>c===a.size?J(t):Jt))})}function fp(n){let e=n.children.map(t=>fp(t)).flat();return[n,...e]}function Qv(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!sp(i)&&(s[vi]=i.title),Yv(s,n,e,r).pipe(de(a=>(n._resolvedData=a,n.data=Ac(n,n.parent,t).resolve,null)))}function Yv(n,e,t,r){let i=ec(n);if(i.length===0)return J({});let s={};return at(i).pipe(nt(a=>Jv(n[a],e,t,r).pipe(Xt(),Fe(c=>{s[a]=c}))),xa(1),Dd(s),Hn(a=>lp(a)?Jt:Yr(a)))}function Jv(n,e,t,r){let i=wi(e)??r,s=sr(n,i),a=s.resolve?s.resolve(e,t):Cn(i,()=>s(e,t));return rn(a)}function Xa(n){return mt(e=>{let t=n(e);return t?at(t).pipe(de(()=>e)):J(e)})}var pp=(()=>{class n{buildTitle(t){let r,i=t.root;for(;i!==void 0;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(s=>s.outlet===X);return r}getResolvedTitleForRoute(t){return t.data[vi]}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:()=>G(Xv),providedIn:"root"})}}return n})(),Xv=(()=>{class n extends pp{constructor(t){super(),this.title=t}updateTitle(t){let r=this.buildTitle(t);r!==void 0&&this.title.setTitle(r)}static{this.\u0275fac=function(r){return new(r||n)(be(Lf))}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Mc=new rt("",{providedIn:"root",factory:()=>({})}),kc=new rt(""),Zv=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=G(Fa)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return J(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let r=rn(t.loadComponent()).pipe(de(mp),Fe(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),Kn(()=>{this.componentLoaders.delete(t)})),i=new Ea(r,()=>new pt).pipe(Ia());return this.componentLoaders.set(t,i),i}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return J({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let s=e0(r,this.compiler,t,this.onLoadEndListener).pipe(Kn(()=>{this.childrenLoaders.delete(r)})),a=new Ea(s,()=>new pt).pipe(Ia());return this.childrenLoaders.set(r,a),a}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function e0(n,e,t,r){return rn(n.loadChildren()).pipe(de(mp),nt(i=>i instanceof $d||Array.isArray(i)?J(i):at(e.compileModuleAsync(i))),de(i=>{r&&r(n);let s,a,c=!1;return Array.isArray(i)?(a=i,c=!0):(s=i.create(t).injector,a=s.get(kc,[],{optional:!0,self:!0}).flat()),{routes:a.map(Pc),injector:s}}))}function t0(n){return n&&typeof n=="object"&&"default"in n}function mp(n){return t0(n)?n.default:n}var Oc=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:()=>G(n0),providedIn:"root"})}}return n})(),n0=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),r0=new rt("");var i0=(()=>{class n{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new pt,this.transitionAbortSubject=new pt,this.configLoader=G(Zv),this.environmentInjector=G(ys),this.urlSerializer=G(Sc),this.rootContexts=G(zs),this.location=G(Es),this.inputBindingEnabled=G(Rc,{optional:!0})!==null,this.titleStrategy=G(pp),this.options=G(Mc,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=G(Oc),this.createViewTransition=G(r0,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>J(void 0),this.rootComponentType=null;let t=i=>this.events.next(new uc(i)),r=i=>this.events.next(new lc(i));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=t}complete(){this.transitions?.complete()}handleNavigationRequest(t){let r=++this.navigationId;this.transitions?.next(we(j(j({},this.transitions.value),t),{id:r}))}setupNavigations(t,r,i){return this.transitions=new ye({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:ui,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Gn(s=>s.id!==0),de(s=>we(j({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),mt(s=>{let a=!1,c=!1;return J(s).pipe(mt(l=>{if(this.navigationId>s.id)return this.cancelNavigationTransition(s,"",Je.SupersededByNewNavigation),Jt;this.currentTransition=s,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?we(j({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let d=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),p=l.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!d&&p!=="reload"){let m="";return this.events.next(new An(l.id,this.urlSerializer.serialize(l.rawUrl),m,ic.IgnoredSameUrlNavigation)),l.resolve(null),Jt}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return J(l).pipe(mt(m=>{let w=this.transitions?.getValue();return this.events.next(new di(m.id,this.urlSerializer.serialize(m.extractedUrl),m.source,m.restoredState)),w!==this.transitions?.getValue()?Jt:Promise.resolve(m)}),Kv(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),Fe(m=>{s.targetSnapshot=m.targetSnapshot,s.urlAfterRedirects=m.urlAfterRedirects,this.currentNavigation=we(j({},this.currentNavigation),{finalUrl:m.urlAfterRedirects});let w=new Vs(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(w)}));if(d&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:m,extractedUrl:w,source:R,restoredState:L,extras:B}=l,k=new di(m,this.urlSerializer.serialize(w),R,L);this.events.next(k);let Y=rp(this.rootComponentType).snapshot;return this.currentTransition=s=we(j({},l),{targetSnapshot:Y,urlAfterRedirects:w,extras:we(j({},B),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=w,J(s)}else{let m="";return this.events.next(new An(l.id,this.urlSerializer.serialize(l.extractedUrl),m,ic.IgnoredByUrlHandlingStrategy)),l.resolve(null),Jt}}),Fe(l=>{let d=new sc(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}),de(l=>(this.currentTransition=s=we(j({},l),{guards:hv(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),s)),bv(this.environmentInjector,l=>this.events.next(l)),Fe(l=>{if(s.guardsResult=l.guardsResult,nr(l.guardsResult))throw ap(this.urlSerializer,l.guardsResult);let d=new oc(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(d)}),Gn(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",Je.GuardRejected),!1)),Xa(l=>{if(l.guards.canActivateChecks.length)return J(l).pipe(Fe(d=>{let p=new ac(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}),mt(d=>{let p=!1;return J(d).pipe(Wv(this.paramsInheritanceStrategy,this.environmentInjector),Fe({next:()=>p=!0,complete:()=>{p||this.cancelNavigationTransition(d,"",Je.NoDataFromResolver)}}))}),Fe(d=>{let p=new cc(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}))}),Xa(l=>{let d=p=>{let m=[];p.routeConfig?.loadComponent&&!p.routeConfig._loadedComponent&&m.push(this.configLoader.loadComponent(p.routeConfig).pipe(Fe(w=>{p.component=w}),de(()=>{})));for(let w of p.children)m.push(...d(w));return m};return Ta(d(l.targetSnapshot.root)).pipe(Aa(null),xt(1))}),Xa(()=>this.afterPreactivation()),mt(()=>{let{currentSnapshot:l,targetSnapshot:d}=s,p=this.createViewTransition?.(this.environmentInjector,l.root,d.root);return p?at(p).pipe(de(()=>s)):J(s)}),de(l=>{let d=rv(t.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=s=we(j({},l),{targetRouterState:d}),this.currentNavigation.targetRouterState=d,s}),Fe(()=>{this.events.next(new pi)}),lv(this.rootContexts,t.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),xt(1),Fe({next:l=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Sn(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{a=!0}}),Nd(this.transitionAbortSubject.pipe(Fe(l=>{throw l}))),Kn(()=>{!a&&!c&&this.cancelNavigationTransition(s,"",Je.SupersededByNewNavigation),this.currentTransition?.id===s.id&&(this.currentNavigation=null,this.currentTransition=null)}),Hn(l=>{if(c=!0,up(l))this.events.next(new nn(s.id,this.urlSerializer.serialize(s.extractedUrl),l.message,l.cancellationCode)),ov(l)?this.events.next(new mi(l.url)):s.resolve(!1);else{this.events.next(new fi(s.id,this.urlSerializer.serialize(s.extractedUrl),l,s.targetSnapshot??void 0));try{s.resolve(t.errorHandler(l))}catch(d){this.options.resolveNavigationPromiseOnError?s.resolve(!1):s.reject(d)}}return Jt}))}))}cancelNavigationTransition(t,r,i){let s=new nn(t.id,this.urlSerializer.serialize(t.extractedUrl),r,i);this.events.next(s),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function s0(n){return n!==ui}var o0=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:()=>G(a0),providedIn:"root"})}}return n})(),Tc=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},a0=(()=>{class n extends Tc{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Da(n)))(i||n)}})()}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),gp=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:()=>G(c0),providedIn:"root"})}}return n})(),c0=(()=>{class n extends gp{constructor(){super(...arguments),this.location=G(Es),this.urlSerializer=G(Sc),this.options=G(Mc,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=G(Oc),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new tn,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=rp(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(r=>{r.type==="popstate"&&t(r.url,r.state)})}handleRouterEvent(t,r){if(t instanceof di)this.stateMemento=this.createStateMemento();else if(t instanceof An)this.rawUrlTree=r.initialUrl;else if(t instanceof Vs){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(i,r)}}else t instanceof pi?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r))):t instanceof nn&&(t.code===Je.GuardRejected||t.code===Je.NoDataFromResolver)?this.restoreHistory(r):t instanceof fi?this.restoreHistory(r,!0):t instanceof Sn&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,r){let i=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){let s=this.browserPageId,a=j(j({},r.extras.state),this.generateNgRouterState(r.id,s));this.location.replaceState(i,"",a)}else{let s=j(j({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(i,"",s)}}restoreHistory(t,r=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,s=this.currentPageId-i;s!==0?this.location.historyGo(s):this.currentUrlTree===t.finalUrl&&s===0&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Da(n)))(i||n)}})()}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),ai=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(ai||{});function u0(n,e){n.events.pipe(Gn(t=>t instanceof Sn||t instanceof nn||t instanceof fi||t instanceof An),de(t=>t instanceof Sn||t instanceof An?ai.COMPLETE:(t instanceof nn?t.code===Je.Redirect||t.code===Je.SupersededByNewNavigation:!1)?ai.REDIRECTING:ai.FAILED),Gn(t=>t!==ai.REDIRECTING),xt(1)).subscribe(()=>{e()})}function l0(n){throw n}var h0={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},d0={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Ci=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=G(Is),this.stateManager=G(gp),this.options=G(Mc,{optional:!0})||{},this.pendingTasks=G(Hd),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=G(i0),this.urlSerializer=G(Sc),this.location=G(Es),this.urlHandlingStrategy=G(Oc),this._events=new pt,this.errorHandler=this.options.errorHandler||l0,this.navigated=!1,this.routeReuseStrategy=G(o0),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=G(kc,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!G(Rc,{optional:!0}),this.eventsSubscription=new Sd,this.isNgZoneEnabled=G(Rt)instanceof Rt&&Rt.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(r=>{try{let i=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(i!==null&&s!==null){if(this.stateManager.handleRouterEvent(r,s),r instanceof nn&&r.code!==Je.Redirect&&r.code!==Je.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Sn)this.navigated=!0;else if(r instanceof mi){let a=this.urlHandlingStrategy.merge(r.url,i.currentRawUrl),c={info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||s0(i.source)};this.scheduleNavigation(a,ui,null,c,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}p0(r)&&this._events.next(r)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),ui,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",r)},0)})}navigateToSyncWithBrowser(t,r,i){let s={replaceUrl:!0},a=i?.navigationId?i:null;if(i){let l=j({},i);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(s.state=l)}let c=this.parseUrl(t);this.scheduleNavigation(c,r,a,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(Pc),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){let{relativeTo:i,queryParams:s,fragment:a,queryParamsHandling:c,preserveFragment:l}=r,d=l?this.currentUrlTree.fragment:a,p=null;switch(c){case"merge":p=j(j({},this.currentUrlTree.queryParams),s);break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=s||null}p!==null&&(p=this.removeEmptyProps(p));let m;try{let w=i?i.snapshot:this.routerState.snapshot.root;m=Zf(w)}catch{(typeof t[0]!="string"||!t[0].startsWith("/"))&&(t=[]),m=this.currentUrlTree.root}return ep(m,t,p,d??null)}navigateByUrl(t,r={skipLocationChange:!1}){let i=nr(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,ui,null,r)}navigate(t,r={skipLocationChange:!1}){return f0(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,r){let i;if(r===!0?i=j({},h0):r===!1?i=j({},d0):i=r,nr(t))return Ff(this.currentUrlTree,t,i);let s=this.parseUrl(t);return Ff(this.currentUrlTree,s,i)}removeEmptyProps(t){return Object.entries(t).reduce((r,[i,s])=>(s!=null&&(r[i]=s),r),{})}scheduleNavigation(t,r,i,s,a){if(this.disposed)return Promise.resolve(!1);let c,l,d;a?(c=a.resolve,l=a.reject,d=a.promise):d=new Promise((m,w)=>{c=m,l=w});let p=this.pendingTasks.add();return u0(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(p))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:c,reject:l,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(m=>Promise.reject(m))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function f0(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new De(4008,!1)}function p0(n){return!(n instanceof pi)&&!(n instanceof mi)}var m0=new rt("");function _p(n,...e){return Pa([{provide:kc,multi:!0,useValue:n},[],{provide:rr,useFactory:g0,deps:[Ci]},{provide:Qd,multi:!0,useFactory:_0},e.map(t=>t.\u0275providers)])}function g0(n){return n.routerState.root}function _0(){let n=G(Ud);return e=>{let t=n.get(La);if(e!==t.components[0])return;let r=n.get(Ci),i=n.get(y0);n.get(v0)===1&&r.initialNavigation(),n.get(w0,null,Ra.Optional)?.setUpPreloading(),n.get(m0,null,Ra.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var y0=new rt("",{factory:()=>new pt}),v0=new rt("",{providedIn:"root",factory:()=>1});var w0=new rt("");var $s=(()=>{class n{constructor(){this.loadingSubject=new ye(!1),this.loading$=this.loadingSubject.asObservable(),this.messageSubject=new ye("Loading..."),this.message$=this.messageSubject.asObservable()}show(t="Loading..."){this.messageSubject.next(t),this.loadingSubject.next(!0)}hide(){this.loadingSubject.next(!1)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Gs=0,yp=(n,e)=>{let t=G($s);return Gs++,Gs===1&&t.show("Loading..."),e(n).pipe(Kn(()=>{Gs--,Gs===0&&t.hide()}))};var C0=()=>{let n=G(Ci);return localStorage.getItem("jjm_logged_in")==="true"?!0:(n.navigate(["/login"]),!1)},I0=()=>{let n=G(Ci),e=localStorage.getItem("jjm_logged_in")==="true",t=localStorage.getItem("jjm_role");return!e||t!=="admin"?(n.navigate(["/"]),!1):!0},vp=[{path:"login",loadComponent:()=>import("./chunk-KHW47E2W.js").then(n=>n.LoginComponent)},{path:"reservation",loadComponent:()=>import("./chunk-DBV5UTD5.js").then(n=>n.ReservationComponent)},{path:"",canActivate:[C0],children:[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-WGYWDMJ2.js").then(n=>n.LandingComponent)},{path:"add-product",loadComponent:()=>import("./chunk-DL2WPNIA.js").then(n=>n.ProductFormComponent)},{path:"sell",loadComponent:()=>import("./chunk-4NGNQ4BL.js").then(n=>n.PosCalculatorComponent)},{path:"inventory",loadComponent:()=>import("./chunk-EMHAUGXU.js").then(n=>n.InventoryListComponent)},{path:"customers",loadComponent:()=>import("./chunk-3ENGM66U.js").then(n=>n.CustomerFormComponent)},{path:"expenses",loadComponent:()=>import("./chunk-B6PJOYU2.js").then(n=>n.ExpensesComponent)},{path:"reports",loadComponent:()=>import("./chunk-TZCPJ7NG.js").then(n=>n.ReportsComponent)},{path:"logs",loadComponent:()=>import("./chunk-XCVJLWEJ.js").then(n=>n.ActivityLogsComponent)},{path:"users",canActivate:[I0],loadComponent:()=>import("./chunk-7BCSZZID.js").then(n=>n.UserManagementComponent)}]},{path:"**",redirectTo:"login"}];var wp={providers:[_p(vp),rf(sf([yp]))]};var bp=()=>{};var Ep=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},E0=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],a=n[t++],c=n[t++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},Tp={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],a=i+1<n.length,c=a?n[i+1]:0,l=i+2<n.length,d=l?n[i+2]:0,p=s>>2,m=(s&3)<<4|c>>4,w=(c&15)<<2|d>>6,R=d&63;l||(R=64,a||(w=64)),r.push(t[p],t[m],t[w],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Ep(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):E0(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||d==null||m==null)throw new Nc;let w=s<<2|c>>4;if(r.push(w),d!==64){let R=c<<4&240|d>>2;if(r.push(R),m!==64){let L=d<<6&192|m;r.push(L)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Nc=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},T0=function(n){let e=Ep(n);return Tp.encodeByteArray(e,!0)},Ei=function(n){return T0(n).replace(/\./g,"")},Sp=function(n){try{return Tp.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ap(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var S0=()=>Ap().__FIREBASE_DEFAULTS__,A0=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},x0=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Sp(n[1]);return e&&JSON.parse(e)},Vc=()=>{try{return bp()||S0()||A0()||x0()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},R0=n=>Vc()?.emulatorHosts?.[n],xp=n=>{let e=R0(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Lc=()=>Vc()?.config;var Hs=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Ks(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Rp(n){return P(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Pp(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=j({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ei(JSON.stringify(t)),Ei(JSON.stringify(a)),""].join(".")}var Ii={};function P0(){let n={prod:[],emulator:[]};for(let e of Object.keys(Ii))Ii[e]?n.emulator.push(e):n.prod.push(e);return n}function D0(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Cp=!1;function Dp(n,e){if(typeof window>"u"||typeof document>"u"||!Ks(window.location.host)||Ii[n]===e||Ii[n]||Cp)return;Ii[n]=e;function t(w){return`__firebase__banner__${w}`}let r="__firebase__banner",s=P0().prod.length>0;function a(){let w=document.getElementById(r);w&&w.remove()}function c(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function l(w,R){w.setAttribute("width","24"),w.setAttribute("id",R),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function d(){let w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{Cp=!0,a()},w}function p(w,R){w.setAttribute("id",R),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function m(){let w=D0(r),R=t("text"),L=document.getElementById(R)||document.createElement("span"),B=t("learnmore"),k=document.getElementById(B)||document.createElement("a"),Y=t("preprendIcon"),se=document.getElementById(Y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){let oe=w.element;c(oe),p(k,B);let qe=d();l(se,Y),oe.append(se,L,k,qe),document.body.appendChild(oe)}s?(L.innerText="Preview backend disconnected.",se.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(se.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,L.innerText="Preview backend running in this workspace."),L.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function Mp(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function M0(){let n=Vc()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kp(){return!M0()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Fc(){try{return typeof indexedDB=="object"}catch{return!1}}function Op(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var k0="FirebaseError",Dt=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=k0,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ti.prototype.create)}},Ti=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?O0(s,r):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new Dt(i,c,r)}};function O0(n,e){return n.replace(N0,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var N0=/\{\$([^}]+)}/g;function or(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],a=e[i];if(Ip(s)&&Ip(a)){if(!or(s,a))return!1}else if(s!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Ip(n){return n!==null&&typeof n=="object"}var uT=4*60*60*1e3;function Xe(n){return n&&n._delegate?n._delegate:n}var Mt=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var xn="[DEFAULT]";var Uc=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Hs;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(L0(e))try{this.getOrInitializeService({instanceIdentifier:xn})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=xn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return P(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=xn){return this.instances.has(e)}getOptions(e=xn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,a]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&a.resolve(i)}return i}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:V0(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=xn){return this.component?this.component.multipleInstances?e:xn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function V0(n){return n===xn?void 0:n}function L0(n){return n.instantiationMode==="EAGER"}var Ws=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Uc(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var F0=[],re=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(re||{}),U0={debug:re.DEBUG,verbose:re.VERBOSE,info:re.INFO,warn:re.WARN,error:re.ERROR,silent:re.SILENT},j0=re.INFO,B0={[re.DEBUG]:"log",[re.VERBOSE]:"log",[re.INFO]:"info",[re.WARN]:"warn",[re.ERROR]:"error"},z0=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=B0[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},ar=class{constructor(e){this.name=e,this._logLevel=j0,this._logHandler=z0,this._userLogHandler=null,F0.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in re))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?U0[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,re.DEBUG,...e),this._logHandler(this,re.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,re.VERBOSE,...e),this._logHandler(this,re.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,re.INFO,...e),this._logHandler(this,re.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,re.WARN,...e),this._logHandler(this,re.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,re.ERROR,...e),this._logHandler(this,re.ERROR,...e)}};var q0=(n,e)=>e.some(t=>n instanceof t),Np,Vp;function $0(){return Np||(Np=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function G0(){return Vp||(Vp=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Lp=new WeakMap,Bc=new WeakMap,Fp=new WeakMap,jc=new WeakMap,qc=new WeakMap;function H0(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(bt(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Lp.set(t,n)}).catch(()=>{}),qc.set(e,n),e}function K0(n){if(Bc.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});Bc.set(n,e)}var zc={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Bc.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Fp.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return bt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Up(n){zc=n(zc)}function W0(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(Qs(this),e,...t);return Fp.set(r,e.sort?e.sort():[e]),bt(r)}:G0().includes(n)?function(...e){return n.apply(Qs(this),e),bt(Lp.get(this))}:function(...e){return bt(n.apply(Qs(this),e))}}function Q0(n){return typeof n=="function"?W0(n):(n instanceof IDBTransaction&&K0(n),q0(n,$0())?new Proxy(n,zc):n)}function bt(n){if(n instanceof IDBRequest)return H0(n);if(jc.has(n))return jc.get(n);let e=Q0(n);return e!==n&&(jc.set(n,e),qc.set(e,n)),e}var Qs=n=>qc.get(n);function Bp(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(n,e),c=bt(a);return r&&a.addEventListener("upgradeneeded",l=>{r(bt(a.result),l.oldVersion,l.newVersion,bt(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}var Y0=["get","getKey","getAll","getAllKeys","count"],J0=["put","add","delete","clear"],$c=new Map;function jp(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if($c.get(e))return $c.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=J0.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Y0.includes(t)))return;let s=function(a,...c){return P(this,null,function*(){let l=this.transaction(a,i?"readwrite":"readonly"),d=l.store;return r&&(d=d.index(c.shift())),(yield Promise.all([d[t](...c),i&&l.done]))[0]})};return $c.set(e,s),s}Up(n=>we(j({},n),{get:(e,t,r)=>jp(e,t)||n.get(e,t,r),has:(e,t)=>!!jp(e,t)||n.has(e,t)}));var Hc=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(X0(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function X0(n){return n.getComponent()?.type==="VERSION"}var Kc="@firebase/app",zp="0.14.6";var kt=new ar("@firebase/app"),Z0="@firebase/app-compat",ew="@firebase/analytics-compat",tw="@firebase/analytics",nw="@firebase/app-check-compat",rw="@firebase/app-check",iw="@firebase/auth",sw="@firebase/auth-compat",ow="@firebase/database",aw="@firebase/data-connect",cw="@firebase/database-compat",uw="@firebase/functions",lw="@firebase/functions-compat",hw="@firebase/installations",dw="@firebase/installations-compat",fw="@firebase/messaging",pw="@firebase/messaging-compat",mw="@firebase/performance",gw="@firebase/performance-compat",_w="@firebase/remote-config",yw="@firebase/remote-config-compat",vw="@firebase/storage",ww="@firebase/storage-compat",bw="@firebase/firestore",Cw="@firebase/ai",Iw="@firebase/firestore-compat",Ew="firebase",Tw="12.6.0";var Wc="[DEFAULT]",Sw={[Kc]:"fire-core",[Z0]:"fire-core-compat",[tw]:"fire-analytics",[ew]:"fire-analytics-compat",[rw]:"fire-app-check",[nw]:"fire-app-check-compat",[iw]:"fire-auth",[sw]:"fire-auth-compat",[ow]:"fire-rtdb",[aw]:"fire-data-connect",[cw]:"fire-rtdb-compat",[uw]:"fire-fn",[lw]:"fire-fn-compat",[hw]:"fire-iid",[dw]:"fire-iid-compat",[fw]:"fire-fcm",[pw]:"fire-fcm-compat",[mw]:"fire-perf",[gw]:"fire-perf-compat",[_w]:"fire-rc",[yw]:"fire-rc-compat",[vw]:"fire-gcs",[ww]:"fire-gcs-compat",[bw]:"fire-fst",[Iw]:"fire-fst-compat",[Cw]:"fire-vertex","fire-js":"fire-js",[Ew]:"fire-js-all"};var Ys=new Map,Aw=new Map,Qc=new Map;function qp(n,e){try{n.container.addComponent(e)}catch(t){kt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Si(n){let e=n.name;if(Qc.has(e))return kt.debug(`There were multiple attempts to register component ${e}.`),!1;Qc.set(e,n);for(let t of Ys.values())qp(t,n);for(let t of Aw.values())qp(t,n);return!0}function Kp(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Wp(n){return n==null?!1:n.settings!==void 0}var xw={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sn=new Ti("app","Firebase",xw);var Yc=class{constructor(e,t,r){this._isDeleted=!1,this._options=j({},e),this._config=j({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Mt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sn.create("app-deleted",{appName:this._name})}};var Qp=Tw;function xi(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=j({name:Wc,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw sn.create("bad-app-name",{appName:String(i)});if(t||(t=Lc()),!t)throw sn.create("no-options");let s=Ys.get(i);if(s){if(or(t,s.options)&&or(r,s.config))return s;throw sn.create("duplicate-app",{appName:i})}let a=new Ws(i);for(let l of Qc.values())a.addComponent(l);let c=new Yc(t,r,a);return Ys.set(i,c),c}function Yp(n=Wc){let e=Ys.get(n);if(!e&&n===Wc&&Lc())return xi();if(!e)throw sn.create("no-app",{appName:n});return e}function on(n,e,t){let r=Sw[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){let a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),kt.warn(a.join(" "));return}Si(new Mt(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var Rw="firebase-heartbeat-database",Pw=1,Ai="firebase-heartbeat-store",Gc=null;function Jp(){return Gc||(Gc=Bp(Rw,Pw,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ai)}catch(t){console.warn(t)}}}}).catch(n=>{throw sn.create("idb-open",{originalErrorMessage:n.message})})),Gc}function Dw(n){return P(this,null,function*(){try{let t=(yield Jp()).transaction(Ai),r=yield t.objectStore(Ai).get(Xp(n));return yield t.done,r}catch(e){if(e instanceof Dt)kt.warn(e.message);else{let t=sn.create("idb-get",{originalErrorMessage:e?.message});kt.warn(t.message)}}})}function $p(n,e){return P(this,null,function*(){try{let r=(yield Jp()).transaction(Ai,"readwrite");yield r.objectStore(Ai).put(e,Xp(n)),yield r.done}catch(t){if(t instanceof Dt)kt.warn(t.message);else{let r=sn.create("idb-set",{originalErrorMessage:t?.message});kt.warn(r.message)}}})}function Xp(n){return`${n.name}!${n.options.appId}`}var Mw=1024,kw=30,Jc=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Xc(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return P(this,null,function*(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Gp();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>kw){let i=Nw(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){kt.warn(e)}})}getHeartbeatsHeader(){return P(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=Gp(),{heartbeatsToSend:t,unsentEntries:r}=Ow(this._heartbeatsCache.heartbeats),i=Ei(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return kt.warn(e),""}})}};function Gp(){return new Date().toISOString().substring(0,10)}function Ow(n,e=Mw){let t=[],r=n.slice();for(let i of n){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),Hp(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Hp(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Xc=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return P(this,null,function*(){return Fc()?Op().then(()=>!0).catch(()=>!1):!1})}read(){return P(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Dw(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return P(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return $p(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return P(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return $p(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function Hp(n){return Ei(JSON.stringify({version:2,heartbeats:n})).length}function Nw(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Vw(n){Si(new Mt("platform-logger",e=>new Hc(e),"PRIVATE")),Si(new Mt("heartbeat",e=>new Jc(e),"PRIVATE")),on(Kc,zp,n),on(Kc,zp,"esm2020"),on("fire-js","")}Vw("");var Lw="firebase",Fw="12.6.0";on(Lw,Fw,"app");var Zp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},em={};var Ot,Zc;(function(){var n;function e(b,g){function y(){}y.prototype=g.prototype,b.F=g.prototype,b.prototype=new y,b.prototype.constructor=b,b.D=function(C,v,E){for(var _=Array(arguments.length-2),Ke=2;Ke<arguments.length;Ke++)_[Ke-2]=arguments[Ke];return g.prototype[v].apply(C,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(b,g,y){y||(y=0);let C=Array(16);if(typeof g=="string")for(var v=0;v<16;++v)C[v]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(v=0;v<16;++v)C[v]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=b.g[0],y=b.g[1],v=b.g[2];let E=b.g[3],_;_=g+(E^y&(v^E))+C[0]+3614090360&4294967295,g=y+(_<<7&4294967295|_>>>25),_=E+(v^g&(y^v))+C[1]+3905402710&4294967295,E=g+(_<<12&4294967295|_>>>20),_=v+(y^E&(g^y))+C[2]+606105819&4294967295,v=E+(_<<17&4294967295|_>>>15),_=y+(g^v&(E^g))+C[3]+3250441966&4294967295,y=v+(_<<22&4294967295|_>>>10),_=g+(E^y&(v^E))+C[4]+4118548399&4294967295,g=y+(_<<7&4294967295|_>>>25),_=E+(v^g&(y^v))+C[5]+1200080426&4294967295,E=g+(_<<12&4294967295|_>>>20),_=v+(y^E&(g^y))+C[6]+2821735955&4294967295,v=E+(_<<17&4294967295|_>>>15),_=y+(g^v&(E^g))+C[7]+4249261313&4294967295,y=v+(_<<22&4294967295|_>>>10),_=g+(E^y&(v^E))+C[8]+1770035416&4294967295,g=y+(_<<7&4294967295|_>>>25),_=E+(v^g&(y^v))+C[9]+2336552879&4294967295,E=g+(_<<12&4294967295|_>>>20),_=v+(y^E&(g^y))+C[10]+4294925233&4294967295,v=E+(_<<17&4294967295|_>>>15),_=y+(g^v&(E^g))+C[11]+2304563134&4294967295,y=v+(_<<22&4294967295|_>>>10),_=g+(E^y&(v^E))+C[12]+1804603682&4294967295,g=y+(_<<7&4294967295|_>>>25),_=E+(v^g&(y^v))+C[13]+4254626195&4294967295,E=g+(_<<12&4294967295|_>>>20),_=v+(y^E&(g^y))+C[14]+2792965006&4294967295,v=E+(_<<17&4294967295|_>>>15),_=y+(g^v&(E^g))+C[15]+1236535329&4294967295,y=v+(_<<22&4294967295|_>>>10),_=g+(v^E&(y^v))+C[1]+4129170786&4294967295,g=y+(_<<5&4294967295|_>>>27),_=E+(y^v&(g^y))+C[6]+3225465664&4294967295,E=g+(_<<9&4294967295|_>>>23),_=v+(g^y&(E^g))+C[11]+643717713&4294967295,v=E+(_<<14&4294967295|_>>>18),_=y+(E^g&(v^E))+C[0]+3921069994&4294967295,y=v+(_<<20&4294967295|_>>>12),_=g+(v^E&(y^v))+C[5]+3593408605&4294967295,g=y+(_<<5&4294967295|_>>>27),_=E+(y^v&(g^y))+C[10]+38016083&4294967295,E=g+(_<<9&4294967295|_>>>23),_=v+(g^y&(E^g))+C[15]+3634488961&4294967295,v=E+(_<<14&4294967295|_>>>18),_=y+(E^g&(v^E))+C[4]+3889429448&4294967295,y=v+(_<<20&4294967295|_>>>12),_=g+(v^E&(y^v))+C[9]+568446438&4294967295,g=y+(_<<5&4294967295|_>>>27),_=E+(y^v&(g^y))+C[14]+3275163606&4294967295,E=g+(_<<9&4294967295|_>>>23),_=v+(g^y&(E^g))+C[3]+4107603335&4294967295,v=E+(_<<14&4294967295|_>>>18),_=y+(E^g&(v^E))+C[8]+1163531501&4294967295,y=v+(_<<20&4294967295|_>>>12),_=g+(v^E&(y^v))+C[13]+2850285829&4294967295,g=y+(_<<5&4294967295|_>>>27),_=E+(y^v&(g^y))+C[2]+4243563512&4294967295,E=g+(_<<9&4294967295|_>>>23),_=v+(g^y&(E^g))+C[7]+1735328473&4294967295,v=E+(_<<14&4294967295|_>>>18),_=y+(E^g&(v^E))+C[12]+2368359562&4294967295,y=v+(_<<20&4294967295|_>>>12),_=g+(y^v^E)+C[5]+4294588738&4294967295,g=y+(_<<4&4294967295|_>>>28),_=E+(g^y^v)+C[8]+2272392833&4294967295,E=g+(_<<11&4294967295|_>>>21),_=v+(E^g^y)+C[11]+1839030562&4294967295,v=E+(_<<16&4294967295|_>>>16),_=y+(v^E^g)+C[14]+4259657740&4294967295,y=v+(_<<23&4294967295|_>>>9),_=g+(y^v^E)+C[1]+2763975236&4294967295,g=y+(_<<4&4294967295|_>>>28),_=E+(g^y^v)+C[4]+1272893353&4294967295,E=g+(_<<11&4294967295|_>>>21),_=v+(E^g^y)+C[7]+4139469664&4294967295,v=E+(_<<16&4294967295|_>>>16),_=y+(v^E^g)+C[10]+3200236656&4294967295,y=v+(_<<23&4294967295|_>>>9),_=g+(y^v^E)+C[13]+681279174&4294967295,g=y+(_<<4&4294967295|_>>>28),_=E+(g^y^v)+C[0]+3936430074&4294967295,E=g+(_<<11&4294967295|_>>>21),_=v+(E^g^y)+C[3]+3572445317&4294967295,v=E+(_<<16&4294967295|_>>>16),_=y+(v^E^g)+C[6]+76029189&4294967295,y=v+(_<<23&4294967295|_>>>9),_=g+(y^v^E)+C[9]+3654602809&4294967295,g=y+(_<<4&4294967295|_>>>28),_=E+(g^y^v)+C[12]+3873151461&4294967295,E=g+(_<<11&4294967295|_>>>21),_=v+(E^g^y)+C[15]+530742520&4294967295,v=E+(_<<16&4294967295|_>>>16),_=y+(v^E^g)+C[2]+3299628645&4294967295,y=v+(_<<23&4294967295|_>>>9),_=g+(v^(y|~E))+C[0]+4096336452&4294967295,g=y+(_<<6&4294967295|_>>>26),_=E+(y^(g|~v))+C[7]+1126891415&4294967295,E=g+(_<<10&4294967295|_>>>22),_=v+(g^(E|~y))+C[14]+2878612391&4294967295,v=E+(_<<15&4294967295|_>>>17),_=y+(E^(v|~g))+C[5]+4237533241&4294967295,y=v+(_<<21&4294967295|_>>>11),_=g+(v^(y|~E))+C[12]+1700485571&4294967295,g=y+(_<<6&4294967295|_>>>26),_=E+(y^(g|~v))+C[3]+2399980690&4294967295,E=g+(_<<10&4294967295|_>>>22),_=v+(g^(E|~y))+C[10]+4293915773&4294967295,v=E+(_<<15&4294967295|_>>>17),_=y+(E^(v|~g))+C[1]+2240044497&4294967295,y=v+(_<<21&4294967295|_>>>11),_=g+(v^(y|~E))+C[8]+1873313359&4294967295,g=y+(_<<6&4294967295|_>>>26),_=E+(y^(g|~v))+C[15]+4264355552&4294967295,E=g+(_<<10&4294967295|_>>>22),_=v+(g^(E|~y))+C[6]+2734768916&4294967295,v=E+(_<<15&4294967295|_>>>17),_=y+(E^(v|~g))+C[13]+1309151649&4294967295,y=v+(_<<21&4294967295|_>>>11),_=g+(v^(y|~E))+C[4]+4149444226&4294967295,g=y+(_<<6&4294967295|_>>>26),_=E+(y^(g|~v))+C[11]+3174756917&4294967295,E=g+(_<<10&4294967295|_>>>22),_=v+(g^(E|~y))+C[2]+718787259&4294967295,v=E+(_<<15&4294967295|_>>>17),_=y+(E^(v|~g))+C[9]+3951481745&4294967295,b.g[0]=b.g[0]+g&4294967295,b.g[1]=b.g[1]+(v+(_<<21&4294967295|_>>>11))&4294967295,b.g[2]=b.g[2]+v&4294967295,b.g[3]=b.g[3]+E&4294967295}r.prototype.v=function(b,g){g===void 0&&(g=b.length);let y=g-this.blockSize,C=this.C,v=this.h,E=0;for(;E<g;){if(v==0)for(;E<=y;)i(this,b,E),E+=this.blockSize;if(typeof b=="string"){for(;E<g;)if(C[v++]=b.charCodeAt(E++),v==this.blockSize){i(this,C),v=0;break}}else for(;E<g;)if(C[v++]=b[E++],v==this.blockSize){i(this,C),v=0;break}}this.h=v,this.o+=g},r.prototype.A=function(){var b=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);b[0]=128;for(var g=1;g<b.length-8;++g)b[g]=0;g=this.o*8;for(var y=b.length-8;y<b.length;++y)b[y]=g&255,g/=256;for(this.v(b),b=Array(16),g=0,y=0;y<4;++y)for(let C=0;C<32;C+=8)b[g++]=this.g[y]>>>C&255;return b};function s(b,g){var y=c;return Object.prototype.hasOwnProperty.call(y,b)?y[b]:y[b]=g(b)}function a(b,g){this.h=g;let y=[],C=!0;for(let v=b.length-1;v>=0;v--){let E=b[v]|0;C&&E==g||(y[v]=E,C=!1)}this.g=y}var c={};function l(b){return-128<=b&&b<128?s(b,function(g){return new a([g|0],g<0?-1:0)}):new a([b|0],b<0?-1:0)}function d(b){if(isNaN(b)||!isFinite(b))return m;if(b<0)return k(d(-b));let g=[],y=1;for(let C=0;b>=y;C++)g[C]=b/y|0,y*=4294967296;return new a(g,0)}function p(b,g){if(b.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(b.charAt(0)=="-")return k(p(b.substring(1),g));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');let y=d(Math.pow(g,8)),C=m;for(let E=0;E<b.length;E+=8){var v=Math.min(8,b.length-E);let _=parseInt(b.substring(E,E+v),g);v<8?(v=d(Math.pow(g,v)),C=C.j(v).add(d(_))):(C=C.j(y),C=C.add(d(_)))}return C}var m=l(0),w=l(1),R=l(16777216);n=a.prototype,n.m=function(){if(B(this))return-k(this).m();let b=0,g=1;for(let y=0;y<this.g.length;y++){let C=this.i(y);b+=(C>=0?C:4294967296+C)*g,g*=4294967296}return b},n.toString=function(b){if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(L(this))return"0";if(B(this))return"-"+k(this).toString(b);let g=d(Math.pow(b,6));var y=this;let C="";for(;;){let v=qe(y,g).g;y=Y(y,v.j(g));let E=((y.g.length>0?y.g[0]:y.h)>>>0).toString(b);if(y=v,L(y))return E+C;for(;E.length<6;)E="0"+E;C=E+C}},n.i=function(b){return b<0?0:b<this.g.length?this.g[b]:this.h};function L(b){if(b.h!=0)return!1;for(let g=0;g<b.g.length;g++)if(b.g[g]!=0)return!1;return!0}function B(b){return b.h==-1}n.l=function(b){return b=Y(this,b),B(b)?-1:L(b)?0:1};function k(b){let g=b.g.length,y=[];for(let C=0;C<g;C++)y[C]=~b.g[C];return new a(y,~b.h).add(w)}n.abs=function(){return B(this)?k(this):this},n.add=function(b){let g=Math.max(this.g.length,b.g.length),y=[],C=0;for(let v=0;v<=g;v++){let E=C+(this.i(v)&65535)+(b.i(v)&65535),_=(E>>>16)+(this.i(v)>>>16)+(b.i(v)>>>16);C=_>>>16,E&=65535,_&=65535,y[v]=_<<16|E}return new a(y,y[y.length-1]&-2147483648?-1:0)};function Y(b,g){return b.add(k(g))}n.j=function(b){if(L(this)||L(b))return m;if(B(this))return B(b)?k(this).j(k(b)):k(k(this).j(b));if(B(b))return k(this.j(k(b)));if(this.l(R)<0&&b.l(R)<0)return d(this.m()*b.m());let g=this.g.length+b.g.length,y=[];for(var C=0;C<2*g;C++)y[C]=0;for(C=0;C<this.g.length;C++)for(let v=0;v<b.g.length;v++){let E=this.i(C)>>>16,_=this.i(C)&65535,Ke=b.i(v)>>>16,$t=b.i(v)&65535;y[2*C+2*v]+=_*$t,se(y,2*C+2*v),y[2*C+2*v+1]+=E*$t,se(y,2*C+2*v+1),y[2*C+2*v+1]+=_*Ke,se(y,2*C+2*v+1),y[2*C+2*v+2]+=E*Ke,se(y,2*C+2*v+2)}for(b=0;b<g;b++)y[b]=y[2*b+1]<<16|y[2*b];for(b=g;b<2*g;b++)y[b]=0;return new a(y,0)};function se(b,g){for(;(b[g]&65535)!=b[g];)b[g+1]+=b[g]>>>16,b[g]&=65535,g++}function oe(b,g){this.g=b,this.h=g}function qe(b,g){if(L(g))throw Error("division by zero");if(L(b))return new oe(m,m);if(B(b))return g=qe(k(b),g),new oe(k(g.g),k(g.h));if(B(g))return g=qe(b,k(g)),new oe(k(g.g),g.h);if(b.g.length>30){if(B(b)||B(g))throw Error("slowDivide_ only works with positive integers.");for(var y=w,C=g;C.l(b)<=0;)y=He(y),C=He(C);var v=Re(y,1),E=Re(C,1);for(C=Re(C,2),y=Re(y,2);!L(C);){var _=E.add(C);_.l(b)<=0&&(v=v.add(y),E=_),C=Re(C,1),y=Re(y,1)}return g=Y(b,v.j(g)),new oe(v,g)}for(v=m;b.l(g)>=0;){for(y=Math.max(1,Math.floor(b.m()/g.m())),C=Math.ceil(Math.log(y)/Math.LN2),C=C<=48?1:Math.pow(2,C-48),E=d(y),_=E.j(g);B(_)||_.l(b)>0;)y-=C,E=d(y),_=E.j(g);L(E)&&(E=w),v=v.add(E),b=Y(b,_)}return new oe(v,b)}n.B=function(b){return qe(this,b).h},n.and=function(b){let g=Math.max(this.g.length,b.g.length),y=[];for(let C=0;C<g;C++)y[C]=this.i(C)&b.i(C);return new a(y,this.h&b.h)},n.or=function(b){let g=Math.max(this.g.length,b.g.length),y=[];for(let C=0;C<g;C++)y[C]=this.i(C)|b.i(C);return new a(y,this.h|b.h)},n.xor=function(b){let g=Math.max(this.g.length,b.g.length),y=[];for(let C=0;C<g;C++)y[C]=this.i(C)^b.i(C);return new a(y,this.h^b.h)};function He(b){let g=b.g.length+1,y=[];for(let C=0;C<g;C++)y[C]=b.i(C)<<1|b.i(C-1)>>>31;return new a(y,b.h)}function Re(b,g){let y=g>>5;g%=32;let C=b.g.length-y,v=[];for(let E=0;E<C;E++)v[E]=g>0?b.i(E+y)>>>g|b.i(E+y+1)<<32-g:b.i(E+y);return new a(v,b.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Zc=em.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Ot=em.Integer=a}).apply(typeof Zp<"u"?Zp:typeof self<"u"?self:typeof window<"u"?window:{});var Js=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Nt={};var eu,Uw,cr,tu,Ri,Xs,nu,ru,iu;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Js=="object"&&Js];for(var u=0;u<o.length;++u){var h=o[u];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function i(o,u){if(u)e:{var h=r;o=o.split(".");for(var f=0;f<o.length-1;f++){var I=o[f];if(!(I in h))break e;h=h[I]}o=o[o.length-1],f=h[o],u=u(f),u!=f&&u!=null&&e(h,o,{configurable:!0,writable:!0,value:u})}}i("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(o){return o||function(u){var h=[],f;for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&h.push([f,u[f]]);return h}});var s=s||{},a=this||self;function c(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function l(o,u,h){return o.call.apply(o.bind,arguments)}function d(o,u,h){return d=l,d.apply(null,arguments)}function p(o,u){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function m(o,u){function h(){}h.prototype=u.prototype,o.Z=u.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(f,I,T){for(var O=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)O[Z-2]=arguments[Z];return u.prototype[I].apply(f,O)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function R(o){let u=o.length;if(u>0){let h=Array(u);for(let f=0;f<u;f++)h[f]=o[f];return h}return[]}function L(o,u){for(let f=1;f<arguments.length;f++){let I=arguments[f];var h=typeof I;if(h=h!="object"?h:I?Array.isArray(I)?"array":h:"null",h=="array"||h=="object"&&typeof I.length=="number"){h=o.length||0;let T=I.length||0;o.length=h+T;for(let O=0;O<T;O++)o[h+O]=I[O]}else o.push(I)}}class B{constructor(u,h){this.i=u,this.j=h,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function k(o){a.setTimeout(()=>{throw o},0)}function Y(){var o=b;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class se{constructor(){this.h=this.g=null}add(u,h){let f=oe.get();f.set(u,h),this.h?this.h.next=f:this.g=f,this.h=f}}var oe=new B(()=>new qe,o=>o.reset());class qe{constructor(){this.next=this.g=this.h=null}set(u,h){this.h=u,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let He,Re=!1,b=new se,g=()=>{let o=Promise.resolve(void 0);He=()=>{o.then(y)}};function y(){for(var o;o=Y();){try{o.h.call(o.g)}catch(h){k(h)}var u=oe;u.j(o),u.h<100&&(u.h++,o.next=u.g,u.g=o)}Re=!1}function C(){this.u=this.u,this.C=this.C}C.prototype.u=!1,C.prototype.dispose=function(){this.u||(this.u=!0,this.N())},C.prototype[Symbol.dispose]=function(){this.dispose()},C.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function v(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}v.prototype.h=function(){this.defaultPrevented=!0};var E=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};a.addEventListener("test",h,u),a.removeEventListener("test",h,u)}catch{}return o}();function _(o){return/^[\s\xa0]*$/.test(o)}function Ke(o,u){v.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,u)}m(Ke,v),Ke.prototype.init=function(o,u){let h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget,u||(h=="mouseover"?u=o.fromElement:h=="mouseout"&&(u=o.toElement)),this.relatedTarget=u,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Ke.Z.h.call(this)},Ke.prototype.h=function(){Ke.Z.h.call(this);let o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var $t="closure_listenable_"+(Math.random()*1e6|0),A_=0;function x_(o,u,h,f,I){this.listener=o,this.proxy=null,this.src=u,this.type=h,this.capture=!!f,this.ha=I,this.key=++A_,this.da=this.fa=!1}function ns(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function rs(o,u,h){for(let f in o)u.call(h,o[f],f,o)}function R_(o,u){for(let h in o)u.call(void 0,o[h],h,o)}function Eh(o){let u={};for(let h in o)u[h]=o[h];return u}let Th="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Sh(o,u){let h,f;for(let I=1;I<arguments.length;I++){f=arguments[I];for(h in f)o[h]=f[h];for(let T=0;T<Th.length;T++)h=Th[T],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function is(o){this.src=o,this.g={},this.h=0}is.prototype.add=function(o,u,h,f,I){let T=o.toString();o=this.g[T],o||(o=this.g[T]=[],this.h++);let O=ea(o,u,f,I);return O>-1?(u=o[O],h||(u.fa=!1)):(u=new x_(u,this.src,T,!!f,I),u.fa=h,o.push(u)),u};function Zo(o,u){let h=u.type;if(h in o.g){var f=o.g[h],I=Array.prototype.indexOf.call(f,u,void 0),T;(T=I>=0)&&Array.prototype.splice.call(f,I,1),T&&(ns(u),o.g[h].length==0&&(delete o.g[h],o.h--))}}function ea(o,u,h,f){for(let I=0;I<o.length;++I){let T=o[I];if(!T.da&&T.listener==u&&T.capture==!!h&&T.ha==f)return I}return-1}var ta="closure_lm_"+(Math.random()*1e6|0),na={};function Ah(o,u,h,f,I){if(f&&f.once)return Rh(o,u,h,f,I);if(Array.isArray(u)){for(let T=0;T<u.length;T++)Ah(o,u[T],h,f,I);return null}return h=oa(h),o&&o[$t]?o.J(u,h,c(f)?!!f.capture:!!f,I):xh(o,u,h,!1,f,I)}function xh(o,u,h,f,I,T){if(!u)throw Error("Invalid event type");let O=c(I)?!!I.capture:!!I,Z=ia(o);if(Z||(o[ta]=Z=new is(o)),h=Z.add(u,h,f,O,T),h.proxy)return h;if(f=P_(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)E||(I=O),I===void 0&&(I=!1),o.addEventListener(u.toString(),f,I);else if(o.attachEvent)o.attachEvent(Dh(u.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function P_(){function o(h){return u.call(o.src,o.listener,h)}let u=D_;return o}function Rh(o,u,h,f,I){if(Array.isArray(u)){for(let T=0;T<u.length;T++)Rh(o,u[T],h,f,I);return null}return h=oa(h),o&&o[$t]?o.K(u,h,c(f)?!!f.capture:!!f,I):xh(o,u,h,!0,f,I)}function Ph(o,u,h,f,I){if(Array.isArray(u))for(var T=0;T<u.length;T++)Ph(o,u[T],h,f,I);else f=c(f)?!!f.capture:!!f,h=oa(h),o&&o[$t]?(o=o.i,T=String(u).toString(),T in o.g&&(u=o.g[T],h=ea(u,h,f,I),h>-1&&(ns(u[h]),Array.prototype.splice.call(u,h,1),u.length==0&&(delete o.g[T],o.h--)))):o&&(o=ia(o))&&(u=o.g[u.toString()],o=-1,u&&(o=ea(u,h,f,I)),(h=o>-1?u[o]:null)&&ra(h))}function ra(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[$t])Zo(u.i,o);else{var h=o.type,f=o.proxy;u.removeEventListener?u.removeEventListener(h,f,o.capture):u.detachEvent?u.detachEvent(Dh(h),f):u.addListener&&u.removeListener&&u.removeListener(f),(h=ia(u))?(Zo(h,o),h.h==0&&(h.src=null,u[ta]=null)):ns(o)}}}function Dh(o){return o in na?na[o]:na[o]="on"+o}function D_(o,u){if(o.da)o=!0;else{u=new Ke(u,this);let h=o.listener,f=o.ha||o.src;o.fa&&ra(o),o=h.call(f,u)}return o}function ia(o){return o=o[ta],o instanceof is?o:null}var sa="__closure_events_fn_"+(Math.random()*1e9>>>0);function oa(o){return typeof o=="function"?o:(o[sa]||(o[sa]=function(u){return o.handleEvent(u)}),o[sa])}function Le(){C.call(this),this.i=new is(this),this.M=this,this.G=null}m(Le,C),Le.prototype[$t]=!0,Le.prototype.removeEventListener=function(o,u,h,f){Ph(this,o,u,h,f)};function $e(o,u){var h,f=o.G;if(f)for(h=[];f;f=f.G)h.push(f);if(o=o.M,f=u.type||u,typeof u=="string")u=new v(u,o);else if(u instanceof v)u.target=u.target||o;else{var I=u;u=new v(f,o),Sh(u,I)}I=!0;let T,O;if(h)for(O=h.length-1;O>=0;O--)T=u.g=h[O],I=ss(T,f,!0,u)&&I;if(T=u.g=o,I=ss(T,f,!0,u)&&I,I=ss(T,f,!1,u)&&I,h)for(O=0;O<h.length;O++)T=u.g=h[O],I=ss(T,f,!1,u)&&I}Le.prototype.N=function(){if(Le.Z.N.call(this),this.i){var o=this.i;for(let u in o.g){let h=o.g[u];for(let f=0;f<h.length;f++)ns(h[f]);delete o.g[u],o.h--}}this.G=null},Le.prototype.J=function(o,u,h,f){return this.i.add(String(o),u,!1,h,f)},Le.prototype.K=function(o,u,h,f){return this.i.add(String(o),u,!0,h,f)};function ss(o,u,h,f){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();let I=!0;for(let T=0;T<u.length;++T){let O=u[T];if(O&&!O.da&&O.capture==h){let Z=O.listener,Ae=O.ha||O.src;O.fa&&Zo(o.i,O),I=Z.call(Ae,f)!==!1&&I}}return I&&!f.defaultPrevented}function M_(o,u){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:a.setTimeout(o,u||0)}function Mh(o){o.g=M_(()=>{o.g=null,o.i&&(o.i=!1,Mh(o))},o.l);let u=o.h;o.h=null,o.m.apply(null,u)}class k_ extends C{constructor(u,h){super(),this.m=u,this.l=h,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Mh(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Or(o){C.call(this),this.h=o,this.g={}}m(Or,C);var kh=[];function Oh(o){rs(o.g,function(u,h){this.g.hasOwnProperty(h)&&ra(u)},o),o.g={}}Or.prototype.N=function(){Or.Z.N.call(this),Oh(this)},Or.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var aa=a.JSON.stringify,O_=a.JSON.parse,N_=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Nh(){}function Vh(){}var Nr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ca(){v.call(this,"d")}m(ca,v);function ua(){v.call(this,"c")}m(ua,v);var _n={},Lh=null;function os(){return Lh=Lh||new Le}_n.Ia="serverreachability";function Fh(o){v.call(this,_n.Ia,o)}m(Fh,v);function Vr(o){let u=os();$e(u,new Fh(u))}_n.STAT_EVENT="statevent";function Uh(o,u){v.call(this,_n.STAT_EVENT,o),this.stat=u}m(Uh,v);function Ge(o){let u=os();$e(u,new Uh(u,o))}_n.Ja="timingevent";function jh(o,u){v.call(this,_n.Ja,o),this.size=u}m(jh,v);function Lr(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},u)}function Fr(){this.g=!0}Fr.prototype.ua=function(){this.g=!1};function V_(o,u,h,f,I,T){o.info(function(){if(o.g)if(T){var O="",Z=T.split("&");for(let le=0;le<Z.length;le++){var Ae=Z[le].split("=");if(Ae.length>1){let Pe=Ae[0];Ae=Ae[1];let ft=Pe.split("_");O=ft.length>=2&&ft[1]=="type"?O+(Pe+"="+Ae+"&"):O+(Pe+"=redacted&")}}}else O=null;else O=T;return"XMLHTTP REQ ("+f+") [attempt "+I+"]: "+u+`
`+h+`
`+O})}function L_(o,u,h,f,I,T,O){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+I+"]: "+u+`
`+h+`
`+T+" "+O})}function zn(o,u,h,f){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+U_(o,h)+(f?" "+f:"")})}function F_(o,u){o.info(function(){return"TIMEOUT: "+u})}Fr.prototype.info=function(){};function U_(o,u){if(!o.g)return u;if(!u)return null;try{let T=JSON.parse(u);if(T){for(o=0;o<T.length;o++)if(Array.isArray(T[o])){var h=T[o];if(!(h.length<2)){var f=h[1];if(Array.isArray(f)&&!(f.length<1)){var I=f[0];if(I!="noop"&&I!="stop"&&I!="close")for(let O=1;O<f.length;O++)f[O]=""}}}}return aa(T)}catch{return u}}var as={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Bh={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},zh;function la(){}m(la,Nh),la.prototype.g=function(){return new XMLHttpRequest},zh=new la;function Ur(o){return encodeURIComponent(String(o))}function j_(o){var u=1;o=o.split(":");let h=[];for(;u>0&&o.length;)h.push(o.shift()),u--;return o.length&&h.push(o.join(":")),h}function Gt(o,u,h,f){this.j=o,this.i=u,this.l=h,this.S=f||1,this.V=new Or(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new qh}function qh(){this.i=null,this.g="",this.h=!1}var $h={},ha={};function da(o,u,h){o.M=1,o.A=us(dt(u)),o.u=h,o.R=!0,Gh(o,null)}function Gh(o,u){o.F=Date.now(),cs(o),o.B=dt(o.A);var h=o.B,f=o.S;Array.isArray(f)||(f=[String(f)]),id(h.i,"t",f),o.C=0,h=o.j.L,o.h=new qh,o.g=Cd(o.j,h?u:null,!o.u),o.P>0&&(o.O=new k_(d(o.Y,o,o.g),o.P)),u=o.V,h=o.g,f=o.ba;var I="readystatechange";Array.isArray(I)||(I&&(kh[0]=I.toString()),I=kh);for(let T=0;T<I.length;T++){let O=Ah(h,I[T],f||u.handleEvent,!1,u.h||u);if(!O)break;u.g[O.key]=O}u=o.J?Eh(o.J):{},o.u?(o.v||(o.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,u)):(o.v="GET",o.g.ea(o.B,o.v,null,u)),Vr(),V_(o.i,o.v,o.B,o.l,o.S,o.u)}Gt.prototype.ba=function(o){o=o.target;let u=this.O;u&&Wt(o)==3?u.j():this.Y(o)},Gt.prototype.Y=function(o){try{if(o==this.g)e:{let Z=Wt(this.g),Ae=this.g.ya(),le=this.g.ca();if(!(Z<3)&&(Z!=3||this.g&&(this.h.h||this.g.la()||hd(this.g)))){this.K||Z!=4||Ae==7||(Ae==8||le<=0?Vr(3):Vr(2)),fa(this);var u=this.g.ca();this.X=u;var h=B_(this);if(this.o=u==200,L_(this.i,this.v,this.B,this.l,this.S,Z,u),this.o){if(this.U&&!this.L){t:{if(this.g){var f,I=this.g;if((f=I.g?I.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(f)){var T=f;break t}}T=null}if(o=T)zn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,pa(this,o);else{this.o=!1,this.m=3,Ge(12),yn(this),jr(this);break e}}if(this.R){o=!0;let Pe;for(;!this.K&&this.C<h.length;)if(Pe=z_(this,h),Pe==ha){Z==4&&(this.m=4,Ge(14),o=!1),zn(this.i,this.l,null,"[Incomplete Response]");break}else if(Pe==$h){this.m=4,Ge(15),zn(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else zn(this.i,this.l,Pe,null),pa(this,Pe);if(Hh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Z!=4||h.length!=0||this.h.h||(this.m=1,Ge(16),o=!1),this.o=this.o&&o,!o)zn(this.i,this.l,h,"[Invalid Chunked Response]"),yn(this),jr(this);else if(h.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),ba(O),O.P=!0,Ge(11))}}else zn(this.i,this.l,h,null),pa(this,h);Z==4&&yn(this),this.o&&!this.K&&(Z==4?yd(this.j,this):(this.o=!1,cs(this)))}else ny(this.g),u==400&&h.indexOf("Unknown SID")>0?(this.m=3,Ge(12)):(this.m=0,Ge(13)),yn(this),jr(this)}}}catch{}finally{}};function B_(o){if(!Hh(o))return o.g.la();let u=hd(o.g);if(u==="")return"";let h="",f=u.length,I=Wt(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return yn(o),jr(o),"";o.h.i=new a.TextDecoder}for(let T=0;T<f;T++)o.h.h=!0,h+=o.h.i.decode(u[T],{stream:!(I&&T==f-1)});return u.length=0,o.h.g+=h,o.C=0,o.h.g}function Hh(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function z_(o,u){var h=o.C,f=u.indexOf(`
`,h);return f==-1?ha:(h=Number(u.substring(h,f)),isNaN(h)?$h:(f+=1,f+h>u.length?ha:(u=u.slice(f,f+h),o.C=f+h,u)))}Gt.prototype.cancel=function(){this.K=!0,yn(this)};function cs(o){o.T=Date.now()+o.H,Kh(o,o.H)}function Kh(o,u){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Lr(d(o.aa,o),u)}function fa(o){o.D&&(a.clearTimeout(o.D),o.D=null)}Gt.prototype.aa=function(){this.D=null;let o=Date.now();o-this.T>=0?(F_(this.i,this.B),this.M!=2&&(Vr(),Ge(17)),yn(this),this.m=2,jr(this)):Kh(this,this.T-o)};function jr(o){o.j.I==0||o.K||yd(o.j,o)}function yn(o){fa(o);var u=o.O;u&&typeof u.dispose=="function"&&u.dispose(),o.O=null,Oh(o.V),o.g&&(u=o.g,o.g=null,u.abort(),u.dispose())}function pa(o,u){try{var h=o.j;if(h.I!=0&&(h.g==o||ma(h.h,o))){if(!o.L&&ma(h.h,o)&&h.I==3){try{var f=h.Ba.g.parse(u)}catch{f=null}if(Array.isArray(f)&&f.length==3){var I=f;if(I[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)ms(h),fs(h);else break e;wa(h),Ge(18)}}else h.xa=I[1],0<h.xa-h.K&&I[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Lr(d(h.Va,h),6e3));Yh(h.h)<=1&&h.ta&&(h.ta=void 0)}else wn(h,11)}else if((o.L||h.g==o)&&ms(h),!_(u))for(I=h.Ba.g.parse(u),u=0;u<I.length;u++){let le=I[u],Pe=le[0];if(!(Pe<=h.K))if(h.K=Pe,le=le[1],h.I==2)if(le[0]=="c"){h.M=le[1],h.ba=le[2];let ft=le[3];ft!=null&&(h.ka=ft,h.j.info("VER="+h.ka));let bn=le[4];bn!=null&&(h.za=bn,h.j.info("SVER="+h.za));let Qt=le[5];Qt!=null&&typeof Qt=="number"&&Qt>0&&(f=1.5*Qt,h.O=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let Yt=o.g;if(Yt){let _s=Yt.g?Yt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_s){var T=f.h;T.g||_s.indexOf("spdy")==-1&&_s.indexOf("quic")==-1&&_s.indexOf("h2")==-1||(T.j=T.l,T.g=new Set,T.h&&(ga(T,T.h),T.h=null))}if(f.G){let Ca=Yt.g?Yt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ca&&(f.wa=Ca,he(f.J,f.G,Ca))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),f=h;var O=o;if(f.na=bd(f,f.L?f.ba:null,f.W),O.L){Jh(f.h,O);var Z=O,Ae=f.O;Ae&&(Z.H=Ae),Z.D&&(fa(Z),cs(Z)),f.g=O}else gd(f);h.i.length>0&&ps(h)}else le[0]!="stop"&&le[0]!="close"||wn(h,7);else h.I==3&&(le[0]=="stop"||le[0]=="close"?le[0]=="stop"?wn(h,7):va(h):le[0]!="noop"&&h.l&&h.l.qa(le),h.A=0)}}Vr(4)}catch{}}var q_=class{constructor(o,u){this.g=o,this.map=u}};function Wh(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Qh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Yh(o){return o.h?1:o.g?o.g.size:0}function ma(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function ga(o,u){o.g?o.g.add(u):o.h=u}function Jh(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}Wh.prototype.cancel=function(){if(this.i=Xh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Xh(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let u=o.i;for(let h of o.g.values())u=u.concat(h.G);return u}return R(o.i)}var Zh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $_(o,u){if(o){o=o.split("&");for(let h=0;h<o.length;h++){let f=o[h].indexOf("="),I,T=null;f>=0?(I=o[h].substring(0,f),T=o[h].substring(f+1)):I=o[h],u(I,T?decodeURIComponent(T.replace(/\+/g," ")):"")}}}function Ht(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;o instanceof Ht?(this.l=o.l,Br(this,o.j),this.o=o.o,this.g=o.g,zr(this,o.u),this.h=o.h,_a(this,sd(o.i)),this.m=o.m):o&&(u=String(o).match(Zh))?(this.l=!1,Br(this,u[1]||"",!0),this.o=qr(u[2]||""),this.g=qr(u[3]||"",!0),zr(this,u[4]),this.h=qr(u[5]||"",!0),_a(this,u[6]||"",!0),this.m=qr(u[7]||"")):(this.l=!1,this.i=new Gr(null,this.l))}Ht.prototype.toString=function(){let o=[];var u=this.j;u&&o.push($r(u,ed,!0),":");var h=this.g;return(h||u=="file")&&(o.push("//"),(u=this.o)&&o.push($r(u,ed,!0),"@"),o.push(Ur(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push($r(h,h.charAt(0)=="/"?K_:H_,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",$r(h,Q_)),o.join("")},Ht.prototype.resolve=function(o){let u=dt(this),h=!!o.j;h?Br(u,o.j):h=!!o.o,h?u.o=o.o:h=!!o.g,h?u.g=o.g:h=o.u!=null;var f=o.h;if(h)zr(u,o.u);else if(h=!!o.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var I=u.h.lastIndexOf("/");I!=-1&&(f=u.h.slice(0,I+1)+f)}if(I=f,I==".."||I==".")f="";else if(I.indexOf("./")!=-1||I.indexOf("/.")!=-1){f=I.lastIndexOf("/",0)==0,I=I.split("/");let T=[];for(let O=0;O<I.length;){let Z=I[O++];Z=="."?f&&O==I.length&&T.push(""):Z==".."?((T.length>1||T.length==1&&T[0]!="")&&T.pop(),f&&O==I.length&&T.push("")):(T.push(Z),f=!0)}f=T.join("/")}else f=I}return h?u.h=f:h=o.i.toString()!=="",h?_a(u,sd(o.i)):h=!!o.m,h&&(u.m=o.m),u};function dt(o){return new Ht(o)}function Br(o,u,h){o.j=h?qr(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function zr(o,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);o.u=u}else o.u=null}function _a(o,u,h){u instanceof Gr?(o.i=u,Y_(o.i,o.l)):(h||(u=$r(u,W_)),o.i=new Gr(u,o.l))}function he(o,u,h){o.i.set(u,h)}function us(o){return he(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function qr(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function $r(o,u,h){return typeof o=="string"?(o=encodeURI(o).replace(u,G_),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function G_(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var ed=/[#\/\?@]/g,H_=/[#\?:]/g,K_=/[#\?]/g,W_=/[#\?@]/g,Q_=/#/g;function Gr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function vn(o){o.g||(o.g=new Map,o.h=0,o.i&&$_(o.i,function(u,h){o.add(decodeURIComponent(u.replace(/\+/g," ")),h)}))}n=Gr.prototype,n.add=function(o,u){vn(this),this.i=null,o=qn(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(u),this.h+=1,this};function td(o,u){vn(o),u=qn(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function nd(o,u){return vn(o),u=qn(o,u),o.g.has(u)}n.forEach=function(o,u){vn(this),this.g.forEach(function(h,f){h.forEach(function(I){o.call(u,I,f,this)},this)},this)};function rd(o,u){vn(o);let h=[];if(typeof u=="string")nd(o,u)&&(h=h.concat(o.g.get(qn(o,u))));else for(o=Array.from(o.g.values()),u=0;u<o.length;u++)h=h.concat(o[u]);return h}n.set=function(o,u){return vn(this),this.i=null,o=qn(this,o),nd(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=rd(this,o),o.length>0?String(o[0]):u):u};function id(o,u,h){td(o,u),h.length>0&&(o.i=null,o.g.set(qn(o,u),R(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],u=Array.from(this.g.keys());for(let f=0;f<u.length;f++){var h=u[f];let I=Ur(h);h=rd(this,h);for(let T=0;T<h.length;T++){let O=I;h[T]!==""&&(O+="="+Ur(h[T])),o.push(O)}}return this.i=o.join("&")};function sd(o){let u=new Gr;return u.i=o.i,o.g&&(u.g=new Map(o.g),u.h=o.h),u}function qn(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function Y_(o,u){u&&!o.j&&(vn(o),o.i=null,o.g.forEach(function(h,f){let I=f.toLowerCase();f!=I&&(td(this,f),id(this,I,h))},o)),o.j=u}function J_(o,u){let h=new Fr;if(a.Image){let f=new Image;f.onload=p(Kt,h,"TestLoadImage: loaded",!0,u,f),f.onerror=p(Kt,h,"TestLoadImage: error",!1,u,f),f.onabort=p(Kt,h,"TestLoadImage: abort",!1,u,f),f.ontimeout=p(Kt,h,"TestLoadImage: timeout",!1,u,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else u(!1)}function X_(o,u){let h=new Fr,f=new AbortController,I=setTimeout(()=>{f.abort(),Kt(h,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:f.signal}).then(T=>{clearTimeout(I),T.ok?Kt(h,"TestPingServer: ok",!0,u):Kt(h,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(I),Kt(h,"TestPingServer: error",!1,u)})}function Kt(o,u,h,f,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),f(h)}catch{}}function Z_(){this.g=new N_}function ls(o){this.i=o.Sb||null,this.h=o.ab||!1}m(ls,Nh),ls.prototype.g=function(){return new hs(this.i,this.h)};function hs(o,u){Le.call(this),this.H=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(hs,Le),n=hs.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=u,this.readyState=1,Kr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(u.body=o),(this.H||a).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Hr(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Kr(this)),this.g&&(this.readyState=3,Kr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;od(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function od(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?Hr(this):Kr(this),this.readyState==3&&od(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Hr(this))},n.Na=function(o){this.g&&(this.response=o,Hr(this))},n.ga=function(){this.g&&Hr(this)};function Hr(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Kr(o)}n.setRequestHeader=function(o,u){this.A.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],u=this.h.entries();for(var h=u.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=u.next();return o.join(`\r
`)};function Kr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(hs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function ad(o){let u="";return rs(o,function(h,f){u+=f,u+=":",u+=h,u+=`\r
`}),u}function ya(o,u,h){e:{for(f in h){var f=!1;break e}f=!0}f||(h=ad(h),typeof o=="string"?h!=null&&Ur(h):he(o,u,h))}function ge(o){Le.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(ge,Le);var ey=/^https?$/i,ty=["POST","PUT"];n=ge.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,u,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():zh.g(),this.g.onreadystatechange=w(d(this.Ca,this));try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(T){cd(this,T);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var I in f)h.set(I,f[I]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let T of f.keys())h.set(T,f.get(T));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(T=>T.toLowerCase()=="content-type"),I=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(ty,u,void 0)>=0)||f||I||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[T,O]of h)this.g.setRequestHeader(T,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(T){cd(this,T)}};function cd(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.o=5,ud(o),ds(o)}function ud(o){o.A||(o.A=!0,$e(o,"complete"),$e(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,$e(this,"complete"),$e(this,"abort"),ds(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ds(this,!0)),ge.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ld(this):this.Xa())},n.Xa=function(){ld(this)};function ld(o){if(o.h&&typeof s<"u"){if(o.v&&Wt(o)==4)setTimeout(o.Ca.bind(o),0);else if($e(o,"readystatechange"),Wt(o)==4){o.h=!1;try{let T=o.ca();e:switch(T){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var h;if(!(h=u)){var f;if(f=T===0){let O=String(o.D).match(Zh)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),f=!ey.test(O?O.toLowerCase():"")}h=f}if(h)$e(o,"complete"),$e(o,"success");else{o.o=6;try{var I=Wt(o)>2?o.g.statusText:""}catch{I=""}o.l=I+" ["+o.ca()+"]",ud(o)}}finally{ds(o)}}}}function ds(o,u){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);let h=o.g;o.g=null,u||$e(o,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Wt(o){return o.g?o.g.readyState:0}n.ca=function(){try{return Wt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),O_(u)}};function hd(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function ny(o){let u={};o=(o.g&&Wt(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(_(o[f]))continue;var h=j_(o[f]);let I=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let T=u[I]||[];u[I]=T,T.push(h)}R_(u,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Wr(o,u,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||u}function dd(o){this.za=0,this.i=[],this.j=new Fr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Wr("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Wr("baseRetryDelayMs",5e3,o),this.Za=Wr("retryDelaySeedMs",1e4,o),this.Ta=Wr("forwardChannelMaxRetries",2,o),this.va=Wr("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new Wh(o&&o.concurrentRequestLimit),this.Ba=new Z_,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=dd.prototype,n.ka=8,n.I=1,n.connect=function(o,u,h,f){Ge(0),this.W=o,this.H=u||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.J=bd(this,null,this.W),ps(this)};function va(o){if(fd(o),o.I==3){var u=o.V++,h=dt(o.J);if(he(h,"SID",o.M),he(h,"RID",u),he(h,"TYPE","terminate"),Qr(o,h),u=new Gt(o,o.j,u),u.M=2,u.A=us(dt(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(u.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=u.A,h=!0),h||(u.g=Cd(u.j,null),u.g.ea(u.A)),u.F=Date.now(),cs(u)}wd(o)}function fs(o){o.g&&(ba(o),o.g.cancel(),o.g=null)}function fd(o){fs(o),o.v&&(a.clearTimeout(o.v),o.v=null),ms(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function ps(o){if(!Qh(o.h)&&!o.m){o.m=!0;var u=o.Ea;He||g(),Re||(He(),Re=!0),b.add(u,o),o.D=0}}function ry(o,u){return Yh(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=u.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Lr(d(o.Ea,o,u),vd(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;let I=new Gt(this,this.j,o),T=this.o;if(this.U&&(T?(T=Eh(T),Sh(T,this.U)):T=this.U),this.u!==null||this.R||(I.J=T,T=null),this.S)e:{for(var u=0,h=0;h<this.i.length;h++){t:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(u+=f,u>4096){u=h;break e}if(u===4096||h===this.i.length-1){u=h+1;break e}}u=1e3}else u=1e3;u=md(this,I,u),h=dt(this.J),he(h,"RID",o),he(h,"CVER",22),this.G&&he(h,"X-HTTP-Session-Id",this.G),Qr(this,h),T&&(this.R?u="headers="+Ur(ad(T))+"&"+u:this.u&&ya(h,this.u,T)),ga(this.h,I),this.Ra&&he(h,"TYPE","init"),this.S?(he(h,"$req",u),he(h,"SID","null"),I.U=!0,da(I,h,null)):da(I,h,u),this.I=2}}else this.I==3&&(o?pd(this,o):this.i.length==0||Qh(this.h)||pd(this))};function pd(o,u){var h;u?h=u.l:h=o.V++;let f=dt(o.J);he(f,"SID",o.M),he(f,"RID",h),he(f,"AID",o.K),Qr(o,f),o.u&&o.o&&ya(f,o.u,o.o),h=new Gt(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),u&&(o.i=u.G.concat(o.i)),u=md(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),ga(o.h,h),da(h,f,u)}function Qr(o,u){o.H&&rs(o.H,function(h,f){he(u,f,h)}),o.l&&rs({},function(h,f){he(u,f,h)})}function md(o,u,h){h=Math.min(o.i.length,h);let f=o.l?d(o.l.Ka,o.l,o):null;e:{var I=o.i;let Z=-1;for(;;){let Ae=["count="+h];Z==-1?h>0?(Z=I[0].g,Ae.push("ofs="+Z)):Z=0:Ae.push("ofs="+Z);let le=!0;for(let Pe=0;Pe<h;Pe++){var T=I[Pe].g;let ft=I[Pe].map;if(T-=Z,T<0)Z=Math.max(0,I[Pe].g-100),le=!1;else try{T="req"+T+"_"||"";try{var O=ft instanceof Map?ft:Object.entries(ft);for(let[bn,Qt]of O){let Yt=Qt;c(Qt)&&(Yt=aa(Qt)),Ae.push(T+bn+"="+encodeURIComponent(Yt))}}catch(bn){throw Ae.push(T+"type="+encodeURIComponent("_badmap")),bn}}catch{f&&f(ft)}}if(le){O=Ae.join("&");break e}}O=void 0}return o=o.i.splice(0,h),u.G=o,O}function gd(o){if(!o.g&&!o.v){o.Y=1;var u=o.Da;He||g(),Re||(He(),Re=!0),b.add(u,o),o.A=0}}function wa(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Lr(d(o.Da,o),vd(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,_d(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Lr(d(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ge(10),fs(this),_d(this))};function ba(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function _d(o){o.g=new Gt(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var u=dt(o.na);he(u,"RID","rpc"),he(u,"SID",o.M),he(u,"AID",o.K),he(u,"CI",o.F?"0":"1"),!o.F&&o.ia&&he(u,"TO",o.ia),he(u,"TYPE","xmlhttp"),Qr(o,u),o.u&&o.o&&ya(u,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=us(dt(u)),h.u=null,h.R=!0,Gh(h,o)}n.Va=function(){this.C!=null&&(this.C=null,fs(this),wa(this),Ge(19))};function ms(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function yd(o,u){var h=null;if(o.g==u){ms(o),ba(o),o.g=null;var f=2}else if(ma(o.h,u))h=u.G,Jh(o.h,u),f=1;else return;if(o.I!=0){if(u.o)if(f==1){h=u.u?u.u.length:0,u=Date.now()-u.F;var I=o.D;f=os(),$e(f,new jh(f,h)),ps(o)}else gd(o);else if(I=u.m,I==3||I==0&&u.X>0||!(f==1&&ry(o,u)||f==2&&wa(o)))switch(h&&h.length>0&&(u=o.h,u.i=u.i.concat(h)),I){case 1:wn(o,5);break;case 4:wn(o,10);break;case 3:wn(o,6);break;default:wn(o,2)}}}function vd(o,u){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*u}function wn(o,u){if(o.j.info("Error code "+u),u==2){var h=d(o.bb,o),f=o.Ua;let I=!f;f=new Ht(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Br(f,"https"),us(f),I?J_(f.toString(),h):X_(f.toString(),h)}else Ge(2);o.I=0,o.l&&o.l.pa(u),wd(o),fd(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Ge(2)):(this.j.info("Failed to ping google.com"),Ge(1))};function wd(o){if(o.I=0,o.ja=[],o.l){let u=Xh(o.h);(u.length!=0||o.i.length!=0)&&(L(o.ja,u),L(o.ja,o.i),o.h.i.length=0,R(o.i),o.i.length=0),o.l.oa()}}function bd(o,u,h){var f=h instanceof Ht?dt(h):new Ht(h);if(f.g!="")u&&(f.g=u+"."+f.g),zr(f,f.u);else{var I=a.location;f=I.protocol,u=u?u+"."+I.hostname:I.hostname,I=+I.port;let T=new Ht(null);f&&Br(T,f),u&&(T.g=u),I&&zr(T,I),h&&(T.h=h),f=T}return h=o.G,u=o.wa,h&&u&&he(f,h,u),he(f,"VER",o.ka),Qr(o,f),f}function Cd(o,u,h){if(u&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Aa&&!o.ma?new ge(new ls({ab:h})):new ge(o.ma),u.Fa(o.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Id(){}n=Id.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function gs(){}gs.prototype.g=function(o,u){return new We(o,u)};function We(o,u){Le.call(this),this.g=new dd(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(o?o["X-WebChannel-Client-Profile"]=u.sa:o={"X-WebChannel-Client-Profile":u.sa}),this.g.U=o,(o=u&&u.Qb)&&!_(o)&&(this.g.u=o),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!_(u)&&(this.g.G=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new $n(this)}m(We,Le),We.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},We.prototype.close=function(){va(this.g)},We.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=aa(o),o=h);u.i.push(new q_(u.Ya++,o)),u.I==3&&ps(u)},We.prototype.N=function(){this.g.l=null,delete this.j,va(this.g),delete this.g,We.Z.N.call(this)};function Ed(o){ca.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(let h in u){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}m(Ed,ca);function Td(){ua.call(this),this.status=1}m(Td,ua);function $n(o){this.g=o}m($n,Id),$n.prototype.ra=function(){$e(this.g,"a")},$n.prototype.qa=function(o){$e(this.g,new Ed(o))},$n.prototype.pa=function(o){$e(this.g,new Td)},$n.prototype.oa=function(){$e(this.g,"b")},gs.prototype.createWebChannel=gs.prototype.g,We.prototype.send=We.prototype.o,We.prototype.open=We.prototype.m,We.prototype.close=We.prototype.close,iu=Nt.createWebChannelTransport=function(){return new gs},ru=Nt.getStatEventTarget=function(){return os()},nu=Nt.Event=_n,Xs=Nt.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},as.NO_ERROR=0,as.TIMEOUT=8,as.HTTP_ERROR=6,Ri=Nt.ErrorCode=as,Bh.COMPLETE="complete",tu=Nt.EventType=Bh,Vh.EventType=Nr,Nr.OPEN="a",Nr.CLOSE="b",Nr.ERROR="c",Nr.MESSAGE="d",Le.prototype.listen=Le.prototype.J,cr=Nt.WebChannel=Vh,Uw=Nt.FetchXmlHttpFactory=ls,ge.prototype.listenOnce=ge.prototype.K,ge.prototype.getLastError=ge.prototype.Ha,ge.prototype.getLastErrorCode=ge.prototype.ya,ge.prototype.getStatus=ge.prototype.ca,ge.prototype.getResponseJson=ge.prototype.La,ge.prototype.getResponseText=ge.prototype.la,ge.prototype.send=ge.prototype.ea,ge.prototype.setWithCredentials=ge.prototype.Fa,eu=Nt.XhrIo=ge}).apply(typeof Js<"u"?Js:typeof self<"u"?self:typeof window<"u"?window:{});var tm="@firebase/firestore",nm="4.9.2";var ke=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ke.UNAUTHENTICATED=new ke(null),ke.GOOGLE_CREDENTIALS=new ke("google-credentials-uid"),ke.FIRST_PARTY=new ke("first-party-uid"),ke.MOCK_USER=new ke("mock-user");var Pr="12.3.0";var kn=new ar("@firebase/firestore");function ur(){return kn.logLevel}function U(n,...e){if(kn.logLevel<=re.DEBUG){let t=e.map(Jl);kn.debug(`Firestore (${Pr}): ${n}`,...t)}}function Lt(n,...e){if(kn.logLevel<=re.ERROR){let t=e.map(Jl);kn.error(`Firestore (${Pr}): ${n}`,...t)}}function _r(n,...e){if(kn.logLevel<=re.WARN){let t=e.map(Jl);kn.warn(`Firestore (${Pr}): ${n}`,...t)}}function Jl(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Km(n,r,t)}function Km(n,e,t){let r=`FIRESTORE (${Pr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Lt(r),new Error(r)}function ce(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Km(e,i,r)}function H(n,e){return n}var A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends Dt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Vt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var so=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},hu=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ke.UNAUTHENTICATED))}shutdown(){}},du=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},fu=class{constructor(e){this.t=e,this.currentUser=ke.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ce(this.o===void 0,42304);let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),s=new Vt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Vt,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>P(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},c=l=>{U("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>c(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?c(l):(U("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Vt)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(U("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ce(typeof r.accessToken=="string",31837,{l:r}),new so(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ce(e===null||typeof e=="string",2055,{h:e}),new ke(e)}},pu=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ke.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},mu=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new pu(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ke.FIRST_PARTY))}shutdown(){}invalidateToken(){}},oo=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},gu=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Wp(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ce(this.o===void 0,3512);let r=s=>{s.error!=null&&U("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.m;return this.m=s.token,U("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{U("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):U("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new oo(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ce(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new oo(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function jw(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Ni=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=jw(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function te(n,e){return n<e?-1:n>e?1:0}function _u(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),s=e.charAt(r);if(i!==s)return su(i)===su(s)?te(i,s):su(i)?1:-1}return te(n.length,e.length)}var Bw=55296,zw=57343;function su(n){let e=n.charCodeAt(0);return e>=Bw&&e<=zw}function yr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var rm="__name__",ao=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return te(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):_u(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ot.fromString(e.substring(4,e.length-2))}},me=class n extends ao{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new V(A.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},qw=/^[_a-zA-Z][_a-zA-Z0-9]*$/,et=class n extends ao{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return qw.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===rm}static keyField(){return new n([rm])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new V(A.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new V(A.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new V(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else c==="`"?(a=!a,i++):c!=="."||a?(r+=c,i++):(s(),i++)}if(s(),a)throw new V(A.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var q=class n{constructor(e){this.path=e}static fromPath(e){return new n(me.fromString(e))}static fromName(e){return new n(me.fromString(e).popFirst(5))}static empty(){return new n(me.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&me.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return me.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new me(e.slice()))}};function Wm(n,e,t){if(!t)throw new V(A.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function $w(n,e,t,r){if(e===!0&&r===!0)throw new V(A.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function im(n){if(!q.isDocumentKey(n))throw new V(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function sm(n){if(q.isDocumentKey(n))throw new V(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Qm(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function jo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function ct(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=jo(n);throw new V(A.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Gw(n,e){if(e<=0)throw new V(A.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Te(n,e){let t={typeString:n};return e&&(t.value=e),t}function Ki(n,e){if(!Qm(n))throw new V(A.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new V(A.INVALID_ARGUMENT,t);return!0}var om=-62135596800,am=1e6,Se=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*am);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<om)throw new V(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/am}_compareTo(e){return this.seconds===e.seconds?te(this.nanoseconds,e.nanoseconds):te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ki(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-om;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};Se._jsonSchemaVersion="firestore/timestamp/1.0",Se._jsonSchema={type:Te("string",Se._jsonSchemaVersion),seconds:Te("number"),nanoseconds:Te("number")};var K=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Se(0,0))}static max(){return new n(new Se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Vi=-1,yu=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};yu.UNKNOWN_ID=-1;function Hw(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=K.fromTimestamp(r===1e9?new Se(t+1,0):new Se(t,r));return new On(i,q.empty(),e)}function Kw(n){return new On(n.readTime,n.key,Vi)}var On=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(K.min(),q.empty(),Vi)}static max(){return new n(K.max(),q.empty(),Vi)}};function Ww(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=q.comparator(n.documentKey,e.documentKey),t!==0?t:te(n.largestBatchId,e.largestBatchId))}var Qw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",vu=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Dr(n){return P(this,null,function*(){if(n.code!==A.FAILED_PRECONDITION||n.message!==Qw)throw n;U("LocalStore","Unexpectedly lost primary lease")})}var D=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(c=>{++i,c.next(()=>{++s,a&&s===i&&t()},l=>r(l))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),c=0;for(let l=0;l<s;l++){let d=l;t(e[d]).next(p=>{a[d]=p,++c,c===s&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function Yw(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Mr(n){return n.name==="IndexedDbTransactionError"}var Xl=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>r.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),Zl=-1;function Bo(n){return n==null}function Li(n){return n===0&&1/n==-1/0}function Jw(n){return typeof n=="number"&&Number.isInteger(n)&&!Li(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Ym="";function Xw(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=cm(e)),e=Zw(n.get(t),e);return cm(e)}function Zw(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case Ym:t+="";break;default:t+=s}}return t}function cm(n){return n+Ym+""}var eb="remoteDocuments",Jm="owner";var Xm="mutationQueues";var Zm="mutations";var eg="documentMutations",tb="remoteDocumentsV14";var tg="remoteDocumentGlobal";var ng="targets";var rg="targetDocuments";var ig="targetGlobal",sg="collectionParents";var og="clientMetadata";var ag="bundles";var cg="namedQueries";var nb="indexConfiguration";var rb="indexState";var ib="indexEntries";var ug="documentOverlays";var sb="globals";var ob=[Xm,Zm,eg,eb,ng,Jm,ig,rg,og,tg,sg,ag,cg],WT=[...ob,ug],ab=[Xm,Zm,eg,tb,ng,Jm,ig,rg,og,tg,sg,ag,cg,ug],cb=ab,ub=[...cb,nb,rb,ib];var QT=[...ub,sb];function um(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function gn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function lg(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var _e=class n{constructor(e,t){this.comparator=e,this.root=t||Ct.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ct.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ct.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new fr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new fr(this.root,e,this.comparator,!1)}getReverseIterator(){return new fr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new fr(this.root,e,this.comparator,!0)}},fr=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ct=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}};Ct.EMPTY=null,Ct.RED=!0,Ct.BLACK=!1;Ct.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ct(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Oe=class n{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new co(this.data.getIterator())}getIteratorFrom(e){return new co(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},co=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var ot=class n{constructor(e){this.fields=e,e.sort(et.comparator)}static empty(){return new n([])}unionWith(e){let t=new Oe(et.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yr(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var uo=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var ze=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new uo("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ze.EMPTY_BYTE_STRING=new ze("");var lb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ft(n){if(ce(!!n,39018),typeof n=="string"){let e=0,t=lb.exec(n);if(ce(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:pe(n.seconds),nanos:pe(n.nanos)}}function pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ut(n){return typeof n=="string"?ze.fromBase64String(n):ze.fromUint8Array(n)}var hg="server_timestamp",dg="__type__",fg="__previous_value__",pg="__local_write_time__";function eh(n){return(n?.mapValue?.fields||{})[dg]?.stringValue===hg}function zo(n){let e=n.mapValue.fields[fg];return eh(e)?zo(e):e}function Fi(n){let e=Ft(n.mapValue.fields[pg].timestampValue);return new Se(e.seconds,e.nanos)}var wu=class{constructor(e,t,r,i,s,a,c,l,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=p}},lo="(default)",ho=class n{constructor(e,t){this.projectId=e,this.database=t||lo}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===lo}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var th="__type__",mg="__max__",Zs={mapValue:{fields:{__type__:{stringValue:mg}}}},nh="__vector__",vr="value";function hn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?eh(n)?4:_g(n)?9007199254740991:gg(n)?10:11:$(28295,{value:n})}function Tt(n,e){if(n===e)return!0;let t=hn(n);if(t!==hn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Fi(n).isEqual(Fi(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=Ft(i.timestampValue),c=Ft(s.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Ut(i.bytesValue).isEqual(Ut(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return pe(i.geoPointValue.latitude)===pe(s.geoPointValue.latitude)&&pe(i.geoPointValue.longitude)===pe(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return pe(i.integerValue)===pe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=pe(i.doubleValue),c=pe(s.doubleValue);return a===c?Li(a)===Li(c):isNaN(a)&&isNaN(c)}return!1}(n,e);case 9:return yr(n.arrayValue.values||[],e.arrayValue.values||[],Tt);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},c=s.mapValue.fields||{};if(um(a)!==um(c))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!Tt(a[l],c[l])))return!1;return!0}(n,e);default:return $(52216,{left:n})}}function Ui(n,e){return(n.values||[]).find(t=>Tt(t,e))!==void 0}function wr(n,e){if(n===e)return 0;let t=hn(n),r=hn(e);if(t!==r)return te(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return te(n.booleanValue,e.booleanValue);case 2:return function(s,a){let c=pe(s.integerValue||s.doubleValue),l=pe(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1}(n,e);case 3:return lm(n.timestampValue,e.timestampValue);case 4:return lm(Fi(n),Fi(e));case 5:return _u(n.stringValue,e.stringValue);case 6:return function(s,a){let c=Ut(s),l=Ut(a);return c.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){let c=s.split("/"),l=a.split("/");for(let d=0;d<c.length&&d<l.length;d++){let p=te(c[d],l[d]);if(p!==0)return p}return te(c.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){let c=te(pe(s.latitude),pe(a.latitude));return c!==0?c:te(pe(s.longitude),pe(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return hm(n.arrayValue,e.arrayValue);case 10:return function(s,a){let c=s.fields||{},l=a.fields||{},d=c[vr]?.arrayValue,p=l[vr]?.arrayValue,m=te(d?.values?.length||0,p?.values?.length||0);return m!==0?m:hm(d,p)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===Zs.mapValue&&a===Zs.mapValue)return 0;if(s===Zs.mapValue)return 1;if(a===Zs.mapValue)return-1;let c=s.fields||{},l=Object.keys(c),d=a.fields||{},p=Object.keys(d);l.sort(),p.sort();for(let m=0;m<l.length&&m<p.length;++m){let w=_u(l[m],p[m]);if(w!==0)return w;let R=wr(c[l[m]],d[p[m]]);if(R!==0)return R}return te(l.length,p.length)}(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function lm(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return te(n,e);let t=Ft(n),r=Ft(e),i=te(t.seconds,r.seconds);return i!==0?i:te(t.nanos,r.nanos)}function hm(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=wr(t[i],r[i]);if(s)return s}return te(t.length,r.length)}function br(n){return bu(n)}function bu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Ft(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ut(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return q.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=bu(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of r)s?s=!1:i+=",",i+=`${a}:${bu(t.fields[a])}`;return i+"}"}(n.mapValue):$(61005,{value:n})}function no(n){switch(hn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=zo(n);return e?16+no(e):16;case 5:return 2*n.stringValue.length;case 6:return Ut(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+no(s),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return gn(r.fields,(s,a)=>{i+=s.length+no(a)}),i}(n.mapValue);default:throw $(13486,{value:n})}}function dm(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Cu(n){return!!n&&"integerValue"in n}function rh(n){return!!n&&"arrayValue"in n}function fm(n){return!!n&&"nullValue"in n}function pm(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ro(n){return!!n&&"mapValue"in n}function gg(n){return(n?.mapValue?.fields||{})[th]?.stringValue===nh}function Di(n){if(n.geoPointValue)return{geoPointValue:j({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:j({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return gn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Di(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Di(n.arrayValue.values[t]);return e}return j({},n)}function _g(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===mg}var JT={mapValue:{fields:{[th]:{stringValue:nh},[vr]:{arrayValue:{}}}}};var Ze=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ro(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Di(t)}setAll(e){let t=et.emptyPath(),r={},i=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=c.popLast()}a?r[c.lastSegment()]=Di(a):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());ro(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Tt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ro(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){gn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Di(this.value))}};function yg(n){let e=[];return gn(n.fields,(t,r)=>{let i=new et([t]);if(ro(r)){let s=yg(r.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new ot(e)}var ut=class n{constructor(e,t,r,i,s,a,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=c}static newInvalidDocument(e){return new n(e,0,K.min(),K.min(),K.min(),Ze.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,K.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,K.min(),K.min(),Ze.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,K.min(),K.min(),Ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Cr=class{constructor(e,t){this.position=e,this.inclusive=t}};function mm(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField()?r=q.comparator(q.fromName(a.referenceValue),t.key):r=wr(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function gm(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Tt(n.position[t],e.position[t]))return!1;return!0}var Nn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function hb(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var fo=class{},Ee=class n extends fo{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Eu(e,t,r):t==="array-contains"?new Au(e,r):t==="in"?new xu(e,r):t==="not-in"?new Ru(e,r):t==="array-contains-any"?new Pu(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Tu(e,r):new Su(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(wr(t,this.value)):t!==null&&hn(this.value)===hn(t)&&this.matchesComparison(wr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},lt=class n extends fo{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return vg(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function vg(n){return n.op==="and"}function wg(n){return db(n)&&vg(n)}function db(n){for(let e of n.filters)if(e instanceof lt)return!1;return!0}function Iu(n){if(n instanceof Ee)return n.field.canonicalString()+n.op.toString()+br(n.value);if(wg(n))return n.filters.map(e=>Iu(e)).join(",");{let e=n.filters.map(t=>Iu(t)).join(",");return`${n.op}(${e})`}}function bg(n,e){return n instanceof Ee?function(r,i){return i instanceof Ee&&r.op===i.op&&r.field.isEqual(i.field)&&Tt(r.value,i.value)}(n,e):n instanceof lt?function(r,i){return i instanceof lt&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,c)=>s&&bg(a,i.filters[c]),!0):!1}(n,e):void $(19439)}function Cg(n){return n instanceof Ee?function(t){return`${t.field.canonicalString()} ${t.op} ${br(t.value)}`}(n):n instanceof lt?function(t){return t.op.toString()+" {"+t.getFilters().map(Cg).join(" ,")+"}"}(n):"Filter"}var Eu=class extends Ee{constructor(e,t,r){super(e,t,r),this.key=q.fromName(r.referenceValue)}matches(e){let t=q.comparator(e.key,this.key);return this.matchesComparison(t)}},Tu=class extends Ee{constructor(e,t){super(e,"in",t),this.keys=Ig("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Su=class extends Ee{constructor(e,t){super(e,"not-in",t),this.keys=Ig("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Ig(n,e){return(e.arrayValue?.values||[]).map(t=>q.fromName(t.referenceValue))}var Au=class extends Ee{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return rh(t)&&Ui(t.arrayValue,this.value)}},xu=class extends Ee{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ui(this.value.arrayValue,t)}},Ru=class extends Ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ui(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ui(this.value.arrayValue,t)}},Pu=class extends Ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!rh(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ui(this.value.arrayValue,r))}};var Du=class{constructor(e,t=null,r=[],i=[],s=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=c,this.Te=null}};function _m(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Du(n,e,t,r,i,s,a)}function ih(n){let e=H(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Iu(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Bo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>br(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>br(r)).join(",")),e.Te=t}return e.Te}function sh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!hb(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!bg(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!gm(n.startAt,e.startAt)&&gm(n.endAt,e.endAt)}function Mu(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var dn=class{constructor(e,t=null,r=[],i=[],s=null,a="F",c=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=c,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function fb(n,e,t,r,i,s,a,c){return new dn(n,e,t,r,i,s,a,c)}function oh(n){return new dn(n)}function ym(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Eg(n){return n.collectionGroup!==null}function Mi(n){let e=H(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new Oe(et.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new Nn(s,r))}),t.has(et.keyField().canonicalString())||e.Ie.push(new Nn(et.keyField(),r))}return e.Ie}function It(n){let e=H(n);return e.Ee||(e.Ee=pb(e,Mi(n))),e.Ee}function pb(n,e){if(n.limitType==="F")return _m(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Nn(i.field,s)});let t=n.endAt?new Cr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Cr(n.startAt.position,n.startAt.inclusive):null;return _m(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ku(n,e){let t=n.filters.concat([e]);return new dn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function po(n,e,t){return new dn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function qo(n,e){return sh(It(n),It(e))&&n.limitType===e.limitType}function Tg(n){return`${ih(It(n))}|lt:${n.limitType}`}function lr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Cg(i)).join(", ")}]`),Bo(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>br(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>br(i)).join(",")),`Target(${r})`}(It(n))}; limitType=${n.limitType})`}function $o(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):q.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Mi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,c,l){let d=mm(a,c,l);return a.inclusive?d<=0:d<0}(r.startAt,Mi(r),i)||r.endAt&&!function(a,c,l){let d=mm(a,c,l);return a.inclusive?d>=0:d>0}(r.endAt,Mi(r),i))}(n,e)}function mb(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Sg(n){return(e,t)=>{let r=!1;for(let i of Mi(n)){let s=gb(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function gb(n,e,t){let r=n.field.isKeyField()?q.comparator(e.key,t.key):function(s,a,c){let l=a.data.field(s),d=c.data.field(s);return l!==null&&d!==null?wr(l,d):$(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}var jt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){gn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return lg(this.inner)}size(){return this.innerSize}};var _b=new _e(q.comparator);function Bt(){return _b}var Ag=new _e(q.comparator);function Pi(...n){let e=Ag;for(let t of n)e=e.insert(t.key,t);return e}function xg(n){let e=Ag;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Rn(){return ki()}function Rg(){return ki()}function ki(){return new jt(n=>n.toString(),(n,e)=>n.isEqual(e))}var yb=new _e(q.comparator),vb=new Oe(q.comparator);function ne(...n){let e=vb;for(let t of n)e=e.add(t);return e}var wb=new Oe(te);function bb(){return wb}function ah(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Li(e)?"-0":e}}function Pg(n){return{integerValue:""+n}}function Cb(n,e){return Jw(e)?Pg(e):ah(n,e)}var Ir=class{constructor(){this._=void 0}};function Ib(n,e,t){return n instanceof Er?function(i,s){let a={fields:{[dg]:{stringValue:hg},[pg]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&eh(s)&&(s=zo(s)),s&&(a.fields[fg]=s),{mapValue:a}}(t,e):n instanceof Vn?Mg(n,e):n instanceof Ln?kg(n,e):function(i,s){let a=Dg(i,s),c=vm(a)+vm(i.Ae);return Cu(a)&&Cu(i.Ae)?Pg(c):ah(i.serializer,c)}(n,e)}function Eb(n,e,t){return n instanceof Vn?Mg(n,e):n instanceof Ln?kg(n,e):t}function Dg(n,e){return n instanceof Tr?function(r){return Cu(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Er=class extends Ir{},Vn=class extends Ir{constructor(e){super(),this.elements=e}};function Mg(n,e){let t=Og(e);for(let r of n.elements)t.some(i=>Tt(i,r))||t.push(r);return{arrayValue:{values:t}}}var Ln=class extends Ir{constructor(e){super(),this.elements=e}};function kg(n,e){let t=Og(e);for(let r of n.elements)t=t.filter(i=>!Tt(i,r));return{arrayValue:{values:t}}}var Tr=class extends Ir{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function vm(n){return pe(n.integerValue||n.doubleValue)}function Og(n){return rh(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Tb(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Vn&&i instanceof Vn||r instanceof Ln&&i instanceof Ln?yr(r.elements,i.elements,Tt):r instanceof Tr&&i instanceof Tr?Tt(r.Ae,i.Ae):r instanceof Er&&i instanceof Er}(n.transform,e.transform)}var Ou=class{constructor(e,t){this.version=e,this.transformResults=t}},tt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function io(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Sr=class{};function Ng(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ar(n.key,tt.none()):new Fn(n.key,n.data,tt.none());{let t=n.data,r=Ze.empty(),i=new Oe(et.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new St(n.key,r,new ot(i.toArray()),tt.none())}}function Sb(n,e,t){n instanceof Fn?function(i,s,a){let c=i.value.clone(),l=bm(i.fieldTransforms,s,a.transformResults);c.setAll(l),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):n instanceof St?function(i,s,a){if(!io(i.precondition,s))return void s.convertToUnknownDocument(a.version);let c=bm(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(Vg(i)),l.setAll(c),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Oi(n,e,t,r){return n instanceof Fn?function(s,a,c,l){if(!io(s.precondition,a))return c;let d=s.value.clone(),p=Cm(s.fieldTransforms,l,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof St?function(s,a,c,l){if(!io(s.precondition,a))return c;let d=Cm(s.fieldTransforms,l,a),p=a.data;return p.setAll(Vg(s)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(s,a,c){return io(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(n,e,t)}function Ab(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=Dg(r.transform,i||null);s!=null&&(t===null&&(t=Ze.empty()),t.set(r.field,s))}return t||null}function wm(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&yr(r,i,(s,a)=>Tb(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Fn=class extends Sr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},St=class extends Sr{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Vg(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function bm(n,e,t){let r=new Map;ce(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,c=e.data.field(s.field);r.set(s.field,Eb(a,c,t[i]))}return r}function Cm(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,Ib(s,a,e))}return r}var Ar=class extends Sr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Nu=class extends Sr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Vu=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&Sb(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Oi(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Oi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Rg();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,c=this.applyToLocalView(a,s.mutatedFields);c=t.has(i.key)?null:c;let l=Ng(a,c);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(K.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ne())}isEqual(e){return this.batchId===e.batchId&&yr(this.mutations,e.mutations,(t,r)=>wm(t,r))&&yr(this.baseMutations,e.baseMutations,(t,r)=>wm(t,r))}},Lu=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){ce(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=function(){return yb}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};var Fu=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Uu=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ce,ie;function xb(n){switch(n){case A.OK:return $(64938);case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function Lg(n){if(n===void 0)return Lt("GRPC error has no .code"),A.UNKNOWN;switch(n){case Ce.OK:return A.OK;case Ce.CANCELLED:return A.CANCELLED;case Ce.UNKNOWN:return A.UNKNOWN;case Ce.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case Ce.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case Ce.INTERNAL:return A.INTERNAL;case Ce.UNAVAILABLE:return A.UNAVAILABLE;case Ce.UNAUTHENTICATED:return A.UNAUTHENTICATED;case Ce.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case Ce.NOT_FOUND:return A.NOT_FOUND;case Ce.ALREADY_EXISTS:return A.ALREADY_EXISTS;case Ce.PERMISSION_DENIED:return A.PERMISSION_DENIED;case Ce.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case Ce.ABORTED:return A.ABORTED;case Ce.OUT_OF_RANGE:return A.OUT_OF_RANGE;case Ce.UNIMPLEMENTED:return A.UNIMPLEMENTED;case Ce.DATA_LOSS:return A.DATA_LOSS;default:return $(39323,{code:n})}}(ie=Ce||(Ce={}))[ie.OK=0]="OK",ie[ie.CANCELLED=1]="CANCELLED",ie[ie.UNKNOWN=2]="UNKNOWN",ie[ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ie[ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ie[ie.NOT_FOUND=5]="NOT_FOUND",ie[ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",ie[ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",ie[ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",ie[ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ie[ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ie[ie.ABORTED=10]="ABORTED",ie[ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",ie[ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",ie[ie.INTERNAL=13]="INTERNAL",ie[ie.UNAVAILABLE=14]="UNAVAILABLE",ie[ie.DATA_LOSS=15]="DATA_LOSS";var Rb=null;function Pb(){return new TextEncoder}var Db=new Ot([4294967295,4294967295],0);function Im(n){let e=Pb().encode(n),t=new Zc;return t.update(e),new Uint8Array(t.digest())}function Em(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ot([t,r],0),new Ot([i,s],0)]}var ju=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Pn(`Invalid padding: ${t}`);if(r<0)throw new Pn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Pn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Pn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ot.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Ot.fromNumber(r)));return i.compare(Db)===1&&(i=new Ot([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=Im(e),[r,i]=Em(t);for(let s=0;s<this.hashCount;s++){let a=this.ye(r,i,s);if(!this.we(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(c=>a.insert(c)),a}insert(e){if(this.ge===0)return;let t=Im(e),[r,i]=Em(t);for(let s=0;s<this.hashCount;s++){let a=this.ye(r,i,s);this.Se(a)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Pn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var mo=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,ji.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(K.min(),i,new _e(te),Bt(),ne())}},ji=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ne(),ne(),ne())}};var pr=class{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}},go=class{constructor(e,t){this.targetId=e,this.Ce=t}},_o=class{constructor(e,t,r=ze.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},yo=class{constructor(){this.ve=0,this.Fe=Tm(),this.Me=ze.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ne(),t=ne(),r=ne();return this.Fe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:$(38017,{changeType:s})}}),new ji(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Tm()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ce(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},Bu=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=Bt(),this.Je=eo(),this.He=eo(),this.Ye=new _e(te)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,i)=>{this.rt(i)&&t(i)})}st(e){let t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){let s=i.target;if(Mu(s))if(r===0){let a=new q(s.path);this.et(t,a,ut.newNoDocument(a,K.min()))}else ce(r===1,20013,{expectedCount:r});else{let a=this._t(t);if(a!==r){let c=this.ut(e),l=c?this.ct(c,e,a):1;if(l!==0){this.it(t);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}Rb?.lt(function(p,m,w,R,L){let B={localCacheCount:p,existenceFilterCount:m.count,databaseId:w.database,projectId:w.projectId},k=m.unchangedNames;return k&&(B.bloomFilter={applied:L===0,hashCount:k?.hashCount??0,bitmapLength:k?.bits?.bitmap?.length??0,padding:k?.bits?.padding??0,mightContain:Y=>R?.mightContain(Y)??!1}),B}(a,e.Ce,this.Ge.ht(),c,l))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a,c;try{a=Ut(r).toUint8Array()}catch(l){if(l instanceof uo)return _r("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new ju(a,i,s)}catch(l){return _r(l instanceof Pn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.ge===0?null:c}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.et(t,s,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((s,a)=>{let c=this.ot(a);if(c){if(s.current&&Mu(c.target)){let l=new q(c.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,ut.newNoDocument(l,e))}s.Be&&(t.set(a,s.ke()),s.qe())}});let r=ne();this.He.forEach((s,a)=>{let c=!0;a.forEachWhile(l=>{let d=this.ot(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.je.forEach((s,a)=>a.setReadTime(e));let i=new mo(e,t,this.Ye,this.je,r);return this.je=Bt(),this.Je=eo(),this.He=eo(),this.Ye=new _e(te),i}Xe(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new yo,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Oe(te),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Oe(te),this.Je=this.Je.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||U("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new yo),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function eo(){return new _e(q.comparator)}function Tm(){return new _e(q.comparator)}var Mb={asc:"ASCENDING",desc:"DESCENDING"},kb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ob={and:"AND",or:"OR"},zu=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function qu(n,e){return n.useProto3Json||Bo(e)?e:{value:e}}function vo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Fg(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Nb(n,e){return vo(n,e.toTimestamp())}function Et(n){return ce(!!n,49232),K.fromTimestamp(function(t){let r=Ft(t);return new Se(r.seconds,r.nanos)}(n))}function ch(n,e){return $u(n,e).canonicalString()}function $u(n,e){let t=function(i){return new me(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Ug(n){let e=me.fromString(n);return ce($g(e),10190,{key:e.toString()}),e}function Gu(n,e){return ch(n.databaseId,e.path)}function ou(n,e){let t=Ug(e);if(t.get(1)!==n.databaseId.projectId)throw new V(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new q(Bg(t))}function jg(n,e){return ch(n.databaseId,e)}function Vb(n){let e=Ug(n);return e.length===4?me.emptyPath():Bg(e)}function Hu(n){return new me(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Bg(n){return ce(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Sm(n,e,t){return{name:Gu(n,e),fields:t.value.mapValue.fields}}function Lb(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:$(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(d,p){return d.useProto3Json?(ce(p===void 0||typeof p=="string",58123),ze.fromBase64String(p||"")):(ce(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),ze.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(d){let p=d.code===void 0?A.UNKNOWN:Lg(d.code);return new V(p,d.message||"")}(a);t=new _o(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=ou(n,r.document.name),s=Et(r.document.updateTime),a=r.document.createTime?Et(r.document.createTime):K.min(),c=new Ze({mapValue:{fields:r.document.fields}}),l=ut.newFoundDocument(i,s,a,c),d=r.targetIds||[],p=r.removedTargetIds||[];t=new pr(d,p,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=ou(n,r.document),s=r.readTime?Et(r.readTime):K.min(),a=ut.newNoDocument(i,s),c=r.removedTargetIds||[];t=new pr([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=ou(n,r.document),s=r.removedTargetIds||[];t=new pr([],s,i,null)}else{if(!("filter"in e))return $(11601,{Rt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new Uu(i,s),c=r.targetId;t=new go(c,a)}}return t}function Fb(n,e){let t;if(e instanceof Fn)t={update:Sm(n,e.key,e.value)};else if(e instanceof Ar)t={delete:Gu(n,e.key)};else if(e instanceof St)t={update:Sm(n,e.key,e.data),updateMask:Kb(e.fieldMask)};else{if(!(e instanceof Nu))return $(16599,{Vt:e.type});t={verify:Gu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){let c=a.transform;if(c instanceof Er)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Vn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Ln)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Tr)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw $(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Nb(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:$(27497)}(n,e.precondition)),t}function Ub(n,e){return n&&n.length>0?(ce(e!==void 0,14353),n.map(t=>function(i,s){let a=i.updateTime?Et(i.updateTime):Et(s);return a.isEqual(K.min())&&(a=Et(s)),new Ou(a,i.transformResults||[])}(t,e))):[]}function jb(n,e){return{documents:[jg(n,e.path)]}}function Bb(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=jg(n,i);let s=function(d){if(d.length!==0)return qg(lt.create(d,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(p=>function(w){return{field:hr(w.field),direction:$b(w.dir)}}(p))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let c=qu(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:t,parent:i}}function zb(n){let e=Vb(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){ce(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];t.where&&(s=function(m){let w=zg(m);return w instanceof lt&&wg(w)?w.getFilters():[w]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(w=>function(L){return new Nn(dr(L.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(w))}(t.orderBy));let c=null;t.limit&&(c=function(m){let w;return w=typeof m=="object"?m.value:m,Bo(w)?null:w}(t.limit));let l=null;t.startAt&&(l=function(m){let w=!!m.before,R=m.values||[];return new Cr(R,w)}(t.startAt));let d=null;return t.endAt&&(d=function(m){let w=!m.before,R=m.values||[];return new Cr(R,w)}(t.endAt)),fb(e,i,a,s,c,"F",l,d)}function qb(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zg(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=dr(t.unaryFilter.field);return Ee.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=dr(t.unaryFilter.field);return Ee.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=dr(t.unaryFilter.field);return Ee.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=dr(t.unaryFilter.field);return Ee.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}}(n):n.fieldFilter!==void 0?function(t){return Ee.create(dr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return lt.create(t.compositeFilter.filters.map(r=>zg(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return $(1026)}}(t.compositeFilter.op))}(n):$(30097,{filter:n})}function $b(n){return Mb[n]}function Gb(n){return kb[n]}function Hb(n){return Ob[n]}function hr(n){return{fieldPath:n.canonicalString()}}function dr(n){return et.fromServerFormat(n.fieldPath)}function qg(n){return n instanceof Ee?function(t){if(t.op==="=="){if(pm(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NAN"}};if(fm(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(pm(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NOT_NAN"}};if(fm(t.value))return{unaryFilter:{field:hr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hr(t.field),op:Gb(t.op),value:t.value}}}(n):n instanceof lt?function(t){let r=t.getFilters().map(i=>qg(i));return r.length===1?r[0]:{compositeFilter:{op:Hb(t.op),filters:r}}}(n):$(54877,{filter:n})}function Kb(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function $g(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Bi=class n{constructor(e,t,r,i,s=K.min(),a=K.min(),c=ze.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ku=class{constructor(e){this.yt=e}};function Wb(n){let e=zb({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?po(e,e.limit,"L"):e}var wo=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(pe(e.integerValue));else if("doubleValue"in e){let r=pe(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Li(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Ft(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ut(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?_g(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):gg(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):$(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=vr,s=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(pe(s)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),q.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};wo.Kt=new wo;var Wu=class{constructor(){this.Cn=new Qu}addToCollectionParentIndex(e,t){return this.Cn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(On.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(On.min())}updateCollectionGroup(e,t,r){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}},Qu=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Oe(me.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Oe(me.comparator)).toArray()}};var XT=new Uint8Array(0);var Am={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Gg=41943040,st=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};st.DEFAULT_COLLECTION_PERCENTILE=10,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,st.DEFAULT=new st(Gg,st.DEFAULT_COLLECTION_PERCENTILE,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),st.DISABLED=new st(-1,0,0);var zi=class n{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var xm="LruGarbageCollector",Qb=1048576;function Rm([n,e],[t,r]){let i=te(n,t);return i===0?te(e,r):i}var Yu=class{constructor(e){this.Ir=e,this.buffer=new Oe(Rm),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Rm(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ju=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){U(xm,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>P(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Mr(t)?U(xm,"Ignoring IndexedDB error during garbage collection: ",t):yield Dr(t)}yield this.Vr(3e5)}))}},Xu=class{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return D.resolve(Xl.ce);let r=new Yu(t);return this.mr.forEachTarget(e,i=>r.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>r.Ar(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(U("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(Am)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Am):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,s,a,c,l,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(U("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,c=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(d=Date.now(),ur()<=re.DEBUG&&U("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(c-a)+`ms
	Removed ${s} targets in `+(l-c)+`ms
	Removed ${m} documents in `+(d-l)+`ms
Total Duration: ${d-p}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function Yb(n,e){return new Xu(n,e)}var Zu=class{constructor(){this.changes=new jt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ut.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?D.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var el=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var tl=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Oi(r.mutation,i,ot.empty(),Se.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ne()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ne()){let i=Rn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=Pi();return s.forEach((c,l)=>{a=a.insert(c,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Rn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ne()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,r,i){let s=Bt(),a=ki(),c=function(){return ki()}();return t.forEach((l,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof St)?s=s.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Oi(p.mutation,d,p.mutation.getFieldMask(),Se.now())):a.set(d.key,ot.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>c.set(d,new el(p,a.get(d)??null))),c))}recalculateAndSaveOverlays(e,t){let r=ki(),i=new _e((a,c)=>a-c),s=ne();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let c of a)c.keys().forEach(l=>{let d=t.get(l);if(d===null)return;let p=r.get(l)||ot.empty();p=c.applyToLocalView(d,p),r.set(l,p);let m=(i.get(c.batchId)||ne()).add(l);i=i.insert(c.batchId,m)})}).next(()=>{let a=[],c=i.getReverseIterator();for(;c.hasNext();){let l=c.getNext(),d=l.key,p=l.value,m=Rg();p.forEach(w=>{if(!s.has(w)){let R=Ng(t.get(w),r.get(w));R!==null&&m.set(w,R),s=s.add(w)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,m))}return D.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return q.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Eg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):D.resolve(Rn()),c=Vi,l=s;return a.next(d=>D.forEach(d,(p,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),s.get(p)?D.resolve():this.remoteDocumentCache.getEntry(e,p).next(w=>{l=l.insert(p,w)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,l,d,ne())).next(p=>({batchId:c,changes:xg(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(r=>{let i=Pi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=Pi();return this.indexManager.getCollectionParents(e,s).next(c=>D.forEach(c,l=>{let d=function(m,w){return new dn(w,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((m,w)=>{a=a.insert(m,w)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((l,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,ut.newInvalidDocument(p)))});let c=Pi();return a.forEach((l,d)=>{let p=s.get(l);p!==void 0&&Oi(p.mutation,d,ot.empty(),Se.now()),$o(t,d)&&(c=c.insert(l,d))}),c})}};var nl=class{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return D.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Et(i.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(i){return{name:i.name,query:Wb(i.bundledQuery),readTime:Et(i.readTime)}}(t)),D.resolve()}};var rl=class{constructor(){this.overlays=new _e(q.comparator),this.qr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Rn();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.St(e,t,s)}),D.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.qr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.qr.delete(r)),D.resolve()}getOverlaysForCollection(e,t,r){let i=Rn(),s=t.length+1,a=new q(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){let l=c.getNext().value,d=l.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return D.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new _e((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=s.get(d.largestBatchId);p===null&&(p=Rn(),s=s.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let c=Rn(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,p)=>c.set(d,p)),!(c.size()>=i)););return D.resolve(c)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Fu(t,r));let s=this.qr.get(t);s===void 0&&(s=ne(),this.qr.set(t,s)),this.qr.set(t,s.add(r.key))}};var il=class{constructor(){this.sessionToken=ze.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}};var qi=class{constructor(){this.Qr=new Oe(Ie.$r),this.Ur=new Oe(Ie.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new Ie(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Ie(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){let t=new q(new me([])),r=new Ie(t,e),i=new Ie(t,e+1),s=[];return this.Ur.forEachInRange([r,i],a=>{this.Gr(a),s.push(a.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new q(new me([])),r=new Ie(t,e),i=new Ie(t,e+1),s=ne();return this.Ur.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new Ie(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ie=class{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return q.comparator(e.key,t.key)||te(e.Yr,t.Yr)}static Kr(e,t){return te(e.Yr,t.Yr)||q.comparator(e.key,t.key)}};var sl=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Oe(Ie.$r)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Vu(s,t,r,i);this.mutationQueue.push(a);for(let c of i)this.Zr=this.Zr.add(new Ie(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return D.resolve(a)}lookupMutationBatch(e,t){return D.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.ei(r),s=i<0?0:i;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?Zl:this.tr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ie(t,0),i=new Ie(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,i],a=>{let c=this.Xr(a.Yr);s.push(c)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Oe(te);return t.forEach(i=>{let s=new Ie(i,0),a=new Ie(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,a],c=>{r=r.add(c.Yr)})}),D.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;q.isDocumentKey(s)||(s=s.child(""));let a=new Ie(new q(s),0),c=new Oe(te);return this.Zr.forEachWhile(l=>{let d=l.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(c=c.add(l.Yr)),!0)},a),D.resolve(this.ti(c))}ti(e){let t=[];return e.forEach(r=>{let i=this.Xr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){ce(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return D.forEach(t.mutations,i=>{let s=new Ie(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new Ie(t,0),i=this.Zr.firstAfterOrEqual(r);return D.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var ol=class{constructor(e){this.ri=e,this.docs=function(){return new _e(q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return D.resolve(r?r.document.mutableCopy():ut.newInvalidDocument(t))}getEntries(e,t){let r=Bt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ut.newInvalidDocument(i))}),D.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Bt(),a=t.path,c=new q(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){let{key:d,value:{document:p}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Ww(Kw(p),r)<=0||(i.has(p.key)||$o(t,p))&&(s=s.insert(p.key,p.mutableCopy()))}return D.resolve(s)}getAllFromCollectionGroup(e,t,r,i){$(9500)}ii(e,t){return D.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new al(this)}getSize(e){return D.resolve(this.size)}},al=class extends Zu{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)}),D.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}};var cl=class{constructor(e){this.persistence=e,this.si=new jt(t=>ih(t),sh),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.oi=0,this._i=new qi,this.targetCount=0,this.ai=zi.ur()}forEachTarget(e,t){return this.si.forEach((r,i)=>t(i)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),D.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new zi(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Pr(t),D.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.si.forEach((a,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.si.delete(a),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),D.waitFor(s).next(()=>i)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return D.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),D.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),D.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),D.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return D.resolve(r)}containsKey(e,t){return D.resolve(this._i.containsKey(t))}};var bo=class{constructor(e,t){this.ui={},this.overlays={},this.ci=new Xl(0),this.li=!1,this.li=!0,this.hi=new il,this.referenceDelegate=e(this),this.Pi=new cl(this),this.indexManager=new Wu,this.remoteDocumentCache=function(i){return new ol(i)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new Ku(t),this.Ii=new nl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new rl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new sl(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){U("MemoryPersistence","Starting transaction:",e);let i=new ul(this.ci.next());return this.referenceDelegate.Ei(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ai(e,t){return D.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}},ul=class extends vu{constructor(e){super(),this.currentSequenceNumber=e}},ll=class n{constructor(e){this.persistence=e,this.Ri=new qi,this.Vi=null}static mi(e){return new n(e)}get fi(){if(this.Vi)return this.Vi;throw $(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),D.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.fi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.fi,r=>{let i=q.fromPath(r);return this.gi(e,i).next(s=>{s||t.removeEntry(i,K.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}},Co=class n{constructor(e,t){this.persistence=e,this.pi=new jt(r=>Xw(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=Yb(this,t)}static mi(e,t){return new n(e,t)}Ei(){}di(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return D.forEach(this.pi,(r,i)=>this.br(e,r,i).next(s=>s?D.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,a=>this.br(e,a,t).next(c=>{c||(r++,s.removeEntry(a,K.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),D.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),D.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=no(e.data.value)),t}br(e,t,r){return D.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.pi.get(t);return D.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var hl=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=ne(),i=ne();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var dl=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var fl=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return kp()?8:Yw(Mp())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ys(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ws(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new dl;return this.Ss(e,t,a).next(c=>{if(s.result=c,this.Vs)return this.bs(e,t,a,c.size)})}).next(()=>s.result)}bs(e,t,r,i){return r.documentReadCount<this.fs?(ur()<=re.DEBUG&&U("QueryEngine","SDK will not create cache indexes for query:",lr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),D.resolve()):(ur()<=re.DEBUG&&U("QueryEngine","Query:",lr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(ur()<=re.DEBUG&&U("QueryEngine","The SDK decides to create cache indexes for query:",lr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,It(t))):D.resolve())}ys(e,t){if(ym(t))return D.resolve(null);let r=It(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=po(t,null,"F"),r=It(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=ne(...s);return this.ps.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,r).next(l=>{let d=this.Ds(t,c);return this.Cs(t,d,a,l.readTime)?this.ys(e,po(t,null,"F")):this.vs(e,d,t,l)}))})))}ws(e,t,r,i){return ym(t)||i.isEqual(K.min())?D.resolve(null):this.ps.getDocuments(e,r).next(s=>{let a=this.Ds(t,s);return this.Cs(t,a,r,i)?D.resolve(null):(ur()<=re.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),lr(t)),this.vs(e,a,t,Hw(i,Vi)).next(c=>c))})}Ds(e,t){let r=new Oe(Sg(e));return t.forEach((i,s)=>{$o(e,s)&&(r=r.add(s))}),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,r){return ur()<=re.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",lr(t)),this.ps.getDocumentsMatchingQuery(e,t,On.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var uh="LocalStore",Jb=3e8,pl=class{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new _e(te),this.xs=new jt(s=>ih(s),sh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tl(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}};function Xb(n,e,t,r){return new pl(n,e,t,r)}function Hg(n,e){return P(this,null,function*(){let t=H(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let a=[],c=[],l=ne();for(let d of i){a.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}for(let d of s){c.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}return t.localDocuments.getDocuments(r,l).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:c}))})})})}function Zb(n,e){let t=H(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return function(c,l,d,p){let m=d.batch,w=m.keys(),R=D.resolve();return w.forEach(L=>{R=R.next(()=>p.getEntry(l,L)).next(B=>{let k=d.docVersions.get(L);ce(k!==null,48541),B.version.compareTo(k)<0&&(m.applyToRemoteDocument(B,d),B.isValidDocument()&&(B.setReadTime(d.commitVersion),p.addEntry(B)))})}),R.next(()=>c.mutationQueue.removeMutationBatch(l,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let l=ne();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(l=l.add(c.batch.mutations[d].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Kg(n){let e=H(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function eC(n,e){let t=H(n),r=e.snapshotVersion,i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;let c=[];e.targetChanges.forEach((p,m)=>{let w=i.get(m);if(!w)return;c.push(t.Pi.removeMatchingKeys(s,p.removedDocuments,m).next(()=>t.Pi.addMatchingKeys(s,p.addedDocuments,m)));let R=w.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?R=R.withResumeToken(ze.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(m,R),function(B,k,Y){return B.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=Jb?!0:Y.addedDocuments.size+Y.modifiedDocuments.size+Y.removedDocuments.size>0}(w,R,p)&&c.push(t.Pi.updateTargetData(s,R))});let l=Bt(),d=ne();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,p))}),c.push(tC(s,a,e.documentUpdates).next(p=>{l=p.ks,d=p.qs})),!r.isEqual(K.min())){let p=t.Pi.getLastRemoteSnapshotVersion(s).next(m=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(p)}return D.waitFor(c).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(t.Ms=i,s))}function tC(n,e,t){let r=ne(),i=ne();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=Bt();return t.forEach((c,l)=>{let d=s.get(c);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(c)),l.isNoDocument()&&l.version.isEqual(K.min())?(e.removeEntry(c,l.readTime),a=a.insert(c,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),a=a.insert(c,l)):U(uh,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",l.version)}),{ks:a,qs:i}})}function nC(n,e){let t=H(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Zl),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function rC(n,e){let t=H(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Pi.getTargetData(r,e).next(s=>s?(i=s,D.resolve(i)):t.Pi.allocateTargetId(r).next(a=>(i=new Bi(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}function ml(n,e,t){return P(this,null,function*(){let r=H(n),i=r.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Mr(a))throw a;U(uh,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)})}function Pm(n,e,t){let r=H(n),i=K.min(),s=ne();return r.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,p){let m=H(l),w=m.xs.get(p);return w!==void 0?D.resolve(m.Ms.get(w)):m.Pi.getTargetData(d,p)}(r,a,It(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,c.targetId).next(l=>{s=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(a,e,t?i:K.min(),t?s:ne())).next(c=>(iC(r,mb(e),c),{documents:c,Qs:s})))}function iC(n,e,t){let r=n.Os.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Os.set(e,r)}var Io=class{constructor(){this.activeTargetIds=bb()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var gl=class{constructor(){this.Mo=new Io,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Io,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var _l=class{Oo(e){}shutdown(){}};var Dm="ConnectivityMonitor",Eo=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){U(Dm,"Network connectivity changed: AVAILABLE");for(let e of this.qo)e(0)}ko(){U(Dm,"Network connectivity changed: UNAVAILABLE");for(let e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var to=null;function yl(){return to===null?to=function(){return 268435456+Math.round(2147483648*Math.random())}():to++,"0x"+to.toString(16)}var au="RestConnection",sC={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},vl=class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===lo?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,s){let a=yl(),c=this.zo(e,t.toUriEncodedString());U(au,`Sending RPC '${e}' ${a}:`,c,r);let l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,i,s);let{host:d}=new URL(c),p=Ks(d);return this.Jo(e,c,l,r,p).then(m=>(U(au,`Received RPC '${e}' ${a}: `,m),m),m=>{throw _r(au,`RPC '${e}' ${a} failed with error: `,m,"url: ",c,"request:",r),m})}Ho(e,t,r,i,s,a){return this.Go(e,t,r,i,s)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Pr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}zo(e,t){let r=sC[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}};var wl=class{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}};var Be="WebChannelConnection",bl=class extends vl{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,s){let a=yl();return new Promise((c,l)=>{let d=new eu;d.setWithCredentials(!0),d.listenOnce(tu.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Ri.NO_ERROR:let m=d.getResponseJson();U(Be,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),c(m);break;case Ri.TIMEOUT:U(Be,`RPC '${e}' ${a} timed out`),l(new V(A.DEADLINE_EXCEEDED,"Request time out"));break;case Ri.HTTP_ERROR:let w=d.getStatus();if(U(Be,`RPC '${e}' ${a} failed with status:`,w,"response text:",d.getResponseText()),w>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let L=R?.error;if(L&&L.status&&L.message){let B=function(Y){let se=Y.toLowerCase().replace(/_/g,"-");return Object.values(A).indexOf(se)>=0?se:A.UNKNOWN}(L.status);l(new V(B,L.message))}else l(new V(A.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new V(A.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{U(Be,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);U(Be,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}T_(e,t,r){let i=yl(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=iu(),c=ru(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let p=s.join("");U(Be,`Creating RPC '${e}' stream ${i}: ${p}`,l);let m=a.createWebChannel(p,l);this.I_(m);let w=!1,R=!1,L=new wl({Yo:k=>{R?U(Be,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(w||(U(Be,`Opening RPC '${e}' stream ${i} transport.`),m.open(),w=!0),U(Be,`RPC '${e}' stream ${i} sending:`,k),m.send(k))},Zo:()=>m.close()}),B=(k,Y,se)=>{k.listen(Y,oe=>{try{se(oe)}catch(qe){setTimeout(()=>{throw qe},0)}})};return B(m,cr.EventType.OPEN,()=>{R||(U(Be,`RPC '${e}' stream ${i} transport opened.`),L.o_())}),B(m,cr.EventType.CLOSE,()=>{R||(R=!0,U(Be,`RPC '${e}' stream ${i} transport closed`),L.a_(),this.E_(m))}),B(m,cr.EventType.ERROR,k=>{R||(R=!0,_r(Be,`RPC '${e}' stream ${i} transport errored. Name:`,k.name,"Message:",k.message),L.a_(new V(A.UNAVAILABLE,"The operation could not be completed")))}),B(m,cr.EventType.MESSAGE,k=>{if(!R){let Y=k.data[0];ce(!!Y,16349);let se=Y,oe=se?.error||se[0]?.error;if(oe){U(Be,`RPC '${e}' stream ${i} received error:`,oe);let qe=oe.status,He=function(g){let y=Ce[g];if(y!==void 0)return Lg(y)}(qe),Re=oe.message;He===void 0&&(He=A.INTERNAL,Re="Unknown error status: "+qe+" with message "+oe.message),R=!0,L.a_(new V(He,Re)),m.close()}else U(Be,`RPC '${e}' stream ${i} received:`,Y),L.u_(Y)}}),B(c,nu.STAT_EVENT,k=>{k.stat===Xs.PROXY?U(Be,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===Xs.NOPROXY&&U(Be,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{L.__()},0),L}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}};function cu(){return typeof document<"u"?document:null}function Go(n){return new zu(n,!0)}var To=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&U("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var Mm="PersistentStream",So=class{constructor(e,t,r,i,s,a,c,l){this.Mi=e,this.S_=r,this.b_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new To(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return P(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return P(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return P(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===A.RESOURCE_EXHAUSTED?(Lt(t.toString()),Lt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===A.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===t&&this.G_(r,i)},r=>{e(()=>{let i=new V(A.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(()=>P(this,null,function*(){this.state=0,this.start()}))}z_(e){return U(Mm,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(U(Mm,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Cl=class extends So{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=Lb(this.serializer,e),r=function(s){if(!("targetChange"in s))return K.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?K.min():a.readTime?Et(a.readTime):K.min()}(e);return this.listener.H_(t,r)}Y_(e){let t={};t.database=Hu(this.serializer),t.addTarget=function(s,a){let c,l=a.target;if(c=Mu(l)?{documents:jb(s,l)}:{query:Bb(s,l).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Fg(s,a.resumeToken);let d=qu(s,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(K.min())>0){c.readTime=vo(s,a.snapshotVersion.toTimestamp());let d=qu(s,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);let r=qb(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){let t={};t.database=Hu(this.serializer),t.removeTarget=e,this.q_(t)}},Il=class extends So{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ce(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ce(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ce(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=Ub(e.writeResults,e.commitTime),r=Et(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=Hu(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Fb(this.serializer,r))};this.q_(t)}};var El=class{},Tl=class extends El{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new V(A.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Go(e,$u(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new V(A.UNKNOWN,s.toString())})}Ho(e,t,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Ho(e,$u(t,r),i,a,c,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(A.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},Sl=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Lt(t),this.aa=!1):U("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Un="RemoteStore",Al=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(a=>{r.enqueueAndForget(()=>P(this,null,function*(){Bn(this)&&(U(Un,"Restarting streams for network reachability change."),yield function(l){return P(this,null,function*(){let d=H(l);d.Ea.add(4),yield Wi(d),d.Ra.set("Unknown"),d.Ea.delete(4),yield Ho(d)})}(this))}))}),this.Ra=new Sl(r,i)}};function Ho(n){return P(this,null,function*(){if(Bn(n))for(let e of n.da)yield e(!0)})}function Wi(n){return P(this,null,function*(){for(let e of n.da)yield e(!1)})}function Wg(n,e){let t=H(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),fh(t)?dh(t):kr(t).O_()&&hh(t,e))}function lh(n,e){let t=H(n),r=kr(t);t.Ia.delete(e),r.O_()&&Qg(t,e),t.Ia.size===0&&(r.O_()?r.L_():Bn(t)&&t.Ra.set("Unknown"))}function hh(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}kr(n).Y_(e)}function Qg(n,e){n.Va.Ue(e),kr(n).Z_(e)}function dh(n){n.Va=new Bu({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),kr(n).start(),n.Ra.ua()}function fh(n){return Bn(n)&&!kr(n).x_()&&n.Ia.size>0}function Bn(n){return H(n).Ea.size===0}function Yg(n){n.Va=void 0}function oC(n){return P(this,null,function*(){n.Ra.set("Online")})}function aC(n){return P(this,null,function*(){n.Ia.forEach((e,t)=>{hh(n,e)})})}function cC(n,e){return P(this,null,function*(){Yg(n),fh(n)?(n.Ra.ha(e),dh(n)):n.Ra.set("Unknown")})}function uC(n,e,t){return P(this,null,function*(){if(n.Ra.set("Online"),e instanceof _o&&e.state===2&&e.cause)try{yield function(i,s){return P(this,null,function*(){let a=s.cause;for(let c of s.targetIds)i.Ia.has(c)&&(yield i.remoteSyncer.rejectListen(c,a),i.Ia.delete(c),i.Va.removeTarget(c))})}(n,e)}catch(r){U(Un,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ao(n,r)}else if(e instanceof pr?n.Va.Ze(e):e instanceof go?n.Va.st(e):n.Va.tt(e),!t.isEqual(K.min()))try{let r=yield Kg(n.localStore);t.compareTo(r)>=0&&(yield function(s,a){let c=s.Va.Tt(a);return c.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let p=s.Ia.get(d);p&&s.Ia.set(d,p.withResumeToken(l.resumeToken,a))}}),c.targetMismatches.forEach((l,d)=>{let p=s.Ia.get(l);if(!p)return;s.Ia.set(l,p.withResumeToken(ze.EMPTY_BYTE_STRING,p.snapshotVersion)),Qg(s,l);let m=new Bi(p.target,l,d,p.sequenceNumber);hh(s,m)}),s.remoteSyncer.applyRemoteEvent(c)}(n,t))}catch(r){U(Un,"Failed to raise snapshot:",r),yield Ao(n,r)}})}function Ao(n,e,t){return P(this,null,function*(){if(!Mr(e))throw e;n.Ea.add(1),yield Wi(n),n.Ra.set("Offline"),t||(t=()=>Kg(n.localStore)),n.asyncQueue.enqueueRetryable(()=>P(this,null,function*(){U(Un,"Retrying IndexedDB access"),yield t(),n.Ea.delete(1),yield Ho(n)}))})}function Jg(n,e){return e().catch(t=>Ao(n,t,e))}function Ko(n){return P(this,null,function*(){let e=H(n),t=fn(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Zl;for(;lC(e);)try{let i=yield nC(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,hC(e,i)}catch(i){yield Ao(e,i)}Xg(e)&&Zg(e)})}function lC(n){return Bn(n)&&n.Ta.length<10}function hC(n,e){n.Ta.push(e);let t=fn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function Xg(n){return Bn(n)&&!fn(n).x_()&&n.Ta.length>0}function Zg(n){fn(n).start()}function dC(n){return P(this,null,function*(){fn(n).ra()})}function fC(n){return P(this,null,function*(){let e=fn(n);for(let t of n.Ta)e.ea(t.mutations)})}function pC(n,e,t){return P(this,null,function*(){let r=n.Ta.shift(),i=Lu.from(r,e,t);yield Jg(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Ko(n)})}function mC(n,e){return P(this,null,function*(){e&&fn(n).X_&&(yield function(r,i){return P(this,null,function*(){if(function(a){return xb(a)&&a!==A.ABORTED}(i.code)){let s=r.Ta.shift();fn(r).B_(),yield Jg(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Ko(r)}})}(n,e)),Xg(n)&&Zg(n)})}function km(n,e){return P(this,null,function*(){let t=H(n);t.asyncQueue.verifyOperationInProgress(),U(Un,"RemoteStore received new credentials");let r=Bn(t);t.Ea.add(3),yield Wi(t),r&&t.Ra.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield Ho(t)})}function gC(n,e){return P(this,null,function*(){let t=H(n);e?(t.Ea.delete(2),yield Ho(t)):e||(t.Ea.add(2),yield Wi(t),t.Ra.set("Unknown"))})}function kr(n){return n.ma||(n.ma=function(t,r,i){let s=H(t);return s.sa(),new Cl(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Xo:oC.bind(null,n),t_:aC.bind(null,n),r_:cC.bind(null,n),H_:uC.bind(null,n)}),n.da.push(e=>P(this,null,function*(){e?(n.ma.B_(),fh(n)?dh(n):n.Ra.set("Unknown")):(yield n.ma.stop(),Yg(n))}))),n.ma}function fn(n){return n.fa||(n.fa=function(t,r,i){let s=H(t);return s.sa(),new Il(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:dC.bind(null,n),r_:mC.bind(null,n),ta:fC.bind(null,n),na:pC.bind(null,n)}),n.da.push(e=>P(this,null,function*(){e?(n.fa.B_(),yield Ko(n)):(yield n.fa.stop(),n.Ta.length>0&&(U(Un,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var xl=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Vt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,c=new n(e,t,a,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(A.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ph(n,e){if(Lt("AsyncQueue",`${e}: ${n}`),Mr(n))return new V(A.UNAVAILABLE,`${e}: ${n}`);throw n}var xo=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||q.comparator(t.key,r.key):(t,r)=>q.comparator(t.key,r.key),this.keyedMap=Pi(),this.sortedSet=new _e(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Ro=class{constructor(){this.ga=new _e(q.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}},xr=class n{constructor(e,t,r,i,s,a,c,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new n(e,t,xo.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Rl=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}},Pl=class{constructor(){this.queries=Om(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=H(t),s=i.queries;i.queries=Om(),s.forEach((a,c)=>{for(let l of c.Sa)l.onError(r)})})(this,new V(A.ABORTED,"Firestore shutting down"))}};function Om(){return new jt(n=>Tg(n),qo)}function _C(n,e){return P(this,null,function*(){let t=H(n),r=3,i=e.query,s=t.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new Rl,r=e.Da()?0:1);try{switch(r){case 0:s.wa=yield t.onListen(i,!0);break;case 1:s.wa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let c=ph(a,`Initialization of query '${lr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&mh(t)})}function yC(n,e){return P(this,null,function*(){let t=H(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.Sa.indexOf(e);a>=0&&(s.Sa.splice(a,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function vC(n,e){let t=H(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let c of a.Sa)c.Fa(i)&&(r=!0);a.wa=i}}r&&mh(t)}function wC(n,e,t){let r=H(n),i=r.queries.get(e);if(i)for(let s of i.Sa)s.onError(t);r.queries.delete(e)}function mh(n){n.Ca.forEach(e=>{e.next()})}var Dl,Nm;(Nm=Dl||(Dl={})).Ma="default",Nm.Cache="cache";var Ml=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new xr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=xr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Dl.Cache}};var Po=class{constructor(e){this.key=e}},Do=class{constructor(e){this.key=e}},kl=class{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ne(),this.mutatedKeys=ne(),this.eu=Sg(e),this.tu=new xo(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new Ro,i=t?t.tu:this.tu,s=t?t.mutatedKeys:this.mutatedKeys,a=i,c=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,m)=>{let w=i.get(p),R=$o(this.query,m)?m:null,L=!!w&&this.mutatedKeys.has(w.key),B=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),k=!1;w&&R?w.data.isEqual(R.data)?L!==B&&(r.track({type:3,doc:R}),k=!0):this.su(w,R)||(r.track({type:2,doc:R}),k=!0,(l&&this.eu(R,l)>0||d&&this.eu(R,d)<0)&&(c=!0)):!w&&R?(r.track({type:0,doc:R}),k=!0):w&&!R&&(r.track({type:1,doc:w}),k=!0,(l||d)&&(c=!0)),k&&(R?(a=a.add(R),s=B?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:c,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort((p,m)=>function(R,L){let B=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Rt:k})}};return B(R)-B(L)}(p.type,m.type)||this.eu(p.doc,m.doc)),this.ou(r),i=i??!1;let c=t&&!i?this._u():[],l=this.Xa.size===0&&this.current&&!i?1:0,d=l!==this.Za;return this.Za=l,a.length!==0||d?{snapshot:new xr(this.query,e.tu,s,a,e.mutatedKeys,l===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ro,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=ne(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});let t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new Do(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new Po(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=ne();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return xr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},gh="SyncEngine",Ol=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Nl=class{constructor(e){this.key=e,this.hu=!1}},Vl=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new jt(c=>Tg(c),qo),this.Iu=new Map,this.Eu=new Set,this.du=new _e(q.comparator),this.Au=new Map,this.Ru=new qi,this.Vu={},this.mu=new Map,this.fu=zi.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function bC(n,e,t=!0){return P(this,null,function*(){let r=s_(n),i,s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=yield e_(r,e,t,!0),i})}function CC(n,e){return P(this,null,function*(){let t=s_(n);yield e_(t,e,!0,!1)})}function e_(n,e,t,r){return P(this,null,function*(){let i=yield rC(n.localStore,It(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=yield IC(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Wg(n.remoteStore,i),c})}function IC(n,e,t,r,i){return P(this,null,function*(){n.pu=(m,w,R)=>function(B,k,Y,se){return P(this,null,function*(){let oe=k.view.ru(Y);oe.Cs&&(oe=yield Pm(B.localStore,k.query,!1).then(({documents:b})=>k.view.ru(b,oe)));let qe=se&&se.targetChanges.get(k.targetId),He=se&&se.targetMismatches.get(k.targetId)!=null,Re=k.view.applyChanges(oe,B.isPrimaryClient,qe,He);return Lm(B,k.targetId,Re.au),Re.snapshot})}(n,m,w,R);let s=yield Pm(n.localStore,e,!0),a=new kl(e,s.Qs),c=a.ru(s.documents),l=ji.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(c,n.isPrimaryClient,l);Lm(n,t,d.au);let p=new Ol(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot})}function EC(n,e,t){return P(this,null,function*(){let r=H(n),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(a=>!qo(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ml(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&lh(r.remoteStore,i.targetId),Ll(r,i.targetId)}).catch(Dr))):(Ll(r,i.targetId),yield ml(r.localStore,i.targetId,!0))})}function TC(n,e){return P(this,null,function*(){let t=H(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),lh(t.remoteStore,r.targetId))})}function SC(n,e,t){return P(this,null,function*(){let r=kC(n);try{let i=yield function(a,c){let l=H(a),d=Se.now(),p=c.reduce((R,L)=>R.add(L.key),ne()),m,w;return l.persistence.runTransaction("Locally write mutations","readwrite",R=>{let L=Bt(),B=ne();return l.Ns.getEntries(R,p).next(k=>{L=k,L.forEach((Y,se)=>{se.isValidDocument()||(B=B.add(Y))})}).next(()=>l.localDocuments.getOverlayedDocuments(R,L)).next(k=>{m=k;let Y=[];for(let se of c){let oe=Ab(se,m.get(se.key).overlayedDocument);oe!=null&&Y.push(new St(se.key,oe,yg(oe.value.mapValue),tt.exists(!0)))}return l.mutationQueue.addMutationBatch(R,d,Y,c)}).next(k=>{w=k;let Y=k.applyToLocalDocumentSet(m,B);return l.documentOverlayCache.saveOverlays(R,k.batchId,Y)})}).then(()=>({batchId:w.batchId,changes:xg(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,c,l){let d=a.Vu[a.currentUser.toKey()];d||(d=new _e(te)),d=d.insert(c,l),a.Vu[a.currentUser.toKey()]=d}(r,i.batchId,t),yield Qi(r,i.changes),yield Ko(r.remoteStore)}catch(i){let s=ph(i,"Failed to persist write");t.reject(s)}})}function t_(n,e){return P(this,null,function*(){let t=H(n);try{let r=yield eC(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Au.get(s);a&&(ce(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?ce(a.hu,14607):i.removedDocuments.size>0&&(ce(a.hu,42227),a.hu=!1))}),yield Qi(t,r,e)}catch(r){yield Dr(r)}})}function Vm(n,e,t){let r=H(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach((s,a)=>{let c=a.view.va(e);c.snapshot&&i.push(c.snapshot)}),function(a,c){let l=H(a);l.onlineState=c;let d=!1;l.queries.forEach((p,m)=>{for(let w of m.Sa)w.va(c)&&(d=!0)}),d&&mh(l)}(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function AC(n,e,t){return P(this,null,function*(){let r=H(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Au.get(e),s=i&&i.key;if(s){let a=new _e(q.comparator);a=a.insert(s,ut.newNoDocument(s,K.min()));let c=ne().add(s),l=new mo(K.min(),new Map,new _e(te),a,c);yield t_(r,l),r.du=r.du.remove(s),r.Au.delete(e),_h(r)}else yield ml(r.localStore,e,!1).then(()=>Ll(r,e,t)).catch(Dr)})}function xC(n,e){return P(this,null,function*(){let t=H(n),r=e.batch.batchId;try{let i=yield Zb(t.localStore,e);r_(t,r,null),n_(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Qi(t,i)}catch(i){yield Dr(i)}})}function RC(n,e,t){return P(this,null,function*(){let r=H(n);try{let i=yield function(a,c){let l=H(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return l.mutationQueue.lookupMutationBatch(d,c).next(m=>(ce(m!==null,37113),p=m.keys(),l.mutationQueue.removeMutationBatch(d,m))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,p,c)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>l.localDocuments.getDocuments(d,p))})}(r.localStore,e);r_(r,e,t),n_(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Qi(r,i)}catch(i){yield Dr(i)}})}function n_(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function r_(n,e,t){let r=H(n),i=r.Vu[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Ll(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||i_(n,r)})}function i_(n,e){n.Eu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(lh(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),_h(n))}function Lm(n,e,t){for(let r of t)r instanceof Po?(n.Ru.addReference(r.key,e),PC(n,r)):r instanceof Do?(U(gh,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||i_(n,r.key)):$(19791,{wu:r})}function PC(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(U(gh,"New document in limbo: "+t),n.Eu.add(r),_h(n))}function _h(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new q(me.fromString(e)),r=n.fu.next();n.Au.set(r,new Nl(t)),n.du=n.du.insert(t,r),Wg(n.remoteStore,new Bi(It(oh(t.path)),r,"TargetPurposeLimboResolution",Xl.ce))}}function Qi(n,e,t){return P(this,null,function*(){let r=H(n),i=[],s=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((c,l)=>{a.push(r.pu(l,e,t).then(d=>{if((d||t)&&r.isPrimaryClient){let p=d?!d.fromCache:t?.targetChanges.get(l.targetId)?.current;r.sharedClientState.updateQueryState(l.targetId,p?"current":"not-current")}if(d){i.push(d);let p=hl.As(l.targetId,d);s.push(p)}}))}),yield Promise.all(a),r.Pu.H_(i),yield function(l,d){return P(this,null,function*(){let p=H(l);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>D.forEach(d,w=>D.forEach(w.Es,R=>p.persistence.referenceDelegate.addReference(m,w.targetId,R)).next(()=>D.forEach(w.ds,R=>p.persistence.referenceDelegate.removeReference(m,w.targetId,R)))))}catch(m){if(!Mr(m))throw m;U(uh,"Failed to update sequence numbers: "+m)}for(let m of d){let w=m.targetId;if(!m.fromCache){let R=p.Ms.get(w),L=R.snapshotVersion,B=R.withLastLimboFreeSnapshotVersion(L);p.Ms=p.Ms.insert(w,B)}}})}(r.localStore,s))})}function DC(n,e){return P(this,null,function*(){let t=H(n);if(!t.currentUser.isEqual(e)){U(gh,"User change. New user:",e.toKey());let r=yield Hg(t.localStore,e);t.currentUser=e,function(s,a){s.mu.forEach(c=>{c.forEach(l=>{l.reject(new V(A.CANCELLED,a))})}),s.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Qi(t,r.Ls)}})}function MC(n,e){let t=H(n),r=t.Au.get(e);if(r&&r.hu)return ne().add(r.key);{let i=ne(),s=t.Iu.get(e);if(!s)return i;for(let a of s){let c=t.Tu.get(a);i=i.unionWith(c.view.nu)}return i}}function s_(n){let e=H(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=t_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=MC.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=AC.bind(null,e),e.Pu.H_=vC.bind(null,e.eventManager),e.Pu.yu=wC.bind(null,e.eventManager),e}function kC(n){let e=H(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=xC.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=RC.bind(null,e),e}var o_=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return P(this,null,function*(){this.serializer=Go(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)})}Fu(t,r){return null}Mu(t,r){return null}vu(t){return Xb(this.persistence,new fl,t.initialUser,this.serializer)}Cu(t){return new bo(ll.mi,this.serializer)}Du(t){return new gl}terminate(){return P(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Fl=class extends o_{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ce(this.persistence.referenceDelegate instanceof Co,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Ju(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?st.withCacheSize(this.cacheSizeBytes):st.DEFAULT;return new bo(r=>Co.mi(r,t),this.serializer)}};var OC=(()=>{class n{initialize(t,r){return P(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Vm(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=DC.bind(null,this.syncEngine),yield gC(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Pl}()}createDatastore(t){let r=Go(t.databaseInfo.databaseId),i=function(a){return new bl(a)}(t.databaseInfo);return function(a,c,l,d){return new Tl(a,c,l,d)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,a,c,l){return new Al(i,s,a,c,l)}(this.localStore,this.datastore,t.asyncQueue,r=>Vm(this.syncEngine,r,0),function(){return Eo.v()?new Eo:new _l}())}createSyncEngine(t,r){return function(s,a,c,l,d,p,m){let w=new Vl(s,a,c,l,d,p);return m&&(w.gu=!0),w}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return P(this,null,function*(){yield function(r){return P(this,null,function*(){let i=H(r);U(Un,"RemoteStore shutting down."),i.Ea.add(5),yield Wi(i),i.Aa.shutdown(),i.Ra.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var Ul=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Lt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var pn="FirestoreClient",jl=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ke.UNAUTHENTICATED,this.clientId=Ni.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,a=>P(this,null,function*(){U(pn,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(U(pn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Vt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ph(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function uu(n,e){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),U(pn,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>P(this,null,function*(){r.isEqual(i)||(yield Hg(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Fm(n,e){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield NC(n);U(pn,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>km(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>km(e.remoteStore,i)),n._onlineComponents=e})}function NC(n){return P(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){U(pn,"Using user provided OfflineComponentProvider");try{yield uu(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===A.FAILED_PRECONDITION||i.code===A.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;_r("Error using user provided cache. Falling back to memory cache: "+t),yield uu(n,new o_)}}else U(pn,"Using default OfflineComponentProvider"),yield uu(n,new Fl(void 0));return n._offlineComponents})}function a_(n){return P(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(U(pn,"Using user provided OnlineComponentProvider"),yield Fm(n,n._uninitializedComponentsProvider._online)):(U(pn,"Using default OnlineComponentProvider"),yield Fm(n,new OC))),n._onlineComponents})}function VC(n){return a_(n).then(e=>e.syncEngine)}function Um(n){return P(this,null,function*(){let e=yield a_(n),t=e.eventManager;return t.onListen=bC.bind(null,e.syncEngine),t.onUnlisten=EC.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=CC.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=TC.bind(null,e.syncEngine),t})}function c_(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var jm=new Map;var u_="firestore.googleapis.com",Bm=!0,Mo=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new V(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=u_,this.ssl=Bm}else this.host=e.host,this.ssl=e.ssl??Bm;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Gg;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Qb)throw new V(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}$w("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=c_(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new V(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new V(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new V(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Rr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Mo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Mo(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new hu;switch(r.type){case"firstParty":return new mu(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return P(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=jm.get(t);r&&(U("ComponentProvider","Removing Datastore"),jm.delete(t),r.terminate())}(this),Promise.resolve()}};function LC(n,e,t,r={}){n=ct(n,Rr);let i=Ks(e),s=n._getSettings(),a=we(j({},s),{emulatorOptions:n._getEmulatorOptions()}),c=`${e}:${t}`;i&&(Rp(`https://${c}`),Dp("Firestore",!0)),s.host!==u_&&s.host!==c&&_r("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l=we(j({},s),{host:c,ssl:i,emulatorOptions:r});if(!or(l,a)&&(n._setSettings(l),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=ke.MOCK_USER;else{d=Pp(r.mockUserToken,n._app?.options.projectId);let m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new V(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new ke(m)}n._authCredentials=new du(new so(d,p))}}var mn=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ne=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new an(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ki(t,n._jsonSchema))return new n(e,r||null,new q(me.fromString(t.referencePath)))}};Ne._jsonSchemaVersion="firestore/documentReference/1.0",Ne._jsonSchema={type:Te("string",Ne._jsonSchemaVersion),referencePath:Te("string")};var an=class n extends mn{constructor(e,t,r){super(e,t,oh(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ne(this.firestore,null,new q(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function ht(n,e,...t){if(n=Xe(n),Wm("collection","path",e),n instanceof Rr){let r=me.fromString(e,...t);return sm(r),new an(n,null,r)}{if(!(n instanceof Ne||n instanceof an))throw new V(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(me.fromString(e,...t));return sm(r),new an(n.firestore,null,r)}}function zt(n,e,...t){if(n=Xe(n),arguments.length===1&&(e=Ni.newId()),Wm("doc","path",e),n instanceof Rr){let r=me.fromString(e,...t);return im(r),new Ne(n,null,new q(r))}{if(!(n instanceof Ne||n instanceof an))throw new V(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(me.fromString(e,...t));return im(r),new Ne(n.firestore,n instanceof an?n.converter:null,new q(r))}}var zm="AsyncQueue",ko=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new To(this,"async_queue_retry"),this._c=()=>{let r=cu();r&&U(zm,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=cu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=cu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new Vt;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return P(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Mr(e))throw e;U(zm,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Lt("INTERNAL UNHANDLED ERROR: ",qm(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=xl.createAndSchedule(this,e,t,r,s=>this.hc(s));return this.tc.push(i),i}uc(){this.nc&&$(47125,{Pc:qm(this.nc)})}verifyOperationInProgress(){}Tc(){return P(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function qm(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function $m(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var At=class extends Rr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new ko,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return P(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ko(e),this._firestoreClient=void 0,yield e}})}};function Wo(n,e){let t=typeof n=="object"?n:Yp(),r=typeof n=="string"?n:e||lo,i=Kp(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=xp("firestore");s&&LC(i,...s)}return i}function yh(n){if(n._terminated)throw new V(A.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||FC(n),n._firestoreClient}function FC(n){let e=n._freezeSettings(),t=function(i,s,a,c){return new wu(i,s,a,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,c_(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)}(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new jl(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(i){let s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}}(n._componentsProvider))}var cn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ze.fromBase64String(e))}catch(t){throw new V(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ze.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ki(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};cn._jsonSchemaVersion="firestore/bytes/1.0",cn._jsonSchema={type:Te("string",cn._jsonSchemaVersion),bytes:Te("string")};var jn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var $i=class{constructor(e){this._methodName=e}};var un=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return te(this._lat,e._lat)||te(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Ki(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};un._jsonSchemaVersion="firestore/geoPoint/1.0",un._jsonSchema={type:Te("string",un._jsonSchemaVersion),latitude:Te("number"),longitude:Te("number")};var ln=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ki(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new V(A.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};ln._jsonSchemaVersion="firestore/vectorValue/1.0",ln._jsonSchema={type:Te("string",ln._jsonSchemaVersion),vectorValues:Te("object")};var UC=/^__.*__$/,Bl=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new St(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fn(e,this.data,t,this.fieldTransforms)}},Oo=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new St(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function l_(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ac:n})}}var zl=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new n(j(j({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Vo(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(l_(this.Ac)&&UC.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}},ql=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Go(e)}Cc(e,t,r,i=!1){return new zl({Ac:e,methodName:t,Dc:r,path:et.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Yi(n){let e=n._freezeSettings(),t=Go(n._databaseId);return new ql(n._databaseId,!!e.ignoreUndefinedProperties,t)}function vh(n,e,t,r,i,s={}){let a=n.Cc(s.merge||s.mergeFields?2:0,e,t,i);wh("Data must be an object, but it was:",a,r);let c=f_(r,a),l,d;if(s.merge)l=new ot(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let p=[];for(let m of s.mergeFields){let w=$l(e,m,t);if(!a.contains(w))throw new V(A.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);m_(p,w)||p.push(w)}l=new ot(p),d=a.fieldTransforms.filter(m=>l.covers(m.field))}else l=null,d=a.fieldTransforms;return new Bl(new Ze(c),l,d)}var No=class n extends $i{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function h_(n,e,t,r){let i=n.Cc(1,e,t);wh("Data must be an object, but it was:",i,r);let s=[],a=Ze.empty();gn(r,(l,d)=>{let p=bh(e,l,t);d=Xe(d);let m=i.yc(p);if(d instanceof No)s.push(p);else{let w=Ji(d,m);w!=null&&(s.push(p),a.set(p,w))}});let c=new ot(s);return new Oo(a,c,i.fieldTransforms)}function d_(n,e,t,r,i,s){let a=n.Cc(1,e,t),c=[$l(e,r,t)],l=[i];if(s.length%2!=0)throw new V(A.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<s.length;w+=2)c.push($l(e,s[w])),l.push(s[w+1]);let d=[],p=Ze.empty();for(let w=c.length-1;w>=0;--w)if(!m_(d,c[w])){let R=c[w],L=l[w];L=Xe(L);let B=a.yc(R);if(L instanceof No)d.push(R);else{let k=Ji(L,B);k!=null&&(d.push(R),p.set(R,k))}}let m=new ot(d);return new Oo(p,m,a.fieldTransforms)}function jC(n,e,t,r=!1){return Ji(t,n.Cc(r?4:3,e))}function Ji(n,e){if(p_(n=Xe(n)))return wh("Unsupported field value:",e,n),f_(n,e);if(n instanceof $i)return function(r,i){if(!l_(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,i){let s=[],a=0;for(let c of r){let l=Ji(c,i.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=Xe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Cb(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Se.fromDate(r);return{timestampValue:vo(i.serializer,s)}}if(r instanceof Se){let s=new Se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:vo(i.serializer,s)}}if(r instanceof un)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof cn)return{bytesValue:Fg(i.serializer,r._byteString)};if(r instanceof Ne){let s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ch(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof ln)return function(a,c){return{mapValue:{fields:{[th]:{stringValue:nh},[vr]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw c.Sc("VectorValues must only contain numeric values.");return ah(c.serializer,d)})}}}}}}(r,i);throw i.Sc(`Unsupported field value: ${jo(r)}`)}(n,e)}function f_(n,e){let t={};return lg(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):gn(n,(r,i)=>{let s=Ji(i,e.mc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function p_(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Se||n instanceof un||n instanceof cn||n instanceof Ne||n instanceof $i||n instanceof ln)}function wh(n,e,t){if(!p_(t)||!Qm(t)){let r=jo(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function $l(n,e,t){if((e=Xe(e))instanceof jn)return e._internalPath;if(typeof e=="string")return bh(n,e);throw Vo("Field path arguments must be of type string or ",n,!1,void 0,t)}var BC=new RegExp("[~\\*/\\[\\]]");function bh(n,e,t){if(e.search(BC)>=0)throw Vo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new jn(...e.split("."))._internalPath}catch{throw Vo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Vo(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new V(A.INVALID_ARGUMENT,c+n+l)}function m_(n,e){return n.some(t=>t.isEqual(e))}var Lo=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ne(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Gl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Qo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Gl=class extends Lo{data(){return super.data()}};function Qo(n,e){return typeof e=="string"?bh(n,e):e instanceof jn?e._internalPath:e._delegate._internalPath}function zC(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new V(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Gi=class{},Hi=class extends Gi{};function Xi(n,e,...t){let r=[];e instanceof Gi&&r.push(e),r=r.concat(t),function(s){let a=s.filter(l=>l instanceof Hl).length,c=s.filter(l=>l instanceof Fo).length;if(a>1||a>0&&c>0)throw new V(A.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Fo=class n extends Hi{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return __(e._query,t),new mn(e.firestore,e.converter,ku(e._query,t))}_parse(e){let t=Yi(e.firestore);return function(s,a,c,l,d,p,m){let w;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new V(A.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Hm(m,p);let L=[];for(let B of m)L.push(Gm(l,s,B));w={arrayValue:{values:L}}}else w=Gm(l,s,m)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Hm(m,p),w=jC(c,a,m,p==="in"||p==="not-in");return Ee.create(d,p,w)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Yo(n,e,t){let r=e,i=Qo("where",n);return Fo._create(i,r,t)}var Hl=class n extends Gi{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:lt.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i,c=s.getFlattenedFilters();for(let l of c)__(a,l),a=ku(a,l)}(e._query,t),new mn(e.firestore,e.converter,ku(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Kl=class n extends Hi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,a){if(i.startAt!==null)throw new V(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new V(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Nn(s,a)}(e._query,this._field,this._direction);return new mn(e.firestore,e.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new dn(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function g_(n,e="asc"){let t=e,r=Qo("orderBy",n);return Kl._create(r,t)}var Wl=class n extends Hi{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new mn(e.firestore,e.converter,po(e._query,this._limit,this._limitType))}};function Zi(n){return Gw("limit",n),Wl._create("limit",n,"F")}function Gm(n,e,t){if(typeof(t=Xe(t))=="string"){if(t==="")throw new V(A.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Eg(e)&&t.indexOf("/")!==-1)throw new V(A.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(me.fromString(t));if(!q.isDocumentKey(r))throw new V(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return dm(n,new q(r))}if(t instanceof Ne)return dm(n,t._key);throw new V(A.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jo(t)}.`)}function Hm(n,e){if(!Array.isArray(n)||n.length===0)throw new V(A.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function __(n,e){let t=function(i,s){for(let a of i)for(let c of a.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new V(A.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new V(A.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ql=class{convertValue(e,t="none"){switch(hn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ut(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return gn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){let t=e.fields?.[vr].arrayValue?.values?.map(r=>pe(r.doubleValue));return new ln(t)}convertGeoPoint(e){return new un(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=zo(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Fi(e));default:return null}}convertTimestamp(e){let t=Ft(e);return new Se(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=me.fromString(e);ce($g(r),9688,{name:e});let i=new ho(r.get(1),r.get(3)),s=new q(r.popFirst(5));return i.isEqual(t)||Lt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Ch(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Dn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Mn=class n extends Lo{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new mr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Qo("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(A.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Mn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Mn._jsonSchema={type:Te("string",Mn._jsonSchemaVersion),bundleSource:Te("string","DocumentSnapshot"),bundleName:Te("string"),bundle:Te("string")};var mr=class extends Mn{data(e={}){return super.data(e)}},gr=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Dn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new mr(this._firestore,this._userDataWriter,r.key,r,new Dn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(c=>{let l=new mr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Dn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let l=new mr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Dn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),p=a.indexOf(c.doc.key)),{type:qC(c.type),doc:l,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(A.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ni.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function qC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}gr._jsonSchemaVersion="firestore/querySnapshot/1.0",gr._jsonSchema={type:Te("string",gr._jsonSchemaVersion),bundleSource:Te("string","QuerySnapshot"),bundleName:Te("string"),bundle:Te("string")};var Uo=class extends Ql{constructor(e){super(),this.firestore=e}convertBytes(e){return new cn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ne(this.firestore,null,t)}};function y_(n,e,t){n=ct(n,Ne);let r=ct(n.firestore,At),i=Ch(n.converter,e,t);return ts(r,[vh(Yi(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,tt.none())])}function Jo(n,e,t,...r){n=ct(n,Ne);let i=ct(n.firestore,At),s=Yi(i),a;return a=typeof(e=Xe(e))=="string"||e instanceof jn?d_(s,"updateDoc",n._key,e,t,r):h_(s,"updateDoc",n._key,e),ts(i,[a.toMutation(n._key,tt.exists(!0))])}function v_(n){return ts(ct(n.firestore,At),[new Ar(n._key,tt.none())])}function es(n,e){let t=ct(n.firestore,At),r=zt(n),i=Ch(n.converter,e);return ts(t,[vh(Yi(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,tt.exists(!1))]).then(()=>r)}function qt(n,...e){n=Xe(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||$m(e[r])||(t=e[r++]);let i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if($m(e[r])){let l=e[r];e[r]=l.next?.bind(l),e[r+1]=l.error?.bind(l),e[r+2]=l.complete?.bind(l)}let s,a,c;if(n instanceof Ne)a=ct(n.firestore,At),c=oh(n._key.path),s={next:l=>{e[r]&&e[r]($C(a,n,l))},error:e[r+1],complete:e[r+2]};else{let l=ct(n,mn);a=ct(l.firestore,At),c=l._query;let d=new Uo(a);s={next:p=>{e[r]&&e[r](new gr(a,d,l,p))},error:e[r+1],complete:e[r+2]},zC(n._query)}return function(d,p,m,w){let R=new Ul(w),L=new Ml(p,R,m);return d.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return _C(yield Um(d),L)})),()=>{R.Nu(),d.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return yC(yield Um(d),L)}))}}(yh(a),c,i,s)}function ts(n,e){return function(r,i){let s=new Vt;return r.asyncQueue.enqueueAndForget(()=>P(this,null,function*(){return SC(yield VC(r),i,s)})),s.promise}(yh(n),e)}function $C(n,e,t){let r=t.docs.get(e._key),i=new Uo(n);return new Mn(n,i,e._key,r,new Dn(t.hasPendingWrites,t.fromCache),e.converter)}var Yl=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Yi(e)}set(e,t,r){this._verifyNotCommitted();let i=lu(e,this._firestore),s=Ch(i.converter,t,r),a=vh(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,tt.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=lu(e,this._firestore),a;return a=typeof(t=Xe(t))=="string"||t instanceof jn?d_(this._dataReader,"WriteBatch.update",s._key,t,r,i):h_(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,tt.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=lu(e,this._firestore);return this._mutations=this._mutations.concat(new Ar(t._key,tt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(A.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function lu(n,e){if((n=Xe(n)).firestore!==e)throw new V(A.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function w_(n){return yh(n=ct(n,At)),new Yl(n,e=>ts(n,e))}(function(e,t=!0){(function(i){Pr=i})(Qp),Si(new Mt("firestore",(r,{instanceIdentifier:i,options:s})=>{let a=r.getProvider("app").getImmediate(),c=new At(new fu(r.getProvider("auth-internal")),new gu(a,r.getProvider("app-check-internal")),function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new V(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ho(d.options.projectId,p)}(a,i),a);return s=j({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),on(tm,nm,e),on(tm,nm,"esm2020")})();var Xo=(()=>{class n{constructor(){this.app=xi(Ts.firebaseConfig),this.db=Wo(this.app),this.messagesSubject=new ye([]),this.messages$=this.messagesSubject.asObservable(),this.logoutSubject=new ye(void 0),this.logout$=this.logoutSubject.asObservable(),this.listenForMessages()}listenForMessages(){let t=ht(this.db,"messages"),r=Xi(t,g_("timestamp","asc"),Zi(100));qt(r,i=>{let s=i.docs.map(a=>{let c=a.data();return{id:a.id,text:c.text,senderName:c.senderName,timestamp:c.timestamp.toDate(),userId:c.userId,conversationId:c.conversationId,audioBase64:c.audioBase64,isRead:c.isRead||!1}});this.messagesSubject.next(s)},i=>{console.error("Error listening to messages:",i)})}sendMessage(t,r,i){return P(this,null,function*(){let s=ht(this.db,"messages"),a=localStorage.getItem("jjm_user_id")||null;yield es(s,{text:t,senderName:r,conversationId:i,timestamp:new Date,userId:a,isRead:!1})})}sendAudioMessage(t,r,i){return P(this,null,function*(){let s=ht(this.db,"messages"),a=localStorage.getItem("jjm_user_id")||null;yield es(s,{text:"\u{1F3A4} Voice Message",senderName:r,audioBase64:t,conversationId:i,timestamp:new Date,userId:a,isRead:!1})})}deleteMessage(t){return P(this,null,function*(){let r=zt(this.db,"messages",t);yield v_(r)})}markAsRead(t){return P(this,null,function*(){let r=w_(this.db);t.forEach(i=>{let s=zt(this.db,"messages",i);r.update(s,{isRead:!0})}),yield r.commit()})}getMessages(){return this.messages$}triggerLogout(){this.logoutSubject.next()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var C_=(()=>{class n{constructor(){this.app=xi(Ts.firebaseConfig),this.db=Wo(this.app),this.peerConnection=null,this.localStream=null,this.remoteStream=null,this.callDocSubscription=null,this.offerCandidatesSubscription=null,this.answerCandidatesSubscription=null,this.incomingCall$=new pt,this.callStatus$=new ye("idle"),this.remoteStream$=new ye(null),this.error$=new pt,this.currentCallId=null,this.candidateQueue=[],this.servers={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302"]}]}}initializeCall(t,r){return P(this,null,function*(){try{this.currentCallId=null,this.callStatus$.next("calling");let i=zt(ht(this.db,"calls"));this.currentCallId=i.id,yield this.setupLocalMedia(),this.setupPeerConnection(this.currentCallId),this.localStream&&this.localStream.getTracks().forEach(l=>{this.peerConnection&&this.localStream&&this.peerConnection.addTrack(l,this.localStream)});let s=yield this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1});yield this.peerConnection.setLocalDescription(s);let a={id:this.currentCallId,conversationId:t,callerName:r,status:"offering",offer:{type:s.type,sdp:s.sdp},timestamp:new Date};yield y_(i,a),this.callDocSubscription=qt(i,l=>P(this,null,function*(){let d=l.data();if(!(!this.peerConnection||!d)){if(this.peerConnection.signalingState==="have-local-offer"&&d.answer){let p=new RTCSessionDescription(d.answer);yield this.peerConnection.setRemoteDescription(p),this.callStatus$.next("connected"),this.candidateQueue.forEach(m=>{this.peerConnection?.addIceCandidate(m).catch(w=>console.error("Error adding buffered candidate",w))}),this.candidateQueue=[]}(d.status==="ended"||d.status==="rejected")&&this.endCallInternal()}}));let c=ht(i,"answerCandidates");this.answerCandidatesSubscription=qt(c,l=>{l.docChanges().forEach(d=>{if(d.type==="added"){let p=d.doc.data(),m=new RTCIceCandidate(p);this.peerConnection?.remoteDescription?this.peerConnection.addIceCandidate(m).catch(w=>console.error("Error adding candidate",w)):(console.log("Buffering candidate..."),this.candidateQueue.push(m))}})})}catch(i){console.error("Call Initialization Failed:",i),this.error$.next("Failed to start call: "+(i.message||i)),this.endCallInternal()}})}answerCall(t){return P(this,null,function*(){try{this.currentCallId=t.id,this.callStatus$.next("connected");let r=zt(this.db,"calls",t.id);yield this.setupLocalMedia(),this.setupPeerConnection(t.id),this.localStream.getTracks().forEach(l=>{this.peerConnection.addTrack(l,this.localStream)});let i=t.offer;yield this.peerConnection.setRemoteDescription(new RTCSessionDescription(i));let s=yield this.peerConnection.createAnswer();yield this.peerConnection.setLocalDescription(s);let a={type:s.type,sdp:s.sdp};yield Jo(r,{answer:a,status:"answered"});let c=ht(r,"offerCandidates");this.offerCandidatesSubscription=qt(c,l=>{l.docChanges().forEach(d=>{if(d.type==="added"){let p=d.doc.data(),m=new RTCIceCandidate(p);this.peerConnection?.remoteDescription&&this.peerConnection.addIceCandidate(m).catch(w=>console.error("Error adding offer candidate",w))}})}),this.callDocSubscription=qt(r,l=>{let d=l.data();d&&d.status==="ended"&&this.endCallInternal()})}catch(r){console.error("Error answering call:",r),this.error$.next("Failed to answer call: "+(r.message||r)),this.endCallInternal()}})}endCall(){return P(this,null,function*(){if(this.currentCallId){let t=zt(this.db,"calls",this.currentCallId);yield Jo(t,{status:"ended"}).catch(()=>{})}this.endCallInternal()})}rejectCall(t){let r=zt(this.db,"calls",t);Jo(r,{status:"rejected"}).catch(()=>{})}endCallInternal(){this.callStatus$.next("idle"),this.remoteStream$.next(null),this.localStream&&(this.localStream.getTracks().forEach(t=>t.stop()),this.localStream=null),this.remoteStream&&(this.remoteStream.getTracks().forEach(t=>t.stop()),this.remoteStream=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.callDocSubscription&&(this.callDocSubscription(),this.callDocSubscription=null),this.offerCandidatesSubscription&&(this.offerCandidatesSubscription(),this.offerCandidatesSubscription=null),this.answerCandidatesSubscription&&(this.answerCandidatesSubscription(),this.answerCandidatesSubscription=null),this.currentCallId=null}setupLocalMedia(){return P(this,null,function*(){try{this.localStream=yield navigator.mediaDevices.getUserMedia({video:!1,audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),console.log("CallService: Local media acquired",this.localStream),this.localStream.getAudioTracks().forEach(t=>{console.log("Local Track:",t.label,t.readyState,t.enabled,t.muted),t.enabled=!0})}catch(t){throw console.error("CallService: Error getting user media",t),t}})}setupPeerConnection(t){this.peerConnection=new RTCPeerConnection(this.servers),this.peerConnection.oniceconnectionstatechange=()=>{let r=this.peerConnection?.iceConnectionState;console.log("CallService: ICE Connection State Change:",r),(r==="failed"||r==="disconnected")&&console.warn("CallService: Peer connection failed/disconnected. Check firewall/network."),r==="connected"&&console.log("CallService: P2P Connection Established!")},this.peerConnection.onicecandidateerror=r=>{console.error("CallService: ICE Candidate Error:",r.errorCode,r.errorText,r.url)},this.peerConnection.onicecandidate=r=>{if(r.candidate){console.log("CallService: Generated ICE Candidate:",r.candidate.type,r.candidate.address);let i="offerCandidates";this.peerConnection?.localDescription&&this.peerConnection.localDescription.type==="answer"&&(i="answerCandidates");let s=ht(this.db,"calls",t,i);es(s,r.candidate.toJSON())}},this.peerConnection.ontrack=r=>{console.log("CallService: Received remote track",r.streams[0]);let i=r.streams[0];this.remoteStream=i,this.remoteStream$.next(i)}}listenForIncomingCalls(t){this.callDocSubscription;let r=ht(this.db,"calls"),i=Xi(r,Yo("conversationId","==",t),Yo("status","==","offering"),Zi(1));return qt(i,s=>{s.docChanges().forEach(a=>{if(a.type==="added"){let c=a.doc.data();c.id=a.doc.id,this.incomingCall$.next(c)}a.type==="removed"&&this.incomingCall$.next(null)})})}listenForAllIncomingCalls(){let t=ht(this.db,"calls"),r=Xi(t,Yo("status","==","offering"),Zi(1));return qt(r,i=>{i.docChanges().forEach(s=>{if(s.type==="added"){let a=s.doc.data();a.id=s.doc.id,this.incomingCall$.next(a)}s.type==="removed"&&this.incomingCall$.next(null)})})}toggleMic(t){this.localStream&&this.localStream.getAudioTracks().forEach(r=>{r.enabled=!t})}setAudioOutput(t,r){return P(this,null,function*(){if("setSinkId"in r)try{return yield r.setSinkId(t),console.log(`Audio output set to ${t}`),!0}catch(i){return console.error("Error setting audio output:",i),!1}return console.warn("setSinkId not supported in this browser."),!1})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ue({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var HC=["messagesContainer"],KC=["remoteAudio"];function WC(n,e){if(n&1){let t=Ue();S(0,"div",5)(1,"div",6)(2,"h2"),N(3,"\u{1F4CB} Customer Information"),x(),S(4,"p",7),N(5,"Please provide your information to use the chat"),x(),S(6,"form",8),ee("ngSubmit",function(){W(t);let i=F();return Q(i.registerCustomer())}),S(7,"div",9)(8,"label",10),N(9,"Full Name *"),x(),S(10,"input",11),Yn("ngModelChange",function(i){W(t);let s=F();return Qn(s.customerInfo.name,i)||(s.customerInfo.name=i),Q(i)}),x()(),S(11,"div",9)(12,"label",12),N(13,"Phone Number *"),x(),S(14,"input",13),Yn("ngModelChange",function(i){W(t);let s=F();return Qn(s.customerInfo.phoneNumber,i)||(s.customerInfo.phoneNumber=i),Q(i)}),x()(),S(15,"div",9)(16,"label",14),N(17,"Delivery Address *"),x(),S(18,"textarea",15),Yn("ngModelChange",function(i){W(t);let s=F();return Qn(s.customerInfo.address,i)||(s.customerInfo.address=i),Q(i)}),x()(),S(19,"div",9)(20,"label"),N(21,"GPS Coordinates"),x(),S(22,"div",16)(23,"input",17),Yn("ngModelChange",function(i){W(t);let s=F();return Qn(s.customerInfo.gpsCoordinates,i)||(s.customerInfo.gpsCoordinates=i),Q(i)}),x(),S(24,"button",18),ee("click",function(){W(t);let i=F();return Q(i.getLocation())}),N(25,"\u{1F4CD}"),x()()(),S(26,"button",19),N(27," Start Chat "),x()()()()}if(n&2){let t=F();M(10),Wn("ngModel",t.customerInfo.name),M(4),Wn("ngModel",t.customerInfo.phoneNumber),M(4),Wn("ngModel",t.customerInfo.address),z("readonly",t.isLocationReadOnly),M(5),Wn("ngModel",t.customerInfo.gpsCoordinates),z("readonly",t.isLocationReadOnly)}}function QC(n,e){if(n&1&&(S(0,"div",50),N(1),x()),n&2){let t=F().$implicit,r=F(3);M(),xe(r.unreadCounts[t])}}function YC(n,e){if(n&1){let t=Ue();S(0,"div",44),ee("click",function(){let i=W(t).$implicit,s=F(3);return Q(s.selectConversation(i))}),S(1,"div",45),N(2),x(),S(3,"div",46)(4,"span",47),N(5),x(),S(6,"span",48),N(7,"Click to view chat"),x()(),fe(8,QC,2,1,"div",49),x()}if(n&2){let t=e.$implicit,r=F(3);Me("active",r.currentConversationId===t),M(2),xe(r.getDisplayName(t).charAt(0).toUpperCase()),M(3),xe(r.getDisplayName(t)),M(3),z("ngIf",r.unreadCounts[t]>0)}}function JC(n,e){n&1&&(S(0,"div",51),N(1," No conversations yet. "),x())}function XC(n,e){if(n&1&&(S(0,"div",40)(1,"div",41),N(2," Conversations "),x(),S(3,"div",42),fe(4,YC,9,5,"div",43)(5,JC,2,0,"div",34),x()()),n&2){let t=F(2);M(4),z("ngForOf",t.conversations),M(),z("ngIf",t.conversations.length===0)}}function ZC(n,e){if(n&1&&(S(0,"div"),N(1),x()),n&2){let t=F(3);M(),je("\u{1F4CD} ",t.getUserAddress(t.currentConversationId),"")}}function eI(n,e){if(n&1&&(S(0,"a",55),N(1),x()),n&2){let t=F(3);z("href","https://www.google.com/maps/search/?api=1&query="+t.getUserGps(t.currentConversationId),ws),M(),je(" \u{1F30D} ",t.getUserGps(t.currentConversationId)," ")}}function tI(n,e){if(n&1&&(S(0,"div",52),fe(1,ZC,2,1,"div",53)(2,eI,2,2,"a",54),x()),n&2){let t=F(2);M(),z("ngIf",t.getUserAddress(t.currentConversationId)),M(),z("ngIf",t.getUserGps(t.currentConversationId))}}function nI(n,e){if(n&1){let t=Ue();S(0,"button",56),ee("click",function(){W(t);let i=F(2);return Q(i.logout())}),N(1," \u{1F6AA} "),x()}}function rI(n,e){if(n&1){let t=Ue();S(0,"div",57)(1,"div",58)(2,"h3"),N(3,"\u{1F4DE} Incoming Call"),x(),S(4,"p"),N(5),x(),S(6,"div",59)(7,"button",60),ee("click",function(){W(t);let i=F(2);return Q(i.acceptCall())}),N(8,"Accept"),x(),S(9,"button",61),ee("click",function(){W(t);let i=F(2);return Q(i.rejectCall())}),N(10,"Reject"),x()()()()}if(n&2){let t=F(2);M(5),je("",t.incomingCall.callerName," is calling...")}}function iI(n,e){if(n&1){let t=Ue();S(0,"button",72),ee("click",function(){W(t);let i=F(3);return Q(i.toggleMic())}),N(1),x()}if(n&2){let t=F(3);Me("active",t.isMicMuted),M(),je(" ",t.isMicMuted?"\u{1F507}":"\u{1F399}\uFE0F"," ")}}function sI(n,e){if(n&1){let t=Ue();S(0,"div",62)(1,"div",58)(2,"div",63),N(3,"\u{1F464}"),x(),S(4,"h3"),N(5),x(),S(6,"p"),N(7),x(),S(8,"div",64),ve(9,"audio",65,1),x(),S(11,"div",66),ve(12,"div",67),x(),S(13,"div",68)(14,"button",69),ee("click",function(){W(t);let i=F(2);return Q(i.toggleSpeaker())}),N(15),x(),fe(16,iI,2,3,"button",70),x(),S(17,"div",59)(18,"button",71),ee("click",function(){W(t);let i=F(2);return Q(i.endCall())}),N(19,"End Call"),x()()()()}if(n&2){let t=F(2);M(5),xe(t.callStatus==="calling"?"Calling...":"Connected"),M(2),xe(t.isAppUser?t.currentConversationId:"Support"),M(2),z("srcObject",t.remoteStream),M(3),Kd("width",t.audioLevel,"%"),M(2),Me("active",t.isSpeakerOn),M(),je(" ",t.isSpeakerOn?"\u{1F50A}":"\u{1F508}"," "),M(),z("ngIf",t.isAppUser)}}function oI(n,e){if(n&1&&(S(0,"div",51),N(1),x()),n&2){let t=F(2);M(),je(" ",t.isAppUser&&!t.currentConversationId?"Select a conversation to start chatting.":"No messages yet. Start the conversation!"," ")}}function aI(n,e){if(n&1&&(S(0,"span",83),N(1),x()),n&2){let t=F().$implicit,r=F(2);M(),je(" \u{1F4CD} ",r.getUserAddress(t.senderName)," ")}}function cI(n,e){if(n&1&&(S(0,"a",84),N(1),x()),n&2){let t=F().$implicit,r=F(2);z("href","https://www.google.com/maps/search/?api=1&query="+r.getUserGps(t.senderName),ws),M(),je(" \u{1F30D} ",r.getUserGps(t.senderName)," ")}}function uI(n,e){if(n&1&&(S(0,"div",85),N(1),x()),n&2){let t=F().$implicit;M(),xe(t.text)}}function lI(n,e){if(n&1&&(S(0,"div",86),ve(1,"audio",87),x()),n&2){let t=F().$implicit;M(),z("src",t.audioBase64,ws)}}function hI(n,e){if(n&1){let t=Ue();S(0,"button",88),ee("click",function(){W(t);let i=F().$implicit,s=F(2);return Q(s.deleteMessage(i))}),N(1," \u{1F5D1}\uFE0F "),x()}}function dI(n,e){if(n&1&&(S(0,"div",73)(1,"div",74)(2,"span",75),N(3),x(),S(4,"div",76),fe(5,aI,2,1,"span",77)(6,cI,2,2,"a",78),S(7,"span",79),N(8),x()()(),fe(9,uI,2,1,"div",80)(10,lI,2,1,"div",81)(11,hI,2,0,"button",82),x()),n&2){let t=e.$implicit,r=F(2);Me("my-message",r.isMyMessage(t))("other-message",!r.isMyMessage(t)),M(3),xe(t.senderName),M(2),z("ngIf",!r.isMyMessage(t)&&r.getUserAddress(t.senderName)),M(),z("ngIf",!r.isMyMessage(t)&&r.getUserGps(t.senderName)),M(2),xe(r.formatTime(t.timestamp)),M(),z("ngIf",t.text),M(),z("ngIf",t.audioBase64),M(),z("ngIf",r.isMyMessage(t))}}function fI(n,e){if(n&1){let t=Ue();S(0,"div",20),fe(1,XC,6,2,"div",21),S(2,"div",22)(3,"div",23)(4,"div",24)(5,"h2"),N(6),x(),fe(7,tI,3,2,"div",25),S(8,"div",26)(9,"span",27),N(10),x(),S(11,"button",28),ee("click",function(){W(t);let i=F();return Q(i.changeInfo())}),N(12," \u270F\uFE0F "),x(),fe(13,nI,2,0,"button",29),S(14,"button",30),ee("click",function(){W(t);let i=F();return Q(i.startCall())}),N(15," \u{1F4DE} "),x()()()(),fe(16,rI,11,1,"div",31)(17,sI,20,9,"div",32),S(18,"div",33,0),fe(20,oI,2,1,"div",34)(21,dI,12,11,"div",35),x(),S(22,"div",36)(23,"input",37),Yn("ngModelChange",function(i){W(t);let s=F();return Qn(s.newMessage,i)||(s.newMessage=i),Q(i)}),ee("keyup.enter",function(){W(t);let i=F();return Q(i.sendMessage())}),x(),S(24,"button",38),ee("click",function(){W(t);let i=F();return Q(i.sendMessage())}),N(25," Send "),x(),S(26,"button",39),ee("mousedown",function(i){W(t);let s=F();return Q(s.startRecording(i))})("mouseup",function(i){W(t);let s=F();return Q(s.stopRecording(i))})("mouseleave",function(i){W(t);let s=F();return Q(s.stopRecording(i))})("touchstart",function(i){W(t);let s=F();return Q(s.startRecording(i))})("touchend",function(i){W(t);let s=F();return Q(s.stopRecording(i))}),N(27),x()()()()}if(n&2){let t=F();M(),z("ngIf",t.isAppUser),M(5),je(" \u{1F4AC} ",t.isAppUser&&t.currentConversationId?"Chat with "+t.getDisplayName(t.currentConversationId):"Customer Support Chat"," "),M(),z("ngIf",t.isAppUser&&t.currentConversationId),M(3),xe(t.senderName),M(3),z("ngIf",!t.isAppUser),M(),z("disabled",t.isAppUser&&!t.currentConversationId),M(2),z("ngIf",t.callStatus==="incoming"&&t.incomingCall),M(),z("ngIf",t.callStatus==="connected"||t.callStatus==="calling"),M(3),z("ngIf",t.messages.length===0),M(),z("ngForOf",t.messages),M(2),Wn("ngModel",t.newMessage),z("disabled",t.isAppUser&&!t.currentConversationId),M(),z("disabled",!t.newMessage.trim()||t.isAppUser&&!t.currentConversationId),M(2),Me("recording",t.isRecording),z("disabled",t.isAppUser&&!t.currentConversationId),M(),je(" ",t.isRecording?"\u{1F534}":"\u{1F399}\uFE0F"," ")}}var I_=(()=>{class n{constructor(t,r,i,s){this.chatService=t,this.customerService=r,this.userService=i,this.callService=s,this.messages=[],this.newMessage="",this.senderName="",this.isOpen=!1,this.totalUnreadCountChange=new In,this.isLocationReadOnly=!0,this.shouldScroll=!1,this.userNamesCache=new Map,this.userAddressesCache=new Map,this.userGpsCache=new Map,this.isRegistered=!1,this.customerInfo={name:"",phoneNumber:"",address:"N/A",gpsCoordinates:"N/A"},this.allCustomers=[],this.errorMessage="",this.isAppUser=!1,this.currentConversationId="",this.conversations=[],this.callStatus="idle",this.incomingCall=null,this.remoteStream=null,this.notificationAudioContext=null,this.audioUnlocked=!1,this.allMessagesCached=[],this.unreadCounts={},this.conversationMessageCounts={},this.isSpeakerOn=!1,this.isMicMuted=!1,this.audioLevel=0,this.audioContext=null,this.analyser=null,this.source=null,this.dataArray=null,this.animationFrameId=null,this.ringInterval=null,this.isRecording=!1,this.mediaRecorder=null,this.audioChunks=[],this.requestNotificationPermission()}ngOnChanges(t){if(t.isOpen&&this.isOpen){let r=localStorage.getItem("chatCustomerInfo");if(r&&!this.isRegistered)try{let i=JSON.parse(r);i.expiresAt&&Date.now()>i.expiresAt?(localStorage.removeItem("chatCustomerInfo"),localStorage.removeItem("chatUserName"),console.log("Chat credentials expired, cleared from storage")):this.checkLoginAndStatus()}catch(i){console.error("Error parsing chat credentials",i),localStorage.removeItem("chatCustomerInfo"),localStorage.removeItem("chatUserName")}this.updateFilteredMessages(!1),this.shouldScroll=!0}}requestNotificationPermission(){"Notification"in window&&Notification.requestPermission()}onVisibilityChange(){document.hidden||(document.title="JJM Inventory")}unlockAudioContext(){if(this.audioUnlocked)return;if(!this.notificationAudioContext){let r=window.AudioContext||window.webkitAudioContext;this.notificationAudioContext=new r}let t=this.notificationAudioContext;if(t){t.state==="suspended"&&t.resume();try{let r=t.createBuffer(1,1,22050),i=t.createBufferSource();i.buffer=r,i.connect(t.destination),i.start(0),this.audioUnlocked=!0,console.log("ChatComponent: AudioContext unlocked via user interaction.")}catch(r){console.error("ChatComponent: Failed to unlock audio",r)}}}onUserInteraction(){this.unlockAudioContext()}ngOnInit(){this.customerSubscription=this.customerService.getCustomers().subscribe({next:t=>{this.allCustomers=t,this.checkLoginAndStatus()},error:t=>{console.error("Failed to load customers",t),this.checkLoginAndStatus()}}),this.logoutSubscription=this.chatService.logout$.subscribe(()=>{this.performForceLogout()}),this.callStatusSubscription=this.callService.callStatus$.subscribe(t=>{this.callStatus=t,t!=="incoming"&&this.stopRinging()}),this.incomingCallSubscription=this.callService.incomingCall$.subscribe(t=>{if(!t){this.callStatus==="incoming"&&(this.incomingCall=null,this.callStatus="idle",this.stopRinging());return}this.callStatus==="idle"&&t.callerName!==this.senderName&&(this.incomingCall=t,this.callStatus="incoming",this.startRinging())}),this.callService.remoteStream$.subscribe(t=>{this.remoteStream=t,t&&this.remoteAudio&&setTimeout(()=>{let r=this.remoteAudio.nativeElement;r.srcObject=t,r.muted=!1,r.volume=1;let i=t.getAudioTracks();i.length>0?(console.log("ChatComponent: Audio track found",i[0].label,"Enabled:",i[0].enabled,"Muted:",i[0].muted),i[0].enabled=!0):console.warn("ChatComponent: No audio tracks in stream!"),r.onloadedmetadata=()=>{console.log("ChatComponent: Audio metadata loaded, attempting play..."),r.play().then(()=>{console.log("ChatComponent: Audio playing successfully"),this.setupAudioVisualizer(t)}).catch(s=>console.error("ChatComponent: Error playing audio:",s))}},100)}),this.callErrorSubscription=this.callService.error$.subscribe(t=>{alert("Call Failed: "+t),this.callStatus="idle",this.stopRinging()})}performForceLogout(){localStorage.removeItem("chatCustomerInfo"),localStorage.removeItem("chatUserName"),this.isRegistered=!1,this.isAppUser=!1,this.senderName="",this.conversations=[],this.currentConversationId="",this.customerInfo={name:"",phoneNumber:"",address:"N/A",gpsCoordinates:"N/A"},this.messages=[]}checkLoginAndStatus(){let t=localStorage.getItem("jjm_logged_in")==="true",r=localStorage.getItem("jjm_username"),i=localStorage.getItem("jjm_user_id");if(t){if(this.isAppUser=!0,this.isRegistered=!0,this.errorMessage="",this.senderName=r||"User",this.loadMessages(),this.incomingCallListener&&this.incomingCallListener(),this.incomingCallListener=this.callService.listenForAllIncomingCalls(),i){let a=this.userService.getUserById(i);a?this.senderName=a.fullName||a.username:this.userService.users$.pipe(xt(1)).subscribe(c=>{let l=c.find(d=>d.id===i);l&&(this.senderName=l.fullName||l.username)})}return}let s=localStorage.getItem("chatCustomerInfo");if(s){let a=JSON.parse(s);if(a.expiresAt&&Date.now()>a.expiresAt){localStorage.removeItem("chatCustomerInfo"),localStorage.removeItem("chatUserName"),this.isRegistered=!1,this.getLocation(!0),console.log("Chat credentials expired after 2 hours");return}this.customerInfo=a,this.senderName=this.customerInfo.name,this.isRegistered=!0,this.loadMessages(),this.incomingCallListener&&this.incomingCallListener(),this.incomingCallListener=this.callService.listenForIncomingCalls(this.senderName),this.allCustomers.find(l=>l.phoneNumber===a.phoneNumber)||console.log("Customer not yet in database, but logged in via localStorage")}else this.getLocation(!0)}ngAfterViewChecked(){this.shouldScroll&&(this.scrollToBottom(),this.shouldScroll=!1)}ngOnDestroy(){this.customerSubscription&&this.customerSubscription.unsubscribe(),this.logoutSubscription&&this.logoutSubscription.unsubscribe(),this.incomingCallSubscription&&this.incomingCallSubscription.unsubscribe(),this.callStatusSubscription&&this.callStatusSubscription.unsubscribe(),this.callErrorSubscription&&this.callErrorSubscription.unsubscribe(),this.incomingCallListener&&this.incomingCallListener()}registerCustomer(){if(this.errorMessage="",!this.customerInfo.name.trim()){alert("Please enter your name");return}if(!this.customerInfo.phoneNumber.trim()){alert("Please enter your phone number");return}if(!this.customerInfo.address.trim()){alert("Please enter your address");return}if(!/^[\d\s\-\+\(\)]+$/.test(this.customerInfo.phoneNumber)){alert("Please enter a valid phone number");return}if(this.allCustomers.length>0){if(!this.allCustomers.find(i=>i.name.toLowerCase()===this.customerInfo.name.trim().toLowerCase())){alert("Access Denied: You must be a registered customer to use the chat.");return}}else console.warn("Customer verification skipped: Customer list is empty or failed to load.");localStorage.setItem("chatCustomerInfo",JSON.stringify(this.customerInfo)),localStorage.setItem("chatUserName",this.customerInfo.name),this.senderName=this.customerInfo.name,this.isRegistered=!0,this.isRegistered=!0,this.loadMessages(),this.callService.listenForIncomingCalls(this.senderName)}notifyUser(t){this.isMyMessage(t)||(this.playNotificationSound(),document.hidden&&"Notification"in window&&Notification.permission==="granted"&&(new Notification("New Message",{body:t.text||"You received a new audio message",icon:"/assets/icons/icon-72x72.png"}),document.title=`New Message from ${t.senderName}`))}loadMessages(){if(this.messagesSubscription){this.updateFilteredMessages(!1);return}this.messagesSubscription=this.chatService.getMessages().subscribe({next:t=>{if(this.allMessagesCached=t,this.isAppUser){let i=new Map,s=new Set,a=new Map;t.forEach(c=>{c.conversationId&&(s.add(c.conversationId),i.set(c.conversationId,(i.get(c.conversationId)||0)+1),a.set(c.conversationId,c))}),this.conversations=Array.from(s),this.userService.users$.pipe(xt(1)).subscribe(c=>{this.conversations.forEach(l=>{if(!this.userNamesCache.has(l)||!this.userAddressesCache.get(l)||!this.userGpsCache.get(l)){let d=c.find(p=>p.username===l||p.fullName===l||p.id===l);if(d)this.userNamesCache.set(l,d.fullName||d.username),this.userAddressesCache.set(l,d.address||""),this.userGpsCache.set(l,d.gpsCoordinates||"");else{let p=this.allCustomers.find(m=>m.name===l);p?(this.userNamesCache.set(l,p.name),this.userAddressesCache.set(l,p.deliveryAddress),this.userGpsCache.set(l,p.gpsCoordinates||"")):this.userNamesCache.set(l,l)}}})}),this.conversations.forEach(c=>{let l=i.get(c)||0,d=this.conversationMessageCounts[c]||0;if(this.unreadCounts[c]=t.filter(p=>p.conversationId===c&&!p.isRead&&!this.isMyMessage(p)).length,l>d){let p=a.get(c);p&&this.notifyUser(p)}this.conversationMessageCounts[c]=l})}let r=0;this.isAppUser?r=Object.values(this.unreadCounts).reduce((i,s)=>i+s,0):r=t.filter(i=>!i.isRead&&!this.isMyMessage(i)).length,this.totalUnreadCountChange.emit(r),this.updateFilteredMessages(!this.isAppUser)},error:t=>{console.error("Error loading messages:",t)}})}getDisplayName(t){return this.userNamesCache.get(t)||t}getUserAddress(t){return this.userAddressesCache.get(t)||""}getUserGps(t){return this.userGpsCache.get(t)||""}updateFilteredMessages(t){let r=this.isAppUser?this.currentConversationId:this.senderName,i=this.allMessagesCached.filter(l=>r?l.conversationId===r:!1),s=this.messages.length,a=i.length,c=s>0;if(this.messages=i,this.isOpen&&r){let l=i.filter(d=>!d.isRead&&!this.isMyMessage(d)).map(d=>d.id);l.length>0&&this.chatService.markAsRead(l)}if(t&&c&&a>s){let l=i[a-1];this.isMyMessage(l)||(this.playNotificationSound(),document.hidden&&"Notification"in window&&Notification.permission==="granted"&&(new Notification("New Message",{body:l.text||"You received a new audio message",icon:"/assets/icons/icon-72x72.png"}),document.title=`(${a-s}) New Message - JJM Inventory`))}(!c||a>s)&&(this.shouldScroll=!0,setTimeout(()=>this.scrollToBottom(),100))}playNotificationSound(){try{let t=this.notificationAudioContext;if(!t){let c=window.AudioContext||window.webkitAudioContext;c&&(t=new c)}if(!t)return;t.state==="suspended"&&t.resume().catch(c=>console.warn("Could not resume audio context",c));let r=t.currentTime,i=t.createOscillator(),s=t.createOscillator(),a=t.createGain();i.type="sine",s.type="sine",i.frequency.setValueAtTime(1200,r),s.frequency.setValueAtTime(2400,r),i.connect(a),s.connect(a),a.connect(t.destination),a.gain.setValueAtTime(0,r),a.gain.linearRampToValueAtTime(.5,r+.02),a.gain.exponentialRampToValueAtTime(.01,r+.6),i.start(r),s.start(r),i.stop(r+.6),s.stop(r+.6)}catch(t){console.warn("Audio playback failed",t)}}startRinging(){if(this.ringInterval)return;let t=()=>{try{let r=window.AudioContext||window.webkitAudioContext,i=new r,s=i.createOscillator(),a=i.createOscillator(),c=i.createGain();s.connect(c),a.connect(c),c.connect(i.destination),s.frequency.value=440,a.frequency.value=480,c.gain.setValueAtTime(0,i.currentTime),c.gain.linearRampToValueAtTime(.5,i.currentTime+.1),c.gain.setValueAtTime(.5,i.currentTime+1.8),c.gain.linearRampToValueAtTime(0,i.currentTime+2),s.start(i.currentTime),a.start(i.currentTime),s.stop(i.currentTime+2),a.stop(i.currentTime+2),setTimeout(()=>{i.state!=="closed"&&i.close()},2500)}catch(r){console.warn("Ring playback failed",r)}};t(),this.ringInterval=setInterval(t,4e3)}stopRinging(){this.ringInterval&&(clearInterval(this.ringInterval),this.ringInterval=null)}sendMessage(){if(!this.newMessage.trim())return;let t=this.isAppUser?this.currentConversationId:this.senderName;if(this.isAppUser&&!t){alert("Please select a conversation first.");return}this.chatService.sendMessage(this.newMessage,this.senderName,t).then(()=>{this.newMessage="",this.shouldScroll=!0}).catch(r=>{console.error("Error sending message:",r),alert("Failed to send message. Please try again.")})}getLocation(t=!1){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(r=>{let i=r.coords.latitude,s=r.coords.longitude;this.customerInfo.gpsCoordinates=`${i.toFixed(6)}, ${s.toFixed(6)}`,this.customerInfo.address||this.fetchAddressFromGps(i,s)},r=>{console.error("Error getting location",r),t||(this.isLocationReadOnly=!1,alert("Unable to retrieve location. Please enter manually."))}):t||(this.isLocationReadOnly=!1,alert("Geolocation is not supported by your browser."))}fetchAddressFromGps(t,r){return P(this,null,function*(){try{let i=yield fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${t}&lon=${r}`);if(i.ok){let s=yield i.json();s.display_name&&(this.customerInfo.address=s.display_name)}}catch(i){console.warn("Failed to reverse geocode",i)}})}selectConversation(t){this.currentConversationId=t,this.unreadCounts[t]=0,this.updateFilteredMessages(!1)}scrollToBottom(){if(this.messagesContainer)try{this.messagesContainer.nativeElement.scrollTop=this.messagesContainer.nativeElement.scrollHeight}catch(t){console.error("Scroll error:",t)}}formatTime(t){return new Date(t).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}isMyMessage(t){let r=localStorage.getItem("jjm_user_id");return this.isAppUser&&r&&t.userId===r?!0:t.senderName===this.senderName}changeInfo(){alert("Do you want to update your customer information?"),this.isRegistered=!1}startRecording(t){t&&(t.preventDefault(),t.stopPropagation()),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(r=>{this.mediaRecorder=new MediaRecorder(r),this.mediaRecorder.start(),this.isRecording=!0,this.audioChunks=[],this.mediaRecorder.addEventListener("dataavailable",i=>{i.data.size>0&&this.audioChunks.push(i.data)}),this.mediaRecorder.addEventListener("stop",()=>{let i=new Blob(this.audioChunks,{type:"audio/webm"}),s=new FileReader;s.readAsDataURL(i),s.onloadend=()=>{let a=s.result;a&&this.sendAudio(a)},r.getTracks().forEach(a=>a.stop())})}).catch(r=>{console.error("Error accessing microphone:",r),alert("Could not access microphone. Please allow permissions."),this.isRecording=!1}):alert("Audio recording is not supported in this browser.")}stopRecording(t){t&&(t.preventDefault(),t.stopPropagation()),this.mediaRecorder&&this.isRecording&&(this.mediaRecorder.stop(),this.isRecording=!1)}cancelRecording(){this.mediaRecorder&&this.isRecording&&this.stopRecording()}sendAudio(t){let r=this.isAppUser?this.currentConversationId:this.senderName;if(this.isAppUser&&!r){alert("Please select a conversation first.");return}this.chatService.sendAudioMessage(t,this.senderName,r).then(()=>{this.shouldScroll=!0}).catch(i=>{console.error("Error sending audio message:",i),alert("Failed to send audio message.")})}deleteMessage(t){this.isMyMessage(t)&&confirm("Are you sure you want to delete this message?")&&this.chatService.deleteMessage(t.id).catch(r=>{console.error("Error deleting message:",r),alert("Failed to delete message.")})}logout(){if(this.isAppUser){alert("You cannot logout of chat while logged into the application.");return}confirm("Are you sure you want to logout? Your information will be cleared.")&&(localStorage.removeItem("chatCustomerInfo"),localStorage.removeItem("chatUserName"),this.isRegistered=!1,this.customerInfo={name:"",phoneNumber:"",address:""},this.messages=[])}startCall(){let t=this.isAppUser?this.currentConversationId:this.senderName;if(!t){alert("Cannot start call: Unknown conversation.");return}this.callService.initializeCall(t,this.senderName)}acceptCall(){this.incomingCall&&(this.callService.answerCall(this.incomingCall),this.incomingCall=null)}rejectCall(){this.incomingCall&&(this.callService.rejectCall(this.incomingCall.id),this.incomingCall=null,this.callStatus="idle",this.stopRinging())}endCall(){this.callService.endCall(),this.isSpeakerOn=!1,this.isMicMuted=!1,this.cleanupAudioVisualizer()}setupAudioVisualizer(t){this.cleanupAudioVisualizer();try{let r=window.AudioContext||window.webkitAudioContext;this.audioContext=new r,this.audioContext.state==="suspended"&&(console.log("ChatComponent: AudioContext suspended. Attempting to resume..."),this.audioContext.resume().then(()=>console.log("ChatComponent: AudioContext resumed!"))),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=64,this.source=this.audioContext.createMediaStreamSource(t),this.source.connect(this.analyser),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount);let i=()=>{if(!this.analyser||!this.dataArray)return;this.analyser.getByteFrequencyData(this.dataArray);let s=0;for(let c=0;c<this.dataArray.length;c++)s+=this.dataArray[c];let a=s/this.dataArray.length;this.audioLevel=Math.min(100,Math.max(0,a/255*300)),this.animationFrameId=requestAnimationFrame(i)};i()}catch(r){console.error("Error setting up visualizer",r)}}cleanupAudioVisualizer(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.source&&(this.source.disconnect(),this.source=null),this.audioContext&&(this.audioContext.close().catch(()=>{}),this.audioContext=null),this.audioLevel=0}toggleSpeaker(){return P(this,null,function*(){if(this.isSpeakerOn=!this.isSpeakerOn,this.remoteAudio&&this.remoteAudio.nativeElement){let r=(yield navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="audiooutput");if(r.length>1&&this.isSpeakerOn){let i=r[0].deviceId==="default"?r[1].deviceId:r[0].deviceId;yield this.callService.setAudioOutput(i,this.remoteAudio.nativeElement)}else yield this.callService.setAudioOutput("default",this.remoteAudio.nativeElement)}})}toggleMic(){this.isMicMuted=!this.isMicMuted,this.callService.toggleMic(this.isMicMuted)}static{this.\u0275fac=function(r){return new(r||n)(Qe(Xo),Qe(_f),Qe(pf),Qe(C_))}}static{this.\u0275cmp=gt({type:n,selectors:[["app-chat"]],viewQuery:function(r,i){if(r&1&&(Va(HC,5),Va(KC,5)),r&2){let s;bs(s=Cs())&&(i.messagesContainer=s.first),bs(s=Cs())&&(i.remoteAudio=s.first)}},hostBindings:function(r,i){r&1&&ee("visibilitychange",function(){return i.onVisibilityChange()},!1,ei)("click",function(){return i.onUserInteraction()},!1,ei)("touchstart",function(){return i.onUserInteraction()},!1,ei)("keydown",function(){return i.onUserInteraction()},!1,ei)},inputs:{isOpen:"isOpen"},outputs:{totalUnreadCountChange:"totalUnreadCountChange"},standalone:!0,features:[vs,_t],decls:3,vars:2,consts:[["messagesContainer",""],["remoteAudio",""],[1,"chat-container"],["class","registration-container",4,"ngIf"],["class","chat-wrapper",4,"ngIf"],[1,"registration-container"],[1,"registration-card"],[1,"registration-subtitle"],[1,"registration-form",3,"ngSubmit"],[1,"form-group"],["for","customerName"],["type","text","id","customerName","name","customerName","placeholder","Enter your full name","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","phoneNumber"],["type","tel","id","phoneNumber","name","phoneNumber","placeholder","e.g., +1 234 567 8900","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","address"],["id","address","name","address","placeholder","Address will be detected automatically...","rows","3","required","",1,"form-textarea",3,"ngModelChange","ngModel","readonly"],[2,"display","flex","gap","8px"],["type","text","name","gpsCoordinates","placeholder","Lat, Lng (Auto-detected)",1,"form-input",3,"ngModelChange","ngModel","readonly"],["type","button",1,"btn-location",3,"click"],["type","submit",1,"btn-register"],[1,"chat-wrapper"],["class","chat-sidebar",4,"ngIf"],[1,"chat-main-area"],[1,"chat-header"],[1,"header-content"],["class","header-details-subtitle",4,"ngIf"],[1,"user-info"],[1,"user-name"],["title","Edit information",1,"btn-edit",3,"click"],["class","btn-logout","title","Logout",3,"click",4,"ngIf"],["title","Start Audio Call",1,"btn-call",3,"click","disabled"],["class","call-overlay incoming",4,"ngIf"],["class","call-overlay active",4,"ngIf"],[1,"messages-container"],["class","no-messages",4,"ngIf"],["class","message",3,"my-message","other-message",4,"ngFor","ngForOf"],[1,"input-container"],["type","text","placeholder","Type a message...",1,"message-input",3,"ngModelChange","keyup.enter","ngModel","disabled"],[1,"btn-send",3,"click","disabled"],["title","Hold to talk",1,"btn-mic",3,"mousedown","mouseup","mouseleave","touchstart","touchend","disabled"],[1,"chat-sidebar"],[1,"sidebar-header"],[1,"conversation-list"],["class","conversation-item",3,"active","click",4,"ngFor","ngForOf"],[1,"conversation-item",3,"click"],[1,"conv-avatar"],[1,"conv-info"],[1,"conversation-name"],[1,"conversation-preview"],["class","active-indicator",4,"ngIf"],[1,"active-indicator"],[1,"no-messages"],[1,"header-details-subtitle"],[4,"ngIf"],["target","_blank","style","color: inherit; text-decoration: none; display: flex; align-items: center; gap: 4px;",3,"href",4,"ngIf"],["target","_blank",2,"color","inherit","text-decoration","none","display","flex","align-items","center","gap","4px",3,"href"],["title","Logout",1,"btn-logout",3,"click"],[1,"call-overlay","incoming"],[1,"call-content"],[1,"call-actions"],[1,"btn-accept",3,"click"],[1,"btn-reject",3,"click"],[1,"call-overlay","active"],[1,"call-avatar","pulsing"],[2,"opacity","0","height","0","width","0","overflow","hidden","position","absolute","pointer-events","none"],["autoplay","","playsinline","","controls","",3,"srcObject"],["title","Audio Signal Strength",1,"volume-meter"],[1,"volume-bar"],[1,"call-utilities"],["title","Toggle Speaker",1,"btn-round",3,"click"],["class","btn-round","title","Toggle Microphone",3,"active","click",4,"ngIf"],[1,"btn-end",3,"click"],["title","Toggle Microphone",1,"btn-round",3,"click"],[1,"message"],[1,"message-header"],[1,"sender-name"],[1,"message-meta"],["class","message-address",4,"ngIf"],["class","message-address gps-link","target","_blank","title","View on Google Maps",3,"href",4,"ngIf"],[1,"message-time"],["class","message-text",4,"ngIf"],["class","message-audio",4,"ngIf"],["class","btn-delete-msg","title","Delete message",3,"click",4,"ngIf"],[1,"message-address"],["target","_blank","title","View on Google Maps",1,"message-address","gps-link",3,"href"],[1,"message-text"],[1,"message-audio"],["controls","",3,"src"],["title","Delete message",1,"btn-delete-msg",3,"click"]],template:function(r,i){r&1&&(S(0,"div",2),fe(1,WC,28,6,"div",3)(2,fI,28,17,"div",4),x()),r&2&&(M(),z("ngIf",!i.isRegistered),M(),z("ngIf",i.isRegistered))},dependencies:[Pt,ef,Zt,ff,hf,of,af,cf,df,lf,uf],styles:[".chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:var(--color-surface);overflow:hidden}.registration-container[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:center;min-height:100%;padding:var(--space-lg);background:linear-gradient(135deg,#3b82f60d,#9333ea0d);overflow-y:auto;scroll-behavior:smooth}.registration-card[_ngcontent-%COMP%]{background:var(--color-surface);border-radius:var(--radius-lg);padding:var(--space-xl);max-width:500px;width:100%;margin:auto;box-shadow:0 10px 25px #0000001a;animation:_ngcontent-%COMP%_fadeInUp .5s ease-out}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.registration-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 var(--space-sm) 0;font-size:1.875rem;font-weight:700;text-align:center;color:var(--color-primary)}.registration-subtitle[_ngcontent-%COMP%]{text-align:center;color:var(--color-text-muted);margin-bottom:var(--space-xl);font-size:.9375rem}.registration-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--space-lg)}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--space-xs)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;font-size:.9375rem;color:var(--color-text)}.form-input[_ngcontent-%COMP%], .form-textarea[_ngcontent-%COMP%]{padding:.75rem 1rem;border:2px solid var(--color-border);border-radius:var(--radius-md);font-size:.9375rem;font-family:inherit;background:var(--color-bg);color:var(--color-text);transition:all .2s}.form-input[_ngcontent-%COMP%]:focus, .form-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px #3b82f61a}.form-textarea[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.btn-register[_ngcontent-%COMP%]{margin-top:var(--space-md);padding:.875rem 1.5rem;background:linear-gradient(135deg,var(--color-primary),var(--color-accent));color:#fff;border:none;border-radius:var(--radius-md);font-weight:600;font-size:1rem;cursor:pointer;transition:all .3s;box-shadow:0 4px 12px #3b82f64d}.btn-register[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 16px #3b82f666}.btn-register[_ngcontent-%COMP%]:active{transform:translateY(0)}.active-indicator[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff;min-width:22px;height:22px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;padding:0 6px;box-shadow:0 2px 5px #ef444466;animation:_ngcontent-%COMP%_bounceIn .3s cubic-bezier(.175,.885,.32,1.275)}@keyframes _ngcontent-%COMP%_bounceIn{0%{transform:scale(0);opacity:0}60%{transform:scale(1.2)}to{transform:scale(1);opacity:1}}.chat-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%}.chat-sidebar[_ngcontent-%COMP%]{width:280px;background:var(--color-surface);border-right:1px solid var(--color-border);display:flex;flex-direction:column}.chat-main-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;height:100%;position:relative}.sidebar-header[_ngcontent-%COMP%]{padding:var(--space-md);border-bottom:1px solid var(--color-border);font-weight:600;background:var(--color-bg)}.conversation-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:8px}.conversation-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:10px 15px;border-radius:16px;background:#ffffff08;border:1px solid transparent;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);margin-bottom:0}.conversation-item[_ngcontent-%COMP%]:hover{background:#ffffff14;transform:translateY(-1px);box-shadow:0 4px 12px #0000000d}.conversation-item.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--color-primary),var(--color-accent));border-color:transparent;box-shadow:0 4px 15px #3b82f64d}.conv-avatar[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#e0e7ff,#c7d2fe);color:#4f46e5;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.1rem;flex-shrink:0;box-shadow:0 2px 5px #0000001a;transition:all .2s}.conversation-item.active[_ngcontent-%COMP%]   .conv-avatar[_ngcontent-%COMP%]{background:var(--color-surface);color:var(--color-primary);transform:scale(1.05);border:2px solid var(--color-primary)}.conv-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden;flex:1}.conversation-name[_ngcontent-%COMP%]{font-weight:600;font-size:.95rem;color:var(--color-text);margin-bottom:2px;transition:color .2s}.conversation-preview[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:color .2s}.conversation-item.active[_ngcontent-%COMP%]   .conversation-name[_ngcontent-%COMP%]{color:var(--color-text);font-weight:700}.conversation-item.active[_ngcontent-%COMP%]   .conversation-preview[_ngcontent-%COMP%]{color:#ffffffe6}.chat-header[_ngcontent-%COMP%]{padding:var(--space-lg);padding-bottom:2rem;background:linear-gradient(135deg,var(--color-primary),var(--color-accent));border-bottom:2px solid var(--color-border);position:relative;z-index:10;flex-shrink:0}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:var(--space-md);color:inherit}.chat-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);position:relative;z-index:20}.user-name[_ngcontent-%COMP%]{font-weight:500;padding:.5rem 1rem;background:#fff3;border-radius:20px;font-size:.9375rem}.btn-edit[_ngcontent-%COMP%], .btn-logout[_ngcontent-%COMP%]{background:#ffffff4d;border:2px solid rgba(255,255,255,.5);padding:.625rem;border-radius:50%;cursor:pointer;font-size:1.125rem;transition:all .2s;line-height:1;position:relative;z-index:30;pointer-events:auto;color:#fff;min-width:36px;min-height:36px;display:flex;align-items:center;justify-content:center}.btn-edit[_ngcontent-%COMP%]:hover, .btn-logout[_ngcontent-%COMP%]:hover{background:#ffffff80;transform:scale(1.15);border-color:#fff}.messages-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:var(--space-lg);background:var(--color-bg);display:flex;flex-direction:column;gap:var(--space-md)}.no-messages[_ngcontent-%COMP%]{text-align:center;color:var(--color-text-muted);padding:var(--space-xl);font-style:italic}.message[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-width:70%;animation:_ngcontent-%COMP%_slideIn .3s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.my-message[_ngcontent-%COMP%]{align-self:flex-end}.other-message[_ngcontent-%COMP%]{align-self:flex-start}.message-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;gap:var(--space-sm)}.sender-name[_ngcontent-%COMP%]{font-weight:600;font-size:.875rem;color:var(--color-text-muted)}.my-message[_ngcontent-%COMP%]   .sender-name[_ngcontent-%COMP%]{color:var(--color-primary)}.header-details-subtitle[_ngcontent-%COMP%]{position:absolute;top:70%;left:20px;font-size:.75rem;color:#fffffff2;display:flex;flex-direction:column;gap:2px}.btn-location[_ngcontent-%COMP%]{padding:.5rem;font-size:1.25rem;background:var(--color-surface);border:1px solid var(--color-border);border-radius:var(--radius-md);cursor:pointer;transition:all .2s}.btn-location[_ngcontent-%COMP%]:hover{background:var(--color-bg);transform:scale(1.05)}.message-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.message-address[_ngcontent-%COMP%]{font-size:.7rem;color:var(--color-text-muted);background:var(--color-border);padding:2px 6px;border-radius:4px;max-width:150px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.gps-link[_ngcontent-%COMP%]{text-decoration:none;cursor:pointer;transition:background-color .2s}.gps-link[_ngcontent-%COMP%]:hover{background:var(--color-bg);text-decoration:underline;color:var(--color-primary)}.message-time[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-text-muted)}.message-text[_ngcontent-%COMP%]{padding:.75rem 1rem;border-radius:12px;word-wrap:break-word;line-height:1.5}.my-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:var(--color-primary);color:#fff;border-bottom-right-radius:4px}.other-message[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{background:var(--color-surface);color:var(--color-text);border:1px solid var(--color-border);border-bottom-left-radius:4px}.input-container[_ngcontent-%COMP%]{display:flex;gap:var(--space-sm);padding:var(--space-lg);background:var(--color-surface);border-top:1px solid var(--color-border)}.message-input[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;border:1px solid var(--color-border);border-radius:24px;font-size:.9375rem;background:var(--color-bg);color:var(--color-text);transition:all .2s}.message-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px #3b82f61a}.btn-send[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--color-primary);color:#fff;border:none;border-radius:24px;font-weight:600;cursor:pointer;transition:all .2s}.btn-send[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--color-accent);transform:translateY(-1px);box-shadow:0 4px 8px #00000026}.btn-send[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--color-bg)}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--color-border);border-radius:4px}.messages-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--color-text-muted)}.registration-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.registration-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--color-bg)}.registration-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--color-border);border-radius:4px}.registration-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--color-text-muted)}textarea[readonly][_ngcontent-%COMP%], input[readonly][_ngcontent-%COMP%]{background-color:var(--color-bg);cursor:not-allowed;opacity:.8;color:var(--color-text-muted);border-color:var(--color-border)}@media (max-width: 640px){.message[_ngcontent-%COMP%]{max-width:85%}.chat-wrapper[_ngcontent-%COMP%]{flex-direction:column}.chat-sidebar[_ngcontent-%COMP%]{width:100%;height:auto;min-height:85px;flex-shrink:0;border-right:none;border-bottom:1px solid var(--color-border);display:flex;flex-direction:column}.conversation-list[_ngcontent-%COMP%]{flex-direction:row;overflow-x:auto;overflow-y:hidden;padding:10px;gap:12px}.conversation-item[_ngcontent-%COMP%]{padding:4px;border-radius:50%;background:transparent;flex-shrink:0;position:relative}.conv-info[_ngcontent-%COMP%]{display:none}.conv-avatar[_ngcontent-%COMP%]{width:48px;height:48px;font-size:1.25rem}.active-indicator[_ngcontent-%COMP%]{position:absolute;top:-2px;right:-2px;min-width:18px;height:18px;font-size:.7rem;border:2px solid var(--color-surface)}.chat-main-area[_ngcontent-%COMP%]{height:100%;overflow:hidden}.chat-header[_ngcontent-%COMP%]{padding:var(--space-md);padding-right:60px}.chat-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.1rem;max-width:60%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.header-content[_ngcontent-%COMP%]{flex-direction:row;align-items:center}.user-info[_ngcontent-%COMP%]{font-size:.8rem}.btn-edit[_ngcontent-%COMP%], .btn-logout[_ngcontent-%COMP%]{padding:.4rem;min-width:32px;min-height:32px}.registration-card[_ngcontent-%COMP%]{padding:var(--space-lg)}.registration-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem}}.btn-mic[_ngcontent-%COMP%]{width:46px;height:46px;border-radius:50%;border:none;background:var(--color-surface);border:1px solid var(--color-border);font-size:1.25rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;flex-shrink:0;-webkit-user-select:none;user-select:none;touch-action:manipulation}.btn-mic[_ngcontent-%COMP%]:hover{background:var(--color-bg);transform:scale(1.05)}.btn-mic[_ngcontent-%COMP%]:active{transform:scale(.95)}.btn-mic.recording[_ngcontent-%COMP%]{background:#ef4444;border-color:#ef4444;color:#fff;transform:scale(1.1);animation:_ngcontent-%COMP%_pulse 1.5s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #ef444466}70%{box-shadow:0 0 0 10px #ef444400}to{box-shadow:0 0 #ef444400}}.message-audio[_ngcontent-%COMP%]{padding:.25rem;border-radius:12px;background:transparent;width:100%}audio[_ngcontent-%COMP%]{height:36px;max-width:100%;border-radius:18px}.btn-delete-msg[_ngcontent-%COMP%]{align-self:flex-end;background:transparent;border:none;font-size:.8rem;opacity:.5;cursor:pointer;padding:0;margin-top:4px;transition:opacity .2s}.btn-delete-msg[_ngcontent-%COMP%]:hover{opacity:1;transform:scale(1.1)}.btn-call[_ngcontent-%COMP%]{background:#10b98133;border:1px solid rgba(16,185,129,.5);color:#10b981;padding:.625rem;border-radius:50%;cursor:pointer;font-size:1.125rem;transition:all .2s;min-width:36px;min-height:36px;display:flex;align-items:center;justify-content:center}.btn-call[_ngcontent-%COMP%]:hover:not(:disabled){background:#10b98166;transform:scale(1.15);color:#fff;border-color:#fff}.btn-call[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;filter:grayscale(1)}.call-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000d9;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);z-index:100;display:flex;align-items:center;justify-content:center;animation:fadeIn .3s}.call-content[_ngcontent-%COMP%]{background:var(--color-surface);padding:2rem;border-radius:20px;text-align:center;width:90%;max-width:350px;box-shadow:0 20px 50px #00000080;border:1px solid var(--color-border)}.call-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:1rem 0;font-size:1.5rem}.call-avatar[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;display:inline-block}.pulsing[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-avatar 2s infinite}@keyframes _ngcontent-%COMP%_pulse-avatar{0%{transform:scale(1);opacity:1;text-shadow:0 0 0 rgba(16,185,129,.7)}50%{transform:scale(1.1);opacity:.8;text-shadow:0 0 20px rgba(16,185,129,0)}to{transform:scale(1);opacity:1;text-shadow:0 0 0 rgba(16,185,129,0)}}.call-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1rem;margin-top:2rem}.btn-accept[_ngcontent-%COMP%], .btn-reject[_ngcontent-%COMP%], .btn-end[_ngcontent-%COMP%]{padding:.8rem 1.5rem;border-radius:30px;font-weight:600;border:none;cursor:pointer;transition:transform .2s;color:#fff}.btn-accept[_ngcontent-%COMP%]{background:#10b981}.btn-reject[_ngcontent-%COMP%], .btn-end[_ngcontent-%COMP%]{background:#ef4444}.btn-accept[_ngcontent-%COMP%]:hover, .btn-reject[_ngcontent-%COMP%]:hover, .btn-end[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.call-utilities[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1.5rem;margin-bottom:2rem}.volume-meter[_ngcontent-%COMP%]{width:200px;height:6px;background:#fff3;border-radius:3px;margin:0 auto 1.5rem;overflow:hidden;position:relative}.volume-bar[_ngcontent-%COMP%]{height:100%;background:#10b981;width:0%;transition:width .1s linear}.btn-round[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;border:1px solid var(--color-border);background:var(--color-surface);font-size:1.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;color:var(--color-text)}.btn-round[_ngcontent-%COMP%]:hover{background:var(--color-bg);transform:scale(1.1)}.btn-round.active[_ngcontent-%COMP%]{background:var(--color-surface);color:var(--color-primary);border-color:var(--color-primary)}"]})}}return n})();function pI(n,e){if(n&1){let t=Ue();S(0,"button",11),ee("click",function(){W(t);let i=F(2);return Q(i.onCancel())}),N(1),x()}if(n&2){let t=F(2);M(),je(" ",(t.dialogState.config==null?null:t.dialogState.config.cancelText)||"Cancel"," ")}}function mI(n,e){if(n&1){let t=Ue();S(0,"div",1),ee("click",function(i){W(t);let s=F();return Q(s.onBackdropClick(i))}),S(1,"div",2)(2,"div",3)(3,"div",4),N(4),x(),S(5,"h2",5),N(6),x()(),S(7,"div",6)(8,"p",7),N(9),x()(),S(10,"div",8),fe(11,pI,2,1,"button",9),S(12,"button",10),ee("click",function(){W(t);let i=F();return Q(i.onConfirm())}),N(13),x()()()()}if(n&2){let t=F();M(),z("@dialogAnimation",void 0),M(),Na("dialog-header-"+(t.dialogState.config==null?null:t.dialogState.config.type)),M(2),xe(t.getIcon()),M(2),xe(t.dialogState.config==null?null:t.dialogState.config.title),M(3),xe(t.dialogState.config==null?null:t.dialogState.config.message),M(2),z("ngIf",t.dialogState.config==null?null:t.dialogState.config.showCancel),M(),Na("dialog-btn-"+(t.dialogState.config==null?null:t.dialogState.config.type)),M(),je(" ",(t.dialogState.config==null?null:t.dialogState.config.confirmText)||"OK"," ")}}var E_=(()=>{class n{constructor(t){this.dialogService=t,this.dialogState={isOpen:!1,config:null,resolve:null}}ngOnInit(){this.subscription=this.dialogService.dialog$.subscribe(t=>{this.dialogState=t})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}onConfirm(){this.dialogService.close(!0)}onCancel(){this.dialogService.close(!1)}onBackdropClick(t){t.target===t.currentTarget&&this.onCancel()}getIcon(){switch(this.dialogState.config?.type){case"success":return"\u2705";case"error":return"\u274C";case"warning":return"\u26A0\uFE0F";case"confirm":return"\u2753";case"info":default:return"\u2139\uFE0F"}}static{this.\u0275fac=function(r){return new(r||n)(Qe(bf))}}static{this.\u0275cmp=gt({type:n,selectors:[["app-dialog"]],standalone:!0,features:[_t],decls:1,vars:1,consts:[["class","dialog-overlay",3,"click",4,"ngIf"],[1,"dialog-overlay",3,"click"],[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-icon"],[1,"dialog-title"],[1,"dialog-body"],[1,"dialog-message"],[1,"dialog-footer"],["class","dialog-btn dialog-btn-cancel",3,"click",4,"ngIf"],[1,"dialog-btn","dialog-btn-confirm",3,"click"],[1,"dialog-btn","dialog-btn-cancel",3,"click"]],template:function(r,i){r&1&&fe(0,mI,14,10,"div",0),r&2&&z("ngIf",i.dialogState.isOpen)},dependencies:[Pt,Zt],styles:[".dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:10000;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.dialog-container[_ngcontent-%COMP%]{background:var(--color-surface);border-radius:var(--radius-xl);box-shadow:0 20px 60px #0000004d;max-width:500px;width:90%;overflow:hidden;animation:_ngcontent-%COMP%_slideIn .3s cubic-bezier(.175,.885,.32,1.275)}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:scale(.9) translateY(-20px)}to{opacity:1;transform:scale(1) translateY(0)}}.dialog-header[_ngcontent-%COMP%]{padding:var(--space-xl);border-bottom:1px solid var(--color-border);display:flex;align-items:center;gap:var(--space-md)}.dialog-header-info[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f61a,#3b82f60d)}.dialog-header-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b9811a,#10b9810d)}.dialog-header-warning[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b1a,#f59e0b0d)}.dialog-header-error[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef44441a,#ef44440d)}.dialog-header-confirm[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9333ea1a,#9333ea0d)}.dialog-icon[_ngcontent-%COMP%]{font-size:2rem;line-height:1}.dialog-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600;color:var(--color-text)}.dialog-body[_ngcontent-%COMP%]{padding:var(--space-xl)}.dialog-message[_ngcontent-%COMP%]{margin:0;font-size:1rem;line-height:1.6;color:var(--color-text);white-space:pre-wrap}.dialog-footer[_ngcontent-%COMP%]{padding:var(--space-lg) var(--space-xl);border-top:1px solid var(--color-border);display:flex;justify-content:flex-end;gap:var(--space-md);background:var(--color-bg)}.dialog-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:var(--radius-md);font-weight:600;font-size:.9375rem;cursor:pointer;transition:all .2s;border:none;min-width:100px}.dialog-btn-cancel[_ngcontent-%COMP%]{background:var(--color-border);color:var(--color-text)}.dialog-btn-cancel[_ngcontent-%COMP%]:hover{background:var(--color-secondary);color:#fff;transform:translateY(-2px);box-shadow:0 4px 8px #00000026}.dialog-btn-confirm[_ngcontent-%COMP%]{background:var(--color-primary);color:#fff}.dialog-btn-confirm[_ngcontent-%COMP%]:hover{background:var(--color-primary-dark);transform:translateY(-2px);box-shadow:0 4px 12px #3b82f64d}.dialog-btn-success[_ngcontent-%COMP%]{background:var(--color-success)}.dialog-btn-success[_ngcontent-%COMP%]:hover{background:#059669;box-shadow:0 4px 12px #10b9814d}.dialog-btn-error[_ngcontent-%COMP%]{background:var(--color-danger)}.dialog-btn-error[_ngcontent-%COMP%]:hover{background:#dc2626;box-shadow:0 4px 12px #ef44444d}.dialog-btn-warning[_ngcontent-%COMP%]{background:var(--color-warning);color:#fff}.dialog-btn-warning[_ngcontent-%COMP%]:hover{background:#d97706;box-shadow:0 4px 12px #f59e0b4d}.dialog-btn-info[_ngcontent-%COMP%]{background:var(--color-primary)}@media (max-width: 640px){.dialog-container[_ngcontent-%COMP%]{width:95%;max-width:none}.dialog-header[_ngcontent-%COMP%], .dialog-body[_ngcontent-%COMP%]{padding:var(--space-lg)}.dialog-footer[_ngcontent-%COMP%]{flex-direction:column-reverse;padding:var(--space-md)}.dialog-btn[_ngcontent-%COMP%]{width:100%}}"]})}}return n})();function gI(n,e){if(n&1&&(S(0,"div",1)(1,"div",2),ve(2,"div",3),S(3,"p",4),N(4),x()()()),n&2){let t=F();M(4),xe(t.message)}}var T_=(()=>{class n{constructor(t){this.loadingService=t,this.isLoading=!1,this.message="Loading...",this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.loadingService.loading$.subscribe(t=>{this.isLoading=t})),this.subscriptions.push(this.loadingService.message$.subscribe(t=>{this.message=t}))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(r){return new(r||n)(Qe($s))}}static{this.\u0275cmp=gt({type:n,selectors:[["app-loading"]],standalone:!0,features:[_t],decls:1,vars:1,consts:[["class","loading-overlay",4,"ngIf"],[1,"loading-overlay"],[1,"loading-container"],[1,"spinner"],[1,"loading-message"]],template:function(r,i){r&1&&fe(0,gI,5,1,"div",0),r&2&&z("ngIf",i.isLoading)},dependencies:[Pt,Zt],styles:['.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:9999;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.loading-container[_ngcontent-%COMP%]{text-align:center;animation:_ngcontent-%COMP%_slideUp .3s ease-out}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.spinner[_ngcontent-%COMP%]{width:60px;height:60px;margin:0 auto 1.5rem;border:4px solid rgba(255,255,255,.2);border-top:4px solid var(--color-primary);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading-message[_ngcontent-%COMP%]{color:#fff;font-size:1.125rem;font-weight:500;margin:0;text-shadow:0 2px 4px rgba(0,0,0,.3)}.spinner[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:-4px;border-radius:50%;border:4px solid transparent;border-top-color:var(--color-primary);opacity:.5;animation:_ngcontent-%COMP%_spin 1.2s linear infinite reverse}']})}}return n})();function _I(n,e){n&1&&ve(0,"app-reservation")}function yI(n,e){n&1&&ve(0,"app-login")}function vI(n,e){if(n&1){let t=Ue();S(0,"div",11)(1,"div",12)(2,"button",13),ee("click",function(){W(t);let i=F();return Q(i.toggleReservation())}),N(3),x()(),fe(4,_I,1,0,"app-reservation",1)(5,yI,1,0,"app-login",1),x()}if(n&2){let t=F();M(3),je(" ",t.showReservation?"\u2190 Back to Login":"\u{1F4C5} Make a Reservation"," "),M(),z("ngIf",t.showReservation),M(),z("ngIf",!t.showReservation)}}function wI(n,e){if(n&1){let t=Ue();S(0,"button",28),ee("click",function(){W(t);let i=F(2);return Q(i.setActiveTab("users"))}),S(1,"span",29),N(2,"\u{1F464}"),x(),S(3,"span",30),N(4,"Users"),x()()}if(n&2){let t=F(2);Me("active",t.activeTab==="users")}}function bI(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-landing"),x()())}function CI(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-product-form"),x()())}function II(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-pos-calculator"),x()())}function EI(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-inventory-list"),x()())}function TI(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-customer-form"),x()())}function SI(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-expenses"),x()())}function AI(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-reports"),x()())}function xI(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-activity-logs"),x()())}function RI(n,e){n&1&&(S(0,"div",35)(1,"div",36),ve(2,"app-user-management"),x()())}function PI(n,e){if(n&1){let t=Ue();S(0,"div")(1,"header",14)(2,"div",15)(3,"div",16)(4,"div",17)(5,"div",18),N(6,"\u{1F4E6}"),x(),S(7,"div",19)(8,"h1"),N(9,"JJM Inventory"),x(),S(10,"p",20),N(11,"Smart Business Management"),x()()(),S(12,"div",21)(13,"button",22),ee("click",function(){W(t);let i=F();return Q(i.toggleTheme())}),S(14,"span",23),N(15),x()(),S(16,"button",24),ee("click",function(){W(t);let i=F();return Q(i.logout())}),S(17,"span",25),N(18,"\u{1F6AA}"),x(),S(19,"span",26),N(20,"Logout"),x()()()()()(),S(21,"main",15)(22,"nav",27)(23,"button",28),ee("click",function(){W(t);let i=F();return Q(i.setActiveTab("home"))}),S(24,"span",29),N(25,"\u{1F3E0}"),x(),S(26,"span",30),N(27,"Home"),x()(),S(28,"button",28),ee("click",function(){W(t);let i=F();return Q(i.setActiveTab("add-product"))}),S(29,"span",29),N(30,"\u{1F4E6}"),x(),S(31,"span",30),N(32,"Add Product"),x()(),S(33,"button",28),ee("click",function(){W(t);let i=F();return Q(i.setActiveTab("sell"))}),S(34,"span",29),N(35,"\u{1F4B0}"),x(),S(36,"span",30),N(37,"Sell"),x()(),S(38,"button",28),ee("click",function(){W(t);let i=F();return Q(i.setActiveTab("inventory"))}),S(39,"span",29),N(40,"\u{1F4CA}"),x(),S(41,"span",30),N(42,"Inventory"),x()(),S(43,"button",28),ee("click",function(){W(t);let i=F();return Q(i.setActiveTab("customers"))}),S(44,"span",29),N(45,"\u{1F465}"),x(),S(46,"span",30),N(47,"Customers"),x()(),S(48,"button",28),ee("click",function(){W(t);let i=F();return Q(i.setActiveTab("expenses"))}),S(49,"span",29),N(50,"\u{1F4B8}"),x(),S(51,"span",30),N(52,"Expenses"),x()(),S(53,"button",28),ee("click",function(){W(t);let i=F();return Q(i.setActiveTab("reports"))}),S(54,"span",29),N(55,"\u{1F4C8}"),x(),S(56,"span",30),N(57,"Reports"),x()(),S(58,"button",28),ee("click",function(){W(t);let i=F();return Q(i.setActiveTab("logs"))}),S(59,"span",29),N(60,"\u{1F4CB}"),x(),S(61,"span",30),N(62,"Activity Logs"),x()(),fe(63,wI,5,2,"button",31),x(),S(64,"div",32),fe(65,bI,3,0,"div",33)(66,CI,3,0,"div",33)(67,II,3,0,"div",33)(68,EI,3,0,"div",33)(69,TI,3,0,"div",33)(70,SI,3,0,"div",33)(71,AI,3,0,"div",33)(72,xI,3,0,"div",33)(73,RI,3,0,"div",33),x()(),S(74,"footer",34)(75,"div",15)(76,"p"),N(77,"\xA9 2024 JJM Inventory. All rights reserved."),x()()()()}if(n&2){let t=F();M(13),z("title",t.isDarkTheme?"Switch to Light Mode":"Switch to Dark Mode"),M(2),xe(t.isDarkTheme?"\u2600\uFE0F":"\u{1F319}"),M(8),Me("active",t.activeTab==="home"),M(5),Me("active",t.activeTab==="add-product"),M(5),Me("active",t.activeTab==="sell"),M(5),Me("active",t.activeTab==="inventory"),M(5),Me("active",t.activeTab==="customers"),M(5),Me("active",t.activeTab==="expenses"),M(5),Me("active",t.activeTab==="reports"),M(5),Me("active",t.activeTab==="logs"),M(5),z("ngIf",t.userRole==="admin"),M(2),z("ngIf",t.activeTab==="home"),M(),z("ngIf",t.activeTab==="add-product"),M(),z("ngIf",t.activeTab==="sell"),M(),z("ngIf",t.activeTab==="inventory"),M(),z("ngIf",t.activeTab==="customers"),M(),z("ngIf",t.activeTab==="expenses"),M(),z("ngIf",t.activeTab==="reports"),M(),z("ngIf",t.activeTab==="logs"),M(),z("ngIf",t.activeTab==="users"&&t.userRole==="admin")}}function DI(n,e){if(n&1&&(S(0,"span",37),N(1),x()),n&2){let t=F();M(),xe(t.totalUnreadMessages)}}var S_=(()=>{class n{constructor(t,r){this.inventoryService=t,this.chatService=r,this.title="JJM Inventory",this.activeTab="home",this.isDarkTheme=!1,this.isLoggedIn=!1,this.userRole="",this.isChatOpen=!1,this.totalUnreadMessages=0,this.showReservation=!1,this.isLoggedIn=localStorage.getItem("jjm_logged_in")==="true",this.userRole=localStorage.getItem("jjm_role")||"user";let i=localStorage.getItem("jjm_theme");this.isDarkTheme=i==="dark",this.applyTheme(),window.inventoryService=this.inventoryService,this.checkUrlForReservation()}checkUrlForReservation(){let t=window.location.hash;(t==="#/reservation"||t==="#reservation")&&(this.showReservation=!0)}setActiveTab(t){t==="users"&&this.userRole!=="admin"||(this.activeTab=t)}toggleTheme(){this.isDarkTheme=!this.isDarkTheme,this.applyTheme(),localStorage.setItem("jjm_theme",this.isDarkTheme?"dark":"light")}logout(){this.chatService.triggerLogout(),localStorage.removeItem("jjm_logged_in"),localStorage.removeItem("jjm_username"),localStorage.removeItem("jjm_user_id"),localStorage.removeItem("jjm_role"),localStorage.removeItem("chatCustomerInfo"),localStorage.removeItem("chatUserName"),this.isLoggedIn=!1,window.location.reload()}applyTheme(){this.isDarkTheme?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")}toggleChat(){this.isChatOpen=!this.isChatOpen}toggleReservation(){this.showReservation=!this.showReservation,this.showReservation?window.location.hash="#/reservation":window.location.hash=""}getReservationLink(){return`${window.location.origin}${window.location.pathname}#/reservation`}static{this.\u0275fac=function(r){return new(r||n)(Qe(gf),Qe(Xo))}}static{this.\u0275cmp=gt({type:n,selectors:[["app-root"]],standalone:!0,features:[_t],decls:16,vars:8,consts:[["class","public-container",4,"ngIf"],[4,"ngIf"],[1,"chat-widget"],["title","Open Chat",1,"chat-toggle-button",3,"click"],[1,"chat-icon"],[1,"chat-label"],["class","notification-badge",4,"ngIf"],[1,"chat-modal"],[1,"chat-modal-content"],[3,"totalUnreadCountChange","isOpen"],["title","Close Chat",1,"chat-modal-close",3,"click"],[1,"public-container"],[1,"public-nav"],[1,"btn-public-toggle",3,"click"],[1,"header"],[1,"container"],[1,"header-content"],[1,"logo-section"],[1,"logo-icon"],[1,"brand-info"],[1,"tagline"],[1,"header-actions"],[1,"theme-toggle",3,"click","title"],[1,"theme-icon"],["title","Logout",1,"logout-button",3,"click"],[1,"logout-icon"],[1,"logout-text"],[1,"tabs"],[1,"tab-button",3,"click"],[1,"tab-icon"],[1,"tab-label"],["class","tab-button",3,"active","click",4,"ngIf"],[1,"tab-content"],["class","tab-pane",4,"ngIf"],[1,"footer"],[1,"tab-pane"],[1,"tab-pane-content"],[1,"notification-badge"]],template:function(r,i){r&1&&(fe(0,vI,6,3,"div",0)(1,PI,78,28,"div",1),S(2,"div",2)(3,"button",3),ee("click",function(){return i.toggleChat()}),S(4,"span",4),N(5,"\u{1F4AC}"),x(),S(6,"span",5),N(7,"Chat"),x()(),fe(8,DI,2,1,"span",6),S(9,"div",7)(10,"div",8)(11,"app-chat",9),ee("totalUnreadCountChange",function(a){return i.totalUnreadMessages=a}),x()(),S(12,"button",10),ee("click",function(){return i.toggleChat()}),N(13,"\u2715"),x()()(),ve(14,"app-dialog")(15,"app-loading")),r&2&&(z("ngIf",!i.isLoggedIn),M(),z("ngIf",i.isLoggedIn),M(2),Me("active",i.isChatOpen),M(5),z("ngIf",i.totalUnreadMessages>0),M(),Me("open",i.isChatOpen),M(2),z("isOpen",i.isChatOpen))},dependencies:[Pt,Zt,wf,Cf,If,Ef,Tf,Sf,vf,mf,Af,I_,xf,yf,E_,T_],styles:['.public-nav[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;z-index:1000}.btn-public-toggle[_ngcontent-%COMP%]{padding:10px 20px;background:var(--color-surface);color:var(--color-text);border:1px solid var(--color-border);border-radius:var(--radius-xl);cursor:pointer;font-weight:600;font-size:.95rem;box-shadow:var(--shadow-md);transition:all .3s ease;display:flex;align-items:center;gap:8px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.btn-public-toggle[_ngcontent-%COMP%]:hover{background:var(--color-primary);color:#fff;border-color:var(--color-primary);transform:translateY(-2px);box-shadow:var(--shadow-lg)}.header[_ngcontent-%COMP%]{background:var(--color-surface);border-bottom:1px solid var(--color-border);padding:var(--space-lg) 0;position:sticky;top:0;z-index:100;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#fffffff2}.header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.logo-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-md)}.logo-icon[_ngcontent-%COMP%]{font-size:2.5rem;animation:_ngcontent-%COMP%_float 3s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0)}50%{transform:translateY(-5px)}}.brand-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:var(--color-text);margin:0;font-size:1.5rem;font-weight:700;letter-spacing:-.5px}.tagline[_ngcontent-%COMP%]{color:var(--color-text-muted);font-size:.75rem;margin:0;font-weight:500}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-md)}.theme-toggle[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:var(--radius-xl);background:var(--color-bg);border:1px solid var(--color-border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all var(--transition-base);padding:0}.theme-toggle[_ngcontent-%COMP%]:hover{background:var(--color-primary);border-color:var(--color-primary);transform:rotate(180deg) scale(1.1);box-shadow:var(--shadow-md)}.theme-icon[_ngcontent-%COMP%]{font-size:1.25rem;transition:transform var(--transition-base)}.logout-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);padding:var(--space-sm) var(--space-md);background:#ef44441a;border:1px solid rgba(239,68,68,.3);border-radius:var(--radius-lg);color:var(--color-danger);font-weight:600;cursor:pointer;transition:all var(--transition-base)}.logout-button[_ngcontent-%COMP%]:hover{background:var(--color-danger);border-color:var(--color-danger);color:#fff;transform:translateY(-2px);box-shadow:0 4px 12px #ef44444d}.logout-icon[_ngcontent-%COMP%]{font-size:1.125rem}.logout-text[_ngcontent-%COMP%]{font-size:.875rem}.tabs[_ngcontent-%COMP%]{display:flex;gap:var(--space-sm);margin-top:var(--space-2xl);margin-bottom:var(--space-xl);padding:var(--space-sm);background:var(--color-bg);border-radius:var(--radius-xl);flex-wrap:wrap;box-shadow:inset 0 2px 4px #0000000d}.tab-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);padding:var(--space-md) var(--space-lg);background:transparent;border:none;border-radius:var(--radius-lg);color:var(--color-text-muted);font-size:.9375rem;font-weight:600;cursor:pointer;transition:all var(--transition-base);white-space:nowrap;position:relative;overflow:hidden}.tab-button[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(59,130,246,.15),transparent);transition:left .5s ease}.tab-button[_ngcontent-%COMP%]:hover:before{left:100%}.tab-button[_ngcontent-%COMP%]:hover{background:#3b82f614;color:var(--color-primary);transform:translateY(-2px);box-shadow:0 4px 12px #3b82f626}.tab-button.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--color-primary),var(--color-primary-light));color:#fff;box-shadow:0 4px 12px #3b82f64d}.tab-button.active[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,var(--color-primary-dark),var(--color-primary));transform:translateY(-2px) scale(1.02)}.tab-icon[_ngcontent-%COMP%]{font-size:1.25rem;transition:transform var(--transition-base);filter:drop-shadow(0 2px 4px rgba(0,0,0,.1))}.tab-button[_ngcontent-%COMP%]:hover   .tab-icon[_ngcontent-%COMP%]{transform:scale(1.15) rotate(5deg)}.tab-button.active[_ngcontent-%COMP%]   .tab-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_iconPulse .6s ease;filter:drop-shadow(0 2px 8px rgba(255,255,255,.5))}.tab-label[_ngcontent-%COMP%]{font-weight:600;letter-spacing:.3px}@keyframes _ngcontent-%COMP%_iconPulse{0%,to{transform:scale(1)}50%{transform:scale(1.2)}}.tab-content[_ngcontent-%COMP%]{min-height:calc(100vh - 400px);padding-bottom:var(--space-md);position:relative}.tab-pane[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInUp .4s cubic-bezier(.16,1,.3,1)}.tab-pane-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(30px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}.footer[_ngcontent-%COMP%]{background:var(--color-surface);border-top:1px solid var(--color-border);padding:var(--space-lg) 0;margin-top:var(--space-lg)}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;color:var(--color-text-muted);font-size:.875rem}@media (max-width: 768px){.tab-button[_ngcontent-%COMP%]{padding:var(--space-sm) var(--space-md);font-size:.875rem}.tab-icon[_ngcontent-%COMP%]{font-size:1rem}.tab-label[_ngcontent-%COMP%]{display:none}}.chat-widget[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;z-index:1000}.chat-toggle-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-sm);padding:var(--space-md) var(--space-lg);background:linear-gradient(135deg,#3b82f6,#2563eb);border:none;border-radius:var(--radius-xl);color:#fff;font-weight:600;font-size:.9375rem;cursor:pointer;box-shadow:0 8px 24px #3b82f666;transition:all var(--transition-base);position:relative;overflow:hidden}.chat-toggle-button[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transition:left .6s ease}.chat-toggle-button[_ngcontent-%COMP%]:hover:before{left:100%}.chat-toggle-button[_ngcontent-%COMP%]:hover{transform:translateY(-4px) scale(1.05);box-shadow:0 12px 32px #3b82f680}.chat-toggle-button.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef4444,#dc2626);box-shadow:0 8px 24px #ef444466}.chat-toggle-button.active[_ngcontent-%COMP%]:hover{box-shadow:0 12px 32px #ef444480}.chat-icon[_ngcontent-%COMP%]{font-size:1.5rem;animation:_ngcontent-%COMP%_bounce 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-4px)}}.chat-label[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.3px}.chat-modal[_ngcontent-%COMP%]{position:fixed;bottom:100px;right:24px;width:850px;max-width:calc(100vw - 48px);height:650px;max-height:calc(100vh - 120px);opacity:0;transform:translateY(20px) scale(.95);pointer-events:none;transition:all .3s cubic-bezier(.16,1,.3,1);display:flex;flex-direction:column;z-index:2000}.chat-modal.open[_ngcontent-%COMP%]{opacity:1;transform:translateY(0) scale(1);pointer-events:all}.chat-modal-close[_ngcontent-%COMP%]{position:absolute;top:-50px;right:0;width:36px;height:36px;border-radius:var(--radius-lg);background:#00000080;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);color:#fff;font-size:1.25rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--transition-base);padding:0;z-index:100;box-shadow:0 4px 12px #0000004d}.chat-modal-close[_ngcontent-%COMP%]:hover{background:#ef4444cc;transform:rotate(90deg) scale(1.1);box-shadow:0 6px 16px #ef444466}.chat-modal-content[_ngcontent-%COMP%]{flex:1;background:var(--color-surface);border-radius:var(--radius-xl);box-shadow:0 20px 60px #0000004d;border:1px solid var(--color-border);overflow:hidden;height:100%}@media (max-width: 768px){.chat-widget[_ngcontent-%COMP%]{bottom:16px;right:16px}.chat-toggle-button[_ngcontent-%COMP%]{padding:var(--space-sm) var(--space-md)}.chat-label[_ngcontent-%COMP%]{display:none}.chat-modal[_ngcontent-%COMP%]{position:fixed;inset:0;width:100%;height:100%;max-width:100%;max-height:100%;border-radius:0;z-index:2000}.chat-modal-close[_ngcontent-%COMP%]{top:16px;right:auto;left:16px;width:44px;height:44px}}.notification-badge[_ngcontent-%COMP%]{position:absolute;top:-6px;right:-6px;background:#ef4444;color:#fff;padding:2px 8px;border-radius:12px;font-size:.8rem;font-weight:700;box-shadow:0 4px 6px #0000004d;animation:_ngcontent-%COMP%_badgePop .3s ease-out;display:inline-flex;align-items:center;justify-content:center;min-width:20px;z-index:1001;pointer-events:none;transition:transform .3s ease;border:2px solid white}.chat-toggle-button[_ngcontent-%COMP%]:hover + .notification-badge[_ngcontent-%COMP%]{transform:translateY(-4px) scale(1.05)}@keyframes _ngcontent-%COMP%_badgePop{0%{transform:scale(0)}to{transform:scale(1)}}']})}}return n})();Vf(S_,wp).catch(n=>console.error(n));
