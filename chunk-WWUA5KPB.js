import{C as h,D as m,E as y,G as D,J as A,K as M,L as S,M as I,O as j}from"./chunk-O7B4BK4X.js";import{I as u,L as w,Q as v,f as p,h as c,n as f,v as d}from"./chunk-VOZMRJF4.js";import{a as o,b as l,g}from"./chunk-7QOE2ANW.js";var T=(()=>{class i{constructor(e){this.firebaseService=e,this.salesSubject=new p([]),this.sales$=this.salesSubject.asObservable(),this.unsubscribe=null,this.defaultSales=[{name:"New Year Sale",month:1,day:1,duration:7,discount:40,isActive:!0,bannerTitle:"\u{1F38A} New Year Sale!",bannerMessage:"Start the year with amazing deals!",bannerIcon:"\u{1F386}"},{name:"Valentine's Special",month:2,day:14,duration:3,discount:25,isActive:!0,bannerTitle:"\u{1F495} Valentine's Special!",bannerMessage:"Share the love with special discounts!",bannerIcon:"\u{1F49D}"},{name:"Summer Sale",month:4,day:15,duration:14,discount:30,isActive:!0,bannerTitle:"\u2600\uFE0F Summer Sale!",bannerMessage:"Hot deals for the summer season!",bannerIcon:"\u{1F334}"},{name:"Mid-Year Blowout",month:6,day:15,duration:7,discount:35,isActive:!0,bannerTitle:"\u{1F525} Mid-Year Blowout!",bannerMessage:"Massive savings on selected items!",bannerIcon:"\u{1F4A5}"},{name:"Back to School Sale",month:8,day:1,duration:14,discount:20,isActive:!0,bannerTitle:"\u{1F4DA} Back to School Sale!",bannerMessage:"Get ready for school with great discounts!",bannerIcon:"\u{1F392}"},{name:"Holiday Season Sale",month:11,day:15,duration:45,discount:50,isActive:!0,bannerTitle:"\u{1F381} Christmas Sale!",bannerMessage:"Celebrate Christmas with 15-70% OFF on selected items!",bannerIcon:"\u{1F384}",holidayKeywords:["lechon","food","party","cake","drink","beverage","wine","ham","fruit","meat","chicken","pork","beef","seafood","fish","dessert","candy","chocolate","gift","decoration","light","ornament","toy","clothing","dress","shirt","shoes","bag","watch","jewelry","electronics","phone","laptop","tablet","appliance","kitchen"],excludeKeywords:["sand","gravel","cement","holloblock","hollow","block","steel","rebar","wire","nail","lumber","wood","plywood","paint","tile","pipe","pvc","fitting","construction","building","hardware"]},{name:"Christmas Special",month:12,day:20,duration:12,discount:50,isActive:!0,bannerTitle:"\u{1F381} Christmas Special!",bannerMessage:"Last chance for holiday savings!",bannerIcon:"\u{1F384}"},{name:"Year-End Clearance",month:12,day:26,duration:6,discount:45,isActive:!0,bannerTitle:"\u{1F38A} Year-End Clearance!",bannerMessage:"Clear out the year with massive discounts!",bannerIcon:"\u{1F389}"}],this.db=this.firebaseService.db}startListening(){if(this.unsubscribe)return;let e=y(h(this.db,"sales_events"),D("month","asc"));this.unsubscribe=I(e,t=>{let a=t.docs.map(s=>o({id:s.id},s.data()));this.salesSubject.next(a),a.length===0&&(console.log("No sales found, seeding defaults..."),this.seedDefaultSales())},t=>{console.error("Error listening to sales:",t),this.salesSubject.value.length===0&&(console.warn("Falling back to default sales data due to error"),this.salesSubject.next(this.defaultSales))})}stopListening(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}getSales(){return this.sales$}getCurrentSale(){let e=new Date,t=e.getMonth()+1,a=e.getDate(),s=this.salesSubject.value;for(let n of s){if(!n.isActive)continue;let b=new Date(e.getFullYear(),n.month-1,n.day),r=new Date(b);if(r.setDate(r.getDate()+n.duration),r.setHours(23,59,59,999),n.month===12&&t===1&&(b.setFullYear(e.getFullYear()-1),r.setFullYear(e.getFullYear())),e>=b&&e<=r)return l(o({},n),{endDate:r})}return null}addSale(e){let t=l(o({},e),{createdAt:new Date,updatedAt:new Date});return c(S(h(this.db,"sales_events"),t)).pipe(f(a=>a.id),u(a=>console.log("Sale added with ID:",a)),d(a=>{throw console.error("Error adding sale:",a),a}))}updateSale(e,t){let a=l(o({},t),{updatedAt:new Date});return c(A(m(this.db,"sales_events",e),a)).pipe(u(()=>console.log("Sale updated:",e)),d(s=>{throw console.error("Error updating sale:",s),s}))}deleteSale(e){return c(M(m(this.db,"sales_events",e))).pipe(u(()=>console.log("Sale deleted:",e)),d(t=>{throw console.error("Error deleting sale:",t),t}))}toggleSaleActive(e,t){return this.updateSale(e,{isActive:t})}seedDefaultSales(){return g(this,null,function*(){for(let e of this.defaultSales)try{yield S(h(this.db,"sales_events"),l(o({},e),{createdAt:new Date,updatedAt:new Date})),console.log("Seeded sale:",e.name)}catch(t){console.error("Error seeding sale:",e.name,t)}})}static{this.\u0275fac=function(t){return new(t||i)(v(j))}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{T as a};
