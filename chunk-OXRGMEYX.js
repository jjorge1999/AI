import{a as Sl}from"./chunk-DSMIOEH7.js";import{a as Rl}from"./chunk-RTZOTCBV.js";import{a as bl,d as ii}from"./chunk-CWCURRVQ.js";import{U as ri,Z as nr,a as L,b as J,d as eo,f as gt,g as y,o as ni}from"./chunk-VTT5FMM4.js";var Pl=()=>{};var Dl=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},tm=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],u=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},kl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,u=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=o>>2,I=(o&3)<<4|u>>4,T=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(T=64)),r.push(t[p],t[I],t[T],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Dl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):tm(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let I=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||u==null||d==null||I==null)throw new no;let T=o<<2|u>>4;if(r.push(T),d!==64){let R=u<<4&240|d>>2;if(r.push(R),I!==64){let O=d<<6&192|I;r.push(O)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},no=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},nm=function(n){let e=Dl(n);return kl.encodeByteArray(e,!0)},ir=function(n){return nm(n).replace(/\./g,"")},oi=function(n){try{return kl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ol(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var rm=()=>Ol().__FIREBASE_DEFAULTS__,im=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},sm=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&oi(n[1]);return e&&JSON.parse(e)},ai=()=>{try{return Pl()||rm()||im()||sm()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},io=n=>ai()?.emulatorHosts?.[n],Vl=n=>{let e=io(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},so=()=>ai()?.config,oo=n=>ai()?.[`_${n}`];var si=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Je(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function sr(n){return y(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function xl(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=L({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ir(JSON.stringify(t)),ir(JSON.stringify(a)),""].join(".")}var rr={};function om(){let n={prod:[],emulator:[]};for(let e of Object.keys(rr))rr[e]?n.emulator.push(e):n.prod.push(e);return n}function am(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Cl=!1;function ci(n,e){if(typeof window>"u"||typeof document>"u"||!Je(window.location.host)||rr[n]===e||rr[n]||Cl)return;rr[n]=e;function t(T){return`__firebase__banner__${T}`}let r="__firebase__banner",o=om().prod.length>0;function a(){let T=document.getElementById(r);T&&T.remove()}function u(T){T.style.display="flex",T.style.background="#7faaf0",T.style.position="fixed",T.style.bottom="5px",T.style.left="5px",T.style.padding=".5em",T.style.borderRadius="5px",T.style.alignItems="center"}function h(T,R){T.setAttribute("width","24"),T.setAttribute("id",R),T.setAttribute("height","24"),T.setAttribute("viewBox","0 0 24 24"),T.setAttribute("fill","none"),T.style.marginLeft="-6px"}function d(){let T=document.createElement("span");return T.style.cursor="pointer",T.style.marginLeft="16px",T.style.fontSize="24px",T.innerHTML=" &times;",T.onclick=()=>{Cl=!0,a()},T}function p(T,R){T.setAttribute("id",R),T.innerText="Learn more",T.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",T.setAttribute("target","__blank"),T.style.paddingLeft="5px",T.style.textDecoration="underline"}function I(){let T=am(r),R=t("text"),O=document.getElementById(R)||document.createElement("span"),x=t("learnmore"),N=document.getElementById(x)||document.createElement("a"),z=t("preprendIcon"),B=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(T.created){let H=T.element;u(H),p(N,x);let _e=d();h(B,z),H.append(B,O,N,_e),document.body.appendChild(H)}o?(O.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,O.innerText="Preview backend running in this workspace."),O.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",I):I()}function fe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ll(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fe())}function cm(){let n=ai()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ml(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Fl(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Ul(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Bl(){let n=fe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ql(){return!cm()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ao(){try{return typeof indexedDB=="object"}catch{return!1}}function jl(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var um="FirebaseError",Se=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=um,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qe.prototype.create)}},Qe=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?lm(o,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new Se(i,u,r)}};function lm(n,e){return n.replace(hm,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var hm=/\{\$([^}]+)}/g;function zl(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ve(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(Nl(o)&&Nl(a)){if(!Ve(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Nl(n){return n!==null&&typeof n=="object"}function or(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function $l(n,e){let t=new ro(n,e);return t.subscribe.bind(t)}var ro=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");dm(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=to),i.error===void 0&&(i.error=to),i.complete===void 0&&(i.complete=to);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function dm(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function to(){}var iE=4*60*60*1e3;function ie(n){return n&&n._delegate?n._delegate:n}var De=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var qt="[DEFAULT]";var co=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new si;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pm(e))try{this.getOrInitializeService({instanceIdentifier:qt})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=qt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return y(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=qt){return this.instances.has(e)}getOptions(e=qt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(i)}return i}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);let o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:fm(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=qt){return this.component?this.component.multipleInstances?e:qt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function fm(n){return n===qt?void 0:n}function pm(n){return n.instantiationMode==="EAGER"}var ui=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new co(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var mm=[],G=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(G||{}),gm={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},_m=G.INFO,ym={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},Im=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=ym[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},_t=class{constructor(e){this.name=e,this._logLevel=_m,this._logHandler=Im,this._userLogHandler=null,mm.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in G))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?gm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...e),this._logHandler(this,G.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...e),this._logHandler(this,G.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,G.INFO,...e),this._logHandler(this,G.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,G.WARN,...e),this._logHandler(this,G.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...e),this._logHandler(this,G.ERROR,...e)}};var Em=(n,e)=>e.some(t=>n instanceof t),Gl,Kl;function wm(){return Gl||(Gl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Tm(){return Kl||(Kl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Wl=new WeakMap,lo=new WeakMap,Hl=new WeakMap,uo=new WeakMap,fo=new WeakMap;function vm(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(qe(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Wl.set(t,n)}).catch(()=>{}),fo.set(e,n),e}function Am(n){if(lo.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});lo.set(n,e)}var ho={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return lo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Hl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qe(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Ql(n){ho=n(ho)}function bm(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(li(this),e,...t);return Hl.set(r,e.sort?e.sort():[e]),qe(r)}:Tm().includes(n)?function(...e){return n.apply(li(this),e),qe(Wl.get(this))}:function(...e){return qe(n.apply(li(this),e))}}function Sm(n){return typeof n=="function"?bm(n):(n instanceof IDBTransaction&&Am(n),Em(n,wm())?new Proxy(n,ho):n)}function qe(n){if(n instanceof IDBRequest)return vm(n);if(uo.has(n))return uo.get(n);let e=Sm(n);return e!==n&&(uo.set(n,e),fo.set(e,n)),e}var li=n=>fo.get(n);function Yl(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),u=qe(a);return r&&a.addEventListener("upgradeneeded",h=>{r(qe(a.result),h.oldVersion,h.newVersion,qe(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var Rm=["get","getKey","getAll","getAllKeys","count"],Pm=["put","add","delete","clear"],po=new Map;function Jl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(po.get(e))return po.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Pm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Rm.includes(t)))return;let o=function(a,...u){return y(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(u.shift())),(yield Promise.all([d[t](...u),i&&h.done]))[0]})};return po.set(e,o),o}Ql(n=>J(L({},n),{get:(e,t,r)=>Jl(e,t)||n.get(e,t,r),has:(e,t)=>!!Jl(e,t)||n.has(e,t)}));var go=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Cm(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function Cm(n){return n.getComponent()?.type==="VERSION"}var _o="@firebase/app",Xl="0.14.6";var Ye=new _t("@firebase/app"),Nm="@firebase/app-compat",Dm="@firebase/analytics-compat",km="@firebase/analytics",Om="@firebase/app-check-compat",Vm="@firebase/app-check",xm="@firebase/auth",Lm="@firebase/auth-compat",Mm="@firebase/database",Fm="@firebase/data-connect",Um="@firebase/database-compat",Bm="@firebase/functions",qm="@firebase/functions-compat",jm="@firebase/installations",zm="@firebase/installations-compat",$m="@firebase/messaging",Gm="@firebase/messaging-compat",Km="@firebase/performance",Wm="@firebase/performance-compat",Hm="@firebase/remote-config",Qm="@firebase/remote-config-compat",Jm="@firebase/storage",Ym="@firebase/storage-compat",Xm="@firebase/firestore",Zm="@firebase/ai",eg="@firebase/firestore-compat",tg="firebase",ng="12.6.0";var yo="[DEFAULT]",rg={[_o]:"fire-core",[Nm]:"fire-core-compat",[km]:"fire-analytics",[Dm]:"fire-analytics-compat",[Vm]:"fire-app-check",[Om]:"fire-app-check-compat",[xm]:"fire-auth",[Lm]:"fire-auth-compat",[Mm]:"fire-rtdb",[Fm]:"fire-data-connect",[Um]:"fire-rtdb-compat",[Bm]:"fire-fn",[qm]:"fire-fn-compat",[jm]:"fire-iid",[zm]:"fire-iid-compat",[$m]:"fire-fcm",[Gm]:"fire-fcm-compat",[Km]:"fire-perf",[Wm]:"fire-perf-compat",[Hm]:"fire-rc",[Qm]:"fire-rc-compat",[Jm]:"fire-gcs",[Ym]:"fire-gcs-compat",[Xm]:"fire-fst",[eg]:"fire-fst-compat",[Zm]:"fire-vertex","fire-js":"fire-js",[tg]:"fire-js-all"};var ar=new Map,ig=new Map,Io=new Map;function Zl(n,e){try{n.container.addComponent(e)}catch(t){Ye.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function It(n){let e=n.name;if(Io.has(e))return Ye.debug(`There were multiple attempts to register component ${e}.`),!1;Io.set(e,n);for(let t of ar.values())Zl(t,n);for(let t of ig.values())Zl(t,n);return!0}function ln(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Re(n){return n==null?!1:n.settings!==void 0}var sg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yt=new Qe("app","Firebase",sg);var Eo=class{constructor(e,t,r){this._isDeleted=!1,this._options=L({},e),this._config=L({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new De("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw yt.create("app-deleted",{appName:this._name})}};var Et=ng;function vo(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=L({name:yo,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw yt.create("bad-app-name",{appName:String(i)});if(t||(t=so()),!t)throw yt.create("no-options");let o=ar.get(i);if(o){if(Ve(t,o.options)&&Ve(r,o.config))return o;throw yt.create("duplicate-app",{appName:i})}let a=new ui(i);for(let h of Io.values())a.addComponent(h);let u=new Eo(t,r,a);return ar.set(i,u),u}function hn(n=yo){let e=ar.get(n);if(!e&&n===yo&&so())return vo();if(!e)throw yt.create("no-app",{appName:n});return e}function rh(){return Array.from(ar.values())}function xe(n,e,t){let r=rg[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){let a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ye.warn(a.join(" "));return}It(new De(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var og="firebase-heartbeat-database",ag=1,cr="firebase-heartbeat-store",mo=null;function ih(){return mo||(mo=Yl(og,ag,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(cr)}catch(t){console.warn(t)}}}}).catch(n=>{throw yt.create("idb-open",{originalErrorMessage:n.message})})),mo}function cg(n){return y(this,null,function*(){try{let t=(yield ih()).transaction(cr),r=yield t.objectStore(cr).get(sh(n));return yield t.done,r}catch(e){if(e instanceof Se)Ye.warn(e.message);else{let t=yt.create("idb-get",{originalErrorMessage:e?.message});Ye.warn(t.message)}}})}function eh(n,e){return y(this,null,function*(){try{let r=(yield ih()).transaction(cr,"readwrite");yield r.objectStore(cr).put(e,sh(n)),yield r.done}catch(t){if(t instanceof Se)Ye.warn(t.message);else{let r=yt.create("idb-set",{originalErrorMessage:t?.message});Ye.warn(r.message)}}})}function sh(n){return`${n.name}!${n.options.appId}`}var ug=1024,lg=30,wo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new To(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return y(this,null,function*(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=th();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>lg){let i=dg(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ye.warn(e)}})}getHeartbeatsHeader(){return y(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=th(),{heartbeatsToSend:t,unsentEntries:r}=hg(this._heartbeatsCache.heartbeats),i=ir(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ye.warn(e),""}})}};function th(){return new Date().toISOString().substring(0,10)}function hg(n,e=ug){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),nh(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),nh(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var To=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return y(this,null,function*(){return ao()?jl().then(()=>!0).catch(()=>!1):!1})}read(){return y(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield cg(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return y(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return eh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return y(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return eh(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function nh(n){return ir(JSON.stringify({version:2,heartbeats:n})).length}function dg(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function fg(n){It(new De("platform-logger",e=>new go(e),"PRIVATE")),It(new De("heartbeat",e=>new wo(e),"PRIVATE")),xe(_o,Xl,n),xe(_o,Xl,"esm2020"),xe("fire-js","")}fg("");var oh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ah={};var Xe,Ao;(function(){var n;function e(w,m){function _(){}_.prototype=m.prototype,w.F=m.prototype,w.prototype=new _,w.prototype.constructor=w,w.D=function(v,E,b){for(var g=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)g[Ae-2]=arguments[Ae];return m.prototype[E].apply(v,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,m,_){_||(_=0);let v=Array(16);if(typeof m=="string")for(var E=0;E<16;++E)v[E]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(E=0;E<16;++E)v[E]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=w.g[0],_=w.g[1],E=w.g[2];let b=w.g[3],g;g=m+(b^_&(E^b))+v[0]+3614090360&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(E^m&(_^E))+v[1]+3905402710&4294967295,b=m+(g<<12&4294967295|g>>>20),g=E+(_^b&(m^_))+v[2]+606105819&4294967295,E=b+(g<<17&4294967295|g>>>15),g=_+(m^E&(b^m))+v[3]+3250441966&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(b^_&(E^b))+v[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(E^m&(_^E))+v[5]+1200080426&4294967295,b=m+(g<<12&4294967295|g>>>20),g=E+(_^b&(m^_))+v[6]+2821735955&4294967295,E=b+(g<<17&4294967295|g>>>15),g=_+(m^E&(b^m))+v[7]+4249261313&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(b^_&(E^b))+v[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(E^m&(_^E))+v[9]+2336552879&4294967295,b=m+(g<<12&4294967295|g>>>20),g=E+(_^b&(m^_))+v[10]+4294925233&4294967295,E=b+(g<<17&4294967295|g>>>15),g=_+(m^E&(b^m))+v[11]+2304563134&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(b^_&(E^b))+v[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=b+(E^m&(_^E))+v[13]+4254626195&4294967295,b=m+(g<<12&4294967295|g>>>20),g=E+(_^b&(m^_))+v[14]+2792965006&4294967295,E=b+(g<<17&4294967295|g>>>15),g=_+(m^E&(b^m))+v[15]+1236535329&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(E^b&(_^E))+v[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^E&(m^_))+v[6]+3225465664&4294967295,b=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(b^m))+v[11]+643717713&4294967295,E=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(E^b))+v[0]+3921069994&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^b&(_^E))+v[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^E&(m^_))+v[10]+38016083&4294967295,b=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(b^m))+v[15]+3634488961&4294967295,E=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(E^b))+v[4]+3889429448&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^b&(_^E))+v[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^E&(m^_))+v[14]+3275163606&4294967295,b=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(b^m))+v[3]+4107603335&4294967295,E=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(E^b))+v[8]+1163531501&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^b&(_^E))+v[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=b+(_^E&(m^_))+v[2]+4243563512&4294967295,b=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(b^m))+v[7]+1735328473&4294967295,E=b+(g<<14&4294967295|g>>>18),g=_+(b^m&(E^b))+v[12]+2368359562&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(_^E^b)+v[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^E)+v[8]+2272392833&4294967295,b=m+(g<<11&4294967295|g>>>21),g=E+(b^m^_)+v[11]+1839030562&4294967295,E=b+(g<<16&4294967295|g>>>16),g=_+(E^b^m)+v[14]+4259657740&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^b)+v[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^E)+v[4]+1272893353&4294967295,b=m+(g<<11&4294967295|g>>>21),g=E+(b^m^_)+v[7]+4139469664&4294967295,E=b+(g<<16&4294967295|g>>>16),g=_+(E^b^m)+v[10]+3200236656&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^b)+v[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^E)+v[0]+3936430074&4294967295,b=m+(g<<11&4294967295|g>>>21),g=E+(b^m^_)+v[3]+3572445317&4294967295,E=b+(g<<16&4294967295|g>>>16),g=_+(E^b^m)+v[6]+76029189&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^b)+v[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=b+(m^_^E)+v[12]+3873151461&4294967295,b=m+(g<<11&4294967295|g>>>21),g=E+(b^m^_)+v[15]+530742520&4294967295,E=b+(g<<16&4294967295|g>>>16),g=_+(E^b^m)+v[2]+3299628645&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(E^(_|~b))+v[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~E))+v[7]+1126891415&4294967295,b=m+(g<<10&4294967295|g>>>22),g=E+(m^(b|~_))+v[14]+2878612391&4294967295,E=b+(g<<15&4294967295|g>>>17),g=_+(b^(E|~m))+v[5]+4237533241&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~b))+v[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~E))+v[3]+2399980690&4294967295,b=m+(g<<10&4294967295|g>>>22),g=E+(m^(b|~_))+v[10]+4293915773&4294967295,E=b+(g<<15&4294967295|g>>>17),g=_+(b^(E|~m))+v[1]+2240044497&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~b))+v[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~E))+v[15]+4264355552&4294967295,b=m+(g<<10&4294967295|g>>>22),g=E+(m^(b|~_))+v[6]+2734768916&4294967295,E=b+(g<<15&4294967295|g>>>17),g=_+(b^(E|~m))+v[13]+1309151649&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~b))+v[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=b+(_^(m|~E))+v[11]+3174756917&4294967295,b=m+(g<<10&4294967295|g>>>22),g=E+(m^(b|~_))+v[2]+718787259&4294967295,E=b+(g<<15&4294967295|g>>>17),g=_+(b^(E|~m))+v[9]+3951481745&4294967295,w.g[0]=w.g[0]+m&4294967295,w.g[1]=w.g[1]+(E+(g<<21&4294967295|g>>>11))&4294967295,w.g[2]=w.g[2]+E&4294967295,w.g[3]=w.g[3]+b&4294967295}r.prototype.v=function(w,m){m===void 0&&(m=w.length);let _=m-this.blockSize,v=this.C,E=this.h,b=0;for(;b<m;){if(E==0)for(;b<=_;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<m;)if(v[E++]=w.charCodeAt(b++),E==this.blockSize){i(this,v),E=0;break}}else for(;b<m;)if(v[E++]=w[b++],E==this.blockSize){i(this,v),E=0;break}}this.h=E,this.o+=m},r.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var m=1;m<w.length-8;++m)w[m]=0;m=this.o*8;for(var _=w.length-8;_<w.length;++_)w[_]=m&255,m/=256;for(this.v(w),w=Array(16),m=0,_=0;_<4;++_)for(let v=0;v<32;v+=8)w[m++]=this.g[_]>>>v&255;return w};function o(w,m){var _=u;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=m(w)}function a(w,m){this.h=m;let _=[],v=!0;for(let E=w.length-1;E>=0;E--){let b=w[E]|0;v&&b==m||(_[E]=b,v=!1)}this.g=_}var u={};function h(w){return-128<=w&&w<128?o(w,function(m){return new a([m|0],m<0?-1:0)}):new a([w|0],w<0?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return I;if(w<0)return N(d(-w));let m=[],_=1;for(let v=0;w>=_;v++)m[v]=w/_|0,_*=4294967296;return new a(m,0)}function p(w,m){if(w.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(w.charAt(0)=="-")return N(p(w.substring(1),m));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');let _=d(Math.pow(m,8)),v=I;for(let b=0;b<w.length;b+=8){var E=Math.min(8,w.length-b);let g=parseInt(w.substring(b,b+E),m);E<8?(E=d(Math.pow(m,E)),v=v.j(E).add(d(g))):(v=v.j(_),v=v.add(d(g)))}return v}var I=h(0),T=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(x(this))return-N(this).m();let w=0,m=1;for(let _=0;_<this.g.length;_++){let v=this.i(_);w+=(v>=0?v:4294967296+v)*m,m*=4294967296}return w},n.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(O(this))return"0";if(x(this))return"-"+N(this).toString(w);let m=d(Math.pow(w,6));var _=this;let v="";for(;;){let E=_e(_,m).g;_=z(_,E.j(m));let b=((_.g.length>0?_.g[0]:_.h)>>>0).toString(w);if(_=E,O(_))return b+v;for(;b.length<6;)b="0"+b;v=b+v}},n.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function O(w){if(w.h!=0)return!1;for(let m=0;m<w.g.length;m++)if(w.g[m]!=0)return!1;return!0}function x(w){return w.h==-1}n.l=function(w){return w=z(this,w),x(w)?-1:O(w)?0:1};function N(w){let m=w.g.length,_=[];for(let v=0;v<m;v++)_[v]=~w.g[v];return new a(_,~w.h).add(T)}n.abs=function(){return x(this)?N(this):this},n.add=function(w){let m=Math.max(this.g.length,w.g.length),_=[],v=0;for(let E=0;E<=m;E++){let b=v+(this.i(E)&65535)+(w.i(E)&65535),g=(b>>>16)+(this.i(E)>>>16)+(w.i(E)>>>16);v=g>>>16,b&=65535,g&=65535,_[E]=g<<16|b}return new a(_,_[_.length-1]&-2147483648?-1:0)};function z(w,m){return w.add(N(m))}n.j=function(w){if(O(this)||O(w))return I;if(x(this))return x(w)?N(this).j(N(w)):N(N(this).j(w));if(x(w))return N(this.j(N(w)));if(this.l(R)<0&&w.l(R)<0)return d(this.m()*w.m());let m=this.g.length+w.g.length,_=[];for(var v=0;v<2*m;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(let E=0;E<w.g.length;E++){let b=this.i(v)>>>16,g=this.i(v)&65535,Ae=w.i(E)>>>16,ut=w.i(E)&65535;_[2*v+2*E]+=g*ut,B(_,2*v+2*E),_[2*v+2*E+1]+=b*ut,B(_,2*v+2*E+1),_[2*v+2*E+1]+=g*Ae,B(_,2*v+2*E+1),_[2*v+2*E+2]+=b*Ae,B(_,2*v+2*E+2)}for(w=0;w<m;w++)_[w]=_[2*w+1]<<16|_[2*w];for(w=m;w<2*m;w++)_[w]=0;return new a(_,0)};function B(w,m){for(;(w[m]&65535)!=w[m];)w[m+1]+=w[m]>>>16,w[m]&=65535,m++}function H(w,m){this.g=w,this.h=m}function _e(w,m){if(O(m))throw Error("division by zero");if(O(w))return new H(I,I);if(x(w))return m=_e(N(w),m),new H(N(m.g),N(m.h));if(x(m))return m=_e(w,N(m)),new H(N(m.g),m.h);if(w.g.length>30){if(x(w)||x(m))throw Error("slowDivide_ only works with positive integers.");for(var _=T,v=m;v.l(w)<=0;)_=ve(_),v=ve(v);var E=he(_,1),b=he(v,1);for(v=he(v,2),_=he(_,2);!O(v);){var g=b.add(v);g.l(w)<=0&&(E=E.add(_),b=g),v=he(v,1),_=he(_,1)}return m=z(w,E.j(m)),new H(E,m)}for(E=I;w.l(m)>=0;){for(_=Math.max(1,Math.floor(w.m()/m.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),b=d(_),g=b.j(m);x(g)||g.l(w)>0;)_-=v,b=d(_),g=b.j(m);O(b)&&(b=T),E=E.add(b),w=z(w,g)}return new H(E,w)}n.B=function(w){return _e(this,w).h},n.and=function(w){let m=Math.max(this.g.length,w.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)&w.i(v);return new a(_,this.h&w.h)},n.or=function(w){let m=Math.max(this.g.length,w.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)|w.i(v);return new a(_,this.h|w.h)},n.xor=function(w){let m=Math.max(this.g.length,w.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)^w.i(v);return new a(_,this.h^w.h)};function ve(w){let m=w.g.length+1,_=[];for(let v=0;v<m;v++)_[v]=w.i(v)<<1|w.i(v-1)>>>31;return new a(_,w.h)}function he(w,m){let _=m>>5;m%=32;let v=w.g.length-_,E=[];for(let b=0;b<v;b++)E[b]=m>0?w.i(b+_)>>>m|w.i(b+_+1)<<32-m:w.i(b+_);return new a(E,w.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Ao=ah.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Xe=ah.Integer=a}).apply(typeof oh<"u"?oh:typeof self<"u"?self:typeof window<"u"?window:{});var hi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ze={};var bo,pg,dn,So,ur,di,Ro,Po,Co;(function(){var n,e=Object.defineProperty;function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof hi=="object"&&hi];for(var c=0;c<s.length;++c){var l=s[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var l=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var A=s[f];if(!(A in l))break e;l=l[A]}s=s[s.length-1],f=l[s],c=c(f),c!=f&&c!=null&&e(l,s,{configurable:!0,writable:!0,value:c})}}i("Symbol.dispose",function(s){return s||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(s){return s||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(s){return s||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function h(s,c,l){return s.call.apply(s.bind,arguments)}function d(s,c,l){return d=h,d.apply(null,arguments)}function p(s,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function I(s,c){function l(){}l.prototype=c.prototype,s.Z=c.prototype,s.prototype=new l,s.prototype.constructor=s,s.Ob=function(f,A,S){for(var D=Array(arguments.length-2),$=2;$<arguments.length;$++)D[$-2]=arguments[$];return c.prototype[A].apply(f,D)}}var T=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?s=>s&&AsyncContext.Snapshot.wrap(s):s=>s;function R(s){let c=s.length;if(c>0){let l=Array(c);for(let f=0;f<c;f++)l[f]=s[f];return l}return[]}function O(s,c){for(let f=1;f<arguments.length;f++){let A=arguments[f];var l=typeof A;if(l=l!="object"?l:A?Array.isArray(A)?"array":l:"null",l=="array"||l=="object"&&typeof A.length=="number"){l=s.length||0;let S=A.length||0;s.length=l+S;for(let D=0;D<S;D++)s[l+D]=A[D]}else s.push(A)}}class x{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function N(s){a.setTimeout(()=>{throw s},0)}function z(){var s=w;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class B{constructor(){this.h=this.g=null}add(c,l){let f=H.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var H=new x(()=>new _e,s=>s.reset());class _e{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let ve,he=!1,w=new B,m=()=>{let s=Promise.resolve(void 0);ve=()=>{s.then(_)}};function _(){for(var s;s=z();){try{s.h.call(s.g)}catch(l){N(l)}var c=H;c.j(s),c.h<100&&(c.h++,s.next=c.g,c.g=s)}he=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var b=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return s}();function g(s){return/^[\s\xa0]*$/.test(s)}function Ae(s,c){E.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s&&this.init(s,c)}I(Ae,E),Ae.prototype.init=function(s,c){let l=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget,c||(l=="mouseover"?c=s.fromElement:l=="mouseout"&&(c=s.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=s.pointerType,this.state=s.state,this.i=s,s.defaultPrevented&&Ae.Z.h.call(this)},Ae.prototype.h=function(){Ae.Z.h.call(this);let s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var ut="closure_listenable_"+(Math.random()*1e6|0),Ap=0;function bp(s,c,l,f,A){this.listener=s,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=A,this.key=++Ap,this.da=this.fa=!1}function Br(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function qr(s,c,l){for(let f in s)c.call(l,s[f],f,s)}function Sp(s,c){for(let l in s)c.call(void 0,s[l],l,s)}function vu(s){let c={};for(let l in s)c[l]=s[l];return c}let Au="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function bu(s,c){let l,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(l in f)s[l]=f[l];for(let S=0;S<Au.length;S++)l=Au[S],Object.prototype.hasOwnProperty.call(f,l)&&(s[l]=f[l])}}function jr(s){this.src=s,this.g={},this.h=0}jr.prototype.add=function(s,c,l,f,A){let S=s.toString();s=this.g[S],s||(s=this.g[S]=[],this.h++);let D=Ds(s,c,f,A);return D>-1?(c=s[D],l||(c.fa=!1)):(c=new bp(c,this.src,S,!!f,A),c.fa=l,s.push(c)),c};function Ns(s,c){let l=c.type;if(l in s.g){var f=s.g[l],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=A>=0)&&Array.prototype.splice.call(f,A,1),S&&(Br(c),s.g[l].length==0&&(delete s.g[l],s.h--))}}function Ds(s,c,l,f){for(let A=0;A<s.length;++A){let S=s[A];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return A}return-1}var ks="closure_lm_"+(Math.random()*1e6|0),Os={};function Su(s,c,l,f,A){if(f&&f.once)return Pu(s,c,l,f,A);if(Array.isArray(c)){for(let S=0;S<c.length;S++)Su(s,c[S],l,f,A);return null}return l=Ms(l),s&&s[ut]?s.J(c,l,u(f)?!!f.capture:!!f,A):Ru(s,c,l,!1,f,A)}function Ru(s,c,l,f,A,S){if(!c)throw Error("Invalid event type");let D=u(A)?!!A.capture:!!A,$=xs(s);if($||(s[ks]=$=new jr(s)),l=$.add(c,l,f,D,S),l.proxy)return l;if(f=Rp(),l.proxy=f,f.src=s,f.listener=l,s.addEventListener)b||(A=D),A===void 0&&(A=!1),s.addEventListener(c.toString(),f,A);else if(s.attachEvent)s.attachEvent(Nu(c.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Rp(){function s(l){return c.call(s.src,s.listener,l)}let c=Pp;return s}function Pu(s,c,l,f,A){if(Array.isArray(c)){for(let S=0;S<c.length;S++)Pu(s,c[S],l,f,A);return null}return l=Ms(l),s&&s[ut]?s.K(c,l,u(f)?!!f.capture:!!f,A):Ru(s,c,l,!0,f,A)}function Cu(s,c,l,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)Cu(s,c[S],l,f,A);else f=u(f)?!!f.capture:!!f,l=Ms(l),s&&s[ut]?(s=s.i,S=String(c).toString(),S in s.g&&(c=s.g[S],l=Ds(c,l,f,A),l>-1&&(Br(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete s.g[S],s.h--)))):s&&(s=xs(s))&&(c=s.g[c.toString()],s=-1,c&&(s=Ds(c,l,f,A)),(l=s>-1?c[s]:null)&&Vs(l))}function Vs(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[ut])Ns(c.i,s);else{var l=s.type,f=s.proxy;c.removeEventListener?c.removeEventListener(l,f,s.capture):c.detachEvent?c.detachEvent(Nu(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=xs(c))?(Ns(l,s),l.h==0&&(l.src=null,c[ks]=null)):Br(s)}}}function Nu(s){return s in Os?Os[s]:Os[s]="on"+s}function Pp(s,c){if(s.da)s=!0;else{c=new Ae(c,this);let l=s.listener,f=s.ha||s.src;s.fa&&Vs(s),s=l.call(f,c)}return s}function xs(s){return s=s[ks],s instanceof jr?s:null}var Ls="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ms(s){return typeof s=="function"?s:(s[Ls]||(s[Ls]=function(c){return s.handleEvent(c)}),s[Ls])}function ye(){v.call(this),this.i=new jr(this),this.M=this,this.G=null}I(ye,v),ye.prototype[ut]=!0,ye.prototype.removeEventListener=function(s,c,l,f){Cu(this,s,c,l,f)};function we(s,c){var l,f=s.G;if(f)for(l=[];f;f=f.G)l.push(f);if(s=s.M,f=c.type||c,typeof c=="string")c=new E(c,s);else if(c instanceof E)c.target=c.target||s;else{var A=c;c=new E(f,s),bu(c,A)}A=!0;let S,D;if(l)for(D=l.length-1;D>=0;D--)S=c.g=l[D],A=zr(S,f,!0,c)&&A;if(S=c.g=s,A=zr(S,f,!0,c)&&A,A=zr(S,f,!1,c)&&A,l)for(D=0;D<l.length;D++)S=c.g=l[D],A=zr(S,f,!1,c)&&A}ye.prototype.N=function(){if(ye.Z.N.call(this),this.i){var s=this.i;for(let c in s.g){let l=s.g[c];for(let f=0;f<l.length;f++)Br(l[f]);delete s.g[c],s.h--}}this.G=null},ye.prototype.J=function(s,c,l,f){return this.i.add(String(s),c,!1,l,f)},ye.prototype.K=function(s,c,l,f){return this.i.add(String(s),c,!0,l,f)};function zr(s,c,l,f){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let S=0;S<c.length;++S){let D=c[S];if(D&&!D.da&&D.capture==l){let $=D.listener,le=D.ha||D.src;D.fa&&Ns(s.i,D),A=$.call(le,f)!==!1&&A}}return A&&!f.defaultPrevented}function Cp(s,c){if(typeof s!="function")if(s&&typeof s.handleEvent=="function")s=d(s.handleEvent,s);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(s,c||0)}function Du(s){s.g=Cp(()=>{s.g=null,s.i&&(s.i=!1,Du(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class Np extends v{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Du(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bn(s){v.call(this),this.h=s,this.g={}}I(Bn,v);var ku=[];function Ou(s){qr(s.g,function(c,l){this.g.hasOwnProperty(l)&&Vs(c)},s),s.g={}}Bn.prototype.N=function(){Bn.Z.N.call(this),Ou(this)},Bn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fs=a.JSON.stringify,Dp=a.JSON.parse,kp=class{stringify(s){return a.JSON.stringify(s,void 0)}parse(s){return a.JSON.parse(s,void 0)}};function Vu(){}function xu(){}var qn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Us(){E.call(this,"d")}I(Us,E);function Bs(){E.call(this,"c")}I(Bs,E);var Lt={},Lu=null;function $r(){return Lu=Lu||new ye}Lt.Ia="serverreachability";function Mu(s){E.call(this,Lt.Ia,s)}I(Mu,E);function jn(s){let c=$r();we(c,new Mu(c))}Lt.STAT_EVENT="statevent";function Fu(s,c){E.call(this,Lt.STAT_EVENT,s),this.stat=c}I(Fu,E);function Te(s){let c=$r();we(c,new Fu(c,s))}Lt.Ja="timingevent";function Uu(s,c){E.call(this,Lt.Ja,s),this.size=c}I(Uu,E);function zn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){s()},c)}function $n(){this.g=!0}$n.prototype.ua=function(){this.g=!1};function Op(s,c,l,f,A,S){s.info(function(){if(s.g)if(S){var D="",$=S.split("&");for(let X=0;X<$.length;X++){var le=$[X].split("=");if(le.length>1){let de=le[0];le=le[1];let Be=de.split("_");D=Be.length>=2&&Be[1]=="type"?D+(de+"="+le+"&"):D+(de+"=redacted&")}}}else D=null;else D=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+l+`
`+D})}function Vp(s,c,l,f,A,S,D){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+l+`
`+S+" "+D})}function an(s,c,l,f){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+Lp(s,l)+(f?" "+f:"")})}function xp(s,c){s.info(function(){return"TIMEOUT: "+c})}$n.prototype.info=function(){};function Lp(s,c){if(!s.g)return c;if(!c)return null;try{let S=JSON.parse(c);if(S){for(s=0;s<S.length;s++)if(Array.isArray(S[s])){var l=S[s];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var A=f[0];if(A!="noop"&&A!="stop"&&A!="close")for(let D=1;D<f.length;D++)f[D]=""}}}}return Fs(S)}catch{return c}}var Gr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Bu={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},qu;function qs(){}I(qs,Vu),qs.prototype.g=function(){return new XMLHttpRequest},qu=new qs;function Gn(s){return encodeURIComponent(String(s))}function Mp(s){var c=1;s=s.split(":");let l=[];for(;c>0&&s.length;)l.push(s.shift()),c--;return s.length&&l.push(s.join(":")),l}function lt(s,c,l,f){this.j=s,this.i=c,this.l=l,this.S=f||1,this.V=new Bn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ju}function ju(){this.i=null,this.g="",this.h=!1}var zu={},js={};function zs(s,c,l){s.M=1,s.A=Wr(Ue(c)),s.u=l,s.R=!0,$u(s,null)}function $u(s,c){s.F=Date.now(),Kr(s),s.B=Ue(s.A);var l=s.B,f=s.S;Array.isArray(f)||(f=[String(f)]),rl(l.i,"t",f),s.C=0,l=s.j.L,s.h=new ju,s.g=wl(s.j,l?c:null,!s.u),s.P>0&&(s.O=new Np(d(s.Y,s,s.g),s.P)),c=s.V,l=s.g,f=s.ba;var A="readystatechange";Array.isArray(A)||(A&&(ku[0]=A.toString()),A=ku);for(let S=0;S<A.length;S++){let D=Su(l,A[S],f||c.handleEvent,!1,c.h||c);if(!D)break;c.g[D.key]=D}c=s.J?vu(s.J):{},s.u?(s.v||(s.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.B,s.v,s.u,c)):(s.v="GET",s.g.ea(s.B,s.v,null,c)),jn(),Op(s.i,s.v,s.B,s.l,s.S,s.u)}lt.prototype.ba=function(s){s=s.target;let c=this.O;c&&ft(s)==3?c.j():this.Y(s)},lt.prototype.Y=function(s){try{if(s==this.g)e:{let $=ft(this.g),le=this.g.ya(),X=this.g.ca();if(!($<3)&&($!=3||this.g&&(this.h.h||this.g.la()||ll(this.g)))){this.K||$!=4||le==7||(le==8||X<=0?jn(3):jn(2)),$s(this);var c=this.g.ca();this.X=c;var l=Fp(this);if(this.o=c==200,Vp(this.i,this.v,this.B,this.l,this.S,$,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,A=this.g;if((f=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var S=f;break t}}S=null}if(s=S)an(this.i,this.l,s,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Gs(this,s);else{this.o=!1,this.m=3,Te(12),Mt(this),Kn(this);break e}}if(this.R){s=!0;let de;for(;!this.K&&this.C<l.length;)if(de=Up(this,l),de==js){$==4&&(this.m=4,Te(14),s=!1),an(this.i,this.l,null,"[Incomplete Response]");break}else if(de==zu){this.m=4,Te(15),an(this.i,this.l,l,"[Invalid Chunk]"),s=!1;break}else an(this.i,this.l,de,null),Gs(this,de);if(Gu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$!=4||l.length!=0||this.h.h||(this.m=1,Te(16),s=!1),this.o=this.o&&s,!s)an(this.i,this.l,l,"[Invalid Chunked Response]"),Mt(this),Kn(this);else if(l.length>0&&!this.W){this.W=!0;var D=this.j;D.g==this&&D.aa&&!D.P&&(D.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),Xs(D),D.P=!0,Te(11))}}else an(this.i,this.l,l,null),Gs(this,l);$==4&&Mt(this),this.o&&!this.K&&($==4?_l(this.j,this):(this.o=!1,Kr(this)))}else Zp(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,Te(12)):(this.m=0,Te(13)),Mt(this),Kn(this)}}}catch{}finally{}};function Fp(s){if(!Gu(s))return s.g.la();let c=ll(s.g);if(c==="")return"";let l="",f=c.length,A=ft(s.g)==4;if(!s.h.i){if(typeof TextDecoder>"u")return Mt(s),Kn(s),"";s.h.i=new a.TextDecoder}for(let S=0;S<f;S++)s.h.h=!0,l+=s.h.i.decode(c[S],{stream:!(A&&S==f-1)});return c.length=0,s.h.g+=l,s.C=0,s.h.g}function Gu(s){return s.g?s.v=="GET"&&s.M!=2&&s.j.Aa:!1}function Up(s,c){var l=s.C,f=c.indexOf(`
`,l);return f==-1?js:(l=Number(c.substring(l,f)),isNaN(l)?zu:(f+=1,f+l>c.length?js:(c=c.slice(f,f+l),s.C=f+l,c)))}lt.prototype.cancel=function(){this.K=!0,Mt(this)};function Kr(s){s.T=Date.now()+s.H,Ku(s,s.H)}function Ku(s,c){if(s.D!=null)throw Error("WatchDog timer not null");s.D=zn(d(s.aa,s),c)}function $s(s){s.D&&(a.clearTimeout(s.D),s.D=null)}lt.prototype.aa=function(){this.D=null;let s=Date.now();s-this.T>=0?(xp(this.i,this.B),this.M!=2&&(jn(),Te(17)),Mt(this),this.m=2,Kn(this)):Ku(this,this.T-s)};function Kn(s){s.j.I==0||s.K||_l(s.j,s)}function Mt(s){$s(s);var c=s.O;c&&typeof c.dispose=="function"&&c.dispose(),s.O=null,Ou(s.V),s.g&&(c=s.g,s.g=null,c.abort(),c.dispose())}function Gs(s,c){try{var l=s.j;if(l.I!=0&&(l.g==s||Ks(l.h,s))){if(!s.L&&Ks(l.h,s)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<s.F)Zr(l),Yr(l);else break e;Ys(l),Te(18)}}else l.xa=A[1],0<l.xa-l.K&&A[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=zn(d(l.Va,l),6e3));Qu(l.h)<=1&&l.ta&&(l.ta=void 0)}else Ut(l,11)}else if((s.L||l.g==s)&&Zr(l),!g(c))for(A=l.Ba.g.parse(c),c=0;c<A.length;c++){let X=A[c],de=X[0];if(!(de<=l.K))if(l.K=de,X=X[1],l.I==2)if(X[0]=="c"){l.M=X[1],l.ba=X[2];let Be=X[3];Be!=null&&(l.ka=Be,l.j.info("VER="+l.ka));let Bt=X[4];Bt!=null&&(l.za=Bt,l.j.info("SVER="+l.za));let pt=X[5];pt!=null&&typeof pt=="number"&&pt>0&&(f=1.5*pt,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;let mt=s.g;if(mt){let ti=mt.g?mt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ti){var S=f.h;S.g||ti.indexOf("spdy")==-1&&ti.indexOf("quic")==-1&&ti.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Ws(S,S.h),S.h=null))}if(f.G){let Zs=mt.g?mt.g.getResponseHeader("X-HTTP-Session-Id"):null;Zs&&(f.wa=Zs,Z(f.J,f.G,Zs))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-s.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var D=s;if(f.na=El(f,f.L?f.ba:null,f.W),D.L){Ju(f.h,D);var $=D,le=f.O;le&&($.H=le),$.D&&($s($),Kr($)),f.g=D}else ml(f);l.i.length>0&&Xr(l)}else X[0]!="stop"&&X[0]!="close"||Ut(l,7);else l.I==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?Ut(l,7):Js(l):X[0]!="noop"&&l.l&&l.l.qa(X),l.A=0)}}jn(4)}catch{}}var Bp=class{constructor(s,c){this.g=s,this.map=c}};function Wu(s){this.l=s||10,a.PerformanceNavigationTiming?(s=a.performance.getEntriesByType("navigation"),s=s.length>0&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Hu(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Qu(s){return s.h?1:s.g?s.g.size:0}function Ks(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function Ws(s,c){s.g?s.g.add(c):s.h=c}function Ju(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}Wu.prototype.cancel=function(){if(this.i=Yu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function Yu(s){if(s.h!=null)return s.i.concat(s.h.G);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let l of s.g.values())c=c.concat(l.G);return c}return R(s.i)}var Xu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qp(s,c){if(s){s=s.split("&");for(let l=0;l<s.length;l++){let f=s[l].indexOf("="),A,S=null;f>=0?(A=s[l].substring(0,f),S=s[l].substring(f+1)):A=s[l],c(A,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function ht(s){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;s instanceof ht?(this.l=s.l,Wn(this,s.j),this.o=s.o,this.g=s.g,Hn(this,s.u),this.h=s.h,Hs(this,il(s.i)),this.m=s.m):s&&(c=String(s).match(Xu))?(this.l=!1,Wn(this,c[1]||"",!0),this.o=Qn(c[2]||""),this.g=Qn(c[3]||"",!0),Hn(this,c[4]),this.h=Qn(c[5]||"",!0),Hs(this,c[6]||"",!0),this.m=Qn(c[7]||"")):(this.l=!1,this.i=new Yn(null,this.l))}ht.prototype.toString=function(){let s=[];var c=this.j;c&&s.push(Jn(c,Zu,!0),":");var l=this.g;return(l||c=="file")&&(s.push("//"),(c=this.o)&&s.push(Jn(c,Zu,!0),"@"),s.push(Gn(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&s.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(Jn(l,l.charAt(0)=="/"?$p:zp,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",Jn(l,Kp)),s.join("")},ht.prototype.resolve=function(s){let c=Ue(this),l=!!s.j;l?Wn(c,s.j):l=!!s.o,l?c.o=s.o:l=!!s.g,l?c.g=s.g:l=s.u!=null;var f=s.h;if(l)Hn(c,s.u);else if(l=!!s.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var A=c.h.lastIndexOf("/");A!=-1&&(f=c.h.slice(0,A+1)+f)}if(A=f,A==".."||A==".")f="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){f=A.lastIndexOf("/",0)==0,A=A.split("/");let S=[];for(let D=0;D<A.length;){let $=A[D++];$=="."?f&&D==A.length&&S.push(""):$==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&D==A.length&&S.push("")):(S.push($),f=!0)}f=S.join("/")}else f=A}return l?c.h=f:l=s.i.toString()!=="",l?Hs(c,il(s.i)):l=!!s.m,l&&(c.m=s.m),c};function Ue(s){return new ht(s)}function Wn(s,c,l){s.j=l?Qn(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function Hn(s,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);s.u=c}else s.u=null}function Hs(s,c,l){c instanceof Yn?(s.i=c,Wp(s.i,s.l)):(l||(c=Jn(c,Gp)),s.i=new Yn(c,s.l))}function Z(s,c,l){s.i.set(c,l)}function Wr(s){return Z(s,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),s}function Qn(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function Jn(s,c,l){return typeof s=="string"?(s=encodeURI(s).replace(c,jp),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function jp(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var Zu=/[#\/\?@]/g,zp=/[#\?:]/g,$p=/[#\?]/g,Gp=/[#\?@]/g,Kp=/#/g;function Yn(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function Ft(s){s.g||(s.g=new Map,s.h=0,s.i&&qp(s.i,function(c,l){s.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=Yn.prototype,n.add=function(s,c){Ft(this),this.i=null,s=cn(this,s);let l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(c),this.h+=1,this};function el(s,c){Ft(s),c=cn(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function tl(s,c){return Ft(s),c=cn(s,c),s.g.has(c)}n.forEach=function(s,c){Ft(this),this.g.forEach(function(l,f){l.forEach(function(A){s.call(c,A,f,this)},this)},this)};function nl(s,c){Ft(s);let l=[];if(typeof c=="string")tl(s,c)&&(l=l.concat(s.g.get(cn(s,c))));else for(s=Array.from(s.g.values()),c=0;c<s.length;c++)l=l.concat(s[c]);return l}n.set=function(s,c){return Ft(this),this.i=null,s=cn(this,s),tl(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=nl(this,s),s.length>0?String(s[0]):c):c};function rl(s,c,l){el(s,c),l.length>0&&(s.i=null,s.g.set(cn(s,c),R(l)),s.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];let A=Gn(l);l=nl(this,l);for(let S=0;S<l.length;S++){let D=A;l[S]!==""&&(D+="="+Gn(l[S])),s.push(D)}}return this.i=s.join("&")};function il(s){let c=new Yn;return c.i=s.i,s.g&&(c.g=new Map(s.g),c.h=s.h),c}function cn(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function Wp(s,c){c&&!s.j&&(Ft(s),s.i=null,s.g.forEach(function(l,f){let A=f.toLowerCase();f!=A&&(el(this,f),rl(this,A,l))},s)),s.j=c}function Hp(s,c){let l=new $n;if(a.Image){let f=new Image;f.onload=p(dt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=p(dt,l,"TestLoadImage: error",!1,c,f),f.onabort=p(dt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(dt,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else c(!1)}function Qp(s,c){let l=new $n,f=new AbortController,A=setTimeout(()=>{f.abort(),dt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?dt(l,"TestPingServer: ok",!0,c):dt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),dt(l,"TestPingServer: error",!1,c)})}function dt(s,c,l,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(l)}catch{}}function Jp(){this.g=new kp}function Hr(s){this.i=s.Sb||null,this.h=s.ab||!1}I(Hr,Vu),Hr.prototype.g=function(){return new Qr(this.i,this.h)};function Qr(s,c){ye.call(this),this.H=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}I(Qr,ye),n=Qr.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=s,this.D=c,this.readyState=1,Zn(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};s&&(c.body=s),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Xn(this)),this.readyState=0},n.Pa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,Zn(this)),this.g&&(this.readyState=3,Zn(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;sl(this)}else s.text().then(this.Oa.bind(this),this.ga.bind(this))};function sl(s){s.j.read().then(s.Ma.bind(s)).catch(s.ga.bind(s))}n.Ma=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?Xn(this):Zn(this),this.readyState==3&&sl(this)}},n.Oa=function(s){this.g&&(this.response=this.responseText=s,Xn(this))},n.Na=function(s){this.g&&(this.response=s,Xn(this))},n.ga=function(){this.g&&Xn(this)};function Xn(s){s.readyState=4,s.l=null,s.j=null,s.B=null,Zn(s)}n.setRequestHeader=function(s,c){this.A.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=c.next();return s.join(`\r
`)};function Zn(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Qr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function ol(s){let c="";return qr(s,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function Qs(s,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=ol(l),typeof s=="string"?l!=null&&Gn(l):Z(s,c,l))}function ne(s){ye.call(this),this.headers=new Map,this.L=s||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}I(ne,ye);var Yp=/^https?$/i,Xp=["POST","PUT"];n=ne.prototype,n.Fa=function(s){this.H=s},n.ea=function(s,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():qu.g(),this.g.onreadystatechange=T(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(S){al(this,S);return}if(s=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)l.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),A=a.FormData&&s instanceof a.FormData,!(Array.prototype.indexOf.call(Xp,c,void 0)>=0)||f||A||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,D]of l)this.g.setRequestHeader(S,D);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(s),this.v=!1}catch(S){al(this,S)}};function al(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.o=5,cl(s),Jr(s)}function cl(s){s.A||(s.A=!0,we(s,"complete"),we(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=s||7,we(this,"complete"),we(this,"abort"),Jr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Jr(this,!0)),ne.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ul(this):this.Xa())},n.Xa=function(){ul(this)};function ul(s){if(s.h&&typeof o<"u"){if(s.v&&ft(s)==4)setTimeout(s.Ca.bind(s),0);else if(we(s,"readystatechange"),ft(s)==4){s.h=!1;try{let S=s.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=S===0){let D=String(s.D).match(Xu)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),f=!Yp.test(D?D.toLowerCase():"")}l=f}if(l)we(s,"complete"),we(s,"success");else{s.o=6;try{var A=ft(s)>2?s.g.statusText:""}catch{A=""}s.l=A+" ["+s.ca()+"]",cl(s)}}finally{Jr(s)}}}}function Jr(s,c){if(s.g){s.m&&(clearTimeout(s.m),s.m=null);let l=s.g;s.g=null,c||we(s,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ft(s){return s.g?s.g.readyState:0}n.ca=function(){try{return ft(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),Dp(c)}};function ll(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.F){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Zp(s){let c={};s=(s.g&&ft(s)>=2&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(g(s[f]))continue;var l=Mp(s[f]);let A=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let S=c[A]||[];c[A]=S,S.push(l)}Sp(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function er(s,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||c}function hl(s){this.za=0,this.i=[],this.j=new $n,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=er("failFast",!1,s),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=er("baseRetryDelayMs",5e3,s),this.Za=er("retryDelaySeedMs",1e4,s),this.Ta=er("forwardChannelMaxRetries",2,s),this.va=er("forwardChannelRequestTimeoutMs",2e4,s),this.ma=s&&s.xmlHttpFactory||void 0,this.Ua=s&&s.Rb||void 0,this.Aa=s&&s.useFetchStreams||!1,this.O=void 0,this.L=s&&s.supportsCrossDomainXhr||!1,this.M="",this.h=new Wu(s&&s.concurrentRequestLimit),this.Ba=new Jp,this.S=s&&s.fastHandshake||!1,this.R=s&&s.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=s&&s.Pb||!1,s&&s.ua&&this.j.ua(),s&&s.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&s&&s.detectBufferingProxy||!1,this.ia=void 0,s&&s.longPollingTimeout&&s.longPollingTimeout>0&&(this.ia=s.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=hl.prototype,n.ka=8,n.I=1,n.connect=function(s,c,l,f){Te(0),this.W=s,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=El(this,null,this.W),Xr(this)};function Js(s){if(dl(s),s.I==3){var c=s.V++,l=Ue(s.J);if(Z(l,"SID",s.M),Z(l,"RID",c),Z(l,"TYPE","terminate"),tr(s,l),c=new lt(s,s.j,c),c.M=2,c.A=Wr(Ue(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=wl(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Kr(c)}Il(s)}function Yr(s){s.g&&(Xs(s),s.g.cancel(),s.g=null)}function dl(s){Yr(s),s.v&&(a.clearTimeout(s.v),s.v=null),Zr(s),s.h.cancel(),s.m&&(typeof s.m=="number"&&a.clearTimeout(s.m),s.m=null)}function Xr(s){if(!Hu(s.h)&&!s.m){s.m=!0;var c=s.Ea;ve||m(),he||(ve(),he=!0),w.add(c,s),s.D=0}}function em(s,c){return Qu(s.h)>=s.h.j-(s.m?1:0)?!1:s.m?(s.i=c.G.concat(s.i),!0):s.I==1||s.I==2||s.D>=(s.Sa?0:s.Ta)?!1:(s.m=zn(d(s.Ea,s,c),yl(s,s.D)),s.D++,!0)}n.Ea=function(s){if(this.m)if(this.m=null,this.I==1){if(!s){this.V=Math.floor(Math.random()*1e5),s=this.V++;let A=new lt(this,this.j,s),S=this.o;if(this.U&&(S?(S=vu(S),bu(S,this.U)):S=this.U),this.u!==null||this.R||(A.J=S,S=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=pl(this,A,c),l=Ue(this.J),Z(l,"RID",s),Z(l,"CVER",22),this.G&&Z(l,"X-HTTP-Session-Id",this.G),tr(this,l),S&&(this.R?c="headers="+Gn(ol(S))+"&"+c:this.u&&Qs(l,this.u,S)),Ws(this.h,A),this.Ra&&Z(l,"TYPE","init"),this.S?(Z(l,"$req",c),Z(l,"SID","null"),A.U=!0,zs(A,l,null)):zs(A,l,c),this.I=2}}else this.I==3&&(s?fl(this,s):this.i.length==0||Hu(this.h)||fl(this))};function fl(s,c){var l;c?l=c.l:l=s.V++;let f=Ue(s.J);Z(f,"SID",s.M),Z(f,"RID",l),Z(f,"AID",s.K),tr(s,f),s.u&&s.o&&Qs(f,s.u,s.o),l=new lt(s,s.j,l,s.D+1),s.u===null&&(l.J=s.o),c&&(s.i=c.G.concat(s.i)),c=pl(s,l,1e3),l.H=Math.round(s.va*.5)+Math.round(s.va*.5*Math.random()),Ws(s.h,l),zs(l,f,c)}function tr(s,c){s.H&&qr(s.H,function(l,f){Z(c,f,l)}),s.l&&qr({},function(l,f){Z(c,f,l)})}function pl(s,c,l){l=Math.min(s.i.length,l);let f=s.l?d(s.l.Ka,s.l,s):null;e:{var A=s.i;let $=-1;for(;;){let le=["count="+l];$==-1?l>0?($=A[0].g,le.push("ofs="+$)):$=0:le.push("ofs="+$);let X=!0;for(let de=0;de<l;de++){var S=A[de].g;let Be=A[de].map;if(S-=$,S<0)$=Math.max(0,A[de].g-100),X=!1;else try{S="req"+S+"_"||"";try{var D=Be instanceof Map?Be:Object.entries(Be);for(let[Bt,pt]of D){let mt=pt;u(pt)&&(mt=Fs(pt)),le.push(S+Bt+"="+encodeURIComponent(mt))}}catch(Bt){throw le.push(S+"type="+encodeURIComponent("_badmap")),Bt}}catch{f&&f(Be)}}if(X){D=le.join("&");break e}}D=void 0}return s=s.i.splice(0,l),c.G=s,D}function ml(s){if(!s.g&&!s.v){s.Y=1;var c=s.Da;ve||m(),he||(ve(),he=!0),w.add(c,s),s.A=0}}function Ys(s){return s.g||s.v||s.A>=3?!1:(s.Y++,s.v=zn(d(s.Da,s),yl(s,s.A)),s.A++,!0)}n.Da=function(){if(this.v=null,gl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var s=4*this.T;this.j.info("BP detection timer enabled: "+s),this.B=zn(d(this.Wa,this),s)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Te(10),Yr(this),gl(this))};function Xs(s){s.B!=null&&(a.clearTimeout(s.B),s.B=null)}function gl(s){s.g=new lt(s,s.j,"rpc",s.Y),s.u===null&&(s.g.J=s.o),s.g.P=0;var c=Ue(s.na);Z(c,"RID","rpc"),Z(c,"SID",s.M),Z(c,"AID",s.K),Z(c,"CI",s.F?"0":"1"),!s.F&&s.ia&&Z(c,"TO",s.ia),Z(c,"TYPE","xmlhttp"),tr(s,c),s.u&&s.o&&Qs(c,s.u,s.o),s.O&&(s.g.H=s.O);var l=s.g;s=s.ba,l.M=1,l.A=Wr(Ue(c)),l.u=null,l.R=!0,$u(l,s)}n.Va=function(){this.C!=null&&(this.C=null,Yr(this),Ys(this),Te(19))};function Zr(s){s.C!=null&&(a.clearTimeout(s.C),s.C=null)}function _l(s,c){var l=null;if(s.g==c){Zr(s),Xs(s),s.g=null;var f=2}else if(Ks(s.h,c))l=c.G,Ju(s.h,c),f=1;else return;if(s.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var A=s.D;f=$r(),we(f,new Uu(f,l)),Xr(s)}else ml(s);else if(A=c.m,A==3||A==0&&c.X>0||!(f==1&&em(s,c)||f==2&&Ys(s)))switch(l&&l.length>0&&(c=s.h,c.i=c.i.concat(l)),A){case 1:Ut(s,5);break;case 4:Ut(s,10);break;case 3:Ut(s,6);break;default:Ut(s,2)}}}function yl(s,c){let l=s.Qa+Math.floor(Math.random()*s.Za);return s.isActive()||(l*=2),l*c}function Ut(s,c){if(s.j.info("Error code "+c),c==2){var l=d(s.bb,s),f=s.Ua;let A=!f;f=new ht(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Wn(f,"https"),Wr(f),A?Hp(f.toString(),l):Qp(f.toString(),l)}else Te(2);s.I=0,s.l&&s.l.pa(c),Il(s),dl(s)}n.bb=function(s){s?(this.j.info("Successfully pinged google.com"),Te(2)):(this.j.info("Failed to ping google.com"),Te(1))};function Il(s){if(s.I=0,s.ja=[],s.l){let c=Yu(s.h);(c.length!=0||s.i.length!=0)&&(O(s.ja,c),O(s.ja,s.i),s.h.i.length=0,R(s.i),s.i.length=0),s.l.oa()}}function El(s,c,l){var f=l instanceof ht?Ue(l):new ht(l);if(f.g!="")c&&(f.g=c+"."+f.g),Hn(f,f.u);else{var A=a.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;let S=new ht(null);f&&Wn(S,f),c&&(S.g=c),A&&Hn(S,A),l&&(S.h=l),f=S}return l=s.G,c=s.wa,l&&c&&Z(f,l,c),Z(f,"VER",s.ka),tr(s,f),f}function wl(s,c,l){if(c&&!s.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Aa&&!s.ma?new ne(new Hr({ab:l})):new ne(s.ma),c.Fa(s.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Tl(){}n=Tl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ei(){}ei.prototype.g=function(s,c){return new be(s,c)};function be(s,c){ye.call(this),this.g=new hl(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(s?s["X-WebChannel-Client-Profile"]=c.sa:s={"X-WebChannel-Client-Profile":c.sa}),this.g.U=s,(s=c&&c.Qb)&&!g(s)&&(this.g.u=s),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new un(this)}I(be,ye),be.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},be.prototype.close=function(){Js(this.g)},be.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.v&&(l={},l.__data__=Fs(s),s=l);c.i.push(new Bp(c.Ya++,s)),c.I==3&&Xr(c)},be.prototype.N=function(){this.g.l=null,delete this.j,Js(this.g),delete this.g,be.Z.N.call(this)};function vl(s){Us.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let l in c){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}I(vl,Us);function Al(){Bs.call(this),this.status=1}I(Al,Bs);function un(s){this.g=s}I(un,Tl),un.prototype.ra=function(){we(this.g,"a")},un.prototype.qa=function(s){we(this.g,new vl(s))},un.prototype.pa=function(s){we(this.g,new Al)},un.prototype.oa=function(){we(this.g,"b")},ei.prototype.createWebChannel=ei.prototype.g,be.prototype.send=be.prototype.o,be.prototype.open=be.prototype.m,be.prototype.close=be.prototype.close,Co=Ze.createWebChannelTransport=function(){return new ei},Po=Ze.getStatEventTarget=function(){return $r()},Ro=Ze.Event=Lt,di=Ze.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Gr.NO_ERROR=0,Gr.TIMEOUT=8,Gr.HTTP_ERROR=6,ur=Ze.ErrorCode=Gr,Bu.COMPLETE="complete",So=Ze.EventType=Bu,xu.EventType=qn,qn.OPEN="a",qn.CLOSE="b",qn.ERROR="c",qn.MESSAGE="d",ye.prototype.listen=ye.prototype.J,dn=Ze.WebChannel=xu,pg=Ze.FetchXmlHttpFactory=Hr,ne.prototype.listenOnce=ne.prototype.K,ne.prototype.getLastError=ne.prototype.Ha,ne.prototype.getLastErrorCode=ne.prototype.ya,ne.prototype.getStatus=ne.prototype.ca,ne.prototype.getResponseJson=ne.prototype.La,ne.prototype.getResponseText=ne.prototype.la,ne.prototype.send=ne.prototype.ea,ne.prototype.setWithCredentials=ne.prototype.Fa,bo=Ze.XhrIo=ne}).apply(typeof hi<"u"?hi:typeof self<"u"?self:typeof window<"u"?window:{});var ch="@firebase/firestore",uh="4.9.2";var pe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};pe.UNAUTHENTICATED=new pe(null),pe.GOOGLE_CREDENTIALS=new pe("google-credentials-uid"),pe.FIRST_PARTY=new pe("first-party-uid"),pe.MOCK_USER=new pe("mock-user");var Vn="12.3.0";var Kt=new _t("@firebase/firestore");function fn(){return Kt.logLevel}function V(n,...e){if(Kt.logLevel<=G.DEBUG){let t=e.map(Tc);Kt.debug(`Firestore (${Vn}): ${n}`,...t)}}function tt(n,...e){if(Kt.logLevel<=G.ERROR){let t=e.map(Tc);Kt.error(`Firestore (${Vn}): ${n}`,...t)}}function wn(n,...e){if(Kt.logLevel<=G.WARN){let t=e.map(Tc);Kt.warn(`Firestore (${Vn}): ${n}`,...t)}}function Tc(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function F(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,ed(n,r,t)}function ed(n,e,t){let r=`FIRESTORE (${Vn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw tt(r),new Error(r)}function Y(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||ed(e,i,r)}function q(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends Se{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var et=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ii=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Lo=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(pe.UNAUTHENTICATED))}shutdown(){}},Mo=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Fo=class{constructor(e){this.t=e,this.currentUser=pe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Y(this.o===void 0,42304);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new et;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new et,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(()=>y(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},u=h=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?u(h):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new et)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Y(typeof r.accessToken=="string",31837,{l:r}),new Ii(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string",2055,{h:e}),new pe(e)}},Uo=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=pe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Bo=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Uo(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(pe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ei=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},qo=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Re(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Y(this.o===void 0,3512);let r=o=>{o.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?i(o):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ei(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Y(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ei(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function mg(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var mr=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=mg(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function K(n,e){return n<e?-1:n>e?1:0}function jo(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),o=e.charAt(r);if(i!==o)return No(i)===No(o)?K(i,o):No(i)?1:-1}return K(n.length,e.length)}var gg=55296,_g=57343;function No(n){let e=n.charCodeAt(0);return e>=gg&&e<=_g}function Tn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var lh="__name__",wi=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&F(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&F(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return K(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):jo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Xe.fromString(e.substring(4,e.length-2))}},te=class n extends wi{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new k(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},yg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ce=class n extends wi{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return yg.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===lh}static keyField(){return new n([lh])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new k(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new k(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new k(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new k(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var M=class n{constructor(e){this.path=e}static fromPath(e){return new n(te.fromString(e))}static fromName(e){return new n(te.fromString(e).popFirst(5))}static empty(){return new n(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new te(e.slice()))}};function td(n,e,t){if(!t)throw new k(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Ig(n,e,t,r){if(e===!0&&r===!0)throw new k(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function hh(n){if(!M.isDocumentKey(n))throw new k(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function dh(n){if(M.isDocumentKey(n))throw new k(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function nd(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Xi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":F(12329,{type:typeof n})}function Le(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new k(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Xi(n);throw new k(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Eg(n,e){if(e<=0)throw new k(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function ce(n,e){let t={typeString:n};return e&&(t.value=e),t}function Pr(n,e){if(!nd(n))throw new k(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new k(P.INVALID_ARGUMENT,t);return!0}var fh=-62135596800,ph=1e6,ue=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ph);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<fh)throw new k(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ph}_compareTo(e){return this.seconds===e.seconds?K(this.nanoseconds,e.nanoseconds):K(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Pr(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-fh;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ue._jsonSchemaVersion="firestore/timestamp/1.0",ue._jsonSchema={type:ce("string",ue._jsonSchemaVersion),seconds:ce("number"),nanoseconds:ce("number")};var j=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new ue(0,0))}static max(){return new n(new ue(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var gr=-1,zo=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};zo.UNKNOWN_ID=-1;function wg(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(r===1e9?new ue(t+1,0):new ue(t,r));return new Wt(i,M.empty(),e)}function Tg(n){return new Wt(n.readTime,n.key,gr)}var Wt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(j.min(),M.empty(),gr)}static max(){return new n(j.max(),M.empty(),gr)}};function vg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:K(n.largestBatchId,e.largestBatchId))}var Ag="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$o=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function xn(n){return y(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==Ag)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),u=0;for(let h=0;h<o;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++u,u===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function bg(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ln(n){return n.name==="IndexedDbTransactionError"}var vc=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>r.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),Ac=-1;function Zi(n){return n==null}function _r(n){return n===0&&1/n==-1/0}function Sg(n){return typeof n=="number"&&Number.isInteger(n)&&!_r(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var rd="";function Rg(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=mh(e)),e=Pg(n.get(t),e);return mh(e)}function Pg(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case rd:t+="";break;default:t+=o}}return t}function mh(n){return n+rd+""}var Cg="remoteDocuments",id="owner";var sd="mutationQueues";var od="mutations";var ad="documentMutations",Ng="remoteDocumentsV14";var cd="remoteDocumentGlobal";var ud="targets";var ld="targetDocuments";var hd="targetGlobal",dd="collectionParents";var fd="clientMetadata";var pd="bundles";var md="namedQueries";var Dg="indexConfiguration";var kg="indexState";var Og="indexEntries";var gd="documentOverlays";var Vg="globals";var xg=[sd,od,ad,Cg,ud,id,hd,ld,fd,cd,dd,pd,md],UE=[...xg,gd],Lg=[sd,od,ad,Ng,ud,id,hd,ld,fd,cd,dd,pd,md,gd],Mg=Lg,Fg=[...Mg,Dg,kg,Og];var BE=[...Fg,Vg];function gh(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Nt(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function _d(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var re=class n{constructor(e,t){this.comparator=e,this.root=t||je.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,je.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,je.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _n(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _n(this.root,e,this.comparator,!1)}getReverseIterator(){return new _n(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _n(this.root,e,this.comparator,!0)}},_n=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},je=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw F(27949);return e+(this.isRed()?0:1)}};je.EMPTY=null,je.RED=!0,je.BLACK=!1;je.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new je(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var me=class n{constructor(e){this.comparator=e,this.data=new re(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ti(this.data.getIterator())}getIteratorFrom(e){return new Ti(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Ti=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Oe=class n{constructor(e){this.fields=e,e.sort(Ce.comparator)}static empty(){return new n([])}unionWith(e){let t=new me(Ce.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var vi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ee=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new vi("Invalid base64 string: "+o):o}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return K(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ee.EMPTY_BYTE_STRING=new Ee("");var Ug=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nt(n){if(Y(!!n,39018),typeof n=="string"){let e=0,t=Ug.exec(n);if(Y(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function rt(n){return typeof n=="string"?Ee.fromBase64String(n):Ee.fromUint8Array(n)}var yd="server_timestamp",Id="__type__",Ed="__previous_value__",wd="__local_write_time__";function bc(n){return(n?.mapValue?.fields||{})[Id]?.stringValue===yd}function es(n){let e=n.mapValue.fields[Ed];return bc(e)?es(e):e}function yr(n){let e=nt(n.mapValue.fields[wd].timestampValue);return new ue(e.seconds,e.nanos)}var Go=class{constructor(e,t,r,i,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}},Ir="(default)",Ai=class n{constructor(e,t){this.projectId=e,this.database=t||Ir}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Ir}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Sc="__type__",Td="__max__",fi={mapValue:{fields:{__type__:{stringValue:Td}}}},Rc="__vector__",vn="value";function bt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?bc(n)?4:Ad(n)?9007199254740991:vd(n)?10:11:F(28295,{value:n})}function Ge(n,e){if(n===e)return!0;let t=bt(n);if(t!==bt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yr(n).isEqual(yr(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=nt(i.timestampValue),u=nt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return rt(i.bytesValue).isEqual(rt(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return ee(i.geoPointValue.latitude)===ee(o.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return ee(i.integerValue)===ee(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=ee(i.doubleValue),u=ee(o.doubleValue);return a===u?_r(a)===_r(u):isNaN(a)&&isNaN(u)}return!1}(n,e);case 9:return Tn(n.arrayValue.values||[],e.arrayValue.values||[],Ge);case 10:case 11:return function(i,o){let a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(gh(a)!==gh(u))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Ge(a[h],u[h])))return!1;return!0}(n,e);default:return F(52216,{left:n})}}function Er(n,e){return(n.values||[]).find(t=>Ge(t,e))!==void 0}function An(n,e){if(n===e)return 0;let t=bt(n),r=bt(e);if(t!==r)return K(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return K(n.booleanValue,e.booleanValue);case 2:return function(o,a){let u=ee(o.integerValue||o.doubleValue),h=ee(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return _h(n.timestampValue,e.timestampValue);case 4:return _h(yr(n),yr(e));case 5:return jo(n.stringValue,e.stringValue);case 6:return function(o,a){let u=rt(o),h=rt(a);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){let u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){let p=K(u[d],h[d]);if(p!==0)return p}return K(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){let u=K(ee(o.latitude),ee(a.latitude));return u!==0?u:K(ee(o.longitude),ee(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return yh(n.arrayValue,e.arrayValue);case 10:return function(o,a){let u=o.fields||{},h=a.fields||{},d=u[vn]?.arrayValue,p=h[vn]?.arrayValue,I=K(d?.values?.length||0,p?.values?.length||0);return I!==0?I:yh(d,p)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===fi.mapValue&&a===fi.mapValue)return 0;if(o===fi.mapValue)return 1;if(a===fi.mapValue)return-1;let u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let I=0;I<h.length&&I<p.length;++I){let T=jo(h[I],p[I]);if(T!==0)return T;let R=An(u[h[I]],d[p[I]]);if(R!==0)return R}return K(h.length,p.length)}(n.mapValue,e.mapValue);default:throw F(23264,{he:t})}}function _h(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return K(n,e);let t=nt(n),r=nt(e),i=K(t.seconds,r.seconds);return i!==0?i:K(t.nanos,r.nanos)}function yh(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=An(t[i],r[i]);if(o)return o}return K(t.length,r.length)}function bn(n){return Ko(n)}function Ko(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=nt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return rt(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return M.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=Ko(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${Ko(t.fields[a])}`;return i+"}"}(n.mapValue):F(61005,{value:n})}function gi(n){switch(bt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=es(n);return e?16+gi(e):16;case 5:return 2*n.stringValue.length;case 6:return rt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+gi(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return Nt(r.fields,(o,a)=>{i+=o.length+gi(a)}),i}(n.mapValue);default:throw F(13486,{value:n})}}function Ih(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Wo(n){return!!n&&"integerValue"in n}function Pc(n){return!!n&&"arrayValue"in n}function Eh(n){return!!n&&"nullValue"in n}function wh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function _i(n){return!!n&&"mapValue"in n}function vd(n){return(n?.mapValue?.fields||{})[Sc]?.stringValue===Rc}function hr(n){if(n.geoPointValue)return{geoPointValue:L({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:L({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Nt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=hr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=hr(n.arrayValue.values[t]);return e}return L({},n)}function Ad(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Td}var jE={mapValue:{fields:{[Sc]:{stringValue:Rc},[vn]:{arrayValue:{}}}}};var Pe=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!_i(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hr(t)}setAll(e){let t=Ce.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=hr(a):i.push(u.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());_i(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ge(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];_i(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Nt(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(hr(this.value))}};function bd(n){let e=[];return Nt(n.fields,(t,r)=>{let i=new Ce([t]);if(_i(r)){let o=bd(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Oe(e)}var Me=class n{constructor(e,t,r,i,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,j.min(),j.min(),j.min(),Pe.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,j.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,j.min(),j.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,j.min(),j.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Sn=class{constructor(e,t){this.position=e,this.inclusive=t}};function Th(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),t.key):r=An(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function vh(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ge(n.position[t],e.position[t]))return!1;return!0}var Ht=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Bg(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var bi=class{},ae=class n extends bi{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Qo(e,t,r):t==="array-contains"?new Xo(e,r):t==="in"?new Zo(e,r):t==="not-in"?new ea(e,r):t==="array-contains-any"?new ta(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Jo(e,r):new Yo(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(An(t,this.value)):t!==null&&bt(this.value)===bt(t)&&this.matchesComparison(An(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Fe=class n extends bi{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return Sd(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Sd(n){return n.op==="and"}function Rd(n){return qg(n)&&Sd(n)}function qg(n){for(let e of n.filters)if(e instanceof Fe)return!1;return!0}function Ho(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+bn(n.value);if(Rd(n))return n.filters.map(e=>Ho(e)).join(",");{let e=n.filters.map(t=>Ho(t)).join(",");return`${n.op}(${e})`}}function Pd(n,e){return n instanceof ae?function(r,i){return i instanceof ae&&r.op===i.op&&r.field.isEqual(i.field)&&Ge(r.value,i.value)}(n,e):n instanceof Fe?function(r,i){return i instanceof Fe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,u)=>o&&Pd(a,i.filters[u]),!0):!1}(n,e):void F(19439)}function Cd(n){return n instanceof ae?function(t){return`${t.field.canonicalString()} ${t.op} ${bn(t.value)}`}(n):n instanceof Fe?function(t){return t.op.toString()+" {"+t.getFilters().map(Cd).join(" ,")+"}"}(n):"Filter"}var Qo=class extends ae{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){let t=M.comparator(e.key,this.key);return this.matchesComparison(t)}},Jo=class extends ae{constructor(e,t){super(e,"in",t),this.keys=Nd("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Yo=class extends ae{constructor(e,t){super(e,"not-in",t),this.keys=Nd("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Nd(n,e){return(e.arrayValue?.values||[]).map(t=>M.fromName(t.referenceValue))}var Xo=class extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Pc(t)&&Er(t.arrayValue,this.value)}},Zo=class extends ae{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Er(this.value.arrayValue,t)}},ea=class extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Er(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Er(this.value.arrayValue,t)}},ta=class extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Pc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Er(this.value.arrayValue,r))}};var na=class{constructor(e,t=null,r=[],i=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}};function Ah(n,e=null,t=[],r=[],i=null,o=null,a=null){return new na(n,e,t,r,i,o,a)}function Cc(n){let e=q(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ho(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),Zi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>bn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>bn(r)).join(",")),e.Te=t}return e.Te}function Nc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Bg(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Pd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!vh(n.startAt,e.startAt)&&vh(n.endAt,e.endAt)}function ra(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var St=class{constructor(e,t=null,r=[],i=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function jg(n,e,t,r,i,o,a,u){return new St(n,e,t,r,i,o,a,u)}function Dc(n){return new St(n)}function bh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Dd(n){return n.collectionGroup!==null}function dr(n){let e=q(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new me(Ce.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Ht(o,r))}),t.has(Ce.keyField().canonicalString())||e.Ie.push(new Ht(Ce.keyField(),r))}return e.Ie}function ze(n){let e=q(n);return e.Ee||(e.Ee=zg(e,dr(n))),e.Ee}function zg(n,e){if(n.limitType==="F")return Ah(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new Ht(i.field,o)});let t=n.endAt?new Sn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Sn(n.startAt.position,n.startAt.inclusive):null;return Ah(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ia(n,e){let t=n.filters.concat([e]);return new St(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Si(n,e,t){return new St(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ts(n,e){return Nc(ze(n),ze(e))&&n.limitType===e.limitType}function kd(n){return`${Cc(ze(n))}|lt:${n.limitType}`}function pn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Cd(i)).join(", ")}]`),Zi(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>bn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>bn(i)).join(",")),`Target(${r})`}(ze(n))}; limitType=${n.limitType})`}function ns(n,e){return e.isFoundDocument()&&function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(let o of dr(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,u,h){let d=Th(a,u,h);return a.inclusive?d<=0:d<0}(r.startAt,dr(r),i)||r.endAt&&!function(a,u,h){let d=Th(a,u,h);return a.inclusive?d>=0:d>0}(r.endAt,dr(r),i))}(n,e)}function $g(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Od(n){return(e,t)=>{let r=!1;for(let i of dr(n)){let o=Gg(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function Gg(n,e,t){let r=n.field.isKeyField()?M.comparator(e.key,t.key):function(o,a,u){let h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?An(h,d):F(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F(19790,{direction:n.dir})}}var it=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Nt(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return _d(this.inner)}size(){return this.innerSize}};var Kg=new re(M.comparator);function st(){return Kg}var Vd=new re(M.comparator);function lr(...n){let e=Vd;for(let t of n)e=e.insert(t.key,t);return e}function xd(n){let e=Vd;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function jt(){return fr()}function Ld(){return fr()}function fr(){return new it(n=>n.toString(),(n,e)=>n.isEqual(e))}var Wg=new re(M.comparator),Hg=new me(M.comparator);function W(...n){let e=Hg;for(let t of n)e=e.add(t);return e}var Qg=new me(K);function Jg(){return Qg}function kc(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_r(e)?"-0":e}}function Md(n){return{integerValue:""+n}}function Yg(n,e){return Sg(e)?Md(e):kc(n,e)}var Rn=class{constructor(){this._=void 0}};function Xg(n,e,t){return n instanceof Pn?function(i,o){let a={fields:{[Id]:{stringValue:yd},[wd]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&bc(o)&&(o=es(o)),o&&(a.fields[Ed]=o),{mapValue:a}}(t,e):n instanceof Qt?Ud(n,e):n instanceof Jt?Bd(n,e):function(i,o){let a=Fd(i,o),u=Sh(a)+Sh(i.Ae);return Wo(a)&&Wo(i.Ae)?Md(u):kc(i.serializer,u)}(n,e)}function Zg(n,e,t){return n instanceof Qt?Ud(n,e):n instanceof Jt?Bd(n,e):t}function Fd(n,e){return n instanceof Cn?function(r){return Wo(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}var Pn=class extends Rn{},Qt=class extends Rn{constructor(e){super(),this.elements=e}};function Ud(n,e){let t=qd(e);for(let r of n.elements)t.some(i=>Ge(i,r))||t.push(r);return{arrayValue:{values:t}}}var Jt=class extends Rn{constructor(e){super(),this.elements=e}};function Bd(n,e){let t=qd(e);for(let r of n.elements)t=t.filter(i=>!Ge(i,r));return{arrayValue:{values:t}}}var Cn=class extends Rn{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function Sh(n){return ee(n.integerValue||n.doubleValue)}function qd(n){return Pc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function e_(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Qt&&i instanceof Qt||r instanceof Jt&&i instanceof Jt?Tn(r.elements,i.elements,Ge):r instanceof Cn&&i instanceof Cn?Ge(r.Ae,i.Ae):r instanceof Pn&&i instanceof Pn}(n.transform,e.transform)}var sa=class{constructor(e,t){this.version=e,this.transformResults=t}},Ne=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function yi(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Nn=class{};function jd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Dn(n.key,Ne.none()):new Yt(n.key,n.data,Ne.none());{let t=n.data,r=Pe.empty(),i=new me(Ce.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new Ke(n.key,r,new Oe(i.toArray()),Ne.none())}}function t_(n,e,t){n instanceof Yt?function(i,o,a){let u=i.value.clone(),h=Ph(i.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):n instanceof Ke?function(i,o,a){if(!yi(i.precondition,o))return void o.convertToUnknownDocument(a.version);let u=Ph(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(zd(i)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function pr(n,e,t,r){return n instanceof Yt?function(o,a,u,h){if(!yi(o.precondition,a))return u;let d=o.value.clone(),p=Ch(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ke?function(o,a,u,h){if(!yi(o.precondition,a))return u;let d=Ch(o.fieldTransforms,h,a),p=a.data;return p.setAll(zd(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(I=>I.field))}(n,e,t,r):function(o,a,u){return yi(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(n,e,t)}function n_(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=Fd(r.transform,i||null);o!=null&&(t===null&&(t=Pe.empty()),t.set(r.field,o))}return t||null}function Rh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Tn(r,i,(o,a)=>e_(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Yt=class extends Nn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ke=class extends Nn{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function zd(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Ph(n,e,t){let r=new Map;Y(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,Zg(a,u,t[i]))}return r}function Ch(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,Xg(o,a,e))}return r}var Dn=class extends Nn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},oa=class extends Nn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var aa=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&t_(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=pr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=pr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Ld();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,u=this.applyToLocalView(a,o.mutatedFields);u=t.has(i.key)?null:u;let h=jd(a,u);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(j.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),W())}isEqual(e){return this.batchId===e.batchId&&Tn(this.mutations,e.mutations,(t,r)=>Rh(t,r))&&Tn(this.baseMutations,e.baseMutations,(t,r)=>Rh(t,r))}},ca=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Y(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=function(){return Wg}(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var ua=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var la=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var se,Q;function r_(n){switch(n){case P.OK:return F(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return F(15467,{code:n})}}function $d(n){if(n===void 0)return tt("GRPC error has no .code"),P.UNKNOWN;switch(n){case se.OK:return P.OK;case se.CANCELLED:return P.CANCELLED;case se.UNKNOWN:return P.UNKNOWN;case se.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case se.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case se.INTERNAL:return P.INTERNAL;case se.UNAVAILABLE:return P.UNAVAILABLE;case se.UNAUTHENTICATED:return P.UNAUTHENTICATED;case se.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case se.NOT_FOUND:return P.NOT_FOUND;case se.ALREADY_EXISTS:return P.ALREADY_EXISTS;case se.PERMISSION_DENIED:return P.PERMISSION_DENIED;case se.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case se.ABORTED:return P.ABORTED;case se.OUT_OF_RANGE:return P.OUT_OF_RANGE;case se.UNIMPLEMENTED:return P.UNIMPLEMENTED;case se.DATA_LOSS:return P.DATA_LOSS;default:return F(39323,{code:n})}}(Q=se||(se={}))[Q.OK=0]="OK",Q[Q.CANCELLED=1]="CANCELLED",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Q[Q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Q[Q.NOT_FOUND=5]="NOT_FOUND",Q[Q.ALREADY_EXISTS=6]="ALREADY_EXISTS",Q[Q.PERMISSION_DENIED=7]="PERMISSION_DENIED",Q[Q.UNAUTHENTICATED=16]="UNAUTHENTICATED",Q[Q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Q[Q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Q[Q.ABORTED=10]="ABORTED",Q[Q.OUT_OF_RANGE=11]="OUT_OF_RANGE",Q[Q.UNIMPLEMENTED=12]="UNIMPLEMENTED",Q[Q.INTERNAL=13]="INTERNAL",Q[Q.UNAVAILABLE=14]="UNAVAILABLE",Q[Q.DATA_LOSS=15]="DATA_LOSS";var i_=null;function s_(){return new TextEncoder}var o_=new Xe([4294967295,4294967295],0);function Nh(n){let e=s_().encode(n),t=new Ao;return t.update(e),new Uint8Array(t.digest())}function Dh(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Xe([t,r],0),new Xe([i,o],0)]}var ha=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new zt(`Invalid padding: ${t}`);if(r<0)throw new zt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new zt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new zt(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Xe.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Xe.fromNumber(r)));return i.compare(o_)===1&&(i=new Xe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=Nh(e),[r,i]=Dh(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);if(!this.we(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.ge===0)return;let t=Nh(e),[r,i]=Dh(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);this.Se(a)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},zt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ri=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,wr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(j.min(),i,new re(K),st(),W())}},wr=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,W(),W(),W())}};var yn=class{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}},Pi=class{constructor(e,t){this.targetId=e,this.Ce=t}},Ci=class{constructor(e,t,r=Ee.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Ni=class{constructor(){this.ve=0,this.Fe=kh(),this.Me=Ee.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=W(),t=W(),r=W();return this.Fe.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:F(38017,{changeType:o})}}),new wr(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=kh()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Y(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},da=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=st(),this.Je=pi(),this.He=pi(),this.Ye=new re(K)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:F(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,i)=>{this.rt(i)&&t(i)})}st(e){let t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){let o=i.target;if(ra(o))if(r===0){let a=new M(o.path);this.et(t,a,Me.newNoDocument(a,j.min()))}else Y(r===1,20013,{expectedCount:r});else{let a=this._t(t);if(a!==r){let u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}i_?.lt(function(p,I,T,R,O){let x={localCacheCount:p,existenceFilterCount:I.count,databaseId:T.database,projectId:T.projectId},N=I.unchangedNames;return N&&(x.bloomFilter={applied:O===0,hashCount:N?.hashCount??0,bitmapLength:N?.bits?.bitmap?.length??0,padding:N?.bits?.padding??0,mightContain:z=>R?.mightContain(z)??!1}),x}(a,e.Ce,this.Ge.ht(),u,h))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,u;try{a=rt(r).toUint8Array()}catch(h){if(h instanceof vi)return wn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new ha(a,i,o)}catch(h){return wn(h instanceof zt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((o,a)=>{let u=this.ot(a);if(u){if(o.current&&ra(u.target)){let h=new M(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Me.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}});let r=W();this.He.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{let d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.je.forEach((o,a)=>a.setReadTime(e));let i=new Ri(e,t,this.Ye,this.je,r);return this.je=st(),this.Je=pi(),this.He=pi(),this.Ye=new re(K),i}Xe(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Ni,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new me(K),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new me(K),this.Je=this.Je.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ni),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function pi(){return new re(M.comparator)}function kh(){return new re(M.comparator)}var a_={asc:"ASCENDING",desc:"DESCENDING"},c_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},u_={and:"AND",or:"OR"},fa=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function pa(n,e){return n.useProto3Json||Zi(e)?e:{value:e}}function Di(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Gd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function l_(n,e){return Di(n,e.toTimestamp())}function $e(n){return Y(!!n,49232),j.fromTimestamp(function(t){let r=nt(t);return new ue(r.seconds,r.nanos)}(n))}function Oc(n,e){return ma(n,e).canonicalString()}function ma(n,e){let t=function(i){return new te(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Kd(n){let e=te.fromString(n);return Y(Yd(e),10190,{key:e.toString()}),e}function ga(n,e){return Oc(n.databaseId,e.path)}function Do(n,e){let t=Kd(e);if(t.get(1)!==n.databaseId.projectId)throw new k(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new k(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(Hd(t))}function Wd(n,e){return Oc(n.databaseId,e)}function h_(n){let e=Kd(n);return e.length===4?te.emptyPath():Hd(e)}function _a(n){return new te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Hd(n){return Y(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Oh(n,e,t){return{name:ga(n,e),fields:t.value.mapValue.fields}}function d_(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:F(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(d,p){return d.useProto3Json?(Y(p===void 0||typeof p=="string",58123),Ee.fromBase64String(p||"")):(Y(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Ee.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(d){let p=d.code===void 0?P.UNKNOWN:$d(d.code);return new k(p,d.message||"")}(a);t=new Ci(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Do(n,r.document.name),o=$e(r.document.updateTime),a=r.document.createTime?$e(r.document.createTime):j.min(),u=new Pe({mapValue:{fields:r.document.fields}}),h=Me.newFoundDocument(i,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new yn(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Do(n,r.document),o=r.readTime?$e(r.readTime):j.min(),a=Me.newNoDocument(i,o),u=r.removedTargetIds||[];t=new yn([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Do(n,r.document),o=r.removedTargetIds||[];t=new yn([],o,i,null)}else{if(!("filter"in e))return F(11601,{Rt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new la(i,o),u=r.targetId;t=new Pi(u,a)}}return t}function f_(n,e){let t;if(e instanceof Yt)t={update:Oh(n,e.key,e.value)};else if(e instanceof Dn)t={delete:ga(n,e.key)};else if(e instanceof Ke)t={update:Oh(n,e.key,e.data),updateMask:T_(e.fieldMask)};else{if(!(e instanceof oa))return F(16599,{Vt:e.type});t={verify:ga(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){let u=a.transform;if(u instanceof Pn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Qt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Jt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Cn)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw F(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:l_(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:F(27497)}(n,e.precondition)),t}function p_(n,e){return n&&n.length>0?(Y(e!==void 0,14353),n.map(t=>function(i,o){let a=i.updateTime?$e(i.updateTime):$e(o);return a.isEqual(j.min())&&(a=$e(o)),new sa(a,i.transformResults||[])}(t,e))):[]}function m_(n,e){return{documents:[Wd(n,e.path)]}}function g_(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Wd(n,i);let o=function(d){if(d.length!==0)return Jd(Fe.create(d,"and"))}(e.filters);o&&(t.structuredQuery.where=o);let a=function(d){if(d.length!==0)return d.map(p=>function(T){return{field:mn(T.field),direction:I_(T.dir)}}(p))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=pa(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:t,parent:i}}function __(n){let e=h_(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Y(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=function(I){let T=Qd(I);return T instanceof Fe&&Rd(T)?T.getFilters():[T]}(t.where));let a=[];t.orderBy&&(a=function(I){return I.map(T=>function(O){return new Ht(gn(O.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(O.direction))}(T))}(t.orderBy));let u=null;t.limit&&(u=function(I){let T;return T=typeof I=="object"?I.value:I,Zi(T)?null:T}(t.limit));let h=null;t.startAt&&(h=function(I){let T=!!I.before,R=I.values||[];return new Sn(R,T)}(t.startAt));let d=null;return t.endAt&&(d=function(I){let T=!I.before,R=I.values||[];return new Sn(R,T)}(t.endAt)),jg(e,i,a,o,u,"F",h,d)}function y_(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Qd(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=gn(t.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=gn(t.unaryFilter.field);return ae.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=gn(t.unaryFilter.field);return ae.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=gn(t.unaryFilter.field);return ae.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(n):n.fieldFilter!==void 0?function(t){return ae.create(gn(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Fe.create(t.compositeFilter.filters.map(r=>Qd(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(t.compositeFilter.op))}(n):F(30097,{filter:n})}function I_(n){return a_[n]}function E_(n){return c_[n]}function w_(n){return u_[n]}function mn(n){return{fieldPath:n.canonicalString()}}function gn(n){return Ce.fromServerFormat(n.fieldPath)}function Jd(n){return n instanceof ae?function(t){if(t.op==="=="){if(wh(t.value))return{unaryFilter:{field:mn(t.field),op:"IS_NAN"}};if(Eh(t.value))return{unaryFilter:{field:mn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(wh(t.value))return{unaryFilter:{field:mn(t.field),op:"IS_NOT_NAN"}};if(Eh(t.value))return{unaryFilter:{field:mn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mn(t.field),op:E_(t.op),value:t.value}}}(n):n instanceof Fe?function(t){let r=t.getFilters().map(i=>Jd(i));return r.length===1?r[0]:{compositeFilter:{op:w_(t.op),filters:r}}}(n):F(54877,{filter:n})}function T_(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Yd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Tr=class n{constructor(e,t,r,i,o=j.min(),a=j.min(),u=Ee.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var ya=class{constructor(e){this.yt=e}};function v_(n){let e=__({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Si(e,e.limit,"L"):e}var ki=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ee(e.integerValue));else if("doubleValue"in e){let r=ee(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),_r(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=nt(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(rt(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?Ad(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):vd(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):F(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=vn,o=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ee(o)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),M.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};ki.Kt=new ki;var Ia=class{constructor(){this.Cn=new Ea}addToCollectionParentIndex(e,t){return this.Cn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(Wt.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(Wt.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},Ea=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new me(te.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new me(te.comparator)).toArray()}};var zE=new Uint8Array(0);var Vh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Xd=41943040,ke=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};ke.DEFAULT_COLLECTION_PERCENTILE=10,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ke.DEFAULT=new ke(Xd,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ke.DISABLED=new ke(-1,0,0);var vr=class n{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var xh="LruGarbageCollector",Zd=1048576;function Lh([n,e],[t,r]){let i=K(n,t);return i===0?K(e,r):i}var wa=class{constructor(e){this.Ir=e,this.buffer=new me(Lh),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Lh(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ta=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){V(xh,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>y(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ln(t)?V(xh,"Ignoring IndexedDB error during garbage collection: ",t):yield xn(t)}yield this.Vr(3e5)}))}},va=class{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(vc.ce);let r=new wa(t);return this.mr.forEachTarget(e,i=>r.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>r.Ar(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Vh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Vh):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,o,a,u,h,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),i=this.params.maximumSequenceNumbersToCollect):i=I,a=Date.now(),this.nthSequenceNumber(e,i))).next(I=>(r=I,u=Date.now(),this.removeTargets(e,r,t))).next(I=>(o=I,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(I=>(d=Date.now(),fn()<=G.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${I} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:I})))}};function A_(n,e){return new va(n,e)}var Aa=class{constructor(){this.changes=new it(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var ba=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Sa=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&pr(r.mutation,i,Oe.empty(),ue.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,W()).next(()=>r))}getLocalViewOfDocuments(e,t,r=W()){let i=jt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=lr();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=jt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,W()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let o=st(),a=fr(),u=function(){return fr()}();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof Ke)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),pr(p.mutation,d,p.mutation.getFieldMask(),ue.now())):a.set(d.key,Oe.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>u.set(d,new ba(p,a.get(d)??null))),u))}recalculateAndSaveOverlays(e,t){let r=fr(),i=new re((a,u)=>a-u),o=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||Oe.empty();p=u.applyToLocalView(d,p),r.set(h,p);let I=(i.get(u.batchId)||W()).add(h);i=i.insert(u.batchId,I)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let h=u.getNext(),d=h.key,p=h.value,I=Ld();p.forEach(T=>{if(!o.has(T)){let R=jd(t.get(T),r.get(T));R!==null&&I.set(T,R),o=o.add(T)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,I))}return C.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Dd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):C.resolve(jt()),u=gr,h=o;return a.next(d=>C.forEach(d,(p,I)=>(u<I.largestBatchId&&(u=I.largestBatchId),o.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next(T=>{h=h.insert(p,T)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,h,d,W())).next(p=>({batchId:u,changes:xd(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=lr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=lr();return this.indexManager.getCollectionParents(e,o).next(u=>C.forEach(u,h=>{let d=function(I,T){return new St(T,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((I,T)=>{a=a.insert(I,T)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,Me.newInvalidDocument(p)))});let u=lr();return a.forEach((h,d)=>{let p=o.get(h);p!==void 0&&pr(p.mutation,d,Oe.empty(),ue.now()),ns(t,d)&&(u=u.insert(h,d))}),u})}};var Ra=class{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return C.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:$e(i.createTime)}}(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(i){return{name:i.name,query:v_(i.bundledQuery),readTime:$e(i.readTime)}}(t)),C.resolve()}};var Pa=class{constructor(){this.overlays=new re(M.comparator),this.qr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=jt();return C.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.St(e,t,o)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.qr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=jt(),o=t.length+1,a=new M(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new re((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=jt(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=jt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return C.resolve(u)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new ua(t,r));let o=this.qr.get(t);o===void 0&&(o=W(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}};var Ca=class{constructor(){this.sessionToken=Ee.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Ar=class{constructor(){this.Qr=new me(oe.$r),this.Ur=new me(oe.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new oe(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new oe(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){let t=new M(new te([])),r=new oe(t,e),i=new oe(t,e+1),o=[];return this.Ur.forEachInRange([r,i],a=>{this.Gr(a),o.push(a.key)}),o}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new M(new te([])),r=new oe(t,e),i=new oe(t,e+1),o=W();return this.Ur.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new oe(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},oe=class{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return M.comparator(e.key,t.key)||K(e.Yr,t.Yr)}static Kr(e,t){return K(e.Yr,t.Yr)||M.comparator(e.key,t.key)}};var Na=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new me(oe.$r)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new aa(o,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Zr=this.Zr.add(new oe(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.ei(r),o=i<0?0:i;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?Ac:this.tr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new oe(t,0),i=new oe(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],a=>{let u=this.Xr(a.Yr);o.push(u)}),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new me(K);return t.forEach(i=>{let o=new oe(i,0),a=new oe(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],u=>{r=r.add(u.Yr)})}),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;M.isDocumentKey(o)||(o=o.child(""));let a=new oe(new M(o),0),u=new me(K);return this.Zr.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(h.Yr)),!0)},a),C.resolve(this.ti(u))}ti(e){let t=[];return e.forEach(r=>{let i=this.Xr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Y(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return C.forEach(t.mutations,i=>{let o=new oe(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new oe(t,0),i=this.Zr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Da=class{constructor(e){this.ri=e,this.docs=function(){return new re(M.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let r=st();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Me.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=st(),a=t.path,u=new M(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||vg(Tg(p),r)<=0||(i.has(p.key)||ns(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(e,t,r,i){F(9500)}ii(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ka(this)}getSize(e){return C.resolve(this.size)}},ka=class extends Aa{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}};var Oa=class{constructor(e){this.persistence=e,this.si=new it(t=>Cc(t),Nc),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.oi=0,this._i=new Ar,this.targetCount=0,this.ai=vr.ur()}forEachTarget(e,t){return this.si.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),C.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new vr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Pr(t),C.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.si.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),C.waitFor(o).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this._i.containsKey(t))}};var Oi=class{constructor(e,t){this.ui={},this.overlays={},this.ci=new vc(0),this.li=!1,this.li=!0,this.hi=new Ca,this.referenceDelegate=e(this),this.Pi=new Oa(this),this.indexManager=new Ia,this.remoteDocumentCache=function(i){return new Da(i)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new ya(t),this.Ii=new Ra(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Pa,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new Na(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new Va(this.ci.next());return this.referenceDelegate.Ei(),r(i).next(o=>this.referenceDelegate.di(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ai(e,t){return C.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}},Va=class extends $o{constructor(e){super(),this.currentSequenceNumber=e}},xa=class n{constructor(e){this.persistence=e,this.Ri=new Ar,this.Vi=null}static mi(e){return new n(e)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.fi.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,r=>{let i=M.fromPath(r);return this.gi(e,i).next(o=>{o||t.removeEntry(i,j.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return C.or([()=>C.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}},Vi=class n{constructor(e,t){this.persistence=e,this.pi=new it(r=>Rg(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=A_(this,t)}static mi(e,t){return new n(e,t)}Ei(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return C.forEach(this.pi,(r,i)=>this.br(e,r,i).next(o=>o?C.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,a=>this.br(e,a,t).next(u=>{u||(r++,o.removeEntry(a,j.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=gi(e.data.value)),t}br(e,t,r){return C.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.pi.get(t);return C.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var La=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=W(),i=W();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var Ma=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Fa=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return ql()?8:bg(fe())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.ys(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ws(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new Ma;return this.Ss(e,t,a).next(u=>{if(o.result=u,this.Vs)return this.bs(e,t,a,u.size)})}).next(()=>o.result)}bs(e,t,r,i){return r.documentReadCount<this.fs?(fn()<=G.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",pn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(fn()<=G.DEBUG&&V("QueryEngine","Query:",pn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(fn()<=G.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",pn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ze(t))):C.resolve())}ys(e,t){if(bh(t))return C.resolve(null);let r=ze(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Si(t,null,"F"),r=ze(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=W(...o);return this.ps.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.Ds(t,u);return this.Cs(t,d,a,h.readTime)?this.ys(e,Si(t,null,"F")):this.vs(e,d,t,h)}))})))}ws(e,t,r,i){return bh(t)||i.isEqual(j.min())?C.resolve(null):this.ps.getDocuments(e,r).next(o=>{let a=this.Ds(t,o);return this.Cs(t,a,r,i)?C.resolve(null):(fn()<=G.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),pn(t)),this.vs(e,a,t,wg(i,gr)).next(u=>u))})}Ds(e,t){let r=new me(Od(e));return t.forEach((i,o)=>{ns(e,o)&&(r=r.add(o))}),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,t,r){return fn()<=G.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",pn(t)),this.ps.getDocumentsMatchingQuery(e,t,Wt.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Vc="LocalStore",b_=3e8,Ua=class{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new re(K),this.xs=new it(o=>Cc(o),Nc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Sa(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}};function S_(n,e,t,r){return new Ua(n,e,t,r)}function ef(n,e){return y(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],u=[],h=W();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of o){u.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:u}))})})})}function R_(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return function(u,h,d,p){let I=d.batch,T=I.keys(),R=C.resolve();return T.forEach(O=>{R=R.next(()=>p.getEntry(h,O)).next(x=>{let N=d.docVersions.get(O);Y(N!==null,48541),x.version.compareTo(N)<0&&(I.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),p.addEntry(x)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(h,I))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=W();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function tf(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function P_(n,e){let t=q(n),r=e.snapshotVersion,i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;let u=[];e.targetChanges.forEach((p,I)=>{let T=i.get(I);if(!T)return;u.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,I).next(()=>t.Pi.addMatchingKeys(o,p.addedDocuments,I)));let R=T.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(I)!==null?R=R.withResumeToken(Ee.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(I,R),function(x,N,z){return x.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=b_?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(T,R,p)&&u.push(t.Pi.updateTargetData(o,R))});let h=st(),d=W();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),u.push(C_(o,a,e.documentUpdates).next(p=>{h=p.ks,d=p.qs})),!r.isEqual(j.min())){let p=t.Pi.getLastRemoteSnapshotVersion(o).next(I=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(p)}return C.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,d)).next(()=>h)}).then(o=>(t.Ms=i,o))}function C_(n,e,t){let r=W(),i=W();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=st();return t.forEach((u,h)=>{let d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(j.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):V(Vc,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)}),{ks:a,qs:i}})}function N_(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Ac),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function D_(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Pi.getTargetData(r,e).next(o=>o?(i=o,C.resolve(i)):t.Pi.allocateTargetId(r).next(a=>(i=new Tr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}function Ba(n,e,t){return y(this,null,function*(){let r=q(n),i=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Ln(a))throw a;V(Vc,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)})}function Mh(n,e,t){let r=q(n),i=j.min(),o=W();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,d,p){let I=q(h),T=I.xs.get(p);return T!==void 0?C.resolve(I.Ms.get(T)):I.Pi.getTargetData(d,p)}(r,a,ze(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>r.Fs.getDocumentsMatchingQuery(a,e,t?i:j.min(),t?o:W())).next(u=>(k_(r,$g(e),u),{documents:u,Qs:o})))}function k_(n,e,t){let r=n.Os.get(e)||j.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Os.set(e,r)}var xi=class{constructor(){this.activeTargetIds=Jg()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var qa=class{constructor(){this.Mo=new xi,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new xi,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var ja=class{Oo(e){}shutdown(){}};var Fh="ConnectivityMonitor",Li=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){V(Fh,"Network connectivity changed: AVAILABLE");for(let e of this.qo)e(0)}ko(){V(Fh,"Network connectivity changed: UNAVAILABLE");for(let e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var mi=null;function za(){return mi===null?mi=function(){return 268435456+Math.round(2147483648*Math.random())}():mi++,"0x"+mi.toString(16)}var ko="RestConnection",O_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},$a=class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Ir?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,o){let a=za(),u=this.zo(e,t.toUriEncodedString());V(ko,`Sending RPC '${e}' ${a}:`,u,r);let h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);let{host:d}=new URL(u),p=Je(d);return this.Jo(e,u,h,r,p).then(I=>(V(ko,`Received RPC '${e}' ${a}: `,I),I),I=>{throw wn(ko,`RPC '${e}' ${a} failed with error: `,I,"url: ",u,"request:",r),I})}Ho(e,t,r,i,o,a){return this.Go(e,t,r,i,o)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Vn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}zo(e,t){let r=O_[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}};var Ga=class{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}};var Ie="WebChannelConnection",Ka=class extends $a{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,o){let a=za();return new Promise((u,h)=>{let d=new bo;d.setWithCredentials(!0),d.listenOnce(So.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case ur.NO_ERROR:let I=d.getResponseJson();V(Ie,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(I)),u(I);break;case ur.TIMEOUT:V(Ie,`RPC '${e}' ${a} timed out`),h(new k(P.DEADLINE_EXCEEDED,"Request time out"));break;case ur.HTTP_ERROR:let T=d.getStatus();if(V(Ie,`RPC '${e}' ${a} failed with status:`,T,"response text:",d.getResponseText()),T>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let O=R?.error;if(O&&O.status&&O.message){let x=function(z){let B=z.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(B)>=0?B:P.UNKNOWN}(O.status);h(new k(x,O.message))}else h(new k(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new k(P.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{V(Ie,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);V(Ie,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}T_(e,t,r){let i=za(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Co(),u=Po(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let p=o.join("");V(Ie,`Creating RPC '${e}' stream ${i}: ${p}`,h);let I=a.createWebChannel(p,h);this.I_(I);let T=!1,R=!1,O=new Ga({Yo:N=>{R?V(Ie,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(T||(V(Ie,`Opening RPC '${e}' stream ${i} transport.`),I.open(),T=!0),V(Ie,`RPC '${e}' stream ${i} sending:`,N),I.send(N))},Zo:()=>I.close()}),x=(N,z,B)=>{N.listen(z,H=>{try{B(H)}catch(_e){setTimeout(()=>{throw _e},0)}})};return x(I,dn.EventType.OPEN,()=>{R||(V(Ie,`RPC '${e}' stream ${i} transport opened.`),O.o_())}),x(I,dn.EventType.CLOSE,()=>{R||(R=!0,V(Ie,`RPC '${e}' stream ${i} transport closed`),O.a_(),this.E_(I))}),x(I,dn.EventType.ERROR,N=>{R||(R=!0,wn(Ie,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),O.a_(new k(P.UNAVAILABLE,"The operation could not be completed")))}),x(I,dn.EventType.MESSAGE,N=>{if(!R){let z=N.data[0];Y(!!z,16349);let B=z,H=B?.error||B[0]?.error;if(H){V(Ie,`RPC '${e}' stream ${i} received error:`,H);let _e=H.status,ve=function(m){let _=se[m];if(_!==void 0)return $d(_)}(_e),he=H.message;ve===void 0&&(ve=P.INTERNAL,he="Unknown error status: "+_e+" with message "+H.message),R=!0,O.a_(new k(ve,he)),I.close()}else V(Ie,`RPC '${e}' stream ${i} received:`,z),O.u_(z)}}),x(u,Ro.STAT_EVENT,N=>{N.stat===di.PROXY?V(Ie,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===di.NOPROXY&&V(Ie,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{O.__()},0),O}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}};function Oo(){return typeof document<"u"?document:null}function rs(n){return new fa(n,!0)}var Mi=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var Uh="PersistentStream",Fi=class{constructor(e,t,r,i,o,a,u,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Mi(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return y(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return y(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return y(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(tt(t.toString()),tt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===t&&this.G_(r,i)},r=>{e(()=>{let i=new k(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(()=>y(this,null,function*(){this.state=0,this.start()}))}z_(e){return V(Uh,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(V(Uh,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Wa=class extends Fi{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=d_(this.serializer,e),r=function(o){if(!("targetChange"in o))return j.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?j.min():a.readTime?$e(a.readTime):j.min()}(e);return this.listener.H_(t,r)}Y_(e){let t={};t.database=_a(this.serializer),t.addTarget=function(o,a){let u,h=a.target;if(u=ra(h)?{documents:m_(o,h)}:{query:g_(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Gd(o,a.resumeToken);let d=pa(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(j.min())>0){u.readTime=Di(o,a.snapshotVersion.toTimestamp());let d=pa(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,e);let r=y_(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){let t={};t.database=_a(this.serializer),t.removeTarget=e,this.q_(t)}},Ha=class extends Fi{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Y(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Y(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Y(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=p_(e.writeResults,e.commitTime),r=$e(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=_a(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>f_(this.serializer,r))};this.q_(t)}};var Qa=class{},Ja=class extends Qa{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new k(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Go(e,ma(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(P.UNKNOWN,o.toString())})}Ho(e,t,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Ho(e,ma(t,r),i,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new k(P.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},Ya=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tt(t),this.aa=!1):V("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Xt="RemoteStore",Xa=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo(a=>{r.enqueueAndForget(()=>y(this,null,function*(){en(this)&&(V(Xt,"Restarting streams for network reachability change."),yield function(h){return y(this,null,function*(){let d=q(h);d.Ea.add(4),yield Cr(d),d.Ra.set("Unknown"),d.Ea.delete(4),yield is(d)})}(this))}))}),this.Ra=new Ya(r,i)}};function is(n){return y(this,null,function*(){if(en(n))for(let e of n.da)yield e(!0)})}function Cr(n){return y(this,null,function*(){for(let e of n.da)yield e(!1)})}function nf(n,e){let t=q(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Fc(t)?Mc(t):Mn(t).O_()&&Lc(t,e))}function xc(n,e){let t=q(n),r=Mn(t);t.Ia.delete(e),r.O_()&&rf(t,e),t.Ia.size===0&&(r.O_()?r.L_():en(t)&&t.Ra.set("Unknown"))}function Lc(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Mn(n).Y_(e)}function rf(n,e){n.Va.Ue(e),Mn(n).Z_(e)}function Mc(n){n.Va=new da({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Mn(n).start(),n.Ra.ua()}function Fc(n){return en(n)&&!Mn(n).x_()&&n.Ia.size>0}function en(n){return q(n).Ea.size===0}function sf(n){n.Va=void 0}function V_(n){return y(this,null,function*(){n.Ra.set("Online")})}function x_(n){return y(this,null,function*(){n.Ia.forEach((e,t)=>{Lc(n,e)})})}function L_(n,e){return y(this,null,function*(){sf(n),Fc(n)?(n.Ra.ha(e),Mc(n)):n.Ra.set("Unknown")})}function M_(n,e,t){return y(this,null,function*(){if(n.Ra.set("Online"),e instanceof Ci&&e.state===2&&e.cause)try{yield function(i,o){return y(this,null,function*(){let a=o.cause;for(let u of o.targetIds)i.Ia.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.Ia.delete(u),i.Va.removeTarget(u))})}(n,e)}catch(r){V(Xt,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ui(n,r)}else if(e instanceof yn?n.Va.Ze(e):e instanceof Pi?n.Va.st(e):n.Va.tt(e),!t.isEqual(j.min()))try{let r=yield tf(n.localStore);t.compareTo(r)>=0&&(yield function(o,a){let u=o.Va.Tt(a);return u.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,d)=>{let p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Ee.EMPTY_BYTE_STRING,p.snapshotVersion)),rf(o,h);let I=new Tr(p.target,h,d,p.sequenceNumber);Lc(o,I)}),o.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){V(Xt,"Failed to raise snapshot:",r),yield Ui(n,r)}})}function Ui(n,e,t){return y(this,null,function*(){if(!Ln(e))throw e;n.Ea.add(1),yield Cr(n),n.Ra.set("Offline"),t||(t=()=>tf(n.localStore)),n.asyncQueue.enqueueRetryable(()=>y(this,null,function*(){V(Xt,"Retrying IndexedDB access"),yield t(),n.Ea.delete(1),yield is(n)}))})}function of(n,e){return e().catch(t=>Ui(n,t,e))}function ss(n){return y(this,null,function*(){let e=q(n),t=Rt(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ac;for(;F_(e);)try{let i=yield N_(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,U_(e,i)}catch(i){yield Ui(e,i)}af(e)&&cf(e)})}function F_(n){return en(n)&&n.Ta.length<10}function U_(n,e){n.Ta.push(e);let t=Rt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function af(n){return en(n)&&!Rt(n).x_()&&n.Ta.length>0}function cf(n){Rt(n).start()}function B_(n){return y(this,null,function*(){Rt(n).ra()})}function q_(n){return y(this,null,function*(){let e=Rt(n);for(let t of n.Ta)e.ea(t.mutations)})}function j_(n,e,t){return y(this,null,function*(){let r=n.Ta.shift(),i=ca.from(r,e,t);yield of(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ss(n)})}function z_(n,e){return y(this,null,function*(){e&&Rt(n).X_&&(yield function(r,i){return y(this,null,function*(){if(function(a){return r_(a)&&a!==P.ABORTED}(i.code)){let o=r.Ta.shift();Rt(r).B_(),yield of(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield ss(r)}})}(n,e)),af(n)&&cf(n)})}function Bh(n,e){return y(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),V(Xt,"RemoteStore received new credentials");let r=en(t);t.Ea.add(3),yield Cr(t),r&&t.Ra.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield is(t)})}function $_(n,e){return y(this,null,function*(){let t=q(n);e?(t.Ea.delete(2),yield is(t)):e||(t.Ea.add(2),yield Cr(t),t.Ra.set("Unknown"))})}function Mn(n){return n.ma||(n.ma=function(t,r,i){let o=q(t);return o.sa(),new Wa(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Xo:V_.bind(null,n),t_:x_.bind(null,n),r_:L_.bind(null,n),H_:M_.bind(null,n)}),n.da.push(e=>y(this,null,function*(){e?(n.ma.B_(),Fc(n)?Mc(n):n.Ra.set("Unknown")):(yield n.ma.stop(),sf(n))}))),n.ma}function Rt(n){return n.fa||(n.fa=function(t,r,i){let o=q(t);return o.sa(),new Ha(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:B_.bind(null,n),r_:z_.bind(null,n),ta:q_.bind(null,n),na:j_.bind(null,n)}),n.da.push(e=>y(this,null,function*(){e?(n.fa.B_(),yield ss(n)):(yield n.fa.stop(),n.Ta.length>0&&(V(Xt,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var Za=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new et,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,u=new n(e,t,a,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Uc(n,e){if(tt("AsyncQueue",`${e}: ${n}`),Ln(n))return new k(P.UNAVAILABLE,`${e}: ${n}`);throw n}var Bi=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=lr(),this.sortedSet=new re(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var qi=class{constructor(){this.ga=new re(M.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):F(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}},kn=class n{constructor(e,t,r,i,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,Bi.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ts(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var ec=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}},tc=class{constructor(){this.queries=qh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=q(t),o=i.queries;i.queries=qh(),o.forEach((a,u)=>{for(let h of u.Sa)h.onError(r)})})(this,new k(P.ABORTED,"Firestore shutting down"))}};function qh(){return new it(n=>kd(n),ts)}function G_(n,e){return y(this,null,function*(){let t=q(n),r=3,i=e.query,o=t.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new ec,r=e.Da()?0:1);try{switch(r){case 0:o.wa=yield t.onListen(i,!0);break;case 1:o.wa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=Uc(a,`Initialization of query '${pn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Bc(t)})}function K_(n,e){return y(this,null,function*(){let t=q(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function W_(n,e){let t=q(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let u of a.Sa)u.Fa(i)&&(r=!0);a.wa=i}}r&&Bc(t)}function H_(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let o of i.Sa)o.onError(t);r.queries.delete(e)}function Bc(n){n.Ca.forEach(e=>{e.next()})}var nc,jh;(jh=nc||(nc={})).Ma="default",jh.Cache="cache";var rc=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new kn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=kn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==nc.Cache}};var ji=class{constructor(e){this.key=e}},zi=class{constructor(e){this.key=e}},ic=class{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=W(),this.mutatedKeys=W(),this.eu=Od(e),this.tu=new Bi(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new qi,i=t?t.tu:this.tu,o=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,I)=>{let T=i.get(p),R=ns(this.query,I)?I:null,O=!!T&&this.mutatedKeys.has(T.key),x=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),N=!1;T&&R?T.data.isEqual(R.data)?O!==x&&(r.track({type:3,doc:R}),N=!0):this.su(T,R)||(r.track({type:2,doc:R}),N=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(u=!0)):!T&&R?(r.track({type:0,doc:R}),N=!0):T&&!R&&(r.track({type:1,doc:T}),N=!0,(h||d)&&(u=!0)),N&&(R?(a=a.add(R),o=x?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort((p,I)=>function(R,O){let x=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:N})}};return x(R)-x(O)}(p.type,I.type)||this.eu(p.doc,I.doc)),this.ou(r),i=i??!1;let u=t&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new kn(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new qi,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=W(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});let t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new zi(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new ji(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=W();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return kn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},qc="SyncEngine",sc=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},oc=class{constructor(e){this.key=e,this.hu=!1}},ac=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new it(u=>kd(u),ts),this.Iu=new Map,this.Eu=new Set,this.du=new re(M.comparator),this.Au=new Map,this.Ru=new Ar,this.Vu={},this.mu=new Map,this.fu=vr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function Q_(n,e,t=!0){return y(this,null,function*(){let r=pf(n),i,o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=yield uf(r,e,t,!0),i})}function J_(n,e){return y(this,null,function*(){let t=pf(n);yield uf(t,e,!0,!1)})}function uf(n,e,t,r){return y(this,null,function*(){let i=yield D_(n.localStore,ze(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),u;return r&&(u=yield Y_(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&nf(n.remoteStore,i),u})}function Y_(n,e,t,r,i){return y(this,null,function*(){n.pu=(I,T,R)=>function(x,N,z,B){return y(this,null,function*(){let H=N.view.ru(z);H.Cs&&(H=yield Mh(x.localStore,N.query,!1).then(({documents:w})=>N.view.ru(w,H)));let _e=B&&B.targetChanges.get(N.targetId),ve=B&&B.targetMismatches.get(N.targetId)!=null,he=N.view.applyChanges(H,x.isPrimaryClient,_e,ve);return $h(x,N.targetId,he.au),he.snapshot})}(n,I,T,R);let o=yield Mh(n.localStore,e,!0),a=new ic(e,o.Qs),u=a.ru(o.documents),h=wr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,h);$h(n,t,d.au);let p=new sc(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot})}function X_(n,e,t){return y(this,null,function*(){let r=q(n),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter(a=>!ts(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Ba(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&xc(r.remoteStore,i.targetId),cc(r,i.targetId)}).catch(xn))):(cc(r,i.targetId),yield Ba(r.localStore,i.targetId,!0))})}function Z_(n,e){return y(this,null,function*(){let t=q(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),xc(t.remoteStore,r.targetId))})}function ey(n,e,t){return y(this,null,function*(){let r=ay(n);try{let i=yield function(a,u){let h=q(a),d=ue.now(),p=u.reduce((R,O)=>R.add(O.key),W()),I,T;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let O=st(),x=W();return h.Ns.getEntries(R,p).next(N=>{O=N,O.forEach((z,B)=>{B.isValidDocument()||(x=x.add(z))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,O)).next(N=>{I=N;let z=[];for(let B of u){let H=n_(B,I.get(B.key).overlayedDocument);H!=null&&z.push(new Ke(B.key,H,bd(H.value.mapValue),Ne.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,z,u)}).next(N=>{T=N;let z=N.applyToLocalDocumentSet(I,x);return h.documentOverlayCache.saveOverlays(R,N.batchId,z)})}).then(()=>({batchId:T.batchId,changes:xd(I)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new re(K)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d}(r,i.batchId,t),yield Nr(r,i.changes),yield ss(r.remoteStore)}catch(i){let o=Uc(i,"Failed to persist write");t.reject(o)}})}function lf(n,e){return y(this,null,function*(){let t=q(n);try{let r=yield P_(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Au.get(o);a&&(Y(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Y(a.hu,14607):i.removedDocuments.size>0&&(Y(a.hu,42227),a.hu=!1))}),yield Nr(t,r,e)}catch(r){yield xn(r)}})}function zh(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach((o,a)=>{let u=a.view.va(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let h=q(a);h.onlineState=u;let d=!1;h.queries.forEach((p,I)=>{for(let T of I.Sa)T.va(u)&&(d=!0)}),d&&Bc(h)}(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function ty(n,e,t){return y(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Au.get(e),o=i&&i.key;if(o){let a=new re(M.comparator);a=a.insert(o,Me.newNoDocument(o,j.min()));let u=W().add(o),h=new Ri(j.min(),new Map,new re(K),a,u);yield lf(r,h),r.du=r.du.remove(o),r.Au.delete(e),jc(r)}else yield Ba(r.localStore,e,!1).then(()=>cc(r,e,t)).catch(xn)})}function ny(n,e){return y(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield R_(t.localStore,e);df(t,r,null),hf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Nr(t,i)}catch(i){yield xn(i)}})}function ry(n,e,t){return y(this,null,function*(){let r=q(n);try{let i=yield function(a,u){let h=q(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next(I=>(Y(I!==null,37113),p=I.keys(),h.mutationQueue.removeMutationBatch(d,I))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})}(r.localStore,e);df(r,e,t),hf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Nr(r,i)}catch(i){yield xn(i)}})}function hf(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function df(n,e,t){let r=q(n),i=r.Vu[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function cc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||ff(n,r)})}function ff(n,e){n.Eu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(xc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),jc(n))}function $h(n,e,t){for(let r of t)r instanceof ji?(n.Ru.addReference(r.key,e),iy(n,r)):r instanceof zi?(V(qc,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||ff(n,r.key)):F(19791,{wu:r})}function iy(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(V(qc,"New document in limbo: "+t),n.Eu.add(r),jc(n))}function jc(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new M(te.fromString(e)),r=n.fu.next();n.Au.set(r,new oc(t)),n.du=n.du.insert(t,r),nf(n.remoteStore,new Tr(ze(Dc(t.path)),r,"TargetPurposeLimboResolution",vc.ce))}}function Nr(n,e,t){return y(this,null,function*(){let r=q(n),i=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((u,h)=>{a.push(r.pu(h,e,t).then(d=>{if((d||t)&&r.isPrimaryClient){let p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){i.push(d);let p=La.As(h.targetId,d);o.push(p)}}))}),yield Promise.all(a),r.Pu.H_(i),yield function(h,d){return y(this,null,function*(){let p=q(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>C.forEach(d,T=>C.forEach(T.Es,R=>p.persistence.referenceDelegate.addReference(I,T.targetId,R)).next(()=>C.forEach(T.ds,R=>p.persistence.referenceDelegate.removeReference(I,T.targetId,R)))))}catch(I){if(!Ln(I))throw I;V(Vc,"Failed to update sequence numbers: "+I)}for(let I of d){let T=I.targetId;if(!I.fromCache){let R=p.Ms.get(T),O=R.snapshotVersion,x=R.withLastLimboFreeSnapshotVersion(O);p.Ms=p.Ms.insert(T,x)}}})}(r.localStore,o))})}function sy(n,e){return y(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){V(qc,"User change. New user:",e.toKey());let r=yield ef(t.localStore,e);t.currentUser=e,function(o,a){o.mu.forEach(u=>{u.forEach(h=>{h.reject(new k(P.CANCELLED,a))})}),o.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Nr(t,r.Ls)}})}function oy(n,e){let t=q(n),r=t.Au.get(e);if(r&&r.hu)return W().add(r.key);{let i=W(),o=t.Iu.get(e);if(!o)return i;for(let a of o){let u=t.Tu.get(a);i=i.unionWith(u.view.nu)}return i}}function pf(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=lf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ty.bind(null,e),e.Pu.H_=W_.bind(null,e.eventManager),e.Pu.yu=H_.bind(null,e.eventManager),e}function ay(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ny.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ry.bind(null,e),e}var mf=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return y(this,null,function*(){this.serializer=rs(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)})}Fu(t,r){return null}Mu(t,r){return null}vu(t){return S_(this.persistence,new Fa,t.initialUser,this.serializer)}Cu(t){return new Oi(xa.mi,this.serializer)}Du(t){return new qa}terminate(){return y(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),uc=class extends mf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Y(this.persistence.referenceDelegate instanceof Vi,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Ta(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?ke.withCacheSize(this.cacheSizeBytes):ke.DEFAULT;return new Oi(r=>Vi.mi(r,t),this.serializer)}};var cy=(()=>{class n{initialize(t,r){return y(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>zh(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=sy.bind(null,this.syncEngine),yield $_(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new tc}()}createDatastore(t){let r=rs(t.databaseInfo.databaseId),i=function(a){return new Ka(a)}(t.databaseInfo);return function(a,u,h,d){return new Ja(a,u,h,d)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,o,a,u,h){return new Xa(i,o,a,u,h)}(this.localStore,this.datastore,t.asyncQueue,r=>zh(this.syncEngine,r,0),function(){return Li.v()?new Li:new ja}())}createSyncEngine(t,r){return function(o,a,u,h,d,p,I){let T=new ac(o,a,u,h,d,p);return I&&(T.gu=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return y(this,null,function*(){yield function(r){return y(this,null,function*(){let i=q(r);V(Xt,"RemoteStore shutting down."),i.Ea.add(5),yield Cr(i),i.Aa.shutdown(),i.Ra.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var lc=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Pt="FirestoreClient",hc=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=pe.UNAUTHENTICATED,this.clientId=mr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>y(this,null,function*(){V(Pt,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(V(Pt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new et;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>y(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Uc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Vo(n,e){return y(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V(Pt,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>y(this,null,function*(){r.isEqual(i)||(yield ef(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Gh(n,e){return y(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield uy(n);V(Pt,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Bh(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Bh(e.remoteStore,i)),n._onlineComponents=e})}function uy(n){return y(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(Pt,"Using user provided OfflineComponentProvider");try{yield Vo(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;wn("Error using user provided cache. Falling back to memory cache: "+t),yield Vo(n,new mf)}}else V(Pt,"Using default OfflineComponentProvider"),yield Vo(n,new uc(void 0));return n._offlineComponents})}function gf(n){return y(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(Pt,"Using user provided OnlineComponentProvider"),yield Gh(n,n._uninitializedComponentsProvider._online)):(V(Pt,"Using default OnlineComponentProvider"),yield Gh(n,new cy))),n._onlineComponents})}function ly(n){return gf(n).then(e=>e.syncEngine)}function Kh(n){return y(this,null,function*(){let e=yield gf(n),t=e.eventManager;return t.onListen=Q_.bind(null,e.syncEngine),t.onUnlisten=X_.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=J_.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Z_.bind(null,e.syncEngine),t})}function _f(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Wh=new Map;var yf="firestore.googleapis.com",Hh=!0,$i=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new k(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=yf,this.ssl=Hh}else this.host=e.host,this.ssl=e.ssl??Hh;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Xd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Zd)throw new k(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ig("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_f(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new k(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new k(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new k(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},On=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $i({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new k(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $i(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Lo;switch(r.type){case"firstParty":return new Bo(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new k(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return y(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Wh.get(t);r&&(V("ComponentProvider","Removing Datastore"),Wh.delete(t),r.terminate())}(this),Promise.resolve()}};function hy(n,e,t,r={}){n=Le(n,On);let i=Je(e),o=n._getSettings(),a=J(L({},o),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;i&&(sr(`https://${u}`),ci("Firestore",!0)),o.host!==yf&&o.host!==u&&wn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=J(L({},o),{host:u,ssl:i,emulatorOptions:r});if(!Ve(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=pe.MOCK_USER;else{d=xl(r.mockUserToken,n._app?.options.projectId);let I=r.mockUserToken.sub||r.mockUserToken.user_id;if(!I)throw new k(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new pe(I)}n._authCredentials=new Mo(new Ii(d,p))}}var Ct=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ge=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Pr(t,n._jsonSchema))return new n(e,r||null,new M(te.fromString(t.referencePath)))}};ge._jsonSchemaVersion="firestore/documentReference/1.0",ge._jsonSchema={type:ce("string",ge._jsonSchemaVersion),referencePath:ce("string")};var wt=class n extends Ct{constructor(e,t,r){super(e,t,Dc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ge(this.firestore,null,new M(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function ot(n,e,...t){if(n=ie(n),td("collection","path",e),n instanceof On){let r=te.fromString(e,...t);return dh(r),new wt(n,null,r)}{if(!(n instanceof ge||n instanceof wt))throw new k(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return dh(r),new wt(n.firestore,null,r)}}function tn(n,e,...t){if(n=ie(n),arguments.length===1&&(e=mr.newId()),td("doc","path",e),n instanceof On){let r=te.fromString(e,...t);return hh(r),new ge(n,null,new M(r))}{if(!(n instanceof ge||n instanceof wt))throw new k(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return hh(r),new ge(n.firestore,n instanceof wt?n.converter:null,new M(r))}}var Qh="AsyncQueue",Gi=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Mi(this,"async_queue_retry"),this._c=()=>{let r=Oo();r&&V(Qh,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=Oo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=Oo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new et;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return y(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ln(e))throw e;V(Qh,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,tt("INTERNAL UNHANDLED ERROR: ",Jh(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=Za.createAndSchedule(this,e,t,r,o=>this.hc(o));return this.tc.push(i),i}uc(){this.nc&&F(47125,{Pc:Jh(this.nc)})}verifyOperationInProgress(){}Tc(){return y(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function Jh(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Yh(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1}(n,["next","error","complete"])}var We=class extends On{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Gi,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return y(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Gi(e),this._firestoreClient=void 0,yield e}})}};function If(n,e,t){t||(t=Ir);let r=ln(n,"firestore");if(r.isInitialized(t)){let i=r.getImmediate({identifier:t}),o=r.getOptions(t);if(Ve(o,e))return i;throw new k(P.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new k(P.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Zd)throw new k(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Je(e.host)&&sr(e.host),r.initialize({options:e,instanceIdentifier:t})}function Ef(n,e){let t=typeof n=="object"?n:hn(),r=typeof n=="string"?n:e||Ir,i=ln(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=Vl("firestore");o&&hy(i,...o)}return i}function zc(n){if(n._terminated)throw new k(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||dy(n),n._firestoreClient}function dy(n){let e=n._freezeSettings(),t=function(i,o,a,u){return new Go(i,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,_f(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)}(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new hc(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(i){let o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}}(n._componentsProvider))}var Tt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ee.fromBase64String(e))}catch(t){throw new k(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ee.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Pr(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Tt._jsonSchemaVersion="firestore/bytes/1.0",Tt._jsonSchema={type:ce("string",Tt._jsonSchemaVersion),bytes:ce("string")};var Zt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new k(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ce(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var br=class{constructor(e){this._methodName=e}};var vt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return K(this._lat,e._lat)||K(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Pr(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};vt._jsonSchemaVersion="firestore/geoPoint/1.0",vt._jsonSchema={type:ce("string",vt._jsonSchemaVersion),latitude:ce("number"),longitude:ce("number")};var At=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Pr(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new k(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};At._jsonSchemaVersion="firestore/vectorValue/1.0",At._jsonSchema={type:ce("string",At._jsonSchemaVersion),vectorValues:ce("object")};var fy=/^__.*__$/,dc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ke(e,this.data,this.fieldMask,t,this.fieldTransforms):new Yt(e,this.data,t,this.fieldTransforms)}},Ki=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ke(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function wf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:n})}}var fc=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new n(L(L({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Hi(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(wf(this.Ac)&&fy.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}},pc=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||rs(e)}Cc(e,t,r,i=!1){return new fc({Ac:e,methodName:t,Dc:r,path:Ce.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Dr(n){let e=n._freezeSettings(),t=rs(n._databaseId);return new pc(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $c(n,e,t,r,i,o={}){let a=n.Cc(o.merge||o.mergeFields?2:0,e,t,i);Gc("Data must be an object, but it was:",a,r);let u=Af(r,a),h,d;if(o.merge)h=new Oe(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){let p=[];for(let I of o.mergeFields){let T=mc(e,I,t);if(!a.contains(T))throw new k(P.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);Sf(p,T)||p.push(T)}h=new Oe(p),d=a.fieldTransforms.filter(I=>h.covers(I.field))}else h=null,d=a.fieldTransforms;return new dc(new Pe(u),h,d)}var Wi=class n extends br{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function Tf(n,e,t,r){let i=n.Cc(1,e,t);Gc("Data must be an object, but it was:",i,r);let o=[],a=Pe.empty();Nt(r,(h,d)=>{let p=Kc(e,h,t);d=ie(d);let I=i.yc(p);if(d instanceof Wi)o.push(p);else{let T=kr(d,I);T!=null&&(o.push(p),a.set(p,T))}});let u=new Oe(o);return new Ki(a,u,i.fieldTransforms)}function vf(n,e,t,r,i,o){let a=n.Cc(1,e,t),u=[mc(e,r,t)],h=[i];if(o.length%2!=0)throw new k(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<o.length;T+=2)u.push(mc(e,o[T])),h.push(o[T+1]);let d=[],p=Pe.empty();for(let T=u.length-1;T>=0;--T)if(!Sf(d,u[T])){let R=u[T],O=h[T];O=ie(O);let x=a.yc(R);if(O instanceof Wi)d.push(R);else{let N=kr(O,x);N!=null&&(d.push(R),p.set(R,N))}}let I=new Oe(d);return new Ki(p,I,a.fieldTransforms)}function py(n,e,t,r=!1){return kr(t,n.Cc(r?4:3,e))}function kr(n,e){if(bf(n=ie(n)))return Gc("Unsupported field value:",e,n),Af(n,e);if(n instanceof br)return function(r,i){if(!wf(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,i){let o=[],a=0;for(let u of r){let h=kr(u,i.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=ie(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Yg(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=ue.fromDate(r);return{timestampValue:Di(i.serializer,o)}}if(r instanceof ue){let o=new ue(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Di(i.serializer,o)}}if(r instanceof vt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Tt)return{bytesValue:Gd(i.serializer,r._byteString)};if(r instanceof ge){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Oc(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof At)return function(a,u){return{mapValue:{fields:{[Sc]:{stringValue:Rc},[vn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return kc(u.serializer,d)})}}}}}}(r,i);throw i.Sc(`Unsupported field value: ${Xi(r)}`)}(n,e)}function Af(n,e){let t={};return _d(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Nt(n,(r,i)=>{let o=kr(i,e.mc(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function bf(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ue||n instanceof vt||n instanceof Tt||n instanceof ge||n instanceof br||n instanceof At)}function Gc(n,e,t){if(!bf(t)||!nd(t)){let r=Xi(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function mc(n,e,t){if((e=ie(e))instanceof Zt)return e._internalPath;if(typeof e=="string")return Kc(n,e);throw Hi("Field path arguments must be of type string or ",n,!1,void 0,t)}var my=new RegExp("[~\\*/\\[\\]]");function Kc(n,e,t){if(e.search(my)>=0)throw Hi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Zt(...e.split("."))._internalPath}catch{throw Hi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Hi(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new k(P.INVALID_ARGUMENT,u+n+h)}function Sf(n,e){return n.some(t=>t.isEqual(e))}var Qi=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ge(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new gc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(os("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},gc=class extends Qi{data(){return super.data()}};function os(n,e){return typeof e=="string"?Kc(n,e):e instanceof Zt?e._internalPath:e._delegate._internalPath}function gy(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Sr=class{},Rr=class extends Sr{};function Fn(n,e,...t){let r=[];e instanceof Sr&&r.push(e),r=r.concat(t),function(o){let a=o.filter(h=>h instanceof _c).length,u=o.filter(h=>h instanceof Ji).length;if(a>1||a>0&&u>0)throw new k(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Ji=class n extends Rr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Rf(e._query,t),new Ct(e.firestore,e.converter,ia(e._query,t))}_parse(e){let t=Dr(e.firestore);return function(o,a,u,h,d,p,I){let T;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new k(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Zh(I,p);let O=[];for(let x of I)O.push(Xh(h,o,x));T={arrayValue:{values:O}}}else T=Xh(h,o,I)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Zh(I,p),T=py(u,a,I,p==="in"||p==="not-in");return ae.create(d,p,T)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function as(n,e,t){let r=e,i=os("where",n);return Ji._create(i,r,t)}var _c=class n extends Sr{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Fe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,o){let a=i,u=o.getFlattenedFilters();for(let h of u)Rf(a,h),a=ia(a,h)}(e._query,t),new Ct(e.firestore,e.converter,ia(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var yc=class n extends Rr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,o,a){if(i.startAt!==null)throw new k(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new k(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ht(o,a)}(e._query,this._field,this._direction);return new Ct(e.firestore,e.converter,function(i,o){let a=i.explicitOrderBy.concat([o]);return new St(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function Wc(n,e="asc"){let t=e,r=os("orderBy",n);return yc._create(r,t)}var Ic=class n extends Rr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Ct(e.firestore,e.converter,Si(e._query,this._limit,this._limitType))}};function Hc(n){return Eg("limit",n),Ic._create("limit",n,"F")}function Xh(n,e,t){if(typeof(t=ie(t))=="string"){if(t==="")throw new k(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Dd(e)&&t.indexOf("/")!==-1)throw new k(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(te.fromString(t));if(!M.isDocumentKey(r))throw new k(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ih(n,new M(r))}if(t instanceof ge)return Ih(n,t._key);throw new k(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xi(t)}.`)}function Zh(n,e){if(!Array.isArray(n)||n.length===0)throw new k(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Rf(n,e){let t=function(i,o){for(let a of i)for(let u of a.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new k(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ec=class{convertValue(e,t="none"){switch(bt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw F(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Nt(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){let t=e.fields?.[vn].arrayValue?.values?.map(r=>ee(r.doubleValue));return new At(t)}convertGeoPoint(e){return new vt(ee(e.latitude),ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=es(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(yr(e));default:return null}}convertTimestamp(e){let t=nt(e);return new ue(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=te.fromString(e);Y(Yd(r),9688,{name:e});let i=new Ai(r.get(1),r.get(3)),o=new M(r.popFirst(5));return i.isEqual(t)||tt(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function Qc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var $t=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Gt=class n extends Qi{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new In(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(os("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new k(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Gt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Gt._jsonSchema={type:ce("string",Gt._jsonSchemaVersion),bundleSource:ce("string","DocumentSnapshot"),bundleName:ce("string"),bundle:ce("string")};var In=class extends Gt{data(e={}){return super.data(e)}},En=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new $t(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new In(this._firestore,this._userDataWriter,r.key,r,new $t(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let h=new In(i._firestore,i._userDataWriter,u.doc.key,u.doc,new $t(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{let h=new In(i._firestore,i._userDataWriter,u.doc.key,u.doc,new $t(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:_y(u.type),doc:h,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new k(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=mr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function _y(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:n})}}En._jsonSchemaVersion="firestore/querySnapshot/1.0",En._jsonSchema={type:ce("string",En._jsonSchemaVersion),bundleSource:ce("string","QuerySnapshot"),bundleName:ce("string"),bundle:ce("string")};var Yi=class extends Ec{constructor(e){super(),this.firestore=e}convertBytes(e){return new Tt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ge(this.firestore,null,t)}};function Or(n,e,t){n=Le(n,ge);let r=Le(n.firestore,We),i=Qc(n.converter,e,t);return Vr(r,[$c(Dr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ne.none())])}function $E(n,e,t,...r){n=Le(n,ge);let i=Le(n.firestore,We),o=Dr(i),a;return a=typeof(e=ie(e))=="string"||e instanceof Zt?vf(o,"updateDoc",n._key,e,t,r):Tf(o,"updateDoc",n._key,e),Vr(i,[a.toMutation(n._key,Ne.exists(!0))])}function Pf(n){return Vr(Le(n.firestore,We),[new Dn(n._key,Ne.none())])}function cs(n,e){let t=Le(n.firestore,We),r=tn(n),i=Qc(n.converter,e);return Vr(t,[$c(Dr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ne.exists(!1))]).then(()=>r)}function us(n,...e){n=ie(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Yh(e[r])||(t=e[r++]);let i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Yh(e[r])){let h=e[r];e[r]=h.next?.bind(h),e[r+1]=h.error?.bind(h),e[r+2]=h.complete?.bind(h)}let o,a,u;if(n instanceof ge)a=Le(n.firestore,We),u=Dc(n._key.path),o={next:h=>{e[r]&&e[r](yy(a,n,h))},error:e[r+1],complete:e[r+2]};else{let h=Le(n,Ct);a=Le(h.firestore,We),u=h._query;let d=new Yi(a);o={next:p=>{e[r]&&e[r](new En(a,d,h,p))},error:e[r+1],complete:e[r+2]},gy(n._query)}return function(d,p,I,T){let R=new lc(T),O=new rc(p,R,I);return d.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return G_(yield Kh(d),O)})),()=>{R.Nu(),d.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return K_(yield Kh(d),O)}))}}(zc(a),u,i,o)}function Vr(n,e){return function(r,i){let o=new et;return r.asyncQueue.enqueueAndForget(()=>y(this,null,function*(){return ey(yield ly(r),i,o)})),o.promise}(zc(n),e)}function yy(n,e,t){let r=t.docs.get(e._key),i=new Yi(n);return new Gt(n,i,e._key,r,new $t(t.hasPendingWrites,t.fromCache),e.converter)}var wc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Dr(e)}set(e,t,r){this._verifyNotCommitted();let i=xo(e,this._firestore),o=Qc(i.converter,t,r),a=$c(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,Ne.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let o=xo(e,this._firestore),a;return a=typeof(t=ie(t))=="string"||t instanceof Zt?vf(this._dataReader,"WriteBatch.update",o._key,t,r,i):Tf(this._dataReader,"WriteBatch.update",o._key,t),this._mutations.push(a.toMutation(o._key,Ne.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=xo(e,this._firestore);return this._mutations=this._mutations.concat(new Dn(t._key,Ne.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function xo(n,e){if((n=ie(n)).firestore!==e)throw new k(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function GE(n){return zc(n=Le(n,We)),new wc(n,e=>Vr(n,e))}(function(e,t=!0){(function(i){Vn=i})(Et),It(new De("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),u=new We(new Fo(r.getProvider("auth-internal")),new qo(a,r.getProvider("app-check-internal")),function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new k(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ai(d.options.projectId,p)}(a,i),a);return o=L({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),xe(ch,uh,e),xe(ch,uh,"esm2020")})();function zf(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var $f=zf,Gf=new Qe("auth","Firebase",zf());var ms=new _t("@firebase/auth");function Iy(n,...e){ms.logLevel<=G.WARN&&ms.warn(`Auth (${Et}): ${n}`,...e)}function hs(n,...e){ms.logLevel<=G.ERROR&&ms.error(`Auth (${Et}): ${n}`,...e)}function Vt(n,...e){throw mu(n,...e)}function nn(n,...e){return mu(n,...e)}function Kf(n,e,t){let r=J(L({},$f()),{[e]:t});return new Qe("auth","Firebase",r).create(e,{appName:n.name})}function Ot(n){return Kf(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mu(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Gf.create(n,...e)}function U(n,e,...t){if(!n)throw mu(e,...t)}function at(n){let e="INTERNAL ASSERTION FAILED: "+n;throw hs(e),new Error(e)}function xt(n,e){n||at(e)}function Zc(){return typeof self<"u"&&self.location?.href||""}function Ey(){return Cf()==="http:"||Cf()==="https:"}function Cf(){return typeof self<"u"&&self.location?.protocol||null}function wy(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ey()||Fl()||"connection"in navigator)?navigator.onLine:!0}function Ty(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var rn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,xt(t>e,"Short delay should be less than long delay!"),this.isMobile=Ll()||Ul()}get(){return wy()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function gu(n,e){xt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var gs=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;at("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;at("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;at("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var vy={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var Ay=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],by=new rn(3e4,6e4);function Rs(n,e){return n.tenantId&&!e.tenantId?J(L({},e),{tenantId:n.tenantId}):e}function Un(o,a,u,h){return y(this,arguments,function*(n,e,t,r,i={}){return Wf(n,i,()=>y(this,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let I=or(L({key:n.config.apiKey},p)).slice(1),T=yield n._getAdditionalHeaders();T["Content-Type"]="application/json",n.languageCode&&(T["X-Firebase-Locale"]=n.languageCode);let R=L({method:e,headers:T},d);return Ml()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&Je(n.emulatorConfig.host)&&(R.credentials="include"),gs.fetch()(yield Qf(n,n.config.apiHost,t,I),R)}))})}function Wf(n,e,t){return y(this,null,function*(){n._canInitEmulator=!1;let r=L(L({},vy),e);try{let i=new eu(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw ls(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw ls(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw ls(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw ls(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Kf(n,p,d);Vt(n,p)}}catch(i){if(i instanceof Se)throw i;Vt(n,"network-request-failed",{message:String(i)})}})}function Hf(o,a,u,h){return y(this,arguments,function*(n,e,t,r,i={}){let d=yield Un(n,e,t,r,i);return"mfaPendingCredential"in d&&Vt(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function Qf(n,e,t,r){return y(this,null,function*(){let i=`${e}${t}?${r}`,o=n,a=o.config.emulator?gu(n.config,i):`${n.config.apiScheme}://${i}`;return Ay.includes(t)&&(yield o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a})}var eu=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(nn(this.auth,"network-request-failed")),by.get())})}};function ls(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=nn(n,e,r);return i.customData._tokenResponse=t,i}function Sy(n,e){return y(this,null,function*(){return Un(n,"POST","/v1/accounts:delete",e)})}function _s(n,e){return y(this,null,function*(){return Un(n,"POST","/v1/accounts:lookup",e)})}function xr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Jf(n,e=!1){return y(this,null,function*(){let t=ie(n),r=yield t.getIdToken(e),i=_u(r);U(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:xr(Jc(i.auth_time)),issuedAtTime:xr(Jc(i.iat)),expirationTime:xr(Jc(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function Jc(n){return Number(n)*1e3}function _u(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return hs("JWT malformed, contained fewer than 3 sections"),null;try{let i=oi(t);return i?JSON.parse(i):(hs("Failed to decode base64 JWT payload"),null)}catch(i){return hs("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Nf(n){let e=_u(n);return U(e,"internal-error"),U(typeof e.exp<"u","internal-error"),U(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Mr(n,e,t=!1){return y(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Se&&Ry(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function Ry({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var tu=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>y(this,null,function*(){yield this.iteration()}),t)}iteration(){return y(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Fr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=xr(this.lastLoginAt),this.creationTime=xr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function ys(n){return y(this,null,function*(){let e=n.auth,t=yield n.getIdToken(),r=yield Mr(n,_s(e,{idToken:t}));U(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let o=i.providerUserInfo?.length?Xf(i.providerUserInfo):[],a=Py(n.providerData,o),u=n.isAnonymous,h=!(n.email&&i.passwordHash)&&!a?.length,d=u?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Fr(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,p)})}function Yf(n){return y(this,null,function*(){let e=ie(n);yield ys(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Py(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Xf(n){return n.map(r=>{var i=r,{providerId:e}=i,t=eo(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}function Cy(n,e){return y(this,null,function*(){let t=yield Wf(n,{},()=>y(this,null,function*(){let r=or({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=yield Qf(n,i,"/v1/token",`key=${o}`),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:u,body:r};return n.emulatorConfig&&Je(n.emulatorConfig.host)&&(h.credentials="include"),gs.fetch()(a,h)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Ny(n,e){return y(this,null,function*(){return Un(n,"POST","/v2/accounts:revokeToken",Rs(n,e))})}var Lr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U(typeof e.idToken<"u","internal-error"),U(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Nf(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){U(e.length!==0,"internal-error");let t=Nf(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return y(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(U(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return y(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield Cy(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(U(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(U(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(U(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return at("not implemented")}};function Dt(n,e){U(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var kt=class n{constructor(o){var a=o,{uid:e,auth:t,stsTokenManager:r}=a,i=eo(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tu(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Fr(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return y(this,null,function*(){let t=yield Mr(this,this.stsTokenManager.getToken(this.auth,e));return U(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Jf(this,e)}reload(){return Yf(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>L({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(J(L({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return y(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield ys(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return y(this,null,function*(){if(Re(this.auth.app))return Promise.reject(Ot(this.auth));let e=yield this.getIdToken();return yield Mr(this,Sy(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return J(L({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>L({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:I,emailVerified:T,isAnonymous:R,providerData:O,stsTokenManager:x}=t;U(I&&x,e,"internal-error");let N=Lr.fromJSON(this.name,x);U(typeof I=="string",e,"internal-error"),Dt(r,e.name),Dt(i,e.name),U(typeof T=="boolean",e,"internal-error"),U(typeof R=="boolean",e,"internal-error"),Dt(o,e.name),Dt(a,e.name),Dt(u,e.name),Dt(h,e.name),Dt(d,e.name),Dt(p,e.name);let z=new n({uid:I,auth:e,email:i,emailVerified:T,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:N,createdAt:d,lastLoginAt:p});return O&&Array.isArray(O)&&(z.providerData=O.map(B=>L({},B))),h&&(z._redirectEventId=h),z}static _fromIdTokenResponse(e,t,r=!1){return y(this,null,function*(){let i=new Lr;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield ys(o),o})}static _fromGetAccountInfoResponse(e,t,r){return y(this,null,function*(){let i=t.users[0];U(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?Xf(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,u=new Lr;u.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Fr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,d),h})}};var Df=new Map;function ct(n){xt(n instanceof Function,"Expected a class definition");let e=Df.get(n);return e?(xt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Df.set(n,e),e)}var Dy=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return y(this,null,function*(){return!0})}_set(t,r){return y(this,null,function*(){this.storage[t]=r})}_get(t){return y(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return y(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),nu=Dy;function ds(n,e,t){return`firebase:${n}:${e}:${t}`}var Is=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=ds(this.userKey,i.apiKey,o),this.fullPersistenceKey=ds("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return y(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield _s(this.auth,{idToken:e}).catch(()=>{});return t?kt._fromGetAccountInfoResponse(this.auth,t,e):null}return kt._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return y(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return y(this,null,function*(){if(!t.length)return new n(ct(nu),e,r);let i=(yield Promise.all(t.map(d=>y(this,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),o=i[0]||ct(nu),a=ds(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=yield d._get(a);if(p){let I;if(typeof p=="string"){let T=yield _s(e,{idToken:p}).catch(()=>{});if(!T)break;I=yield kt._fromGetAccountInfoResponse(e,T,p)}else I=kt._fromJSON(e,p);d!==o&&(u=I),o=d;break}}catch{}let h=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],u&&(yield o._set(a,u.toJSON())),yield Promise.all(t.map(d=>y(this,null,function*(){if(d!==o)try{yield d._remove(a)}catch{}}))),new n(o,e,r))})}};function kf(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(np(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Zf(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ip(e))return"Blackberry";if(sp(e))return"Webos";if(ep(e))return"Safari";if((e.includes("chrome/")||tp(e))&&!e.includes("edge/"))return"Chrome";if(rp(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Zf(n=fe()){return/firefox\//i.test(n)}function ep(n=fe()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function tp(n=fe()){return/crios\//i.test(n)}function np(n=fe()){return/iemobile/i.test(n)}function rp(n=fe()){return/android/i.test(n)}function ip(n=fe()){return/blackberry/i.test(n)}function sp(n=fe()){return/webos/i.test(n)}function yu(n=fe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function ky(n=fe()){return yu(n)&&!!window.navigator?.standalone}function Oy(){return Bl()&&document.documentMode===10}function op(n=fe()){return yu(n)||rp(n)||sp(n)||ip(n)||/windows phone/i.test(n)||np(n)}function ap(n,e=[]){let t;switch(n){case"Browser":t=kf(fe());break;case"Worker":t=`${kf(fe())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Et}/${r}`}var ru=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,u)=>{try{let h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return y(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Vy(t){return y(this,arguments,function*(n,e={}){return Un(n,"GET","/v2/passwordPolicy",Rs(n,e))})}var xy=6,iu=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??xy,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var su=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Es(this),this.idTokenSubscription=new Es(this),this.beforeStateQueue=new ru(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Gf,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ct(t)),this._initializationPromise=this.queue(()=>y(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield Is.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return y(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return y(this,null,function*(){try{let t=yield _s(this,{idToken:e}),r=yield kt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return y(this,null,function*(){if(Re(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let t=yield this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return U(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return y(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return y(this,null,function*(){try{yield ys(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=Ty()}_delete(){return y(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return y(this,null,function*(){if(Re(this.app))return Promise.reject(Ot(this));let t=e?ie(e):null;return t&&U(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return y(this,null,function*(){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>y(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return y(this,null,function*(){return Re(this.app)?Promise.reject(Ot(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Re(this.app)?Promise.reject(Ot(this)):this.queue(()=>y(this,null,function*(){yield this.assertedPersistence.setPersistence(ct(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return y(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return y(this,null,function*(){let e=yield Vy(this),t=new iu(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Qe("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return y(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Ny(this,r)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(e,t){return y(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return y(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&ct(e)||this._popupRedirectResolver;U(t,this,"argument-error"),this.redirectPersistenceManager=yield Is.create(this,[ct(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return y(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>y(this,null,function*(){}))),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null})}_persistUserIfCurrent(e){return y(this,null,function*(){if(e===this.currentUser)return this.queue(()=>y(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(U(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return y(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ap(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return y(this,null,function*(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=yield this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e})}_getAppCheckToken(){return y(this,null,function*(){if(Re(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Iy(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function Ps(n){return ie(n)}var Es=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=$l(t=>this.observer=t)}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Iu={loadJS(){return y(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ly(n){Iu=n}function My(n){return Iu.loadJS(n)}function Fy(){return Iu.gapiScript}function cp(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function up(n,e){let t=ln(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),o=t.getOptions();if(Ve(o,e??{}))return i;Vt(i,"already-initialized")}return t.initialize({options:e})}function Uy(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(ct);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function lp(n,e,t){let r=Ps(n);U(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,o=hp(e),{host:a,port:u}=By(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){U(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),U(Ve(d,r.config.emulator)&&Ve(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Je(a)?(sr(`${o}//${a}${h}`),ci("Auth",!0)):i||qy()}function hp(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function By(n){let e=hp(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let o=i[1];return{host:o,port:Of(r.substr(o.length+1))}}else{let[o,a]=r.split(":");return{host:o,port:Of(a)}}}function Of(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function qy(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var ws=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return at("not implemented")}_getIdTokenResponse(e){return at("not implemented")}_linkToIdToken(e,t){return at("not implemented")}_getReauthenticationResolver(e){return at("not implemented")}};function Yc(n,e){return y(this,null,function*(){return Hf(n,"POST","/v1/accounts:signInWithIdp",Rs(n,e))})}var Ts=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var ou=class extends Ts{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function jy(n,e){return y(this,null,function*(){return Hf(n,"POST","/v1/accounts:signUp",Rs(n,e))})}var sn=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return y(this,null,function*(){let o=yield kt._fromIdTokenResponse(e,r,i),a=Vf(r);return new n({user:o,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return y(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Vf(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Vf(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}function Eu(n){return y(this,null,function*(){if(Re(n.app))return Promise.reject(Ot(n));let e=Ps(n);if(yield e._initializationPromise,e.currentUser?.isAnonymous)return new sn({user:e.currentUser,providerId:null,operationType:"signIn"});let t=yield jy(e,{returnSecureToken:!0}),r=yield sn._fromIdTokenResponse(e,"signIn",t,!0);return yield e._updateCurrentUser(r.user),r})}var au=class n extends Se{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function dp(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?au._fromErrorAndOperation(n,o,e,r):o})}function zy(n,e,t=!1){return y(this,null,function*(){let r=yield Mr(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return sn._forOperation(n,"link",r)})}function $y(n,e,t=!1){return y(this,null,function*(){let{auth:r}=n;if(Re(r.app))return Promise.reject(Ot(r));let i="reauthenticate";try{let o=yield Mr(n,dp(r,i,e,n),t);U(o.idToken,r,"internal-error");let a=_u(o.idToken);U(a,r,"internal-error");let{sub:u}=a;return U(n.uid===u,r,"user-mismatch"),sn._forOperation(n,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&Vt(r,"user-mismatch"),o}})}function Gy(n,e,t=!1){return y(this,null,function*(){if(Re(n.app))return Promise.reject(Ot(n));let r="signIn",i=yield dp(n,r,e),o=yield sn._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(o.user)),o})}function fp(n,e,t,r){return ie(n).onIdTokenChanged(e,t,r)}function pp(n,e,t){return ie(n).beforeAuthStateChanged(e,t)}var vs="__sak";var As=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(vs,"1"),this.storage.removeItem(vs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var Ky=1e3,Wy=10,Hy=(()=>{class n extends As{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=op(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),o=this.localCache[r];i!==o&&t(r,o,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,h,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let o=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);Oy()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(o,Wy):o()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},Ky)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return y(this,null,function*(){yield gt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return y(this,null,function*(){let r=yield gt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return y(this,null,function*(){yield gt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),mp=Hy;var Qy=(()=>{class n extends As{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),wu=Qy;function Jy(n){return Promise.all(n.map(e=>y(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var Yy=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(o=>o.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return y(this,null,function*(){let r=t,{eventId:i,eventType:o,data:a}=r.data,u=this.handlersMap[o];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:o});let h=Array.from(u).map(p=>y(this,null,function*(){return p(r.origin,a)})),d=yield Jy(h);r.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function gp(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var cu=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return y(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{let d=gp("",20);i.port1.start();let p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(I){let T=I;if(T.data.eventId===d)switch(T.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(T.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function He(){return window}function Xy(n){He().location.href=n}function _p(){return typeof He().WorkerGlobalScope<"u"&&typeof He().importScripts=="function"}function Zy(){return y(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function eI(){return navigator?.serviceWorker?.controller||null}function tI(){return _p()?self:null}var yp="firebaseLocalStorageDb",nI=1,bs="firebaseLocalStorage",Ip="fbase_key",on=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Cs(n,e){return n.transaction([bs],e?"readwrite":"readonly").objectStore(bs)}function rI(){let n=indexedDB.deleteDatabase(yp);return new on(n).toPromise()}function uu(){let n=indexedDB.open(yp,nI);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(bs,{keyPath:Ip})}catch(i){t(i)}}),n.addEventListener("success",()=>y(this,null,function*(){let r=n.result;r.objectStoreNames.contains(bs)?e(r):(r.close(),yield rI(),e(yield uu()))}))})}function xf(n,e,t){return y(this,null,function*(){let r=Cs(n,!0).put({[Ip]:e,value:t});return new on(r).toPromise()})}function iI(n,e){return y(this,null,function*(){let t=Cs(n,!1).get(e),r=yield new on(t).toPromise();return r===void 0?null:r.value})}function Lf(n,e){let t=Cs(n,!0).delete(e);return new on(t).toPromise()}var sI=800,oI=3,aI=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return y(this,null,function*(){return this.db?this.db:(this.db=yield uu(),this.db)})}_withRetries(t){return y(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>oI)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return y(this,null,function*(){return _p()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return y(this,null,function*(){this.receiver=Yy._getInstance(tI()),this.receiver._subscribe("keyChanged",(t,r)=>y(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>y(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return y(this,null,function*(){if(this.activeServiceWorker=yield Zy(),!this.activeServiceWorker)return;this.sender=new cu(this.activeServiceWorker);let t=yield this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return y(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||eI()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return y(this,null,function*(){try{if(!indexedDB)return!1;let t=yield uu();return yield xf(t,vs,"1"),yield Lf(t,vs),!0}catch{}return!1})}_withPendingWrite(t){return y(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return y(this,null,function*(){return this._withPendingWrite(()=>y(this,null,function*(){return yield this._withRetries(i=>xf(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return y(this,null,function*(){let r=yield this._withRetries(i=>iI(i,t));return this.localCache[t]=r,r})}_remove(t){return y(this,null,function*(){return this._withPendingWrite(()=>y(this,null,function*(){return yield this._withRetries(r=>Lf(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return y(this,null,function*(){let t=yield this._withRetries(o=>{let a=Cs(o,!1).getAll();return new on(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:o,value:a}of t)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(a)&&(this.notifyListeners(o,a),r.push(o));for(let o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),r.push(o));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>y(this,null,function*(){return this._poll()}),sI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Ep=aI;var nw=cp("rcb"),rw=new rn(3e4,6e4);function cI(n,e){return e?ct(e):(U(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Ur=class extends ws{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Yc(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Yc(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Yc(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function uI(n){return Gy(n.auth,new Ur(n),n.bypassAuthState)}function lI(n){let{auth:e,user:t}=n;return U(t,e,"internal-error"),$y(t,new Ur(n),n.bypassAuthState)}function hI(n){return y(this,null,function*(){let{auth:e,user:t}=n;return U(t,e,"internal-error"),zy(t,new Ur(n),n.bypassAuthState)})}var lu=class{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>y(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return y(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}let h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(u)(h))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return uI;case"linkViaPopup":case"linkViaRedirect":return hI;case"reauthViaPopup":case"reauthViaRedirect":return lI;default:Vt(this.auth,"internal-error")}}resolve(e){xt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){xt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var iw=new rn(2e3,1e4);var dI="pendingRedirect",fs=new Map,hu=class n extends lu{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return y(this,null,function*(){let e=fs.get(this.auth._key());if(!e){try{let r=(yield fI(this.resolver,this.auth))?yield gt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}fs.set(this.auth._key(),e)}return this.bypassAuthState||fs.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return y(this,null,function*(){if(e.type==="signInViaRedirect")return gt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,gt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return y(this,null,function*(){})}cleanUp(){}};function fI(n,e){return y(this,null,function*(){let t=gI(e),r=mI(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function pI(n,e){fs.set(n._key(),e)}function mI(n){return ct(n._redirectPersistence)}function gI(n){return ds(dI,n.config.apiKey,n.name)}function _I(n,e,t=!1){return y(this,null,function*(){if(Re(n.app))return Promise.reject(Ot(n));let r=Ps(n),i=cI(r,e),a=yield new hu(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var yI=10*60*1e3,du=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!II(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!wp(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(nn(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=yI&&this.cachedEventUids.clear(),this.cachedEventUids.has(Mf(e))}saveEventToCache(e){this.cachedEventUids.add(Mf(e)),this.lastProcessedEventTime=Date.now()}};function Mf(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function wp({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function II(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return wp(n);default:return!1}}function EI(t){return y(this,arguments,function*(n,e={}){return Un(n,"GET","/v1/projects",e)})}var wI=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,TI=/^https?/;function vI(n){return y(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield EI(n);for(let t of e)try{if(AI(t))return}catch{}Vt(n,"unauthorized-domain")})}function AI(n){let e=Zc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!TI.test(t))return!1;if(wI.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var bI=new rn(3e4,6e4);function Ff(){let n=He().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function SI(n){return new Promise((e,t)=>{function r(){Ff(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ff(),t(nn(n,"network-request-failed"))},timeout:bI.get()})}if(He().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(He().gapi?.load)r();else{let i=cp("iframefcb");return He()[i]=()=>{gapi.load?r():t(nn(n,"network-request-failed"))},My(`${Fy()}?onload=${i}`).catch(o=>t(o))}}).catch(e=>{throw ps=null,e})}var ps=null;function RI(n){return ps=ps||SI(n),ps}var PI=new rn(5e3,15e3),CI="__/auth/iframe",NI="emulator/auth/iframe",DI={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},kI=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function OI(n){let e=n.config;U(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?gu(e,NI):`https://${n.config.authDomain}/${CI}`,r={apiKey:e.apiKey,appName:n.name,v:Et},i=kI.get(n.config.apiHost);i&&(r.eid=i);let o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${or(r).slice(1)}`}function VI(n){return y(this,null,function*(){let e=yield RI(n),t=He().gapi;return U(t,n,"internal-error"),e.open({where:document.body,url:OI(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:DI,dontclear:!0},r=>new Promise((i,o)=>y(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=nn(n,"network-request-failed"),u=He().setTimeout(()=>{o(a)},PI.get());function h(){He().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(a)})})))})}var xI={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},LI=500,MI=600,FI="_blank",UI="http://localhost",Ss=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function BI(n,e,t,r=LI,i=MI){let o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",h=J(L({},xI),{width:r.toString(),height:i.toString(),top:o,left:a}),d=fe().toLowerCase();t&&(u=tp(d)?FI:t),Zf(d)&&(e=e||UI,h.scrollbars="yes");let p=Object.entries(h).reduce((T,[R,O])=>`${T}${R}=${O},`,"");if(ky(d)&&u!=="_self")return qI(e||"",u),new Ss(null);let I=window.open(e||"",u,p);U(I,n,"popup-blocked");try{I.focus()}catch{}return new Ss(I)}function qI(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var jI="__/auth/handler",zI="emulator/auth/handler",$I=encodeURIComponent("fac");function Uf(n,e,t,r,i,o){return y(this,null,function*(){U(n.config.authDomain,n,"auth-domain-config-required"),U(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Et,eventId:i};if(e instanceof Ts){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",zl(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,I]of Object.entries(o||{}))a[p]=I}if(e instanceof ou){let p=e.getScopes().filter(I=>I!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let h=yield n._getAppCheckToken(),d=h?`#${$I}=${encodeURIComponent(h)}`:"";return`${GI(n)}?${or(u).slice(1)}${d}`})}function GI({config:n}){return n.emulator?gu(n,zI):`https://${n.authDomain}/${jI}`}var Xc="webStorageSupport",fu=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wu,this._completeRedirectFn=_I,this._overrideRedirectResult=pI}_openPopup(e,t,r,i){return y(this,null,function*(){xt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");let o=yield Uf(e,t,r,Zc(),i);return BI(e,o,gp())})}_openRedirect(e,t,r,i){return y(this,null,function*(){yield this._originValidation(e);let o=yield Uf(e,t,r,Zc(),i);return Xy(o),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(xt(o,"If manager is not set, promise should be"),o)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return y(this,null,function*(){let t=yield VI(e),r=new du(e);return t.register("authEvent",i=>(U(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Xc,{type:Xc},i=>{let o=i?.[0]?.[Xc];o!==void 0&&t(!!o),Vt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=vI(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return op()||ep()||yu()}},Tp=fu;var Bf="@firebase/auth",qf="1.11.1";var pu=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(e){return y(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function KI(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function WI(n){It(new De("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;U(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ap(n)},d=new su(r,i,o,h);return Uy(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),It(new De("auth-internal",e=>{let t=Ps(e.getProvider("auth").getImmediate());return(r=>new pu(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),xe(Bf,qf,KI(n)),xe(Bf,qf,"esm2020")}var HI=5*60,QI=oo("authIdTokenMaxAge")||HI,jf=null,JI=n=>e=>y(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>QI)return;let i=t?.token;jf!==i&&(jf=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function Tu(n=hn()){let e=ln(n,"auth");if(e.isInitialized())return e.getImmediate();let t=up(n,{popupRedirectResolver:Tp,persistence:[Ep,mp,wu]}),r=oo("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let o=new URL(r,location.origin);if(location.origin===o.origin){let a=JI(o.toString());pp(t,a,()=>a(t.currentUser)),fp(t,u=>a(u))}}let i=io("auth");return i&&lp(t,`http://${i}`),t}function YI(){return document.getElementsByTagName("head")?.[0]??document}Ly({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=nn("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",YI().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});WI("Browser");var XI="firebase",ZI="12.6.0";xe(XI,ZI,"app");var vp=(()=>{class n{constructor(){rh().length>0?(this.app=hn(),this.db=Ef(this.app)):(this.app=vo(ii.firebaseConfig),this.db=If(this.app,{experimentalForceLongPolling:!0}))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ri({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var $T=(()=>{class n{constructor(t,r,i,o){this.http=t,this.loggingService=r,this.customerService=i,this.firebaseService=o,this.apiUrl=ii.apiUrl,this.productsSubject=new ni([]),this.salesSubject=new ni([]),this.expensesSubject=new ni([]),this.products$=this.productsSubject.asObservable(),this.sales$=this.salesSubject.asObservable(),this.expenses$=this.expensesSubject.asObservable(),this.firebaseUser=null,this.unsubscribes=[],this.pollingInterval=null,this.app=this.firebaseService.app,this.db=this.firebaseService.db,this.auth=Tu(this.app)}getCurrentUser(){return localStorage.getItem("jjm_user_id")||"guest"}getFirestoreUserId(){return this.firebaseUser?this.firebaseUser.uid:localStorage.getItem("firebase_auth_disabled")==="true"?this.getCurrentUser():(console.warn("Firestore User ID requested but not authenticated. Using legacy fallback."),this.getCurrentUser())}reloadData(){this.startRealtimeListeners()}stopRealtimeListeners(){this.unsubscribes.forEach(t=>t()),this.unsubscribes=[],this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}startRealtimeListeners(){this.stopRealtimeListeners();let t=this.getCurrentUser();if(!t||t==="guest")return;if(localStorage.getItem("firebase_auth_disabled")==="true"){console.log("Auth previously failed. Skipping to Public/Fallback Mode."),this.setupFirestoreListeners(t,t);return}let i=this.auth.currentUser;if(i){console.log("Already Authenticated. Starting Secure Listeners."),this.firebaseUser=i,this.setupFirestoreListeners(i.uid,t);return}Eu(this.auth).then(o=>{console.log("Signed In Anonymously. Starting Secure Listeners."),this.firebaseUser=o.user,this.setupFirestoreListeners(o.user.uid,t)}).catch(o=>{console.warn("Anonymous Auth unavailable. Attempting Public Realtime Mode with Legacy ID."),localStorage.setItem("firebase_auth_disabled","true"),this.setupFirestoreListeners(t,t)})}setupFirestoreListeners(t,r){console.log(`Starting Firestore Listeners. FirestoreID: ${t}, LegacyID: ${r}`);let i=!!localStorage.getItem("customer_id"),o;i?(console.log("InventoryService: Customer Mode - Fetching ALL products for AI"),o=Fn(ot(this.db,"products"),Wc("name","asc"),Hc(100))):o=Fn(ot(this.db,"products"),as("userId","==",r)),this.unsubscribes.push(us(o,h=>{console.log("Products Snapshot:",h.docs.length);let d=h.docs.map(p=>L({id:p.id},p.data()));this.productsSubject.next(d),!i&&d.length===0&&this.migrateProducts(r,t)},h=>{console.error("Products Listener Error:",h),h.code==="permission-denied"&&(console.warn("Permission Denied. Falling back to Legacy Polling."),this.fallbackToLegacyPolling())}));let a;i?(console.log("InventoryService: Customer Mode - Querying RECENT sales for fuzzy matching"),a=Fn(ot(this.db,"sales"),Wc("timestamp","desc"),Hc(100))):a=Fn(ot(this.db,"sales"),as("userId","==",r)),this.unsubscribes.push(us(a,h=>{console.log("Sales Snapshot:",h.docs.length);let d=h.docs.map(p=>this.transformSale(L({id:p.id},p.data())));this.salesSubject.next(d),!i&&d.length===0&&this.migrateSales(r,t)},h=>console.error("Sales Listener Error:",h)));let u=Fn(ot(this.db,"expenses"),as("userId","==",t));this.unsubscribes.push(us(u,h=>{console.log("Expenses Snapshot:",h.docs.length);let d=h.docs.map(p=>L({id:p.id},p.data()));this.expensesSubject.next(d),d.length===0&&this.migrateExpenses(r,t)},h=>console.error("Expenses Listener Error:",h)))}fallbackToLegacyPolling(){this.pollingInterval||(console.log("Starting Legacy Polling (Fallback Mode)..."),this.fetchAllLegacyData(),this.pollingInterval=setInterval(()=>this.fetchAllLegacyData(),1e4))}fetchAllLegacyData(){this.fetchProducts(),this.fetchSales(),this.fetchExpenses()}migrateProducts(t,r){this.http.get(`${this.apiUrl}/products?userId=${t}`).subscribe(i=>{i.forEach(o=>y(this,null,function*(){try{yield Or(tn(this.db,"products",o.id),J(L({},o),{userId:r}))}catch(a){console.error("Error migrating product:",a)}}))})}migrateSales(t,r){this.http.get(`${this.apiUrl}/sales?userId=${t}`).subscribe(i=>{i.forEach(o=>y(this,null,function*(){try{let a=J(L({},o),{pending:o.pending===!0||o.pending==="true",timestamp:this.parseDate(o.timestamp),deliveryDate:o.deliveryDate?this.parseDate(o.deliveryDate):null,userId:r});yield Or(tn(this.db,"sales",o.id),a)}catch(a){console.error("Error migrating sale:",a)}}))})}migrateExpenses(t,r){this.http.get(`${this.apiUrl}/expenses?userId=${t}`).subscribe(i=>{i.forEach(o=>y(this,null,function*(){try{let a=J(L({},o),{timestamp:this.parseDate(o.timestamp),userId:r});yield Or(tn(this.db,"expenses",o.id),a)}catch(a){console.error("Error migrating expense:",a)}}))})}loadProducts(){this.fetchProducts()}fetchProducts(){let t=this.getCurrentUser(),r=`${this.apiUrl}/products`;t&&t!=="guest"&&(r+=`?userId=${t}`),this.http.get(r).subscribe({next:i=>this.productsSubject.next(i),error:i=>console.error("Error fetching products:",i)})}fetchSales(){let t=this.getCurrentUser();!t||t==="guest"||this.http.get(`${this.apiUrl}/sales?userId=${t}`).subscribe({next:r=>{let i=r.map(o=>this.transformSale(o));this.salesSubject.next(i)},error:r=>console.error("Error fetching sales:",r)})}fetchExpenses(){let t=this.getCurrentUser();!t||t==="guest"||this.http.get(`${this.apiUrl}/expenses?userId=${t}`).subscribe({next:r=>this.expensesSubject.next(r),error:r=>console.error("Error fetching expenses:",r)})}getProducts(){return this.products$}getSales(){return this.sales$}getExpenses(){return this.expenses$}addExpense(t){return y(this,null,function*(){let r=J(L({},t),{timestamp:new Date}),i;try{let a=J(L({},r),{userId:this.getFirestoreUserId()});i=(yield cs(ot(this.db,"expenses"),a)).id}catch(a){console.warn("Firestore write failed (proceeding with Legacy):",a)}let o=J(L({},r),{userId:this.getCurrentUser()});i&&Object.assign(o,{id:i}),this.http.post(`${this.apiUrl}/expenses`,o).subscribe({next:a=>{let u=this.expensesSubject.value;u.find(h=>h.id===a.id)||this.expensesSubject.next([...u,a]),this.loggingService.logActivity("create","expense",a.id,a.productName,`$${a.price.toFixed(2)}`)},error:a=>console.error("Error adding expense:",a)})})}deleteExpense(t){return y(this,null,function*(){try{yield Pf(tn(this.db,"expenses",t))}catch(r){console.warn("Firestore delete failed (proceeding with Legacy):",r)}this.http.delete(`${this.apiUrl}/expenses/${t}`).subscribe({next:()=>{let r=this.expensesSubject.value;this.expensesSubject.next(r.filter(i=>i.id!==t)),this.loggingService.logActivity("delete","expense",t,"Expense","Deleted")},error:r=>console.error("Error deleting expense:",r)})})}addProduct(t){return y(this,null,function*(){let r=J(L({},t),{createdAt:new Date}),i;try{let a=J(L({},r),{userId:this.getFirestoreUserId()});i=(yield cs(ot(this.db,"products"),a)).id}catch(a){console.warn("Firestore write failed:",a)}let o=J(L({},r),{userId:this.getCurrentUser()});i&&Object.assign(o,{id:i}),this.http.post(`${this.apiUrl}/products`,o).subscribe({next:a=>{let u=this.productsSubject.value;u.find(h=>h.id===a.id)||this.productsSubject.next([...u,a]),this.loggingService.logActivity("create","product",a.id,a.name)},error:a=>console.error("Error adding product:",a)})})}recordSale(t,r,i,o,a,u,h=0,d="amount",p){return y(this,null,function*(){let T=this.productsSubject.value.find(B=>B.id===t);if(!T)throw new Error("Product not found");if(T.quantity<r)throw new Error("Insufficient quantity");let R=T.price*r;h>0&&(d==="percent"?R=R-R*(h/100):R=R-h),R=Math.max(0,Math.round(R*100)/100);let O=i-R;if(O<0)throw new Error("Insufficient cash");let x={productId:T.id,productName:T.name,category:T.category,price:T.price,quantitySold:r,total:R,cashReceived:i,change:O,deliveryDate:o,deliveryNotes:a,customerId:u,pending:!0,discount:h,discountType:d,orderId:p,timestamp:new Date},N;try{let B=J(L({},x),{userId:this.getFirestoreUserId()});N=(yield cs(ot(this.db,"sales"),B)).id}catch(B){console.warn("Firestore Sale Write Failed:",B)}let z=J(L({},x),{userId:this.getCurrentUser()});N&&Object.assign(z,{id:N}),this.http.post(`${this.apiUrl}/sales`,z).subscribe({next:B=>{let H=this.salesSubject.value;H.find(_e=>_e.id===B.id)||this.salesSubject.next([...H,this.transformSale(B)]),this.loggingService.logActivity("create","sale",B.id,T.name,`Sold ${r} units (Pending Delivery)`)},error:B=>console.error("Error recording sale:",B)})})}completePendingSale(t){let r=this.salesSubject.value,i=r.find(o=>o.id===t);if(!i){console.error("Sale not found via ID");return}this.http.put(`${this.apiUrl}/sales/${t}`,{pending:!1}).subscribe({next:()=>{let o=r.map(h=>h.id===t?J(L({},h),{pending:!1}):h);this.salesSubject.next(o);let u=this.productsSubject.value.find(h=>h.id===i.productId);if(u){let h=J(L({},u),{quantity:u.quantity-i.quantitySold});this.updateProduct(h)}if(i.customerId){let h=this.customerService.getCustomerById(i.customerId);if(h){let d=Math.floor(i.total/5e3);if(d>0){let p=h.credits||0;this.customerService.updateCustomer(h.id,{credits:p+d}),this.loggingService.logActivity("update","customer",h.id,h.name,`Awarded ${d} credits for purchase`)}}}this.loggingService.logActivity("complete","sale",t,i.productName,`Marked as delivered & Deducted ${i.quantitySold} units`)},error:o=>console.error("Error completing sale:",o)})}updateSale(t){this.http.put(`${this.apiUrl}/sales/${t.id}`,t).subscribe({next:r=>{let o=this.salesSubject.value.map(a=>a.id===t.id?this.transformSale(r):a);this.salesSubject.next(o),this.loggingService.logActivity("update","sale",t.id,t.productName,"Updated delivery details")},error:r=>console.error("Error updating sale:",r)})}confirmReservation(t){if(!this.productsSubject.value.find(a=>a.id===t.productId)){console.error("Product not found for confirmation stock deduction");return}let o=J(L({},t),{reservationStatus:"confirmed"});this.http.put(`${this.apiUrl}/sales/${t.id}`,o).subscribe({next:a=>{let h=this.salesSubject.value.map(d=>d.id===t.id?this.transformSale(o):d);this.salesSubject.next(h),this.loggingService.logActivity("update","sale",t.id,t.productName,"Confirmed reservation (Stock deduction pending delivery)")},error:a=>console.error("Error confirming reservation:",a)})}transformSale(t){return J(L({},t),{timestamp:this.parseDate(t.timestamp),deliveryDate:t.deliveryDate?this.parseDate(t.deliveryDate):void 0})}parseDate(t){if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t.toDate=="function")return t.toDate();if(t&&(t.seconds!==void 0||t._seconds!==void 0)){let r=t.seconds??t._seconds;return new Date(r*1e3)}return typeof t=="string"?new Date(t):new Date(t)}restockProduct(t,r){let o=this.productsSubject.value.find(a=>a.id===t);if(o){let a=J(L({},o),{quantity:o.quantity+r});this.updateProduct(a),this.loggingService.logActivity("restock","product",t,o.name,`Added ${r} units`)}}deleteSale(t){this.http.delete(`${this.apiUrl}/sales/${t}`).subscribe({next:()=>{let i=this.salesSubject.value.filter(o=>o.id!==t);this.salesSubject.next(i),this.loggingService.logActivity("delete","sale",t,"Reservation/Sale","Deleted sale record")},error:r=>console.error("Error deleting sale:",r)})}updateProduct(t){return y(this,null,function*(){try{let r=J(L({},t),{userId:this.getFirestoreUserId()});yield Or(tn(this.db,"products",t.id),r,{merge:!0})}catch(r){console.warn("Firestore update failed (proceeding with Legacy):",r)}this.http.put(`${this.apiUrl}/products/${t.id}`,t).subscribe({next:()=>{let i=this.productsSubject.value.map(u=>u.id===t.id?t:u);this.productsSubject.next(i);let o=this.salesSubject.value,a=o.filter(u=>u.productId===t.id&&u.productName!==t.name);if(a.length>0){let u=o.map(h=>h.productId===t.id?J(L({},h),{productName:t.name}):h);this.salesSubject.next(u),a.forEach(h=>{let d=J(L({},h),{productName:t.name});this.http.put(`${this.apiUrl}/sales/${h.id}`,d).subscribe({error:p=>console.error(`Error updating sale ${h.id} name:`,p)})})}this.loggingService.logActivity("update","product",t.id,t.name)},error:r=>console.error("Error updating product:",r)})})}clearAllData(){this.productsSubject.next([]),this.salesSubject.next([]),this.expensesSubject.next([])}migrateFromLocalStorage(){let t=localStorage.getItem("jjm_products"),r=localStorage.getItem("jjm_sales"),i=localStorage.getItem("jjm_expenses");t&&JSON.parse(t).forEach(a=>this.addProduct(a)),r&&JSON.parse(r).forEach(a=>{this.http.post(`${this.apiUrl}/sales`,a).subscribe({error:u=>console.error("Error migrating sale:",u)})}),i&&JSON.parse(i).forEach(a=>this.addExpense(a)),console.log("Migration started...")}static{this.\u0275fac=function(r){return new(r||n)(nr(bl),nr(Sl),nr(Rl),nr(vp))}}static{this.\u0275prov=ri({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{ot as a,tn as b,Fn as c,as as d,Wc as e,Hc as f,Or as g,$E as h,Pf as i,cs as j,us as k,GE as l,vp as m,$T as n};
