import{P as Ah}from"./chunk-OKMRB5PS.js";import{a as wt,b as xr,f as na,g as C}from"./chunk-7QOE2ANW.js";var bh=()=>{};var Ph=function(r){let t=[],e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},qp=function(r){let t=[],e=0,n=0;for(;e<r.length;){let s=r[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){let i=r[e++];t[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){let i=r[e++],a=r[e++],c=r[e++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;t[n++]=String.fromCharCode(55296+(l>>10)),t[n++]=String.fromCharCode(56320+(l&1023))}else{let i=r[e++],a=r[e++];t[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return t.join("")},Ch={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){let i=r[s],a=s+1<r.length,c=a?r[s+1]:0,l=s+2<r.length,d=l?r[s+2]:0,m=i>>2,p=(i&3)<<4|c>>4,w=(c&15)<<2|d>>6,R=d&63;l||(R=64,a||(w=64)),n.push(e[m],e[p],e[w],e[R])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Ph(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):qp(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){let i=e[r.charAt(s++)],c=s<r.length?e[r.charAt(s)]:0;++s;let d=s<r.length?e[r.charAt(s)]:64;++s;let p=s<r.length?e[r.charAt(s)]:64;if(++s,i==null||c==null||d==null||p==null)throw new sa;let w=i<<2|c>>4;if(n.push(w),d!==64){let R=c<<4&240|d>>2;if(n.push(R),p!==64){let N=d<<6&192|p;n.push(N)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}},sa=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},jp=function(r){let t=Ph(r);return Ch.encodeByteArray(t,!0)},kr=function(r){return jp(r).replace(/\./g,"")},Dh=function(r){try{return Ch.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function oa(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var zp=()=>oa().__FIREBASE_DEFAULTS__,Gp=()=>{if(typeof process>"u"||typeof process.env>"u")return;let r=process.env.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},$p=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=r&&Dh(r[1]);return t&&JSON.parse(t)},Qs=()=>{try{return bh()||zp()||Gp()||$p()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Kp=r=>Qs()?.emulatorHosts?.[r],Vh=r=>{let t=Kp(r);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},aa=()=>Qs()?.config,yw=r=>Qs()?.[`_${r}`];var Ks=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}};function Mr(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}function ca(r){return C(this,null,function*(){return(yield fetch(r,{credentials:"include"})).ok})}function xh(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},n=t||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=wt({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},r);return[kr(JSON.stringify(e)),kr(JSON.stringify(a)),""].join(".")}var Nr={};function Qp(){let r={prod:[],emulator:[]};for(let t of Object.keys(Nr))Nr[t]?r.emulator.push(t):r.prod.push(t);return r}function Wp(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}var Sh=!1;function Nh(r,t){if(typeof window>"u"||typeof document>"u"||!Mr(window.location.host)||Nr[r]===t||Nr[r]||Sh)return;Nr[r]=t;function e(w){return`__firebase__banner__${w}`}let n="__firebase__banner",i=Qp().prod.length>0;function a(){let w=document.getElementById(n);w&&w.remove()}function c(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function l(w,R){w.setAttribute("width","24"),w.setAttribute("id",R),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function d(){let w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{Sh=!0,a()},w}function m(w,R){w.setAttribute("id",R),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function p(){let w=Wp(n),R=e("text"),N=document.getElementById(R)||document.createElement("span"),O=e("learnmore"),V=document.getElementById(O)||document.createElement("a"),G=e("preprendIcon"),j=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){let U=w.element;c(U),m(V,O);let tt=d();l(j,G),U.append(j,N,V,tt),document.body.appendChild(U)}i?(N.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function $e(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _w(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($e())}function kh(){let r=Qs()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ww(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Ew(){let r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Iw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Tw(){let r=$e();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function ua(){return!kh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function la(){return!kh()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Ws(){try{return typeof indexedDB=="object"}catch{return!1}}function Oh(){return new Promise((r,t)=>{try{let e=!0,n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}function vw(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}var Hp="FirebaseError",Zt=class r extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=Hp,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Or.prototype.create)}},Or=class{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){let n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],a=i?Jp(i,n):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Zt(s,c,n)}};function Jp(r,t){return r.replace(Xp,(e,n)=>{let s=t[n];return s!=null?String(s):`<${n}?>`})}var Xp=/\{\$([^}]+)}/g;function Aw(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function pe(r,t){if(r===t)return!0;let e=Object.keys(r),n=Object.keys(t);for(let s of e){if(!n.includes(s))return!1;let i=r[s],a=t[s];if(Rh(i)&&Rh(a)){if(!pe(i,a))return!1}else if(i!==a)return!1}for(let s of n)if(!e.includes(s))return!1;return!0}function Rh(r){return r!==null&&typeof r=="object"}function bw(r){let t=[];for(let[e,n]of Object.entries(r))Array.isArray(n)?n.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function Sw(r,t){let e=new ia(r,t);return e.subscribe.bind(e)}var ia=class{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(n=>{this.error(n)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,n){let s;if(t===void 0&&e===void 0&&n===void 0)throw new Error("Missing Observer.");Yp(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:n},s.next===void 0&&(s.next=ra),s.error===void 0&&(s.error=ra),s.complete===void 0&&(s.complete=ra);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Yp(r,t){if(typeof r!="object"||r===null)return!1;for(let e of t)if(e in r&&typeof r[e]=="function")return!0;return!1}function ra(){}var Rw=4*60*60*1e3;function xt(r){return r&&r._delegate?r._delegate:r}var te=class{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var Ke="[DEFAULT]";var ha=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let n=new Ks;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){let e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(tg(t))try{this.getOrInitializeService({instanceIdentifier:Ke})}catch{}for(let[e,n]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(t=Ke){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return C(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=Ke){return this.instances.has(t)}getOptions(t=Ke){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(let[i,a]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(i);n===c&&a.resolve(s)}return s}onInit(t,e){let n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);let i=this.instances.get(n);return i&&t(i,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){let n=this.onInitCallbacks.get(e);if(n)for(let s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Zp(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=Ke){return this.component?this.component.multipleInstances?t:Ke:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Zp(r){return r===Ke?void 0:r}function tg(r){return r.instantiationMode==="EAGER"}var Hs=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new ha(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var eg=[],H=function(r){return r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT",r}(H||{}),ng={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},rg=H.INFO,sg={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},ig=(r,t,...e)=>{if(t<r.logLevel)return;let n=new Date().toISOString(),s=sg[t];if(s)console[s](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},vn=class{constructor(t){this.name=t,this._logLevel=rg,this._logHandler=ig,this._userLogHandler=null,eg.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in H))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?ng[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...t),this._logHandler(this,H.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...t),this._logHandler(this,H.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,H.INFO,...t),this._logHandler(this,H.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,H.WARN,...t),this._logHandler(this,H.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...t),this._logHandler(this,H.ERROR,...t)}};var og=(r,t)=>t.some(e=>r instanceof e),Mh,Fh;function ag(){return Mh||(Mh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function cg(){return Fh||(Fh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Lh=new WeakMap,fa=new WeakMap,Bh=new WeakMap,da=new WeakMap,pa=new WeakMap;function ug(r){let t=new Promise((e,n)=>{let s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",a)},i=()=>{e(Bt(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Lh.set(e,r)}).catch(()=>{}),pa.set(t,r),t}function lg(r){if(fa.has(r))return;let t=new Promise((e,n)=>{let s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",a),r.removeEventListener("abort",a)},i=()=>{e(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",a),r.addEventListener("abort",a)});fa.set(r,t)}var ma={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return fa.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Bh.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Bt(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Uh(r){ma=r(ma)}function hg(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let n=r.call(Js(this),t,...e);return Bh.set(n,t.sort?t.sort():[t]),Bt(n)}:cg().includes(r)?function(...t){return r.apply(Js(this),t),Bt(Lh.get(this))}:function(...t){return Bt(r.apply(Js(this),t))}}function dg(r){return typeof r=="function"?hg(r):(r instanceof IDBTransaction&&lg(r),og(r,ag())?new Proxy(r,ma):r)}function Bt(r){if(r instanceof IDBRequest)return ug(r);if(da.has(r))return da.get(r);let t=dg(r);return t!==r&&(da.set(r,t),pa.set(t,r)),t}var Js=r=>pa.get(r);function jh(r,t,{blocked:e,upgrade:n,blocking:s,terminated:i}={}){let a=indexedDB.open(r,t),c=Bt(a);return n&&a.addEventListener("upgradeneeded",l=>{n(Bt(a.result),l.oldVersion,l.newVersion,Bt(a.transaction),l)}),e&&a.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}function Mw(r,{blocked:t}={}){let e=indexedDB.deleteDatabase(r);return t&&e.addEventListener("blocked",n=>t(n.oldVersion,n)),Bt(e).then(()=>{})}var fg=["get","getKey","getAll","getAllKeys","count"],mg=["put","add","delete","clear"],ga=new Map;function qh(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(ga.get(t))return ga.get(t);let e=t.replace(/FromIndex$/,""),n=t!==e,s=mg.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||fg.includes(e)))return;let i=function(a,...c){return C(this,null,function*(){let l=this.transaction(a,s?"readwrite":"readonly"),d=l.store;return n&&(d=d.index(c.shift())),(yield Promise.all([d[e](...c),s&&l.done]))[0]})};return ga.set(t,i),i}Uh(r=>xr(wt({},r),{get:(t,e,n)=>qh(t,e)||r.get(t,e,n),has:(t,e)=>!!qh(t,e)||r.has(t,e)}));var _a=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(pg(e)){let n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}};function pg(r){return r.getComponent()?.type==="VERSION"}var wa="@firebase/app",zh="0.14.6";var ee=new vn("@firebase/app"),gg="@firebase/app-compat",yg="@firebase/analytics-compat",_g="@firebase/analytics",wg="@firebase/app-check-compat",Eg="@firebase/app-check",Ig="@firebase/auth",Tg="@firebase/auth-compat",vg="@firebase/database",Ag="@firebase/data-connect",bg="@firebase/database-compat",Sg="@firebase/functions",Rg="@firebase/functions-compat",Pg="@firebase/installations",Cg="@firebase/installations-compat",Dg="@firebase/messaging",Vg="@firebase/messaging-compat",xg="@firebase/performance",Ng="@firebase/performance-compat",kg="@firebase/remote-config",Og="@firebase/remote-config-compat",Mg="@firebase/storage",Fg="@firebase/storage-compat",Lg="@firebase/firestore",Bg="@firebase/ai",Ug="@firebase/firestore-compat",qg="firebase",jg="12.6.0";var Ea="[DEFAULT]",zg={[wa]:"fire-core",[gg]:"fire-core-compat",[_g]:"fire-analytics",[yg]:"fire-analytics-compat",[Eg]:"fire-app-check",[wg]:"fire-app-check-compat",[Ig]:"fire-auth",[Tg]:"fire-auth-compat",[vg]:"fire-rtdb",[Ag]:"fire-data-connect",[bg]:"fire-rtdb-compat",[Sg]:"fire-fn",[Rg]:"fire-fn-compat",[Pg]:"fire-iid",[Cg]:"fire-iid-compat",[Dg]:"fire-fcm",[Vg]:"fire-fcm-compat",[xg]:"fire-perf",[Ng]:"fire-perf-compat",[kg]:"fire-rc",[Og]:"fire-rc-compat",[Mg]:"fire-gcs",[Fg]:"fire-gcs-compat",[Lg]:"fire-fst",[Ug]:"fire-fst-compat",[Bg]:"fire-vertex","fire-js":"fire-js",[qg]:"fire-js-all"};var Xs=new Map,Gg=new Map,Ia=new Map;function Gh(r,t){try{r.container.addComponent(t)}catch(e){ee.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function Fr(r){let t=r.name;if(Ia.has(t))return ee.debug(`There were multiple attempts to register component ${t}.`),!1;Ia.set(t,r);for(let e of Xs.values())Gh(e,r);for(let e of Gg.values())Gh(e,r);return!0}function ba(r,t){let e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function Wh(r){return r==null?!1:r.settings!==void 0}var $g={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ge=new Or("app","Firebase",$g);var Ta=class{constructor(t,e,n){this._isDeleted=!1,this._options=wt({},t),this._config=wt({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new te("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ge.create("app-deleted",{appName:this._name})}};var Hh=jg;function Kg(r,t={}){let e=r;typeof t!="object"&&(t={name:t});let n=wt({name:Ea,automaticDataCollectionEnabled:!0},t),s=n.name;if(typeof s!="string"||!s)throw ge.create("bad-app-name",{appName:String(s)});if(e||(e=aa()),!e)throw ge.create("no-options");let i=Xs.get(s);if(i){if(pe(e,i.options)&&pe(n,i.config))return i;throw ge.create("duplicate-app",{appName:s})}let a=new Hs(s);for(let l of Ia.values())a.addComponent(l);let c=new Ta(e,n,a);return Xs.set(s,c),c}function Ys(r=Ea){let t=Xs.get(r);if(!t&&r===Ea&&aa())return Kg();if(!t)throw ge.create("no-app",{appName:r});return t}function ye(r,t,e){let n=zg[r]??r;e&&(n+=`-${e}`);let s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){let a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ee.warn(a.join(" "));return}Fr(new te(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}var Qg="firebase-heartbeat-database",Wg=1,Lr="firebase-heartbeat-store",ya=null;function Jh(){return ya||(ya=jh(Qg,Wg,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Lr)}catch(e){console.warn(e)}}}}).catch(r=>{throw ge.create("idb-open",{originalErrorMessage:r.message})})),ya}function Hg(r){return C(this,null,function*(){try{let e=(yield Jh()).transaction(Lr),n=yield e.objectStore(Lr).get(Xh(r));return yield e.done,n}catch(t){if(t instanceof Zt)ee.warn(t.message);else{let e=ge.create("idb-get",{originalErrorMessage:t?.message});ee.warn(e.message)}}})}function $h(r,t){return C(this,null,function*(){try{let n=(yield Jh()).transaction(Lr,"readwrite");yield n.objectStore(Lr).put(t,Xh(r)),yield n.done}catch(e){if(e instanceof Zt)ee.warn(e.message);else{let n=ge.create("idb-set",{originalErrorMessage:e?.message});ee.warn(n.message)}}})}function Xh(r){return`${r.name}!${r.options.appId}`}var Jg=1024,Xg=30,va=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new Aa(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}triggerHeartbeat(){return C(this,null,function*(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Kh();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>Xg){let s=Zg(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){ee.warn(t)}})}getHeartbeatsHeader(){return C(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Kh(),{heartbeatsToSend:e,unsentEntries:n}=Yg(this._heartbeatsCache.heartbeats),s=kr(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return ee.warn(t),""}})}};function Kh(){return new Date().toISOString().substring(0,10)}function Yg(r,t=Jg){let e=[],n=r.slice();for(let s of r){let i=e.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Qh(e)>t){i.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Qh(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}var Aa=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return C(this,null,function*(){return Ws()?Oh().then(()=>!0).catch(()=>!1):!1})}read(){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield Hg(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield this.read();return $h(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield this.read();return $h(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return})}};function Qh(r){return kr(JSON.stringify({version:2,heartbeats:r})).length}function Zg(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}function ty(r){Fr(new te("platform-logger",t=>new _a(t),"PRIVATE")),Fr(new te("heartbeat",t=>new va(t),"PRIVATE")),ye(wa,zh,r),ye(wa,zh,"esm2020"),ye("fire-js","")}ty("");var Yh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Zh={};var ne,Sa;(function(){var r;function t(E,g){function _(){}_.prototype=g.prototype,E.F=g.prototype,E.prototype=new _,E.prototype.constructor=E,E.D=function(T,I,A){for(var y=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)y[Ct-2]=arguments[Ct];return g.prototype[I].apply(T,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(n,e),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,g,_){_||(_=0);let T=Array(16);if(typeof g=="string")for(var I=0;I<16;++I)T[I]=g.charCodeAt(_++)|g.charCodeAt(_++)<<8|g.charCodeAt(_++)<<16|g.charCodeAt(_++)<<24;else for(I=0;I<16;++I)T[I]=g[_++]|g[_++]<<8|g[_++]<<16|g[_++]<<24;g=E.g[0],_=E.g[1],I=E.g[2];let A=E.g[3],y;y=g+(A^_&(I^A))+T[0]+3614090360&4294967295,g=_+(y<<7&4294967295|y>>>25),y=A+(I^g&(_^I))+T[1]+3905402710&4294967295,A=g+(y<<12&4294967295|y>>>20),y=I+(_^A&(g^_))+T[2]+606105819&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(g^I&(A^g))+T[3]+3250441966&4294967295,_=I+(y<<22&4294967295|y>>>10),y=g+(A^_&(I^A))+T[4]+4118548399&4294967295,g=_+(y<<7&4294967295|y>>>25),y=A+(I^g&(_^I))+T[5]+1200080426&4294967295,A=g+(y<<12&4294967295|y>>>20),y=I+(_^A&(g^_))+T[6]+2821735955&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(g^I&(A^g))+T[7]+4249261313&4294967295,_=I+(y<<22&4294967295|y>>>10),y=g+(A^_&(I^A))+T[8]+1770035416&4294967295,g=_+(y<<7&4294967295|y>>>25),y=A+(I^g&(_^I))+T[9]+2336552879&4294967295,A=g+(y<<12&4294967295|y>>>20),y=I+(_^A&(g^_))+T[10]+4294925233&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(g^I&(A^g))+T[11]+2304563134&4294967295,_=I+(y<<22&4294967295|y>>>10),y=g+(A^_&(I^A))+T[12]+1804603682&4294967295,g=_+(y<<7&4294967295|y>>>25),y=A+(I^g&(_^I))+T[13]+4254626195&4294967295,A=g+(y<<12&4294967295|y>>>20),y=I+(_^A&(g^_))+T[14]+2792965006&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(g^I&(A^g))+T[15]+1236535329&4294967295,_=I+(y<<22&4294967295|y>>>10),y=g+(I^A&(_^I))+T[1]+4129170786&4294967295,g=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(g^_))+T[6]+3225465664&4294967295,A=g+(y<<9&4294967295|y>>>23),y=I+(g^_&(A^g))+T[11]+643717713&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^g&(I^A))+T[0]+3921069994&4294967295,_=I+(y<<20&4294967295|y>>>12),y=g+(I^A&(_^I))+T[5]+3593408605&4294967295,g=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(g^_))+T[10]+38016083&4294967295,A=g+(y<<9&4294967295|y>>>23),y=I+(g^_&(A^g))+T[15]+3634488961&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^g&(I^A))+T[4]+3889429448&4294967295,_=I+(y<<20&4294967295|y>>>12),y=g+(I^A&(_^I))+T[9]+568446438&4294967295,g=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(g^_))+T[14]+3275163606&4294967295,A=g+(y<<9&4294967295|y>>>23),y=I+(g^_&(A^g))+T[3]+4107603335&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^g&(I^A))+T[8]+1163531501&4294967295,_=I+(y<<20&4294967295|y>>>12),y=g+(I^A&(_^I))+T[13]+2850285829&4294967295,g=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(g^_))+T[2]+4243563512&4294967295,A=g+(y<<9&4294967295|y>>>23),y=I+(g^_&(A^g))+T[7]+1735328473&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^g&(I^A))+T[12]+2368359562&4294967295,_=I+(y<<20&4294967295|y>>>12),y=g+(_^I^A)+T[5]+4294588738&4294967295,g=_+(y<<4&4294967295|y>>>28),y=A+(g^_^I)+T[8]+2272392833&4294967295,A=g+(y<<11&4294967295|y>>>21),y=I+(A^g^_)+T[11]+1839030562&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^g)+T[14]+4259657740&4294967295,_=I+(y<<23&4294967295|y>>>9),y=g+(_^I^A)+T[1]+2763975236&4294967295,g=_+(y<<4&4294967295|y>>>28),y=A+(g^_^I)+T[4]+1272893353&4294967295,A=g+(y<<11&4294967295|y>>>21),y=I+(A^g^_)+T[7]+4139469664&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^g)+T[10]+3200236656&4294967295,_=I+(y<<23&4294967295|y>>>9),y=g+(_^I^A)+T[13]+681279174&4294967295,g=_+(y<<4&4294967295|y>>>28),y=A+(g^_^I)+T[0]+3936430074&4294967295,A=g+(y<<11&4294967295|y>>>21),y=I+(A^g^_)+T[3]+3572445317&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^g)+T[6]+76029189&4294967295,_=I+(y<<23&4294967295|y>>>9),y=g+(_^I^A)+T[9]+3654602809&4294967295,g=_+(y<<4&4294967295|y>>>28),y=A+(g^_^I)+T[12]+3873151461&4294967295,A=g+(y<<11&4294967295|y>>>21),y=I+(A^g^_)+T[15]+530742520&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^g)+T[2]+3299628645&4294967295,_=I+(y<<23&4294967295|y>>>9),y=g+(I^(_|~A))+T[0]+4096336452&4294967295,g=_+(y<<6&4294967295|y>>>26),y=A+(_^(g|~I))+T[7]+1126891415&4294967295,A=g+(y<<10&4294967295|y>>>22),y=I+(g^(A|~_))+T[14]+2878612391&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~g))+T[5]+4237533241&4294967295,_=I+(y<<21&4294967295|y>>>11),y=g+(I^(_|~A))+T[12]+1700485571&4294967295,g=_+(y<<6&4294967295|y>>>26),y=A+(_^(g|~I))+T[3]+2399980690&4294967295,A=g+(y<<10&4294967295|y>>>22),y=I+(g^(A|~_))+T[10]+4293915773&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~g))+T[1]+2240044497&4294967295,_=I+(y<<21&4294967295|y>>>11),y=g+(I^(_|~A))+T[8]+1873313359&4294967295,g=_+(y<<6&4294967295|y>>>26),y=A+(_^(g|~I))+T[15]+4264355552&4294967295,A=g+(y<<10&4294967295|y>>>22),y=I+(g^(A|~_))+T[6]+2734768916&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~g))+T[13]+1309151649&4294967295,_=I+(y<<21&4294967295|y>>>11),y=g+(I^(_|~A))+T[4]+4149444226&4294967295,g=_+(y<<6&4294967295|y>>>26),y=A+(_^(g|~I))+T[11]+3174756917&4294967295,A=g+(y<<10&4294967295|y>>>22),y=I+(g^(A|~_))+T[2]+718787259&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~g))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+I&4294967295,E.g[3]=E.g[3]+A&4294967295}n.prototype.v=function(E,g){g===void 0&&(g=E.length);let _=g-this.blockSize,T=this.C,I=this.h,A=0;for(;A<g;){if(I==0)for(;A<=_;)s(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<g;)if(T[I++]=E.charCodeAt(A++),I==this.blockSize){s(this,T),I=0;break}}else for(;A<g;)if(T[I++]=E[A++],I==this.blockSize){s(this,T),I=0;break}}this.h=I,this.o+=g},n.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var _=E.length-8;_<E.length;++_)E[_]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,_=0;_<4;++_)for(let T=0;T<32;T+=8)E[g++]=this.g[_]>>>T&255;return E};function i(E,g){var _=c;return Object.prototype.hasOwnProperty.call(_,E)?_[E]:_[E]=g(E)}function a(E,g){this.h=g;let _=[],T=!0;for(let I=E.length-1;I>=0;I--){let A=E[I]|0;T&&A==g||(_[I]=A,T=!1)}this.g=_}var c={};function l(E){return-128<=E&&E<128?i(E,function(g){return new a([g|0],g<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return p;if(E<0)return V(d(-E));let g=[],_=1;for(let T=0;E>=_;T++)g[T]=E/_|0,_*=4294967296;return new a(g,0)}function m(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return V(m(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');let _=d(Math.pow(g,8)),T=p;for(let A=0;A<E.length;A+=8){var I=Math.min(8,E.length-A);let y=parseInt(E.substring(A,A+I),g);I<8?(I=d(Math.pow(g,I)),T=T.j(I).add(d(y))):(T=T.j(_),T=T.add(d(y)))}return T}var p=l(0),w=l(1),R=l(16777216);r=a.prototype,r.m=function(){if(O(this))return-V(this).m();let E=0,g=1;for(let _=0;_<this.g.length;_++){let T=this.i(_);E+=(T>=0?T:4294967296+T)*g,g*=4294967296}return E},r.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(N(this))return"0";if(O(this))return"-"+V(this).toString(E);let g=d(Math.pow(E,6));var _=this;let T="";for(;;){let I=tt(_,g).g;_=G(_,I.j(g));let A=((_.g.length>0?_.g[0]:_.h)>>>0).toString(E);if(_=I,N(_))return A+T;for(;A.length<6;)A="0"+A;T=A+T}},r.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function N(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function O(E){return E.h==-1}r.l=function(E){return E=G(this,E),O(E)?-1:N(E)?0:1};function V(E){let g=E.g.length,_=[];for(let T=0;T<g;T++)_[T]=~E.g[T];return new a(_,~E.h).add(w)}r.abs=function(){return O(this)?V(this):this},r.add=function(E){let g=Math.max(this.g.length,E.g.length),_=[],T=0;for(let I=0;I<=g;I++){let A=T+(this.i(I)&65535)+(E.i(I)&65535),y=(A>>>16)+(this.i(I)>>>16)+(E.i(I)>>>16);T=y>>>16,A&=65535,y&=65535,_[I]=y<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function G(E,g){return E.add(V(g))}r.j=function(E){if(N(this)||N(E))return p;if(O(this))return O(E)?V(this).j(V(E)):V(V(this).j(E));if(O(E))return V(this.j(V(E)));if(this.l(R)<0&&E.l(R)<0)return d(this.m()*E.m());let g=this.g.length+E.g.length,_=[];for(var T=0;T<2*g;T++)_[T]=0;for(T=0;T<this.g.length;T++)for(let I=0;I<E.g.length;I++){let A=this.i(T)>>>16,y=this.i(T)&65535,Ct=E.i(I)>>>16,ce=E.i(I)&65535;_[2*T+2*I]+=y*ce,j(_,2*T+2*I),_[2*T+2*I+1]+=A*ce,j(_,2*T+2*I+1),_[2*T+2*I+1]+=y*Ct,j(_,2*T+2*I+1),_[2*T+2*I+2]+=A*Ct,j(_,2*T+2*I+2)}for(E=0;E<g;E++)_[E]=_[2*E+1]<<16|_[2*E];for(E=g;E<2*g;E++)_[E]=0;return new a(_,0)};function j(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function U(E,g){this.g=E,this.h=g}function tt(E,g){if(N(g))throw Error("division by zero");if(N(E))return new U(p,p);if(O(E))return g=tt(V(E),g),new U(V(g.g),V(g.h));if(O(g))return g=tt(E,V(g)),new U(V(g.g),g.h);if(E.g.length>30){if(O(E)||O(g))throw Error("slowDivide_ only works with positive integers.");for(var _=w,T=g;T.l(E)<=0;)_=X(_),T=X(T);var I=W(_,1),A=W(T,1);for(T=W(T,2),_=W(_,2);!N(T);){var y=A.add(T);y.l(E)<=0&&(I=I.add(_),A=y),T=W(T,1),_=W(_,1)}return g=G(E,I.j(g)),new U(I,g)}for(I=p;E.l(g)>=0;){for(_=Math.max(1,Math.floor(E.m()/g.m())),T=Math.ceil(Math.log(_)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),A=d(_),y=A.j(g);O(y)||y.l(E)>0;)_-=T,A=d(_),y=A.j(g);N(A)&&(A=w),I=I.add(A),E=G(E,y)}return new U(I,E)}r.B=function(E){return tt(this,E).h},r.and=function(E){let g=Math.max(this.g.length,E.g.length),_=[];for(let T=0;T<g;T++)_[T]=this.i(T)&E.i(T);return new a(_,this.h&E.h)},r.or=function(E){let g=Math.max(this.g.length,E.g.length),_=[];for(let T=0;T<g;T++)_[T]=this.i(T)|E.i(T);return new a(_,this.h|E.h)},r.xor=function(E){let g=Math.max(this.g.length,E.g.length),_=[];for(let T=0;T<g;T++)_[T]=this.i(T)^E.i(T);return new a(_,this.h^E.h)};function X(E){let g=E.g.length+1,_=[];for(let T=0;T<g;T++)_[T]=E.i(T)<<1|E.i(T-1)>>>31;return new a(_,E.h)}function W(E,g){let _=g>>5;g%=32;let T=E.g.length-_,I=[];for(let A=0;A<T;A++)I[A]=g>0?E.i(A+_)>>>g|E.i(A+_+1)<<32-g:E.i(A+_);return new a(I,E.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Sa=Zh.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=m,ne=Zh.Integer=a}).apply(typeof Yh<"u"?Yh:typeof self<"u"?self:typeof window<"u"?window:{});var Zs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},re={};var Ra,ey,An,Pa,Br,ti,Ca,Da,Va;(function(){var r,t=Object.defineProperty;function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Zs=="object"&&Zs];for(var u=0;u<o.length;++u){var h=o[u];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function s(o,u){if(u)t:{var h=n;o=o.split(".");for(var f=0;f<o.length-1;f++){var v=o[f];if(!(v in h))break t;h=h[v]}o=o[o.length-1],f=h[o],u=u(f),u!=f&&u!=null&&t(h,o,{configurable:!0,writable:!0,value:u})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(u){var h=[],f;for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&h.push([f,u[f]]);return h}});var i=i||{},a=this||self;function c(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function l(o,u,h){return o.call.apply(o.bind,arguments)}function d(o,u,h){return d=l,d.apply(null,arguments)}function m(o,u){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function p(o,u){function h(){}h.prototype=u.prototype,o.Z=u.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(f,v,S){for(var k=Array(arguments.length-2),$=2;$<arguments.length;$++)k[$-2]=arguments[$];return u.prototype[v].apply(f,k)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function R(o){let u=o.length;if(u>0){let h=Array(u);for(let f=0;f<u;f++)h[f]=o[f];return h}return[]}function N(o,u){for(let f=1;f<arguments.length;f++){let v=arguments[f];var h=typeof v;if(h=h!="object"?h:v?Array.isArray(v)?"array":h:"null",h=="array"||h=="object"&&typeof v.length=="number"){h=o.length||0;let S=v.length||0;o.length=h+S;for(let k=0;k<S;k++)o[h+k]=v[k]}else o.push(v)}}class O{constructor(u,h){this.i=u,this.j=h,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function V(o){a.setTimeout(()=>{throw o},0)}function G(){var o=E;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class j{constructor(){this.h=this.g=null}add(u,h){let f=U.get();f.set(u,h),this.h?this.h.next=f:this.g=f,this.h=f}}var U=new O(()=>new tt,o=>o.reset());class tt{constructor(){this.next=this.g=this.h=null}set(u,h){this.h=u,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let X,W=!1,E=new j,g=()=>{let o=Promise.resolve(void 0);X=()=>{o.then(_)}};function _(){for(var o;o=G();){try{o.h.call(o.g)}catch(h){V(h)}var u=U;u.j(o),u.h<100&&(u.h++,o.next=u.g,u.g=o)}W=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var A=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};a.addEventListener("test",h,u),a.removeEventListener("test",h,u)}catch{}return o}();function y(o){return/^[\s\xa0]*$/.test(o)}function Ct(o,u){I.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,u)}p(Ct,I),Ct.prototype.init=function(o,u){let h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget,u||(h=="mouseover"?u=o.fromElement:h=="mouseout"&&(u=o.toElement)),this.relatedTarget=u,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Ct.Z.h.call(this)},Ct.prototype.h=function(){Ct.Z.h.call(this);let o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ce="closure_listenable_"+(Math.random()*1e6|0),lp=0;function hp(o,u,h,f,v){this.listener=o,this.proxy=null,this.src=u,this.type=h,this.capture=!!f,this.ha=v,this.key=++lp,this.da=this.fa=!1}function Ds(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Vs(o,u,h){for(let f in o)u.call(h,o[f],f,o)}function dp(o,u){for(let h in o)u.call(void 0,o[h],h,o)}function Tl(o){let u={};for(let h in o)u[h]=o[h];return u}let vl="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Al(o,u){let h,f;for(let v=1;v<arguments.length;v++){f=arguments[v];for(h in f)o[h]=f[h];for(let S=0;S<vl.length;S++)h=vl[S],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function xs(o){this.src=o,this.g={},this.h=0}xs.prototype.add=function(o,u,h,f,v){let S=o.toString();o=this.g[S],o||(o=this.g[S]=[],this.h++);let k=No(o,u,f,v);return k>-1?(u=o[k],h||(u.fa=!1)):(u=new hp(u,this.src,S,!!f,v),u.fa=h,o.push(u)),u};function xo(o,u){let h=u.type;if(h in o.g){var f=o.g[h],v=Array.prototype.indexOf.call(f,u,void 0),S;(S=v>=0)&&Array.prototype.splice.call(f,v,1),S&&(Ds(u),o.g[h].length==0&&(delete o.g[h],o.h--))}}function No(o,u,h,f){for(let v=0;v<o.length;++v){let S=o[v];if(!S.da&&S.listener==u&&S.capture==!!h&&S.ha==f)return v}return-1}var ko="closure_lm_"+(Math.random()*1e6|0),Oo={};function bl(o,u,h,f,v){if(f&&f.once)return Rl(o,u,h,f,v);if(Array.isArray(u)){for(let S=0;S<u.length;S++)bl(o,u[S],h,f,v);return null}return h=Bo(h),o&&o[ce]?o.J(u,h,c(f)?!!f.capture:!!f,v):Sl(o,u,h,!1,f,v)}function Sl(o,u,h,f,v,S){if(!u)throw Error("Invalid event type");let k=c(v)?!!v.capture:!!v,$=Fo(o);if($||(o[ko]=$=new xs(o)),h=$.add(u,h,f,k,S),h.proxy)return h;if(f=fp(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)A||(v=k),v===void 0&&(v=!1),o.addEventListener(u.toString(),f,v);else if(o.attachEvent)o.attachEvent(Cl(u.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function fp(){function o(h){return u.call(o.src,o.listener,h)}let u=mp;return o}function Rl(o,u,h,f,v){if(Array.isArray(u)){for(let S=0;S<u.length;S++)Rl(o,u[S],h,f,v);return null}return h=Bo(h),o&&o[ce]?o.K(u,h,c(f)?!!f.capture:!!f,v):Sl(o,u,h,!0,f,v)}function Pl(o,u,h,f,v){if(Array.isArray(u))for(var S=0;S<u.length;S++)Pl(o,u[S],h,f,v);else f=c(f)?!!f.capture:!!f,h=Bo(h),o&&o[ce]?(o=o.i,S=String(u).toString(),S in o.g&&(u=o.g[S],h=No(u,h,f,v),h>-1&&(Ds(u[h]),Array.prototype.splice.call(u,h,1),u.length==0&&(delete o.g[S],o.h--)))):o&&(o=Fo(o))&&(u=o.g[u.toString()],o=-1,u&&(o=No(u,h,f,v)),(h=o>-1?u[o]:null)&&Mo(h))}function Mo(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[ce])xo(u.i,o);else{var h=o.type,f=o.proxy;u.removeEventListener?u.removeEventListener(h,f,o.capture):u.detachEvent?u.detachEvent(Cl(h),f):u.addListener&&u.removeListener&&u.removeListener(f),(h=Fo(u))?(xo(h,o),h.h==0&&(h.src=null,u[ko]=null)):Ds(o)}}}function Cl(o){return o in Oo?Oo[o]:Oo[o]="on"+o}function mp(o,u){if(o.da)o=!0;else{u=new Ct(u,this);let h=o.listener,f=o.ha||o.src;o.fa&&Mo(o),o=h.call(f,u)}return o}function Fo(o){return o=o[ko],o instanceof xs?o:null}var Lo="__closure_events_fn_"+(Math.random()*1e9>>>0);function Bo(o){return typeof o=="function"?o:(o[Lo]||(o[Lo]=function(u){return o.handleEvent(u)}),o[Lo])}function Tt(){T.call(this),this.i=new xs(this),this.M=this,this.G=null}p(Tt,T),Tt.prototype[ce]=!0,Tt.prototype.removeEventListener=function(o,u,h,f){Pl(this,o,u,h,f)};function bt(o,u){var h,f=o.G;if(f)for(h=[];f;f=f.G)h.push(f);if(o=o.M,f=u.type||u,typeof u=="string")u=new I(u,o);else if(u instanceof I)u.target=u.target||o;else{var v=u;u=new I(f,o),Al(u,v)}v=!0;let S,k;if(h)for(k=h.length-1;k>=0;k--)S=u.g=h[k],v=Ns(S,f,!0,u)&&v;if(S=u.g=o,v=Ns(S,f,!0,u)&&v,v=Ns(S,f,!1,u)&&v,h)for(k=0;k<h.length;k++)S=u.g=h[k],v=Ns(S,f,!1,u)&&v}Tt.prototype.N=function(){if(Tt.Z.N.call(this),this.i){var o=this.i;for(let u in o.g){let h=o.g[u];for(let f=0;f<h.length;f++)Ds(h[f]);delete o.g[u],o.h--}}this.G=null},Tt.prototype.J=function(o,u,h,f){return this.i.add(String(o),u,!1,h,f)},Tt.prototype.K=function(o,u,h,f){return this.i.add(String(o),u,!0,h,f)};function Ns(o,u,h,f){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();let v=!0;for(let S=0;S<u.length;++S){let k=u[S];if(k&&!k.da&&k.capture==h){let $=k.listener,mt=k.ha||k.src;k.fa&&xo(o.i,k),v=$.call(mt,f)!==!1&&v}}return v&&!f.defaultPrevented}function pp(o,u){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:a.setTimeout(o,u||0)}function Dl(o){o.g=pp(()=>{o.g=null,o.i&&(o.i=!1,Dl(o))},o.l);let u=o.h;o.h=null,o.m.apply(null,u)}class gp extends T{constructor(u,h){super(),this.m=u,this.l=h,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Dl(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gr(o){T.call(this),this.h=o,this.g={}}p(gr,T);var Vl=[];function xl(o){Vs(o.g,function(u,h){this.g.hasOwnProperty(h)&&Mo(u)},o),o.g={}}gr.prototype.N=function(){gr.Z.N.call(this),xl(this)},gr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Uo=a.JSON.stringify,yp=a.JSON.parse,_p=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Nl(){}function kl(){}var yr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function qo(){I.call(this,"d")}p(qo,I);function jo(){I.call(this,"c")}p(jo,I);var Ue={},Ol=null;function ks(){return Ol=Ol||new Tt}Ue.Ia="serverreachability";function Ml(o){I.call(this,Ue.Ia,o)}p(Ml,I);function _r(o){let u=ks();bt(u,new Ml(u))}Ue.STAT_EVENT="statevent";function Fl(o,u){I.call(this,Ue.STAT_EVENT,o),this.stat=u}p(Fl,I);function St(o){let u=ks();bt(u,new Fl(u,o))}Ue.Ja="timingevent";function Ll(o,u){I.call(this,Ue.Ja,o),this.size=u}p(Ll,I);function wr(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},u)}function Er(){this.g=!0}Er.prototype.ua=function(){this.g=!1};function wp(o,u,h,f,v,S){o.info(function(){if(o.g)if(S){var k="",$=S.split("&");for(let nt=0;nt<$.length;nt++){var mt=$[nt].split("=");if(mt.length>1){let yt=mt[0];mt=mt[1];let $t=yt.split("_");k=$t.length>=2&&$t[1]=="type"?k+(yt+"="+mt+"&"):k+(yt+"=redacted&")}}}else k=null;else k=S;return"XMLHTTP REQ ("+f+") [attempt "+v+"]: "+u+`
`+h+`
`+k})}function Ep(o,u,h,f,v,S,k){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+v+"]: "+u+`
`+h+`
`+S+" "+k})}function En(o,u,h,f){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+Tp(o,h)+(f?" "+f:"")})}function Ip(o,u){o.info(function(){return"TIMEOUT: "+u})}Er.prototype.info=function(){};function Tp(o,u){if(!o.g)return u;if(!u)return null;try{let S=JSON.parse(u);if(S){for(o=0;o<S.length;o++)if(Array.isArray(S[o])){var h=S[o];if(!(h.length<2)){var f=h[1];if(Array.isArray(f)&&!(f.length<1)){var v=f[0];if(v!="noop"&&v!="stop"&&v!="close")for(let k=1;k<f.length;k++)f[k]=""}}}}return Uo(S)}catch{return u}}var Os={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Bl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ul;function zo(){}p(zo,Nl),zo.prototype.g=function(){return new XMLHttpRequest},Ul=new zo;function Ir(o){return encodeURIComponent(String(o))}function vp(o){var u=1;o=o.split(":");let h=[];for(;u>0&&o.length;)h.push(o.shift()),u--;return o.length&&h.push(o.join(":")),h}function ue(o,u,h,f){this.j=o,this.i=u,this.l=h,this.S=f||1,this.V=new gr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ql}function ql(){this.i=null,this.g="",this.h=!1}var jl={},Go={};function $o(o,u,h){o.M=1,o.A=Fs(Gt(u)),o.u=h,o.R=!0,zl(o,null)}function zl(o,u){o.F=Date.now(),Ms(o),o.B=Gt(o.A);var h=o.B,f=o.S;Array.isArray(f)||(f=[String(f)]),nh(h.i,"t",f),o.C=0,h=o.j.L,o.h=new ql,o.g=Eh(o.j,h?u:null,!o.u),o.P>0&&(o.O=new gp(d(o.Y,o,o.g),o.P)),u=o.V,h=o.g,f=o.ba;var v="readystatechange";Array.isArray(v)||(v&&(Vl[0]=v.toString()),v=Vl);for(let S=0;S<v.length;S++){let k=bl(h,v[S],f||u.handleEvent,!1,u.h||u);if(!k)break;u.g[k.key]=k}u=o.J?Tl(o.J):{},o.u?(o.v||(o.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,u)):(o.v="GET",o.g.ea(o.B,o.v,null,u)),_r(),wp(o.i,o.v,o.B,o.l,o.S,o.u)}ue.prototype.ba=function(o){o=o.target;let u=this.O;u&&de(o)==3?u.j():this.Y(o)},ue.prototype.Y=function(o){try{if(o==this.g)t:{let $=de(this.g),mt=this.g.ya(),nt=this.g.ca();if(!($<3)&&($!=3||this.g&&(this.h.h||this.g.la()||uh(this.g)))){this.K||$!=4||mt==7||(mt==8||nt<=0?_r(3):_r(2)),Ko(this);var u=this.g.ca();this.X=u;var h=Ap(this);if(this.o=u==200,Ep(this.i,this.v,this.B,this.l,this.S,$,u),this.o){if(this.U&&!this.L){e:{if(this.g){var f,v=this.g;if((f=v.g?v.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(f)){var S=f;break e}}S=null}if(o=S)En(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Qo(this,o);else{this.o=!1,this.m=3,St(12),qe(this),Tr(this);break t}}if(this.R){o=!0;let yt;for(;!this.K&&this.C<h.length;)if(yt=bp(this,h),yt==Go){$==4&&(this.m=4,St(14),o=!1),En(this.i,this.l,null,"[Incomplete Response]");break}else if(yt==jl){this.m=4,St(15),En(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else En(this.i,this.l,yt,null),Qo(this,yt);if(Gl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$!=4||h.length!=0||this.h.h||(this.m=1,St(16),o=!1),this.o=this.o&&o,!o)En(this.i,this.l,h,"[Invalid Chunked Response]"),qe(this),Tr(this);else if(h.length>0&&!this.W){this.W=!0;var k=this.j;k.g==this&&k.aa&&!k.P&&(k.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),ta(k),k.P=!0,St(11))}}else En(this.i,this.l,h,null),Qo(this,h);$==4&&qe(this),this.o&&!this.K&&($==4?gh(this.j,this):(this.o=!1,Ms(this)))}else Bp(this.g),u==400&&h.indexOf("Unknown SID")>0?(this.m=3,St(12)):(this.m=0,St(13)),qe(this),Tr(this)}}}catch{}finally{}};function Ap(o){if(!Gl(o))return o.g.la();let u=uh(o.g);if(u==="")return"";let h="",f=u.length,v=de(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return qe(o),Tr(o),"";o.h.i=new a.TextDecoder}for(let S=0;S<f;S++)o.h.h=!0,h+=o.h.i.decode(u[S],{stream:!(v&&S==f-1)});return u.length=0,o.h.g+=h,o.C=0,o.h.g}function Gl(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function bp(o,u){var h=o.C,f=u.indexOf(`
`,h);return f==-1?Go:(h=Number(u.substring(h,f)),isNaN(h)?jl:(f+=1,f+h>u.length?Go:(u=u.slice(f,f+h),o.C=f+h,u)))}ue.prototype.cancel=function(){this.K=!0,qe(this)};function Ms(o){o.T=Date.now()+o.H,$l(o,o.H)}function $l(o,u){if(o.D!=null)throw Error("WatchDog timer not null");o.D=wr(d(o.aa,o),u)}function Ko(o){o.D&&(a.clearTimeout(o.D),o.D=null)}ue.prototype.aa=function(){this.D=null;let o=Date.now();o-this.T>=0?(Ip(this.i,this.B),this.M!=2&&(_r(),St(17)),qe(this),this.m=2,Tr(this)):$l(this,this.T-o)};function Tr(o){o.j.I==0||o.K||gh(o.j,o)}function qe(o){Ko(o);var u=o.O;u&&typeof u.dispose=="function"&&u.dispose(),o.O=null,xl(o.V),o.g&&(u=o.g,o.g=null,u.abort(),u.dispose())}function Qo(o,u){try{var h=o.j;if(h.I!=0&&(h.g==o||Wo(h.h,o))){if(!o.L&&Wo(h.h,o)&&h.I==3){try{var f=h.Ba.g.parse(u)}catch{f=null}if(Array.isArray(f)&&f.length==3){var v=f;if(v[0]==0){t:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)zs(h),qs(h);else break t;Zo(h),St(18)}}else h.xa=v[1],0<h.xa-h.K&&v[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=wr(d(h.Va,h),6e3));Wl(h.h)<=1&&h.ta&&(h.ta=void 0)}else ze(h,11)}else if((o.L||h.g==o)&&zs(h),!y(u))for(v=h.Ba.g.parse(u),u=0;u<v.length;u++){let nt=v[u],yt=nt[0];if(!(yt<=h.K))if(h.K=yt,nt=nt[1],h.I==2)if(nt[0]=="c"){h.M=nt[1],h.ba=nt[2];let $t=nt[3];$t!=null&&(h.ka=$t,h.j.info("VER="+h.ka));let Ge=nt[4];Ge!=null&&(h.za=Ge,h.j.info("SVER="+h.za));let fe=nt[5];fe!=null&&typeof fe=="number"&&fe>0&&(f=1.5*fe,h.O=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let me=o.g;if(me){let $s=me.g?me.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($s){var S=f.h;S.g||$s.indexOf("spdy")==-1&&$s.indexOf("quic")==-1&&$s.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Ho(S,S.h),S.h=null))}if(f.G){let ea=me.g?me.g.getResponseHeader("X-HTTP-Session-Id"):null;ea&&(f.wa=ea,rt(f.J,f.G,ea))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),f=h;var k=o;if(f.na=wh(f,f.L?f.ba:null,f.W),k.L){Hl(f.h,k);var $=k,mt=f.O;mt&&($.H=mt),$.D&&(Ko($),Ms($)),f.g=k}else mh(f);h.i.length>0&&js(h)}else nt[0]!="stop"&&nt[0]!="close"||ze(h,7);else h.I==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?ze(h,7):Yo(h):nt[0]!="noop"&&h.l&&h.l.qa(nt),h.A=0)}}_r(4)}catch{}}var Sp=class{constructor(o,u){this.g=o,this.map=u}};function Kl(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ql(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Wl(o){return o.h?1:o.g?o.g.size:0}function Wo(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function Ho(o,u){o.g?o.g.add(u):o.h=u}function Hl(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}Kl.prototype.cancel=function(){if(this.i=Jl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Jl(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let u=o.i;for(let h of o.g.values())u=u.concat(h.G);return u}return R(o.i)}var Xl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Rp(o,u){if(o){o=o.split("&");for(let h=0;h<o.length;h++){let f=o[h].indexOf("="),v,S=null;f>=0?(v=o[h].substring(0,f),S=o[h].substring(f+1)):v=o[h],u(v,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function le(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;o instanceof le?(this.l=o.l,vr(this,o.j),this.o=o.o,this.g=o.g,Ar(this,o.u),this.h=o.h,Jo(this,rh(o.i)),this.m=o.m):o&&(u=String(o).match(Xl))?(this.l=!1,vr(this,u[1]||"",!0),this.o=br(u[2]||""),this.g=br(u[3]||"",!0),Ar(this,u[4]),this.h=br(u[5]||"",!0),Jo(this,u[6]||"",!0),this.m=br(u[7]||"")):(this.l=!1,this.i=new Rr(null,this.l))}le.prototype.toString=function(){let o=[];var u=this.j;u&&o.push(Sr(u,Yl,!0),":");var h=this.g;return(h||u=="file")&&(o.push("//"),(u=this.o)&&o.push(Sr(u,Yl,!0),"@"),o.push(Ir(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Sr(h,h.charAt(0)=="/"?Dp:Cp,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Sr(h,xp)),o.join("")},le.prototype.resolve=function(o){let u=Gt(this),h=!!o.j;h?vr(u,o.j):h=!!o.o,h?u.o=o.o:h=!!o.g,h?u.g=o.g:h=o.u!=null;var f=o.h;if(h)Ar(u,o.u);else if(h=!!o.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var v=u.h.lastIndexOf("/");v!=-1&&(f=u.h.slice(0,v+1)+f)}if(v=f,v==".."||v==".")f="";else if(v.indexOf("./")!=-1||v.indexOf("/.")!=-1){f=v.lastIndexOf("/",0)==0,v=v.split("/");let S=[];for(let k=0;k<v.length;){let $=v[k++];$=="."?f&&k==v.length&&S.push(""):$==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&k==v.length&&S.push("")):(S.push($),f=!0)}f=S.join("/")}else f=v}return h?u.h=f:h=o.i.toString()!=="",h?Jo(u,rh(o.i)):h=!!o.m,h&&(u.m=o.m),u};function Gt(o){return new le(o)}function vr(o,u,h){o.j=h?br(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function Ar(o,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);o.u=u}else o.u=null}function Jo(o,u,h){u instanceof Rr?(o.i=u,Np(o.i,o.l)):(h||(u=Sr(u,Vp)),o.i=new Rr(u,o.l))}function rt(o,u,h){o.i.set(u,h)}function Fs(o){return rt(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function br(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Sr(o,u,h){return typeof o=="string"?(o=encodeURI(o).replace(u,Pp),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Pp(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Yl=/[#\/\?@]/g,Cp=/[#\?:]/g,Dp=/[#\?]/g,Vp=/[#\?@]/g,xp=/#/g;function Rr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function je(o){o.g||(o.g=new Map,o.h=0,o.i&&Rp(o.i,function(u,h){o.add(decodeURIComponent(u.replace(/\+/g," ")),h)}))}r=Rr.prototype,r.add=function(o,u){je(this),this.i=null,o=In(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(u),this.h+=1,this};function Zl(o,u){je(o),u=In(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function th(o,u){return je(o),u=In(o,u),o.g.has(u)}r.forEach=function(o,u){je(this),this.g.forEach(function(h,f){h.forEach(function(v){o.call(u,v,f,this)},this)},this)};function eh(o,u){je(o);let h=[];if(typeof u=="string")th(o,u)&&(h=h.concat(o.g.get(In(o,u))));else for(o=Array.from(o.g.values()),u=0;u<o.length;u++)h=h.concat(o[u]);return h}r.set=function(o,u){return je(this),this.i=null,o=In(this,o),th(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},r.get=function(o,u){return o?(o=eh(this,o),o.length>0?String(o[0]):u):u};function nh(o,u,h){Zl(o,u),h.length>0&&(o.i=null,o.g.set(In(o,u),R(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],u=Array.from(this.g.keys());for(let f=0;f<u.length;f++){var h=u[f];let v=Ir(h);h=eh(this,h);for(let S=0;S<h.length;S++){let k=v;h[S]!==""&&(k+="="+Ir(h[S])),o.push(k)}}return this.i=o.join("&")};function rh(o){let u=new Rr;return u.i=o.i,o.g&&(u.g=new Map(o.g),u.h=o.h),u}function In(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function Np(o,u){u&&!o.j&&(je(o),o.i=null,o.g.forEach(function(h,f){let v=f.toLowerCase();f!=v&&(Zl(this,f),nh(this,v,h))},o)),o.j=u}function kp(o,u){let h=new Er;if(a.Image){let f=new Image;f.onload=m(he,h,"TestLoadImage: loaded",!0,u,f),f.onerror=m(he,h,"TestLoadImage: error",!1,u,f),f.onabort=m(he,h,"TestLoadImage: abort",!1,u,f),f.ontimeout=m(he,h,"TestLoadImage: timeout",!1,u,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else u(!1)}function Op(o,u){let h=new Er,f=new AbortController,v=setTimeout(()=>{f.abort(),he(h,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:f.signal}).then(S=>{clearTimeout(v),S.ok?he(h,"TestPingServer: ok",!0,u):he(h,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(v),he(h,"TestPingServer: error",!1,u)})}function he(o,u,h,f,v){try{v&&(v.onload=null,v.onerror=null,v.onabort=null,v.ontimeout=null),f(h)}catch{}}function Mp(){this.g=new _p}function Ls(o){this.i=o.Sb||null,this.h=o.ab||!1}p(Ls,Nl),Ls.prototype.g=function(){return new Bs(this.i,this.h)};function Bs(o,u){Tt.call(this),this.H=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(Bs,Tt),r=Bs.prototype,r.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=u,this.readyState=1,Cr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(u.body=o),(this.H||a).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Pr(this)),this.readyState=0},r.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Cr(this)),this.g&&(this.readyState=3,Cr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;sh(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function sh(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}r.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?Pr(this):Cr(this),this.readyState==3&&sh(this)}},r.Oa=function(o){this.g&&(this.response=this.responseText=o,Pr(this))},r.Na=function(o){this.g&&(this.response=o,Pr(this))},r.ga=function(){this.g&&Pr(this)};function Pr(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Cr(o)}r.setRequestHeader=function(o,u){this.A.append(o,u)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],u=this.h.entries();for(var h=u.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=u.next();return o.join(`\r
`)};function Cr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Bs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function ih(o){let u="";return Vs(o,function(h,f){u+=f,u+=":",u+=h,u+=`\r
`}),u}function Xo(o,u,h){t:{for(f in h){var f=!1;break t}f=!0}f||(h=ih(h),typeof o=="string"?h!=null&&Ir(h):rt(o,u,h))}function at(o){Tt.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(at,Tt);var Fp=/^https?$/i,Lp=["POST","PUT"];r=at.prototype,r.Fa=function(o){this.H=o},r.ea=function(o,u,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ul.g(),this.g.onreadystatechange=w(d(this.Ca,this));try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(S){oh(this,S);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var v in f)h.set(v,f[v]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())h.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(S=>S.toLowerCase()=="content-type"),v=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(Lp,u,void 0)>=0)||f||v||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,k]of h)this.g.setRequestHeader(S,k);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(S){oh(this,S)}};function oh(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.o=5,ah(o),Us(o)}function ah(o){o.A||(o.A=!0,bt(o,"complete"),bt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,bt(this,"complete"),bt(this,"abort"),Us(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Us(this,!0)),at.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?ch(this):this.Xa())},r.Xa=function(){ch(this)};function ch(o){if(o.h&&typeof i<"u"){if(o.v&&de(o)==4)setTimeout(o.Ca.bind(o),0);else if(bt(o,"readystatechange"),de(o)==4){o.h=!1;try{let S=o.ca();t:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break t;default:u=!1}var h;if(!(h=u)){var f;if(f=S===0){let k=String(o.D).match(Xl)[1]||null;!k&&a.self&&a.self.location&&(k=a.self.location.protocol.slice(0,-1)),f=!Fp.test(k?k.toLowerCase():"")}h=f}if(h)bt(o,"complete"),bt(o,"success");else{o.o=6;try{var v=de(o)>2?o.g.statusText:""}catch{v=""}o.l=v+" ["+o.ca()+"]",ah(o)}}finally{Us(o)}}}}function Us(o,u){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);let h=o.g;o.g=null,u||bt(o,"ready");try{h.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function de(o){return o.g?o.g.readyState:0}r.ca=function(){try{return de(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),yp(u)}};function uh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Bp(o){let u={};o=(o.g&&de(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(y(o[f]))continue;var h=vp(o[f]);let v=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let S=u[v]||[];u[v]=S,S.push(h)}dp(u,function(f){return f.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Dr(o,u,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||u}function lh(o){this.za=0,this.i=[],this.j=new Er,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Dr("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Dr("baseRetryDelayMs",5e3,o),this.Za=Dr("retryDelaySeedMs",1e4,o),this.Ta=Dr("forwardChannelMaxRetries",2,o),this.va=Dr("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new Kl(o&&o.concurrentRequestLimit),this.Ba=new Mp,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=lh.prototype,r.ka=8,r.I=1,r.connect=function(o,u,h,f){St(0),this.W=o,this.H=u||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.J=wh(this,null,this.W),js(this)};function Yo(o){if(hh(o),o.I==3){var u=o.V++,h=Gt(o.J);if(rt(h,"SID",o.M),rt(h,"RID",u),rt(h,"TYPE","terminate"),Vr(o,h),u=new ue(o,o.j,u),u.M=2,u.A=Fs(Gt(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(u.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=u.A,h=!0),h||(u.g=Eh(u.j,null),u.g.ea(u.A)),u.F=Date.now(),Ms(u)}_h(o)}function qs(o){o.g&&(ta(o),o.g.cancel(),o.g=null)}function hh(o){qs(o),o.v&&(a.clearTimeout(o.v),o.v=null),zs(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function js(o){if(!Ql(o.h)&&!o.m){o.m=!0;var u=o.Ea;X||g(),W||(X(),W=!0),E.add(u,o),o.D=0}}function Up(o,u){return Wl(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=u.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=wr(d(o.Ea,o,u),yh(o,o.D)),o.D++,!0)}r.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;let v=new ue(this,this.j,o),S=this.o;if(this.U&&(S?(S=Tl(S),Al(S,this.U)):S=this.U),this.u!==null||this.R||(v.J=S,S=null),this.S)t:{for(var u=0,h=0;h<this.i.length;h++){e:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(u+=f,u>4096){u=h;break t}if(u===4096||h===this.i.length-1){u=h+1;break t}}u=1e3}else u=1e3;u=fh(this,v,u),h=Gt(this.J),rt(h,"RID",o),rt(h,"CVER",22),this.G&&rt(h,"X-HTTP-Session-Id",this.G),Vr(this,h),S&&(this.R?u="headers="+Ir(ih(S))+"&"+u:this.u&&Xo(h,this.u,S)),Ho(this.h,v),this.Ra&&rt(h,"TYPE","init"),this.S?(rt(h,"$req",u),rt(h,"SID","null"),v.U=!0,$o(v,h,null)):$o(v,h,u),this.I=2}}else this.I==3&&(o?dh(this,o):this.i.length==0||Ql(this.h)||dh(this))};function dh(o,u){var h;u?h=u.l:h=o.V++;let f=Gt(o.J);rt(f,"SID",o.M),rt(f,"RID",h),rt(f,"AID",o.K),Vr(o,f),o.u&&o.o&&Xo(f,o.u,o.o),h=new ue(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),u&&(o.i=u.G.concat(o.i)),u=fh(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Ho(o.h,h),$o(h,f,u)}function Vr(o,u){o.H&&Vs(o.H,function(h,f){rt(u,f,h)}),o.l&&Vs({},function(h,f){rt(u,f,h)})}function fh(o,u,h){h=Math.min(o.i.length,h);let f=o.l?d(o.l.Ka,o.l,o):null;t:{var v=o.i;let $=-1;for(;;){let mt=["count="+h];$==-1?h>0?($=v[0].g,mt.push("ofs="+$)):$=0:mt.push("ofs="+$);let nt=!0;for(let yt=0;yt<h;yt++){var S=v[yt].g;let $t=v[yt].map;if(S-=$,S<0)$=Math.max(0,v[yt].g-100),nt=!1;else try{S="req"+S+"_"||"";try{var k=$t instanceof Map?$t:Object.entries($t);for(let[Ge,fe]of k){let me=fe;c(fe)&&(me=Uo(fe)),mt.push(S+Ge+"="+encodeURIComponent(me))}}catch(Ge){throw mt.push(S+"type="+encodeURIComponent("_badmap")),Ge}}catch{f&&f($t)}}if(nt){k=mt.join("&");break t}}k=void 0}return o=o.i.splice(0,h),u.G=o,k}function mh(o){if(!o.g&&!o.v){o.Y=1;var u=o.Da;X||g(),W||(X(),W=!0),E.add(u,o),o.A=0}}function Zo(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=wr(d(o.Da,o),yh(o,o.A)),o.A++,!0)}r.Da=function(){if(this.v=null,ph(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=wr(d(this.Wa,this),o)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,St(10),qs(this),ph(this))};function ta(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function ph(o){o.g=new ue(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var u=Gt(o.na);rt(u,"RID","rpc"),rt(u,"SID",o.M),rt(u,"AID",o.K),rt(u,"CI",o.F?"0":"1"),!o.F&&o.ia&&rt(u,"TO",o.ia),rt(u,"TYPE","xmlhttp"),Vr(o,u),o.u&&o.o&&Xo(u,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=Fs(Gt(u)),h.u=null,h.R=!0,zl(h,o)}r.Va=function(){this.C!=null&&(this.C=null,qs(this),Zo(this),St(19))};function zs(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function gh(o,u){var h=null;if(o.g==u){zs(o),ta(o),o.g=null;var f=2}else if(Wo(o.h,u))h=u.G,Hl(o.h,u),f=1;else return;if(o.I!=0){if(u.o)if(f==1){h=u.u?u.u.length:0,u=Date.now()-u.F;var v=o.D;f=ks(),bt(f,new Ll(f,h)),js(o)}else mh(o);else if(v=u.m,v==3||v==0&&u.X>0||!(f==1&&Up(o,u)||f==2&&Zo(o)))switch(h&&h.length>0&&(u=o.h,u.i=u.i.concat(h)),v){case 1:ze(o,5);break;case 4:ze(o,10);break;case 3:ze(o,6);break;default:ze(o,2)}}}function yh(o,u){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*u}function ze(o,u){if(o.j.info("Error code "+u),u==2){var h=d(o.bb,o),f=o.Ua;let v=!f;f=new le(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||vr(f,"https"),Fs(f),v?kp(f.toString(),h):Op(f.toString(),h)}else St(2);o.I=0,o.l&&o.l.pa(u),_h(o),hh(o)}r.bb=function(o){o?(this.j.info("Successfully pinged google.com"),St(2)):(this.j.info("Failed to ping google.com"),St(1))};function _h(o){if(o.I=0,o.ja=[],o.l){let u=Jl(o.h);(u.length!=0||o.i.length!=0)&&(N(o.ja,u),N(o.ja,o.i),o.h.i.length=0,R(o.i),o.i.length=0),o.l.oa()}}function wh(o,u,h){var f=h instanceof le?Gt(h):new le(h);if(f.g!="")u&&(f.g=u+"."+f.g),Ar(f,f.u);else{var v=a.location;f=v.protocol,u=u?u+"."+v.hostname:v.hostname,v=+v.port;let S=new le(null);f&&vr(S,f),u&&(S.g=u),v&&Ar(S,v),h&&(S.h=h),f=S}return h=o.G,u=o.wa,h&&u&&rt(f,h,u),rt(f,"VER",o.ka),Vr(o,f),f}function Eh(o,u,h){if(u&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Aa&&!o.ma?new at(new Ls({ab:h})):new at(o.ma),u.Fa(o.L),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ih(){}r=Ih.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function Gs(){}Gs.prototype.g=function(o,u){return new Vt(o,u)};function Vt(o,u){Tt.call(this),this.g=new lh(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(o?o["X-WebChannel-Client-Profile"]=u.sa:o={"X-WebChannel-Client-Profile":u.sa}),this.g.U=o,(o=u&&u.Qb)&&!y(o)&&(this.g.u=o),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!y(u)&&(this.g.G=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new Tn(this)}p(Vt,Tt),Vt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Vt.prototype.close=function(){Yo(this.g)},Vt.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=Uo(o),o=h);u.i.push(new Sp(u.Ya++,o)),u.I==3&&js(u)},Vt.prototype.N=function(){this.g.l=null,delete this.j,Yo(this.g),delete this.g,Vt.Z.N.call(this)};function Th(o){qo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){t:{for(let h in u){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}p(Th,qo);function vh(){jo.call(this),this.status=1}p(vh,jo);function Tn(o){this.g=o}p(Tn,Ih),Tn.prototype.ra=function(){bt(this.g,"a")},Tn.prototype.qa=function(o){bt(this.g,new Th(o))},Tn.prototype.pa=function(o){bt(this.g,new vh)},Tn.prototype.oa=function(){bt(this.g,"b")},Gs.prototype.createWebChannel=Gs.prototype.g,Vt.prototype.send=Vt.prototype.o,Vt.prototype.open=Vt.prototype.m,Vt.prototype.close=Vt.prototype.close,Va=re.createWebChannelTransport=function(){return new Gs},Da=re.getStatEventTarget=function(){return ks()},Ca=re.Event=Ue,ti=re.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Os.NO_ERROR=0,Os.TIMEOUT=8,Os.HTTP_ERROR=6,Br=re.ErrorCode=Os,Bl.COMPLETE="complete",Pa=re.EventType=Bl,kl.EventType=yr,yr.OPEN="a",yr.CLOSE="b",yr.ERROR="c",yr.MESSAGE="d",Tt.prototype.listen=Tt.prototype.J,An=re.WebChannel=kl,ey=re.FetchXmlHttpFactory=Ls,at.prototype.listenOnce=at.prototype.K,at.prototype.getLastError=at.prototype.Ha,at.prototype.getLastErrorCode=at.prototype.ya,at.prototype.getStatus=at.prototype.ca,at.prototype.getResponseJson=at.prototype.La,at.prototype.getResponseText=at.prototype.la,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Fa,Ra=re.XhrIo=at}).apply(typeof Zs<"u"?Zs:typeof self<"u"?self:typeof window<"u"?window:{});var td="@firebase/firestore",ed="4.9.2";var ht=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};ht.UNAUTHENTICATED=new ht(null),ht.GOOGLE_CREDENTIALS=new ht("google-credentials-uid"),ht.FIRST_PARTY=new ht("first-party-uid"),ht.MOCK_USER=new ht("mock-user");var hr="12.3.0";var un=new vn("@firebase/firestore");function Vn(){return un.logLevel}function D(r,...t){if(un.logLevel<=H.DEBUG){let e=t.map(zu);un.debug(`Firestore (${hr}): ${r}`,...e)}}function ct(r,...t){if(un.logLevel<=H.ERROR){let e=t.map(zu);un.error(`Firestore (${hr}): ${r}`,...e)}}function qn(r,...t){if(un.logLevel<=H.WARN){let e=t.map(zu);un.warn(`Firestore (${hr}): ${r}`,...e)}}function zu(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function F(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,gf(r,n,e)}function gf(r,t,e){let n=`FIRESTORE (${hr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw ct(n),new Error(n)}function B(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||gf(t,s,n)}function L(r,t){return r}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends Zt{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ht=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var mi=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},qa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ht.UNAUTHENTICATED))}shutdown(){}},ja=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},za=class{constructor(t){this.t=t,this.currentUser=ht.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){B(this.o===void 0,42304);let n=this.i,s=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),i=new Ht;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ht,t.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let l=i;t.enqueueRetryable(()=>C(this,null,function*(){yield l.promise,yield s(this.currentUser)}))},c=l=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>c(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?c(l):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ht)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(B(typeof n.accessToken=="string",31837,{l:n}),new mi(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return B(t===null||typeof t=="string",2055,{h:t}),new ht(t)}},Ga=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=ht.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},$a=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Ga(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(ht.FIRST_PARTY))}shutdown(){}invalidateToken(){}},pi=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ka=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Wh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){B(this.o===void 0,3512);let n=i=>{i.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let a=i.token!==this.m;return this.m=i.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>n(i))};let s=i=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.V.getImmediate({optional:!0});i?s(i):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new pi(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(B(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new pi(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function ny(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var es=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let s=ny(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function Qa(r,t){let e=Math.min(r.length,t.length);for(let n=0;n<e;n++){let s=r.charAt(n),i=t.charAt(n);if(s!==i)return xa(s)===xa(i)?z(s,i):xa(s)?1:-1}return z(r.length,t.length)}var ry=55296,sy=57343;function xa(r){let t=r.charCodeAt(0);return t>=ry&&t<=sy}function jn(r,t,e){return r.length===t.length&&r.every((n,s)=>e(n,t[s]))}function yf(r){return r+"\0"}var nd="__name__",gi=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&F(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&F(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let s=0;s<n;s++){let i=r.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return z(t.length,e.length)}static compareSegments(t,e){let n=r.isNumericId(t),s=r.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?r.extractNumericId(t).compare(r.extractNumericId(e)):Qa(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ne.fromString(t.substring(4,t.length-2))}},Y=class r extends gi{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(s=>s.length>0))}return new r(e)}static emptyPath(){return new r([])}},iy=/^[_a-zA-Z][_a-zA-Z0-9]*$/,pt=class r extends gi{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return iy.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===nd}static keyField(){return new r([nd])}static fromServerFormat(t){let e=[],n="",s=0,i=()=>{if(n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;s<t.length;){let c=t[s];if(c==="\\"){if(s+1===t.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(n+=c,s++):(i(),s++)}if(i(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var M=class r{constructor(t){this.path=t}static fromPath(t){return new r(Y.fromString(t))}static fromName(t){return new r(Y.fromString(t).popFirst(5))}static empty(){return new r(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new Y(t.slice()))}};function _f(r,t,e){if(!e)throw new x(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function oy(r,t,e,n){if(t===!0&&n===!0)throw new x(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function rd(r){if(!M.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function sd(r){if(M.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function wf(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function _o(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":F(12329,{type:typeof r})}function qt(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=_o(r);throw new x(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function ay(r,t){if(t<=0)throw new x(P.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function dt(r,t){let e={typeString:r};return t&&(e.value=t),e}function vs(r,t){if(!wf(r))throw new x(P.INVALID_ARGUMENT,"JSON must be an object");let e;for(let n in t)if(t[n]){let s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}let a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new x(P.INVALID_ARGUMENT,e);return!0}var id=-62135596800,od=1e6,ot=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*od);return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<id)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/od}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(vs(t,r._jsonSchema))return new r(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-id;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ot._jsonSchemaVersion="firestore/timestamp/1.0",ot._jsonSchema={type:dt("string",ot._jsonSchemaVersion),seconds:dt("number"),nanoseconds:dt("number")};var q=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new ot(0,0))}static max(){return new r(new ot(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var zn=-1,Gn=class{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}};function Wa(r){return r.fields.find(t=>t.kind===2)}function We(r){return r.fields.filter(t=>t.kind!==2)}Gn.UNKNOWN_ID=-1;var Fn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var ns=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Lt.min())}};function Ef(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=q.fromTimestamp(n===1e9?new ot(e+1,0):new ot(e,n));return new Lt(s,M.empty(),t)}function If(r){return new Lt(r.readTime,r.key,zn)}var Lt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(q.min(),M.empty(),zn)}static max(){return new r(q.max(),M.empty(),zn)}};function Gu(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var Tf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",yi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Me(r){return C(this,null,function*(){if(r.code!==P.FAILED_PRECONDITION||r.message!==Tf)throw r;D("LocalStore","Unexpectedly lost primary lease")})}var b=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let s=0,i=0,a=!1;t.forEach(c=>{++s,c.next(()=>{++i,a&&i===s&&e()},l=>n(l))}),a=!0,i===s&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(s=>s?r.resolve(s):n());return e}static forEach(t,e){let n=[];return t.forEach((s,i)=>{n.push(e.call(this,s,i))}),this.waitFor(n)}static mapArray(t,e){return new r((n,s)=>{let i=t.length,a=new Array(i),c=0;for(let l=0;l<i;l++){let d=l;e(t[d]).next(m=>{a[d]=m,++c,c===i&&n(a)},m=>s(m))}})}static doWhile(t,e){return new r((n,s)=>{let i=()=>{t()===!0?e().next(()=>{i()},s):n()};i()})}};var Nt="SimpleDb",_i=class r{static open(t,e,n,s){try{return new r(e,t.transaction(s,n))}catch(i){throw new rn(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new Ht,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new rn(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{let s=$u(n.target.error);this.S.reject(new rn(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(D(Nt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Ja(e)}},$n=class r{static delete(t){return D(Nt,"Removing database:",t),Je(oa().indexedDB.deleteDatabase(t)).toPromise()}static v(){if(!Ws())return!1;if(r.F())return!0;let t=$e(),e=r.M(t),n=0<e&&e<10,s=vf(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(t,e){return t.store(e)}static M(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.N=n,this.B=null,r.M($e())===12.2&&ct("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}L(t){return C(this,null,function*(){return this.db||(D(Nt,"Opening database:",this.name),this.db=yield new Promise((e,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{let a=i.target.result;e(a)},s.onblocked=()=>{n(new rn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{let a=i.target.error;a.name==="VersionError"?n(new x(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new rn(t,a))},s.onupgradeneeded=i=>{D(Nt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);let a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next(()=>{D(Nt,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db})}$(t){this.q=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,s){return C(this,null,function*(){let i=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.L(t);let c=_i.open(this.db,t,i?"readonly":"readwrite",n),l=s(c).next(d=>(c.C(),d)).catch(d=>(c.abort(d),b.reject(d))).toPromise();return l.catch(()=>{}),yield c.D,l}catch(c){let l=c,d=l.name!=="FirebaseError"&&a<3;if(D(Nt,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function vf(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Ha=class{constructor(t){this.U=t,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(t){this.U=t}done(){this.K=!0}j(t){this.W=t}delete(){return Je(this.U.delete())}},rn=class extends x{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Fe(r){return r.name==="IndexedDbTransactionError"}var Ja=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(D(Nt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(D(Nt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Je(n)}add(t){return D(Nt,"ADD",this.store.name,t,t),Je(this.store.add(t))}get(t){return Je(this.store.get(t)).next(e=>(e===void 0&&(e=null),D(Nt,"GET",this.store.name,t,e),e))}delete(t){return D(Nt,"DELETE",this.store.name,t),Je(this.store.delete(t))}count(){return D(Nt,"COUNT",this.store.name),Je(this.store.count())}J(t,e){let n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let i=s.getAll(n.range);return new b((a,c)=>{i.onerror=l=>{c(l.target.error)},i.onsuccess=l=>{a(l.target.result)}})}{let i=this.cursor(n),a=[];return this.H(i,(c,l)=>{a.push(l)}).next(()=>a)}}Y(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new b((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}})}Z(t,e){D(Nt,"DELETE ALL",this.store.name);let n=this.options(t,e);n.X=!1;let s=this.cursor(n);return this.H(s,(i,a,c)=>c.delete())}ee(t,e){let n;e?n=t:(n={},e=t);let s=this.cursor(n);return this.H(s,e)}te(t){let e=this.cursor({});return new b((n,s)=>{e.onerror=i=>{let a=$u(i.target.error);s(a)},e.onsuccess=i=>{let a=i.target.result;a?t(a.primaryKey,a.value).next(c=>{c?a.continue():n()}):n()}})}H(t,e){let n=[];return new b((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{let c=a.target.result;if(!c)return void s();let l=new Ha(c),d=e(c.primaryKey,c.value,l);if(d instanceof b){let m=d.catch(p=>(l.done(),b.reject(p)));n.push(m)}l.isDone?s():l.G===null?c.continue():c.continue(l.G)}}).next(()=>b.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.X?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function Je(r){return new b((t,e)=>{r.onsuccess=n=>{let s=n.target.result;t(s)},r.onerror=n=>{let s=$u(n.target.error);e(s)}})}var ad=!1;function $u(r){let t=$n.M($e());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ad||(ad=!0,setTimeout(()=>{throw n},0)),n}}return r}var Kr="IndexBackfiller",Xa=class{constructor(t,e){this.asyncQueue=t,this.ne=e,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(t){D(Kr,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>C(this,null,function*(){this.task=null;try{let e=yield this.ne.ie();D(Kr,`Documents written: ${e}`)}catch(e){Fe(e)?D(Kr,"Ignoring IndexedDB error during index backfill: ",e):yield Me(e)}yield this.re(6e4)}))}},Ya=class{constructor(t,e){this.localStore=t,this.persistence=e}ie(t=50){return C(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.se(e,t))})}se(t,e){let n=new Set,s=e,i=!0;return b.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return D(Kr,`Processing collection: ${a}`),this.oe(t,a,s).next(c=>{s-=c,n.add(a)});i=!1})).next(()=>e-s)}oe(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next(i=>{let a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this._e(s,i)).next(c=>(D(Kr,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(t,e,c))).next(()=>a.size)}))}_e(t,e){let n=t;return e.changes.forEach((s,i)=>{let a=If(i);Gu(a,n)>0&&(n=a)}),new Lt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var kt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>n.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}r.ce=-1;return r})(),sn=-1;function wo(r){return r==null}function rs(r){return r===0&&1/r==-1/0}function Af(r){return typeof r=="number"&&Number.isInteger(r)&&!rs(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var wi="";function At(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=cd(t)),t=cy(r.get(e),t);return cd(t)}function cy(r,t){let e=t,n=r.length;for(let s=0;s<n;s++){let i=r.charAt(s);switch(i){case"\0":e+="";break;case wi:e+="";break;default:e+=i}}return e}function cd(r){return r+wi+""}function Qt(r){let t=r.length;if(B(t>=2,64408,{path:r}),t===2)return B(r.charAt(0)===wi&&r.charAt(1)==="",56145,{path:r}),Y.emptyPath();let e=t-2,n=[],s="";for(let i=0;i<t;){let a=r.indexOf(wi,i);switch((a<0||a>e)&&F(50515,{path:r}),r.charAt(a+1)){case"":let c=r.substring(i,a),l;s.length===0?l=c:(s+=c,l=s,s=""),n.push(l);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:F(61167,{path:r})}i=a+2}return new Y(n)}var He="remoteDocuments",As="owner",bn="owner",ss="mutationQueues",uy="userId",Ut="mutations",ud="batchId",tn="userMutationsIndex",ld=["userId","batchId"];function oi(r,t){return[r,At(t)]}function bf(r,t,e){return[r,At(t),e]}var ly={},Kn="documentMutations",Ei="remoteDocumentsV14",hy=["prefixPath","collectionGroup","readTime","documentId"],ai="documentKeyIndex",dy=["prefixPath","collectionGroup","documentId"],Sf="collectionGroupIndex",fy=["collectionGroup","readTime","prefixPath","documentId"],is="remoteDocumentGlobal",Za="remoteDocumentGlobalKey",Qn="targets",Rf="queryTargetsIndex",my=["canonicalId","targetId"],Wn="targetDocuments",py=["targetId","path"],Ku="documentTargetsIndex",gy=["path","targetId"],Ii="targetGlobalKey",on="targetGlobal",os="collectionParents",yy=["collectionId","parent"],Hn="clientMetadata",_y="clientId",Eo="bundles",wy="bundleId",Io="namedQueries",Ey="name",Qu="indexConfiguration",Iy="indexId",tc="collectionGroupIndex",Ty="collectionGroup",Qr="indexState",vy=["indexId","uid"],Pf="sequenceNumberIndex",Ay=["uid","sequenceNumber"],Wr="indexEntries",by=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Cf="documentKeyIndex",Sy=["indexId","uid","orderedDocumentKey"],To="documentOverlays",Ry=["userId","collectionPath","documentId"],ec="collectionPathOverlayIndex",Py=["userId","collectionPath","largestBatchId"],Df="collectionGroupOverlayIndex",Cy=["userId","collectionGroup","largestBatchId"],Wu="globals",Dy="name",Vf=[ss,Ut,Kn,He,Qn,As,on,Wn,Hn,is,os,Eo,Io],Vy=[...Vf,To],xf=[ss,Ut,Kn,Ei,Qn,As,on,Wn,Hn,is,os,Eo,Io,To],Nf=xf,Hu=[...Nf,Qu,Qr,Wr],xy=Hu,kf=[...Hu,Wu],Ny=kf;var as=class extends yi{constructor(t,e){super(),this.le=t,this.currentSequenceNumber=e}};function gt(r,t){let e=L(r);return $n.O(e.le,t)}function hd(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Le(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Of(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var st=class r{constructor(t,e){this.comparator=t,this.root=e||Jt.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Jt.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Jt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Mn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Mn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Mn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Mn(this.root,t,this.comparator,!0)}},Mn=class{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Jt=class r{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??r.RED,this.left=s??r.EMPTY,this.right=i??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new r(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this,i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return r.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw F(27949);return t+(this.isRed()?0:1)}};Jt.EMPTY=null,Jt.RED=!0,Jt.BLACK=!1;Jt.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new Jt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var et=class r{constructor(t){this.comparator=t,this.data=new st(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ti(this.data.getIterator())}getIteratorFrom(t){return new Ti(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Ti=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Sn(r){return r.hasNext()?r.getNext():void 0}var Ot=class r{constructor(t){this.fields=t,t.sort(pt.comparator)}static empty(){return new r([])}unionWith(t){let e=new et(pt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return jn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var vi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var ft=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new vi("Invalid base64 string: "+i):i}}(t);return new r(e)}static fromUint8Array(t){let e=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};ft.EMPTY_BYTE_STRING=new ft("");var ky=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ie(r){if(B(!!r,39018),typeof r=="string"){let t=0,e=ky.exec(r);if(B(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:it(r.seconds),nanos:it(r.nanos)}}function it(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function oe(r){return typeof r=="string"?ft.fromBase64String(r):ft.fromUint8Array(r)}var Mf="server_timestamp",Ff="__type__",Lf="__previous_value__",Bf="__local_write_time__";function Ju(r){return(r?.mapValue?.fields||{})[Ff]?.stringValue===Mf}function vo(r){let t=r.mapValue.fields[Lf];return Ju(t)?vo(t):t}function cs(r){let t=ie(r.mapValue.fields[Bf].timestampValue);return new ot(t.seconds,t.nanos)}var nc=class{constructor(t,e,n,s,i,a,c,l,d,m){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=m}},us="(default)",Jn=class r{constructor(t,e){this.projectId=t,this.database=e||us}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===us}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Xu="__type__",Uf="__max__",Te={mapValue:{fields:{__type__:{stringValue:Uf}}}},Yu="__vector__",Xn="value",ci={nullValue:"NULL_VALUE"};function Re(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ju(r)?4:qf(r)?9007199254740991:Ao(r)?10:11:F(28295,{value:r})}function Xt(r,t){if(r===t)return!0;let e=Re(r);if(e!==Re(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return cs(r).isEqual(cs(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let a=ie(s.timestampValue),c=ie(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(s,i){return oe(s.bytesValue).isEqual(oe(i.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(s,i){return it(s.geoPointValue.latitude)===it(i.geoPointValue.latitude)&&it(s.geoPointValue.longitude)===it(i.geoPointValue.longitude)}(r,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return it(s.integerValue)===it(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let a=it(s.doubleValue),c=it(i.doubleValue);return a===c?rs(a)===rs(c):isNaN(a)&&isNaN(c)}return!1}(r,t);case 9:return jn(r.arrayValue.values||[],t.arrayValue.values||[],Xt);case 10:case 11:return function(s,i){let a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(hd(a)!==hd(c))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!Xt(a[l],c[l])))return!1;return!0}(r,t);default:return F(52216,{left:r})}}function ls(r,t){return(r.values||[]).find(e=>Xt(e,t))!==void 0}function Pe(r,t){if(r===t)return 0;let e=Re(r),n=Re(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return function(i,a){let c=it(i.integerValue||i.doubleValue),l=it(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1}(r,t);case 3:return dd(r.timestampValue,t.timestampValue);case 4:return dd(cs(r),cs(t));case 5:return Qa(r.stringValue,t.stringValue);case 6:return function(i,a){let c=oe(i),l=oe(a);return c.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(i,a){let c=i.split("/"),l=a.split("/");for(let d=0;d<c.length&&d<l.length;d++){let m=z(c[d],l[d]);if(m!==0)return m}return z(c.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(i,a){let c=z(it(i.latitude),it(a.latitude));return c!==0?c:z(it(i.longitude),it(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return fd(r.arrayValue,t.arrayValue);case 10:return function(i,a){let c=i.fields||{},l=a.fields||{},d=c[Xn]?.arrayValue,m=l[Xn]?.arrayValue,p=z(d?.values?.length||0,m?.values?.length||0);return p!==0?p:fd(d,m)}(r.mapValue,t.mapValue);case 11:return function(i,a){if(i===Te.mapValue&&a===Te.mapValue)return 0;if(i===Te.mapValue)return 1;if(a===Te.mapValue)return-1;let c=i.fields||{},l=Object.keys(c),d=a.fields||{},m=Object.keys(d);l.sort(),m.sort();for(let p=0;p<l.length&&p<m.length;++p){let w=Qa(l[p],m[p]);if(w!==0)return w;let R=Pe(c[l[p]],d[m[p]]);if(R!==0)return R}return z(l.length,m.length)}(r.mapValue,t.mapValue);default:throw F(23264,{he:e})}}function dd(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=ie(r),n=ie(t),s=z(e.seconds,n.seconds);return s!==0?s:z(e.nanos,n.nanos)}function fd(r,t){let e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){let i=Pe(e[s],n[s]);if(i)return i}return z(e.length,n.length)}function Yn(r){return rc(r)}function rc(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=ie(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return oe(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return M.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",s=!0;for(let i of e.values||[])s?s=!1:n+=",",n+=rc(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),s="{",i=!0;for(let a of n)i?i=!1:s+=",",s+=`${a}:${rc(e.fields[a])}`;return s+"}"}(r.mapValue):F(61005,{value:r})}function ui(r){switch(Re(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=vo(r);return t?16+ui(t):16;case 5:return 2*r.stringValue.length;case 6:return oe(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((s,i)=>s+ui(i),0)}(r.arrayValue);case 10:case 11:return function(n){let s=0;return Le(n.fields,(i,a)=>{s+=i.length+ui(a)}),s}(r.mapValue);default:throw F(13486,{value:r})}}function hs(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function sc(r){return!!r&&"integerValue"in r}function ds(r){return!!r&&"arrayValue"in r}function md(r){return!!r&&"nullValue"in r}function pd(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function li(r){return!!r&&"mapValue"in r}function Ao(r){return(r?.mapValue?.fields||{})[Xu]?.stringValue===Yu}function Hr(r){if(r.geoPointValue)return{geoPointValue:wt({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:wt({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return Le(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Hr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Hr(r.arrayValue.values[e]);return t}return wt({},r)}function qf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Uf}var jf={mapValue:{fields:{[Xu]:{stringValue:Yu},[Xn]:{arrayValue:{}}}}};function Oy(r){return"nullValue"in r?ci:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?hs(Jn.empty(),M.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Ao(r)?jf:{mapValue:{}}:F(35942,{value:r})}function My(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?hs(Jn.empty(),M.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?jf:"mapValue"in r?Ao(r)?{mapValue:{}}:Te:F(61959,{value:r})}function gd(r,t){let e=Pe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function yd(r,t){let e=Pe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Rt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!li(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Hr(e)}setAll(t){let e=pt.emptyPath(),n={},s=[];t.forEach((a,c)=>{if(!e.isImmediateParentOf(c)){let l=this.getFieldsMap(e);this.applyChanges(l,n,s),n={},s=[],e=c.popLast()}a?n[c.lastSegment()]=Hr(a):s.push(c.lastSegment())});let i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){let e=this.field(t.popLast());li(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Xt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];li(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Le(e,(s,i)=>t[s]=i);for(let s of n)delete t[s]}clone(){return new r(Hr(this.value))}};function zf(r){let t=[];return Le(r.fields,(e,n)=>{let s=new pt([e]);if(li(n)){let i=zf(n.mapValue).fields;if(i.length===0)t.push(s);else for(let a of i)t.push(s.child(a))}else t.push(s)}),new Ot(t)}var It=class r{constructor(t,e,n,s,i,a,c){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(t){return new r(t,0,q.min(),q.min(),q.min(),Rt.empty(),0)}static newFoundDocument(t,e,n,s){return new r(t,1,e,q.min(),n,s,0)}static newNoDocument(t,e){return new r(t,2,e,q.min(),q.min(),Rt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,q.min(),q.min(),Rt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Rt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Rt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Ce=class{constructor(t,e){this.position=t,this.inclusive=e}};function _d(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){let i=t[s],a=r.position[s];if(i.field.isKeyField()?n=M.comparator(M.fromName(a.referenceValue),e.key):n=Pe(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function wd(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Xt(r.position[e],t.position[e]))return!1;return!0}var ln=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Fy(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Ai=class{},Q=class r extends Ai{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new ac(t,e,n):e==="array-contains"?new lc(t,n):e==="in"?new bi(t,n):e==="not-in"?new hc(t,n):e==="array-contains-any"?new dc(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new cc(t,n):new uc(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Pe(e,this.value)):e!==null&&Re(this.value)===Re(e)&&this.matchesComparison(Pe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Z=class r extends Ai{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new r(t,e)}matches(t){return Zn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Zn(r){return r.op==="and"}function ic(r){return r.op==="or"}function Zu(r){return Gf(r)&&Zn(r)}function Gf(r){for(let t of r.filters)if(t instanceof Z)return!1;return!0}function oc(r){if(r instanceof Q)return r.field.canonicalString()+r.op.toString()+Yn(r.value);if(Zu(r))return r.filters.map(t=>oc(t)).join(",");{let t=r.filters.map(e=>oc(e)).join(",");return`${r.op}(${t})`}}function $f(r,t){return r instanceof Q?function(n,s){return s instanceof Q&&n.op===s.op&&n.field.isEqual(s.field)&&Xt(n.value,s.value)}(r,t):r instanceof Z?function(n,s){return s instanceof Z&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((i,a,c)=>i&&$f(a,s.filters[c]),!0):!1}(r,t):void F(19439)}function Kf(r,t){let e=r.filters.concat(t);return Z.create(e,r.op)}function Qf(r){return r instanceof Q?function(e){return`${e.field.canonicalString()} ${e.op} ${Yn(e.value)}`}(r):r instanceof Z?function(e){return e.op.toString()+" {"+e.getFilters().map(Qf).join(" ,")+"}"}(r):"Filter"}var ac=class extends Q{constructor(t,e,n){super(t,e,n),this.key=M.fromName(n.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},cc=class extends Q{constructor(t,e){super(t,"in",e),this.keys=Wf("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},uc=class extends Q{constructor(t,e){super(t,"not-in",e),this.keys=Wf("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Wf(r,t){return(t.arrayValue?.values||[]).map(e=>M.fromName(e.referenceValue))}var lc=class extends Q{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return ds(e)&&ls(e.arrayValue,this.value)}},bi=class extends Q{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&ls(this.value.arrayValue,e)}},hc=class extends Q{constructor(t,e){super(t,"not-in",e)}matches(t){if(ls(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!ls(this.value.arrayValue,e)}},dc=class extends Q{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!ds(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>ls(this.value.arrayValue,n))}};var fc=class{constructor(t,e=null,n=[],s=[],i=null,a=null,c=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Te=null}};function mc(r,t=null,e=[],n=[],s=null,i=null,a=null){return new fc(r,t,e,n,s,i,a)}function hn(r){let t=L(r);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>oc(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),wo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Yn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Yn(n)).join(",")),t.Te=e}return t.Te}function bs(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Fy(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!$f(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!wd(r.startAt,t.startAt)&&wd(r.endAt,t.endAt)}function Si(r){return M.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ri(r,t){return r.filters.filter(e=>e instanceof Q&&e.field.isEqual(t))}function Ed(r,t,e){let n=ci,s=!0;for(let i of Ri(r,t)){let a=ci,c=!0;switch(i.op){case"<":case"<=":a=Oy(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,c=!1;break;case"!=":case"not-in":a=ci}gd({value:n,inclusive:s},{value:a,inclusive:c})<0&&(n=a,s=c)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];gd({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function Id(r,t,e){let n=Te,s=!0;for(let i of Ri(r,t)){let a=Te,c=!0;switch(i.op){case">=":case">":a=My(i.value),c=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,c=!1;break;case"!=":case"not-in":a=Te}yd({value:n,inclusive:s},{value:a,inclusive:c})>0&&(n=a,s=c)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];yd({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}var De=class{constructor(t,e=null,n=[],s=[],i=null,a="F",c=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function Hf(r,t,e,n,s,i,a,c){return new De(r,t,e,n,s,i,a,c)}function bo(r){return new De(r)}function Td(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Jf(r){return r.collectionGroup!==null}function Jr(r){let t=L(r);if(t.Ie===null){t.Ie=[];let e=new Set;for(let i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new et(pt.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new ln(i,n))}),e.has(pt.keyField().canonicalString())||t.Ie.push(new ln(pt.keyField(),n))}return t.Ie}function Ft(r){let t=L(r);return t.Ee||(t.Ee=Ly(t,Jr(r))),t.Ee}function Ly(r,t){if(r.limitType==="F")return mc(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new ln(s.field,i)});let e=r.endAt?new Ce(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Ce(r.startAt.position,r.startAt.inclusive):null;return mc(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function pc(r,t){let e=r.filters.concat([t]);return new De(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Pi(r,t,e){return new De(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function So(r,t){return bs(Ft(r),Ft(t))&&r.limitType===t.limitType}function Xf(r){return`${hn(Ft(r))}|lt:${r.limitType}`}function xn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>Qf(s)).join(", ")}]`),wo(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>Yn(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>Yn(s)).join(",")),`Target(${n})`}(Ft(r))}; limitType=${r.limitType})`}function Ss(r,t){return t.isFoundDocument()&&function(n,s){let i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):M.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,t)&&function(n,s){for(let i of Jr(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(r,t)&&function(n,s){for(let i of n.filters)if(!i.matches(s))return!1;return!0}(r,t)&&function(n,s){return!(n.startAt&&!function(a,c,l){let d=_d(a,c,l);return a.inclusive?d<=0:d<0}(n.startAt,Jr(n),s)||n.endAt&&!function(a,c,l){let d=_d(a,c,l);return a.inclusive?d>=0:d>0}(n.endAt,Jr(n),s))}(r,t)}function Yf(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Zf(r){return(t,e)=>{let n=!1;for(let s of Jr(r)){let i=By(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function By(r,t,e){let n=r.field.isKeyField()?M.comparator(t.key,e.key):function(i,a,c){let l=a.data.field(i),d=c.data.field(i);return l!==null&&d!==null?Pe(l,d):F(42886)}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return F(19790,{direction:r.dir})}}var jt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Le(this.inner,(e,n)=>{for(let[s,i]of n)t(s,i)})}isEmpty(){return Of(this.inner)}size(){return this.innerSize}};var Uy=new st(M.comparator);function Mt(){return Uy}var tm=new st(M.comparator);function Gr(...r){let t=tm;for(let e of r)t=t.insert(e.key,e);return t}function em(r){let t=tm;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Wt(){return Xr()}function nm(){return Xr()}function Xr(){return new jt(r=>r.toString(),(r,t)=>r.isEqual(t))}var qy=new st(M.comparator),jy=new et(M.comparator);function K(...r){let t=jy;for(let e of r)t=t.add(e);return t}var zy=new et(z);function tl(){return zy}function el(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rs(t)?"-0":t}}function rm(r){return{integerValue:""+r}}function Gy(r,t){return Af(t)?rm(t):el(r,t)}var tr=class{constructor(){this._=void 0}};function $y(r,t,e){return r instanceof dn?function(s,i){let a={fields:{[Ff]:{stringValue:Mf},[Bf]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ju(i)&&(i=vo(i)),i&&(a.fields[Lf]=i),{mapValue:a}}(e,t):r instanceof ae?im(r,t):r instanceof Ve?om(r,t):function(s,i){let a=sm(s,i),c=vd(a)+vd(s.Ae);return sc(a)&&sc(s.Ae)?rm(c):el(s.serializer,c)}(r,t)}function Ky(r,t,e){return r instanceof ae?im(r,t):r instanceof Ve?om(r,t):e}function sm(r,t){return r instanceof fn?function(n){return sc(n)||function(i){return!!i&&"doubleValue"in i}(n)}(t)?t:{integerValue:0}:null}var dn=class extends tr{},ae=class extends tr{constructor(t){super(),this.elements=t}};function im(r,t){let e=am(t);for(let n of r.elements)e.some(s=>Xt(s,n))||e.push(n);return{arrayValue:{values:e}}}var Ve=class extends tr{constructor(t){super(),this.elements=t}};function om(r,t){let e=am(t);for(let n of r.elements)e=e.filter(s=>!Xt(s,n));return{arrayValue:{values:e}}}var fn=class extends tr{constructor(t,e){super(),this.serializer=t,this.Ae=e}};function vd(r){return it(r.integerValue||r.doubleValue)}function am(r){return ds(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var Ci=class{constructor(t,e){this.field=t,this.transform=e}};function Qy(r,t){return r.field.isEqual(t.field)&&function(n,s){return n instanceof ae&&s instanceof ae||n instanceof Ve&&s instanceof Ve?jn(n.elements,s.elements,Xt):n instanceof fn&&s instanceof fn?Xt(n.Ae,s.Ae):n instanceof dn&&s instanceof dn}(r.transform,t.transform)}var gc=class{constructor(t,e){this.version=t,this.transformResults=e}},Et=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function hi(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var er=class{};function cm(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new mn(r.key,Et.none()):new xe(r.key,r.data,Et.none());{let e=r.data,n=Rt.empty(),s=new et(pt.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new zt(r.key,n,new Ot(s.toArray()),Et.none())}}function Wy(r,t,e){r instanceof xe?function(s,i,a){let c=s.value.clone(),l=bd(s.fieldTransforms,i,a.transformResults);c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,t,e):r instanceof zt?function(s,i,a){if(!hi(s.precondition,i))return void i.convertToUnknownDocument(a.version);let c=bd(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(um(s)),l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Yr(r,t,e,n){return r instanceof xe?function(i,a,c,l){if(!hi(i.precondition,a))return c;let d=i.value.clone(),m=Sd(i.fieldTransforms,l,a);return d.setAll(m),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof zt?function(i,a,c,l){if(!hi(i.precondition,a))return c;let d=Sd(i.fieldTransforms,l,a),m=a.data;return m.setAll(um(i)),m.setAll(d),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(p=>p.field))}(r,t,e,n):function(i,a,c){return hi(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(r,t,e)}function Hy(r,t){let e=null;for(let n of r.fieldTransforms){let s=t.data.field(n.field),i=sm(n.transform,s||null);i!=null&&(e===null&&(e=Rt.empty()),e.set(n.field,i))}return e||null}function Ad(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&jn(n,s,(i,a)=>Qy(i,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var xe=class extends er{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},zt=class extends er{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function um(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function bd(r,t,e){let n=new Map;B(r.length===e.length,32656,{Re:e.length,Ve:r.length});for(let s=0;s<e.length;s++){let i=r[s],a=i.transform,c=t.data.field(i.field);n.set(i.field,Ky(a,c,e[s]))}return n}function Sd(r,t,e){let n=new Map;for(let s of r){let i=s.transform,a=e.data.field(s.field);n.set(s.field,$y(i,a,t))}return n}var mn=class extends er{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Di=class extends er{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var fs=class{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&Wy(i,t,n[s])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Yr(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Yr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=nm();return this.mutations.forEach(s=>{let i=t.get(s.key),a=i.overlayedDocument,c=this.applyToLocalView(a,i.mutatedFields);c=e.has(s.key)?null:c;let l=cm(a,c);l!==null&&n.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(q.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&jn(this.mutations,t.mutations,(e,n)=>Ad(e,n))&&jn(this.baseMutations,t.baseMutations,(e,n)=>Ad(e,n))}},yc=class r{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){B(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=function(){return qy}(),i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new r(t,e,n,s)}};var ms=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var _c=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ut,J;function Jy(r){switch(r){case P.OK:return F(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return F(15467,{code:r})}}function lm(r){if(r===void 0)return ct("GRPC error has no .code"),P.UNKNOWN;switch(r){case ut.OK:return P.OK;case ut.CANCELLED:return P.CANCELLED;case ut.UNKNOWN:return P.UNKNOWN;case ut.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ut.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ut.INTERNAL:return P.INTERNAL;case ut.UNAVAILABLE:return P.UNAVAILABLE;case ut.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ut.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ut.NOT_FOUND:return P.NOT_FOUND;case ut.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ut.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ut.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ut.ABORTED:return P.ABORTED;case ut.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ut.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ut.DATA_LOSS:return P.DATA_LOSS;default:return F(39323,{code:r})}}(J=ut||(ut={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var Xy=null;function Yy(){return new TextEncoder}var Zy=new ne([4294967295,4294967295],0);function Rd(r){let t=Yy().encode(r),e=new Sa;return e.update(t),new Uint8Array(e.digest())}function Pd(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new ne([e,n],0),new ne([s,i],0)]}var wc=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new en(`Invalid padding: ${e}`);if(n<0)throw new en(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new en(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new en(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=ne.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(ne.fromNumber(n)));return s.compare(Zy)===1&&(s=new ne([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;let e=Rd(t),[n,s]=Pd(e);for(let i=0;i<this.hashCount;i++){let a=this.ye(n,s,i);if(!this.we(a))return!1}return!0}static create(t,e,n){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new r(i,s,e);return n.forEach(c=>a.insert(c)),a}insert(t){if(this.ge===0)return;let e=Rd(t),[n,s]=Pd(e);for(let i=0;i<this.hashCount;i++){let a=this.ye(n,s,i);this.Se(a)}}Se(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},en=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ps=class r{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let s=new Map;return s.set(t,gs.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(q.min(),s,new st(z),Mt(),K())}},gs=class r{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};var Ln=class{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}},Vi=class{constructor(t,e){this.targetId=t,this.Ce=e}},xi=class{constructor(t,e,n=ft.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}},Ni=class{constructor(){this.ve=0,this.Fe=Cd(),this.Me=ft.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=K(),e=K(),n=K();return this.Fe.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:F(38017,{changeType:i})}}),new gs(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=Cd()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,B(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},Ec=class{constructor(t){this.Ge=t,this.ze=new Map,this.je=Mt(),this.Je=ei(),this.He=ei(),this.Ye=new st(z)}Ze(t){for(let e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(let e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{let n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:F(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((n,s)=>{this.rt(s)&&e(s)})}st(t){let e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){let i=s.target;if(Si(i))if(n===0){let a=new M(i.path);this.et(e,a,It.newNoDocument(a,q.min()))}else B(n===1,20013,{expectedCount:n});else{let a=this._t(e);if(a!==n){let c=this.ut(t),l=c?this.ct(c,t,a):1;if(l!==0){this.it(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}Xy?.lt(function(m,p,w,R,N){let O={localCacheCount:m,existenceFilterCount:p.count,databaseId:w.database,projectId:w.projectId},V=p.unchangedNames;return V&&(O.bloomFilter={applied:N===0,hashCount:V?.hashCount??0,bitmapLength:V?.bits?.bitmap?.length??0,padding:V?.bits?.padding??0,mightContain:G=>R?.mightContain(G)??!1}),O}(a,t.Ce,this.Ge.ht(),c,l))}}}}ut(t){let e=t.Ce.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e,a,c;try{a=oe(n).toUint8Array()}catch(l){if(l instanceof vi)return qn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new wc(a,s,i)}catch(l){return qn(l instanceof en?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.ge===0?null:c}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){let n=this.Ge.getRemoteKeysForTarget(e),s=0;return n.forEach(i=>{let a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(c)||(this.et(e,i,null),s++)}),s}Tt(t){let e=new Map;this.ze.forEach((i,a)=>{let c=this.ot(a);if(c){if(i.current&&Si(c.target)){let l=new M(c.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,It.newNoDocument(l,t))}i.Be&&(e.set(a,i.ke()),i.qe())}});let n=K();this.He.forEach((i,a)=>{let c=!0;a.forEachWhile(l=>{let d=this.ot(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.je.forEach((i,a)=>a.setReadTime(t));let s=new ps(t,e,this.Ye,this.je,n);return this.je=Mt(),this.Je=ei(),this.He=ei(),this.Ye=new st(z),s}Xe(t,e){if(!this.rt(t))return;let n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;let s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){let e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Ni,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new et(z),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new et(z),this.Je=this.Je.insert(t,e)),e}rt(t){let e=this.ot(t)!==null;return e||D("WatchChangeAggregator","Detected inactive target",t),e}ot(t){let e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Ni),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}};function ei(){return new st(M.comparator)}function Cd(){return new st(M.comparator)}var t_={asc:"ASCENDING",desc:"DESCENDING"},e_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},n_={and:"AND",or:"OR"},Ic=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Tc(r,t){return r.useProto3Json||wo(t)?t:{value:t}}function nr(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function hm(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function r_(r,t){return nr(r,t.toTimestamp())}function Pt(r){return B(!!r,49232),q.fromTimestamp(function(e){let n=ie(e);return new ot(n.seconds,n.nanos)}(r))}function nl(r,t){return vc(r,t).canonicalString()}function vc(r,t){let e=function(s){return new Y(["projects",s.projectId,"databases",s.database])}(r).child("documents");return t===void 0?e:e.child(t)}function dm(r){let t=Y.fromString(r);return B(Im(t),10190,{key:t.toString()}),t}function ki(r,t){return nl(r.databaseId,t.path)}function an(r,t){let e=dm(t);if(e.get(1)!==r.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new M(pm(e))}function fm(r,t){return nl(r.databaseId,t)}function mm(r){let t=dm(r);return t.length===4?Y.emptyPath():pm(t)}function Ac(r){return new Y(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function pm(r){return B(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function Dd(r,t,e){return{name:ki(r,t),fields:e.value.mapValue.fields}}function s_(r,t,e){let n=an(r,t.name),s=Pt(t.updateTime),i=t.createTime?Pt(t.createTime):q.min(),a=new Rt({mapValue:{fields:t.fields}}),c=It.newFoundDocument(n,s,i,a);return e&&c.setHasCommittedMutations(),e?c.setHasCommittedMutations():c}function i_(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:F(39313,{state:d})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(d,m){return d.useProto3Json?(B(m===void 0||typeof m=="string",58123),ft.fromBase64String(m||"")):(B(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),ft.fromUint8Array(m||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&function(d){let m=d.code===void 0?P.UNKNOWN:lm(d.code);return new x(m,d.message||"")}(a);e=new xi(n,s,i,c||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let s=an(r,n.document.name),i=Pt(n.document.updateTime),a=n.document.createTime?Pt(n.document.createTime):q.min(),c=new Rt({mapValue:{fields:n.document.fields}}),l=It.newFoundDocument(s,i,a,c),d=n.targetIds||[],m=n.removedTargetIds||[];e=new Ln(d,m,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let s=an(r,n.document),i=n.readTime?Pt(n.readTime):q.min(),a=It.newNoDocument(s,i),c=n.removedTargetIds||[];e=new Ln([],c,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let s=an(r,n.document),i=n.removedTargetIds||[];e=new Ln([],i,s,null)}else{if(!("filter"in t))return F(11601,{Rt:t});{t.filter;let n=t.filter;n.targetId;let{count:s=0,unchangedNames:i}=n,a=new _c(s,i),c=n.targetId;e=new Vi(c,a)}}return e}function Oi(r,t){let e;if(t instanceof xe)e={update:Dd(r,t.key,t.value)};else if(t instanceof mn)e={delete:ki(r,t.key)};else if(t instanceof zt)e={update:Dd(r,t.key,t.data),updateMask:h_(t.fieldMask)};else{if(!(t instanceof Di))return F(16599,{Vt:t.type});e={verify:ki(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(i,a){let c=a.transform;if(c instanceof dn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof ae)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Ve)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof fn)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw F(20930,{transform:a.transform})}(0,n))),t.precondition.isNone||(e.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:r_(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:F(27497)}(r,t.precondition)),e}function bc(r,t){let e=t.currentDocument?function(i){return i.updateTime!==void 0?Et.updateTime(Pt(i.updateTime)):i.exists!==void 0?Et.exists(i.exists):Et.none()}(t.currentDocument):Et.none(),n=t.updateTransforms?t.updateTransforms.map(s=>function(a,c){let l=null;if("setToServerValue"in c)B(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),l=new dn;else if("appendMissingElements"in c){let m=c.appendMissingElements.values||[];l=new ae(m)}else if("removeAllFromArray"in c){let m=c.removeAllFromArray.values||[];l=new Ve(m)}else"increment"in c?l=new fn(a,c.increment):F(16584,{proto:c});let d=pt.fromServerFormat(c.fieldPath);return new Ci(d,l)}(r,s)):[];if(t.update){t.update.name;let s=an(r,t.update.name),i=new Rt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new Ot(d.map(m=>pt.fromServerFormat(m)))}(t.updateMask);return new zt(s,i,a,e,n)}return new xe(s,i,e,n)}if(t.delete){let s=an(r,t.delete);return new mn(s,e)}if(t.verify){let s=an(r,t.verify);return new Di(s,e)}return F(1463,{proto:t})}function o_(r,t){return r&&r.length>0?(B(t!==void 0,14353),r.map(e=>function(s,i){let a=s.updateTime?Pt(s.updateTime):Pt(i);return a.isEqual(q.min())&&(a=Pt(i)),new gc(a,s.transformResults||[])}(e,t))):[]}function gm(r,t){return{documents:[fm(r,t.path)]}}function ym(r,t){let e={structuredQuery:{}},n=t.path,s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=fm(r,s);let i=function(d){if(d.length!==0)return Em(Z.create(d,"and"))}(t.filters);i&&(e.structuredQuery.where=i);let a=function(d){if(d.length!==0)return d.map(m=>function(w){return{field:Nn(w.field),direction:c_(w.dir)}}(m))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let c=Tc(r,t.limit);return c!==null&&(e.structuredQuery.limit=c),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{ft:e,parent:s}}function _m(r){let t=mm(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,s=null;if(n>0){B(n===1,65062);let m=e.from[0];m.allDescendants?s=m.collectionId:t=t.child(m.collectionId)}let i=[];e.where&&(i=function(p){let w=wm(p);return w instanceof Z&&Zu(w)?w.getFilters():[w]}(e.where));let a=[];e.orderBy&&(a=function(p){return p.map(w=>function(N){return new ln(kn(N.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(w))}(e.orderBy));let c=null;e.limit&&(c=function(p){let w;return w=typeof p=="object"?p.value:p,wo(w)?null:w}(e.limit));let l=null;e.startAt&&(l=function(p){let w=!!p.before,R=p.values||[];return new Ce(R,w)}(e.startAt));let d=null;return e.endAt&&(d=function(p){let w=!p.before,R=p.values||[];return new Ce(R,w)}(e.endAt)),Hf(t,s,a,i,c,"F",l,d)}function a_(r,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function wm(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=kn(e.unaryFilter.field);return Q.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=kn(e.unaryFilter.field);return Q.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=kn(e.unaryFilter.field);return Q.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=kn(e.unaryFilter.field);return Q.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(r):r.fieldFilter!==void 0?function(e){return Q.create(kn(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return Z.create(e.compositeFilter.filters.map(n=>wm(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(e.compositeFilter.op))}(r):F(30097,{filter:r})}function c_(r){return t_[r]}function u_(r){return e_[r]}function l_(r){return n_[r]}function Nn(r){return{fieldPath:r.canonicalString()}}function kn(r){return pt.fromServerFormat(r.fieldPath)}function Em(r){return r instanceof Q?function(e){if(e.op==="=="){if(pd(e.value))return{unaryFilter:{field:Nn(e.field),op:"IS_NAN"}};if(md(e.value))return{unaryFilter:{field:Nn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(pd(e.value))return{unaryFilter:{field:Nn(e.field),op:"IS_NOT_NAN"}};if(md(e.value))return{unaryFilter:{field:Nn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Nn(e.field),op:u_(e.op),value:e.value}}}(r):r instanceof Z?function(e){let n=e.getFilters().map(s=>Em(s));return n.length===1?n[0]:{compositeFilter:{op:l_(e.op),filters:n}}}(r):F(54877,{filter:r})}function h_(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Im(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var rr=class r{constructor(t,e,n,s,i=q.min(),a=q.min(),c=ft.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Mi=class{constructor(t){this.yt=t}};function d_(r,t){let e;if(t.document)e=s_(r.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=M.fromSegments(t.noDocument.path),s=gn(t.noDocument.readTime);e=It.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return F(56709);{let n=M.fromSegments(t.unknownDocument.path),s=gn(t.unknownDocument.version);e=It.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime(function(s){let i=new ot(s[0],s[1]);return q.fromTimestamp(i)}(t.readTime)),e}function Vd(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Fi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(i,a){return{name:ki(i,a.key),fields:a.data.value.mapValue.fields,updateTime:nr(i,a.version.toTimestamp()),createTime:nr(i,a.createTime.toTimestamp())}}(r.yt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:pn(t.version)};else{if(!t.isUnknownDocument())return F(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:pn(t.version)}}return n}function Fi(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function pn(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function gn(r){let t=new ot(r.seconds,r.nanoseconds);return q.fromTimestamp(t)}function Xe(r,t){let e=(t.baseMutations||[]).map(i=>bc(r.yt,i));for(let i=0;i<t.mutations.length-1;++i){let a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){let c=t.mutations[i+1];a.updateTransforms=c.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}let n=t.mutations.map(i=>bc(r.yt,i)),s=ot.fromMillis(t.localWriteTimeMs);return new fs(t.batchId,s,e,n)}function $r(r){let t=gn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?gn(r.lastLimboFreeSnapshotVersion):q.min(),n;return n=function(i){return i.documents!==void 0}(r.query)?function(i){let a=i.documents.length;return B(a===1,1966,{count:a}),Ft(bo(mm(i.documents[0])))}(r.query):function(i){return Ft(_m(i))}(r.query),new rr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,ft.fromBase64String(r.resumeToken))}function Tm(r,t){let e=pn(t.snapshotVersion),n=pn(t.lastLimboFreeSnapshotVersion),s;s=Si(t.target)?gm(r.yt,t.target):ym(r.yt,t.target).ft;let i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:hn(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function vm(r){let t=_m({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Pi(t,t.limit,"L"):t}function Na(r,t){return new ms(t.largestBatchId,bc(r.yt,t.overlayMutation))}function xd(r,t){let e=t.path.lastSegment();return[r,At(t.path.popLast()),e]}function Nd(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:pn(n.readTime),documentKey:At(n.documentKey.path),largestBatchId:n.largestBatchId}}var Sc=class{getBundleMetadata(t,e){return kd(t).get(e).next(n=>{if(n)return function(i){return{id:i.bundleId,createTime:gn(i.createTime),version:i.version}}(n)})}saveBundleMetadata(t,e){return kd(t).put(function(s){return{bundleId:s.id,createTime:pn(Pt(s.createTime)),version:s.version}}(e))}getNamedQuery(t,e){return Od(t).get(e).next(n=>{if(n)return function(i){return{name:i.name,query:vm(i.bundledQuery),readTime:gn(i.readTime)}}(n)})}saveNamedQuery(t,e){return Od(t).put(function(s){return{name:s.name,readTime:pn(Pt(s.readTime)),bundledQuery:s.bundledQuery}}(e))}};function kd(r){return gt(r,Eo)}function Od(r){return gt(r,Io)}var Li=class r{constructor(t,e){this.serializer=t,this.userId=e}static wt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return Ur(t).get(xd(this.userId,e)).next(n=>n?Na(this.serializer,n):null)}getOverlays(t,e){let n=Wt();return b.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){let s=[];return n.forEach((i,a)=>{let c=new ms(e,a);s.push(this.St(t,c))}),b.waitFor(s)}removeOverlaysForBatchId(t,e,n){let s=new Set;e.forEach(a=>s.add(At(a.getCollectionPath())));let i=[];return s.forEach(a=>{let c=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(Ur(t).Z(ec,c))}),b.waitFor(i)}getOverlaysForCollection(t,e,n){let s=Wt(),i=At(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ur(t).J(ec,a).next(c=>{for(let l of c){let d=Na(this.serializer,l);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(t,e,n,s){let i=Wt(),a,c=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Ur(t).ee({index:Df,range:c},(l,d,m)=>{let p=Na(this.serializer,d);i.size()<s||p.largestBatchId===a?(i.set(p.getKey(),p),a=p.largestBatchId):m.done()}).next(()=>i)}St(t,e){return Ur(t).put(function(s,i,a){let[c,l,d]=xd(i,a.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Oi(s.yt,a.mutation)}}(this.serializer,this.userId,e))}};function Ur(r){return gt(r,To)}var Rc=class{bt(t){return gt(t,Wu)}getSessionToken(t){return this.bt(t).get("sessionToken").next(e=>{let n=e?.value;return n?ft.fromUint8Array(n):ft.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.bt(t).put({name:"sessionToken",value:e.toUint8Array()})}};var se=class{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(it(t.integerValue));else if("doubleValue"in t){let n=it(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),rs(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),typeof n=="string"&&(n=ie(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(oe(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?qf(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):Ao(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):F(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){let n=t.fields||{};this.Ft(e,55);for(let s of Object.keys(n))this.Ot(s,e),this.Ct(n[s],e)}kt(t,e){let n=t.fields||{};this.Ft(e,53);let s=Xn,i=n[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(it(i)),this.Ot(s,e),this.Ct(n[s],e)}Qt(t,e){let n=t.values||[];this.Ft(e,50);for(let s of n)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),M.fromName(t).path.forEach(n=>{this.Ft(e,60),this.Ut(n,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}};se.Kt=new se;var Rn=255;function f_(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function Md(r){let t=64-function(n){let s=0;for(let i=0;i<8;++i){let a=f_(255&n[i]);if(s+=a,a!==8)break}return s}(r);return Math.ceil(t/8)}var Pc=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Gt(n.value),n=e.next();this.zt()}jt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Jt(n.value),n=e.next();this.Ht()}Yt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{let s=e.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{let s=e.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(t){let e=this.en(t),n=Md(e);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}nn(t){let e=this.en(t),n=Md(e);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}rn(){this.sn(Rn),this.sn(255)}_n(){this.an(Rn),this.an(255)}reset(){this.position=0}seed(t){this.tn(t.length),this.buffer.set(t,this.position),this.position+=t.length}un(){return this.buffer.slice(0,this.position)}en(t){let e=function(i){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Gt(t){let e=255&t;e===0?(this.sn(0),this.sn(255)):e===Rn?(this.sn(Rn),this.sn(0)):this.sn(e)}Jt(t){let e=255&t;e===0?(this.an(0),this.an(255)):e===Rn?(this.an(Rn),this.an(0)):this.an(t)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(t){this.tn(1),this.buffer[this.position++]=t}an(t){this.tn(1),this.buffer[this.position++]=~t}tn(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},Cc=class{constructor(t){this.cn=t}Bt(t){this.cn.Wt(t)}xt(t){this.cn.Yt(t)}Mt(t){this.cn.Xt(t)}vt(){this.cn.rn()}},Dc=class{constructor(t){this.cn=t}Bt(t){this.cn.jt(t)}xt(t){this.cn.Zt(t)}Mt(t){this.cn.nn(t)}vt(){this.cn._n()}},Ye=class{constructor(){this.cn=new Pc,this.ln=new Cc(this.cn),this.hn=new Dc(this.cn)}seed(t){this.cn.seed(t)}Pn(t){return t===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}};var Ze=class r{constructor(t,e,n,s){this.Tn=t,this.In=e,this.En=n,this.dn=s}An(){let t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new r(this.Tn,this.In,this.En,n)}Rn(t,e,n){return{indexId:this.Tn,uid:t,arrayValue:di(this.En),directionalValue:di(this.dn),orderedDocumentKey:di(e),documentKey:n.path.toArray()}}Vn(t,e,n){let s=this.Rn(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}};function _e(r,t){let e=r.Tn-t.Tn;return e!==0?e:(e=Fd(r.En,t.En),e!==0?e:(e=Fd(r.dn,t.dn),e!==0?e:M.comparator(r.In,t.In)))}function Fd(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function di(r){return la()?function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n}(r):r}function Ld(r){return typeof r!="string"?r:function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(r)}var Bi=class{constructor(t){this.mn=new et((e,n)=>pt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.fn=t.orderBy,this.gn=[];for(let e of t.filters){let n=e;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(t){if(B(t.collectionGroup===this.collectionId,49279),this.pn)return!1;let e=Wa(t);if(e!==void 0&&!this.wn(e))return!1;let n=We(t),s=new Set,i=0,a=0;for(;i<n.length&&this.wn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){let c=this.mn.getIterator().getNext();if(!s.has(c.field.canonicalString())){let l=n[i];if(!this.Sn(c,l)||!this.bn(this.fn[a++],l))return!1}++i}for(;i<n.length;++i){let c=n[i];if(a>=this.fn.length||!this.bn(this.fn[a++],c))return!1}return!0}Dn(){if(this.pn)return null;let t=new et(pt.comparator),e=[];for(let n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Fn(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Fn(n.field,0))}for(let n of this.fn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Fn(n.field,n.dir==="asc"?0:1)));return new Gn(Gn.UNKNOWN_ID,this.collectionId,e,ns.empty())}wn(t){for(let e of this.gn)if(this.Sn(e,t))return!0;return!1}Sn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}bn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Am(r){if(B(r instanceof Q||r instanceof Z,20012),r instanceof Q){if(r instanceof bi){let e=r.value.arrayValue?.values?.map(n=>Q.create(r.field,"==",n))||[];return Z.create(e,"or")}return r}let t=r.filters.map(e=>Am(e));return Z.create(t,r.op)}function m_(r){if(r.getFilters().length===0)return[];let t=Nc(Am(r));return B(bm(t),7391),Vc(t)||xc(t)?[t]:t.getFilters()}function Vc(r){return r instanceof Q}function xc(r){return r instanceof Z&&Zu(r)}function bm(r){return Vc(r)||xc(r)||function(e){if(e instanceof Z&&ic(e)){for(let n of e.getFilters())if(!Vc(n)&&!xc(n))return!1;return!0}return!1}(r)}function Nc(r){if(B(r instanceof Q||r instanceof Z,34018),r instanceof Q)return r;if(r.filters.length===1)return Nc(r.filters[0]);let t=r.filters.map(n=>Nc(n)),e=Z.create(t,r.op);return e=Ui(e),bm(e)?e:(B(e instanceof Z,64498),B(Zn(e),40251),B(e.filters.length>1,57927),e.filters.reduce((n,s)=>rl(n,s)))}function rl(r,t){let e;return B(r instanceof Q||r instanceof Z,38388),B(t instanceof Q||t instanceof Z,25473),e=r instanceof Q?t instanceof Q?function(s,i){return Z.create([s,i],"and")}(r,t):Bd(r,t):t instanceof Q?Bd(t,r):function(s,i){if(B(s.filters.length>0&&i.filters.length>0,48005),Zn(s)&&Zn(i))return Kf(s,i.getFilters());let a=ic(s)?s:i,c=ic(s)?i:s,l=a.filters.map(d=>rl(d,c));return Z.create(l,"or")}(r,t),Ui(e)}function Bd(r,t){if(Zn(t))return Kf(t,r.getFilters());{let e=t.filters.map(n=>rl(r,n));return Z.create(e,"or")}}function Ui(r){if(B(r instanceof Q||r instanceof Z,11850),r instanceof Q)return r;let t=r.getFilters();if(t.length===1)return Ui(t[0]);if(Gf(r))return r;let e=t.map(s=>Ui(s)),n=[];return e.forEach(s=>{s instanceof Q?n.push(s):s instanceof Z&&(s.op===r.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:Z.create(n,r.op)}var kc=class{constructor(){this.Cn=new ys}addToCollectionParentIndex(t,e){return this.Cn.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(Lt.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(Lt.min())}updateCollectionGroup(t,e,n){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}},ys=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new et(Y.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new et(Y.comparator)).toArray()}};var Ud="IndexedDbIndexManager",ni=new Uint8Array(0),Oc=class{constructor(t,e){this.databaseId=e,this.vn=new ys,this.Fn=new jt(n=>hn(n),(n,s)=>bs(n,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){let n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});let i={collectionId:n,parent:At(s)};return qd(t).put(i)}return b.resolve()}getCollectionParents(t,e){let n=[],s=IDBKeyRange.bound([e,""],[yf(e),""],!1,!0);return qd(t).J(s).next(i=>{for(let a of i){if(a.collectionId!==e)break;n.push(Qt(a.parent))}return n})}addFieldIndex(t,e){let n=qr(t),s=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete s.indexId;let i=n.add(s);if(e.indexState){let a=Cn(t);return i.next(c=>{a.put(Nd(c,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return i.next()}deleteFieldIndex(t,e){let n=qr(t),s=Cn(t),i=Pn(t);return n.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=qr(t),n=Pn(t),s=Cn(t);return e.Z().next(()=>n.Z()).next(()=>s.Z())}createTargetIndexes(t,e){return b.forEach(this.Mn(e),n=>this.getIndexType(t,n).next(s=>{if(s===0||s===1){let i=new Bi(n).Dn();if(i!=null)return this.addFieldIndex(t,i)}}))}getDocumentsMatchingTarget(t,e){let n=Pn(t),s=!0,i=new Map;return b.forEach(this.Mn(e),a=>this.xn(t,a).next(c=>{s&&(s=!!c),i.set(a,c)})).next(()=>{if(s){let a=K(),c=[];return b.forEach(i,(l,d)=>{D(Ud,`Using index ${function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(tt=>`${tt.fieldPath}:${tt.kind}`).join(",")}`}(l)} to execute ${hn(e)}`);let m=function(U,tt){let X=Wa(tt);if(X===void 0)return null;for(let W of Ri(U,X.fieldPath))switch(W.op){case"array-contains-any":return W.value.arrayValue.values||[];case"array-contains":return[W.value]}return null}(d,l),p=function(U,tt){let X=new Map;for(let W of We(tt))for(let E of Ri(U,W.fieldPath))switch(E.op){case"==":case"in":X.set(W.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return X.set(W.fieldPath.canonicalString(),E.value),Array.from(X.values())}return null}(d,l),w=function(U,tt){let X=[],W=!0;for(let E of We(tt)){let g=E.kind===0?Ed(U,E.fieldPath,U.startAt):Id(U,E.fieldPath,U.startAt);X.push(g.value),W&&(W=g.inclusive)}return new Ce(X,W)}(d,l),R=function(U,tt){let X=[],W=!0;for(let E of We(tt)){let g=E.kind===0?Id(U,E.fieldPath,U.endAt):Ed(U,E.fieldPath,U.endAt);X.push(g.value),W&&(W=g.inclusive)}return new Ce(X,W)}(d,l),N=this.On(l,d,w),O=this.On(l,d,R),V=this.Nn(l,d,p),G=this.Bn(l.indexId,m,N,w.inclusive,O,R.inclusive,V);return b.forEach(G,j=>n.Y(j,e.limit).next(U=>{U.forEach(tt=>{let X=M.fromSegments(tt.documentKey);a.has(X)||(a=a.add(X),c.push(X))})}))}).next(()=>c)}return b.resolve(null)})}Mn(t){let e=this.Fn.get(t);return e||(t.filters.length===0?e=[t]:e=m_(Z.create(t.filters,"and")).map(n=>mc(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Fn.set(t,e),e)}Bn(t,e,n,s,i,a,c){let l=(e!=null?e.length:1)*Math.max(n.length,i.length),d=l/(e!=null?e.length:1),m=[];for(let p=0;p<l;++p){let w=e?this.Ln(e[p/d]):ni,R=this.kn(t,w,n[p%d],s),N=this.qn(t,w,i[p%d],a),O=c.map(V=>this.kn(t,w,V,!0));m.push(...this.createRange(R,N,O))}return m}kn(t,e,n,s){let i=new Ze(t,M.empty(),e,n);return s?i:i.An()}qn(t,e,n,s){let i=new Ze(t,M.empty(),e,n);return s?i.An():i}xn(t,e){let n=new Bi(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(i=>{let a=null;for(let c of i)n.yn(c)&&(!a||c.fields.length>a.fields.length)&&(a=c);return a})}getIndexType(t,e){let n=2,s=this.Mn(e);return b.forEach(s,i=>this.xn(t,i).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new et(pt.comparator),m=!1;for(let p of l.filters)for(let w of p.getFlattenedFilters())w.field.isKeyField()||(w.op==="array-contains"||w.op==="array-contains-any"?m=!0:d=d.add(w.field));for(let p of l.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(m?1:0)}(i)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&s.length>1&&n===2?1:n)}Qn(t,e){let n=new Ye;for(let s of We(t)){let i=e.data.field(s.fieldPath);if(i==null)return null;let a=n.Pn(s.kind);se.Kt.Dt(i,a)}return n.un()}Ln(t){let e=new Ye;return se.Kt.Dt(t,e.Pn(0)),e.un()}$n(t,e){let n=new Ye;return se.Kt.Dt(hs(this.databaseId,e),n.Pn(function(i){let a=We(i);return a.length===0?0:a[a.length-1].kind}(t))),n.un()}Nn(t,e,n){if(n===null)return[];let s=[];s.push(new Ye);let i=0;for(let a of We(t)){let c=n[i++];for(let l of s)if(this.Un(e,a.fieldPath)&&ds(c))s=this.Kn(s,a,c);else{let d=l.Pn(a.kind);se.Kt.Dt(c,d)}}return this.Wn(s)}On(t,e,n){return this.Nn(t,e,n.position)}Wn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].un();return e}Kn(t,e,n){let s=[...t],i=[];for(let a of n.arrayValue.values||[])for(let c of s){let l=new Ye;l.seed(c.un()),se.Kt.Dt(a,l.Pn(e.kind)),i.push(l)}return i}Un(t,e){return!!t.filters.find(n=>n instanceof Q&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=qr(t),s=Cn(t);return(e?n.J(tc,IDBKeyRange.bound(e,e)):n.J()).next(i=>{let a=[];return b.forEach(i,c=>s.get([c.indexId,this.uid]).next(l=>{a.push(function(m,p){let w=p?new ns(p.sequenceNumber,new Lt(gn(p.readTime),new M(Qt(p.documentKey)),p.largestBatchId)):ns.empty(),R=m.fields.map(([N,O])=>new Fn(pt.fromServerFormat(N),O));return new Gn(m.indexId,m.collectionGroup,R,w)}(c,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,s)=>{let i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:z(n.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let s=qr(t),i=Cn(t);return this.Gn(t).next(a=>s.J(tc,IDBKeyRange.bound(e,e)).next(c=>b.forEach(c,l=>i.put(Nd(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return b.forEach(e,(s,i)=>{let a=n.get(s.collectionGroup);return(a?b.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next(c=>(n.set(s.collectionGroup,c),b.forEach(c,l=>this.zn(t,s,l).next(d=>{let m=this.jn(i,l);return d.isEqual(m)?b.resolve():this.Jn(t,i,l,d,m)}))))})}Hn(t,e,n,s){return Pn(t).put(s.Rn(this.uid,this.$n(n,e.key),e.key))}Yn(t,e,n,s){return Pn(t).delete(s.Vn(this.uid,this.$n(n,e.key),e.key))}zn(t,e,n){let s=Pn(t),i=new et(_e);return s.ee({index:Cf,range:IDBKeyRange.only([n.indexId,this.uid,di(this.$n(n,e))])},(a,c)=>{i=i.add(new Ze(n.indexId,e,Ld(c.arrayValue),Ld(c.directionalValue)))}).next(()=>i)}jn(t,e){let n=new et(_e),s=this.Qn(e,t);if(s==null)return n;let i=Wa(e);if(i!=null){let a=t.data.field(i.fieldPath);if(ds(a))for(let c of a.arrayValue.values||[])n=n.add(new Ze(e.indexId,t.key,this.Ln(c),s))}else n=n.add(new Ze(e.indexId,t.key,ni,s));return n}Jn(t,e,n,s,i){D(Ud,"Updating index entries for document '%s'",e.key);let a=[];return function(l,d,m,p,w){let R=l.getIterator(),N=d.getIterator(),O=Sn(R),V=Sn(N);for(;O||V;){let G=!1,j=!1;if(O&&V){let U=m(O,V);U<0?j=!0:U>0&&(G=!0)}else O!=null?j=!0:G=!0;G?(p(V),V=Sn(N)):j?(w(O),O=Sn(R)):(O=Sn(R),V=Sn(N))}}(s,i,_e,c=>{a.push(this.Hn(t,e,n,c))},c=>{a.push(this.Yn(t,e,n,c))}),b.waitFor(a)}Gn(t){let e=1;return Cn(t).ee({index:Pf,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,i)=>{i.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,c)=>_e(a,c)).filter((a,c,l)=>!c||_e(a,l[c-1])!==0);let s=[];s.push(t);for(let a of n){let c=_e(a,t),l=_e(a,e);if(c===0)s[0]=t.An();else if(c>0&&l<0)s.push(a),s.push(a.An());else if(l>0)break}s.push(e);let i=[];for(let a=0;a<s.length;a+=2){if(this.Zn(s[a],s[a+1]))return[];let c=s[a].Vn(this.uid,ni,M.empty()),l=s[a+1].Vn(this.uid,ni,M.empty());i.push(IDBKeyRange.bound(c,l))}return i}Zn(t,e){return _e(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(jd)}getMinOffset(t,e){return b.mapArray(this.Mn(e),n=>this.xn(t,n).next(s=>s||F(44426))).next(jd)}};function qd(r){return gt(r,os)}function Pn(r){return gt(r,Wr)}function qr(r){return gt(r,Qu)}function Cn(r){return gt(r,Qr)}function jd(r){B(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let s=r[n].indexState.offset;Gu(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new Lt(t.readTime,t.documentKey,e)}var zd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Sm=41943040,Dt=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function Rm(r,t,e){let n=r.store(Ut),s=r.store(Kn),i=[],a=IDBKeyRange.only(e.batchId),c=0,l=n.ee({range:a},(m,p,w)=>(c++,w.delete()));i.push(l.next(()=>{B(c===1,47070,{batchId:e.batchId})}));let d=[];for(let m of e.mutations){let p=bf(t,m.key.path,e.batchId);i.push(s.delete(p)),d.push(m.key)}return b.waitFor(i).next(()=>d)}function qi(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw F(14731);t=r.noDocument}return JSON.stringify(t).length}Dt.DEFAULT_COLLECTION_PERCENTILE=10,Dt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Dt.DEFAULT=new Dt(Sm,Dt.DEFAULT_COLLECTION_PERCENTILE,Dt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Dt.DISABLED=new Dt(-1,0,0);var ji=class r{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Xn={}}static wt(t,e,n,s){B(t.uid!=="",64387);let i=t.isAuthenticated()?t.uid:"";return new r(i,e,n,s)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return we(t).ee({index:tn,range:n},(s,i,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,s){let i=On(t),a=we(t);return a.add({}).next(c=>{B(typeof c=="number",49019);let l=new fs(c,e,n,s),d=function(R,N,O){let V=O.baseMutations.map(j=>Oi(R.yt,j)),G=O.mutations.map(j=>Oi(R.yt,j));return{userId:N,batchId:O.batchId,localWriteTimeMs:O.localWriteTime.toMillis(),baseMutations:V,mutations:G}}(this.serializer,this.userId,l),m=[],p=new et((w,R)=>z(w.canonicalString(),R.canonicalString()));for(let w of s){let R=bf(this.userId,w.key.path,c);p=p.add(w.key.path.popLast()),m.push(a.put(d)),m.push(i.put(R,ly))}return p.forEach(w=>{m.push(this.indexManager.addToCollectionParentIndex(t,w))}),t.addOnCommittedListener(()=>{this.Xn[c]=l.keys()}),b.waitFor(m).next(()=>l)})}lookupMutationBatch(t,e){return we(t).get(e).next(n=>n?(B(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),Xe(this.serializer,n)):null)}er(t,e){return this.Xn[e]?b.resolve(this.Xn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let s=n.keys();return this.Xn[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]),i=null;return we(t).ee({index:tn,range:s},(a,c,l)=>{c.userId===this.userId&&(B(c.batchId>=n,47524,{tr:n}),i=Xe(this.serializer,c)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=sn;return we(t).ee({index:tn,range:e,reverse:!0},(s,i,a)=>{n=i.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,sn],[this.userId,Number.POSITIVE_INFINITY]);return we(t).J(tn,e).next(n=>n.map(s=>Xe(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=oi(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return On(t).ee({range:s},(a,c,l)=>{let[d,m,p]=a,w=Qt(m);if(d===this.userId&&e.path.isEqual(w))return we(t).get(p).next(R=>{if(!R)throw F(61480,{nr:a,batchId:p});B(R.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:R.userId,batchId:p}),i.push(Xe(this.serializer,R))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z),s=[];return e.forEach(i=>{let a=oi(this.userId,i.path),c=IDBKeyRange.lowerBound(a),l=On(t).ee({range:c},(d,m,p)=>{let[w,R,N]=d,O=Qt(R);w===this.userId&&i.path.isEqual(O)?n=n.add(N):p.done()});s.push(l)}),b.waitFor(s).next(()=>this.rr(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=oi(this.userId,n),a=IDBKeyRange.lowerBound(i),c=new et(z);return On(t).ee({range:a},(l,d,m)=>{let[p,w,R]=l,N=Qt(w);p===this.userId&&n.isPrefixOf(N)?N.length===s&&(c=c.add(R)):m.done()}).next(()=>this.rr(t,c))}rr(t,e){let n=[],s=[];return e.forEach(i=>{s.push(we(t).get(i).next(a=>{if(a===null)throw F(35274,{batchId:i});B(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(Xe(this.serializer,a))}))}),b.waitFor(s).next(()=>n)}removeMutationBatch(t,e){return Rm(t.le,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.ir(e.batchId)}),b.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}ir(t){delete this.Xn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return b.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return On(t).ee({range:n},(i,a,c)=>{if(i[0]===this.userId){let l=Qt(i[1]);s.push(l)}else c.done()}).next(()=>{B(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(t,e){return Pm(t,this.userId,e)}_r(t){return Cm(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:sn,lastStreamToken:""})}};function Pm(r,t,e){let n=oi(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n),a=!1;return On(r).ee({range:i,X:!0},(c,l,d)=>{let[m,p,w]=c;m===t&&p===s&&(a=!0),d.done()}).next(()=>a)}function we(r){return gt(r,Ut)}function On(r){return gt(r,Kn)}function Cm(r){return gt(r,ss)}var sr=class r{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new r(0)}static cr(){return new r(-1)}};var Mc=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.lr(t).next(e=>{let n=new sr(e.highestTargetId);return e.highestTargetId=n.next(),this.hr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.lr(t).next(e=>q.fromTimestamp(new ot(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.lr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.lr(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.hr(t,s)))}addTargetData(t,e){return this.Pr(t,e).next(()=>this.lr(t).next(n=>(n.targetCount+=1,this.Tr(e,n),this.hr(t,n))))}updateTargetData(t,e){return this.Pr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Dn(t).delete(e.targetId)).next(()=>this.lr(t)).next(n=>(B(n.targetCount>0,8065),n.targetCount-=1,this.hr(t,n)))}removeTargets(t,e,n){let s=0,i=[];return Dn(t).ee((a,c)=>{let l=$r(c);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(t,l)))}).next(()=>b.waitFor(i)).next(()=>s)}forEachTarget(t,e){return Dn(t).ee((n,s)=>{let i=$r(s);e(i)})}lr(t){return Gd(t).get(Ii).next(e=>(B(e!==null,2888),e))}hr(t,e){return Gd(t).put(Ii,e)}Pr(t,e){return Dn(t).put(Tm(this.serializer,e))}Tr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.lr(t).next(e=>e.targetCount)}getTargetData(t,e){let n=hn(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Dn(t).ee({range:s,index:Rf},(a,c,l)=>{let d=$r(c);bs(e,d.target)&&(i=d,l.done())}).next(()=>i)}addMatchingKeys(t,e,n){let s=[],i=Ie(t);return e.forEach(a=>{let c=At(a.path);s.push(i.put({targetId:n,path:c})),s.push(this.referenceDelegate.addReference(t,n,a))}),b.waitFor(s)}removeMatchingKeys(t,e,n){let s=Ie(t);return b.forEach(e,i=>{let a=At(i.path);return b.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])})}removeMatchingKeysForTargetId(t,e){let n=Ie(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),s=Ie(t),i=K();return s.ee({range:n,X:!0},(a,c,l)=>{let d=Qt(a[1]),m=new M(d);i=i.add(m)}).next(()=>i)}containsKey(t,e){let n=At(e.path),s=IDBKeyRange.bound([n],[yf(n)],!1,!0),i=0;return Ie(t).ee({index:Ku,X:!0,range:s},([a,c],l,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}At(t,e){return Dn(t).get(e).next(n=>n?$r(n):null)}};function Dn(r){return gt(r,Qn)}function Gd(r){return gt(r,on)}function Ie(r){return gt(r,Wn)}var $d="LruGarbageCollector",Dm=1048576;function Kd([r,t],[e,n]){let s=z(r,e);return s===0?z(t,n):s}var Fc=class{constructor(t){this.Ir=t,this.buffer=new et(Kd),this.Er=0}dr(){return++this.Er}Ar(t){let e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Kd(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},zi=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){D($d,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>C(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Fe(e)?D($d,"Ignoring IndexedDB error during garbage collection: ",e):yield Me(e)}yield this.Vr(3e5)}))}},Lc=class{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return b.resolve(kt.ce);let n=new Fc(e);return this.mr.forEachTarget(t,s=>n.Ar(s.sequenceNumber)).next(()=>this.mr.pr(t,s=>n.Ar(s))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(zd)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zd):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,i,a,c,l,d,m=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,a=Date.now(),this.nthSequenceNumber(t,s))).next(p=>(n=p,c=Date.now(),this.removeTargets(t,n,e))).next(p=>(i=p,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(p=>(d=Date.now(),Vn()<=H.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(l-c)+`ms
	Removed ${p} documents in `+(d-l)+`ms
Total Duration: ${d-m}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p})))}};function Vm(r,t){return new Lc(r,t)}var Bc=class{constructor(t,e){this.db=t,this.garbageCollector=Vm(this,e)}gr(t){let e=this.wr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}wr(t){let e=0;return this.pr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}pr(t,e){return this.Sr(t,(n,s)=>e(s))}addReference(t,e,n){return ri(t,n)}removeReference(t,e,n){return ri(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return ri(t,e)}br(t,e){return function(s,i){let a=!1;return Cm(s).te(c=>Pm(s,c,i).next(l=>(l&&(a=!0),b.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],i=0;return this.Sr(t,(a,c)=>{if(c<=e){let l=this.br(t,a).next(d=>{if(!d)return i++,n.getEntry(t,a).next(()=>(n.removeEntry(a,q.min()),Ie(t).delete(function(p){return[0,At(p.path)]}(a))))});s.push(l)}}).next(()=>b.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return ri(t,e)}Sr(t,e){let n=Ie(t),s,i=kt.ce;return n.ee({index:Ku},([a,c],{path:l,sequenceNumber:d})=>{a===0?(i!==kt.ce&&e(new M(Qt(s)),i),i=d,s=l):i=kt.ce}).next(()=>{i!==kt.ce&&e(new M(Qt(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function ri(r,t){return Ie(r).put(function(n,s){return{targetId:0,path:At(n.path),sequenceNumber:s}}(t,r.currentSequenceNumber))}var Gi=class{constructor(){this.changes=new jt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,It.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?b.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Uc=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Qe(t).put(n)}removeEntry(t,e,n){return Qe(t).delete(function(i,a){let c=i.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Fi(a),c[c.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Dr(t,n)))}getEntry(t,e){let n=It.newInvalidDocument(e);return Qe(t).ee({index:ai,range:IDBKeyRange.only(jr(e))},(s,i)=>{n=this.Cr(e,i)}).next(()=>n)}vr(t,e){let n={size:0,document:It.newInvalidDocument(e)};return Qe(t).ee({index:ai,range:IDBKeyRange.only(jr(e))},(s,i)=>{n={document:this.Cr(e,i),size:qi(i)}}).next(()=>n)}getEntries(t,e){let n=Mt();return this.Fr(t,e,(s,i)=>{let a=this.Cr(s,i);n=n.insert(s,a)}).next(()=>n)}Mr(t,e){let n=Mt(),s=new st(M.comparator);return this.Fr(t,e,(i,a)=>{let c=this.Cr(i,a);n=n.insert(i,c),s=s.insert(i,qi(a))}).next(()=>({documents:n,Or:s}))}Fr(t,e,n){if(e.isEmpty())return b.resolve();let s=new et(Hd);e.forEach(l=>s=s.add(l));let i=IDBKeyRange.bound(jr(s.first()),jr(s.last())),a=s.getIterator(),c=a.getNext();return Qe(t).ee({index:ai,range:i},(l,d,m)=>{let p=M.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;c&&Hd(c,p)<0;)n(c,null),c=a.getNext();c&&c.isEqual(p)&&(n(c,d),c=a.hasNext()?a.getNext():null),c?m.j(jr(c)):m.done()}).next(()=>{for(;c;)n(c,null),c=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,s,i){let a=e.path,c=[a.popLast().toArray(),a.lastSegment(),Fi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Qe(t).J(IDBKeyRange.bound(c,l,!0)).next(d=>{i?.incrementDocumentReadCount(d.length);let m=Mt();for(let p of d){let w=this.Cr(M.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);w.isFoundDocument()&&(Ss(e,w)||s.has(w.key))&&(m=m.insert(w.key,w))}return m})}getAllFromCollectionGroup(t,e,n,s){let i=Mt(),a=Wd(e,n),c=Wd(e,Lt.max());return Qe(t).ee({index:Sf,range:IDBKeyRange.bound(a,c,!0)},(l,d,m)=>{let p=this.Cr(M.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(p.key,p),i.size===s&&m.done()}).next(()=>i)}newChangeBuffer(t){return new qc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Qd(t).get(Za).next(e=>(B(!!e,20021),e))}Dr(t,e){return Qd(t).put(Za,e)}Cr(t,e){if(e){let n=d_(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(q.min())))return n}return It.newInvalidDocument(t)}};function xm(r){return new Uc(r)}var qc=class extends Gi{constructor(t,e){super(),this.Nr=t,this.trackRemovals=e,this.Br=new jt(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(t){let e=[],n=0,s=new et((i,a)=>z(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{let c=this.Br.get(i);if(e.push(this.Nr.removeEntry(t,i,c.readTime)),a.isValidDocument()){let l=Vd(this.Nr.serializer,a);s=s.add(i.path.popLast());let d=qi(l);n+=d-c.size,e.push(this.Nr.addEntry(t,i,l))}else if(n-=c.size,this.trackRemovals){let l=Vd(this.Nr.serializer,a.convertToNoDocument(q.min()));e.push(this.Nr.addEntry(t,i,l))}}),s.forEach(i=>{e.push(this.Nr.indexManager.addToCollectionParentIndex(t,i))}),e.push(this.Nr.updateMetadata(t,n)),b.waitFor(e)}getFromCache(t,e){return this.Nr.vr(t,e).next(n=>(this.Br.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Nr.Mr(t,e).next(({documents:n,Or:s})=>(s.forEach((i,a)=>{this.Br.set(i,{size:a,readTime:n.get(i).readTime})}),n))}};function Qd(r){return gt(r,is)}function Qe(r){return gt(r,Ei)}function jr(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Wd(r,t){let e=t.documentKey.path.toArray();return[r,Fi(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Hd(r,t){let e=r.path.toArray(),n=t.path.toArray(),s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=z(e[i],n[i]),s)return s;return s=z(e.length,n.length),s||(s=z(e[e.length-2],n[n.length-2]),s||z(e[e.length-1],n[n.length-1]))}var jc=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var $i=class{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(n!==null&&Yr(n.mutation,s,Ot.empty(),ot.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let s=Wt();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(i=>{let a=Gr();return i.forEach((c,l)=>{a=a.insert(c,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=Wt();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let s=[];return n.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((a,c)=>{e.set(a,c)})})}computeViews(t,e,n,s){let i=Mt(),a=Xr(),c=function(){return Xr()}();return e.forEach((l,d)=>{let m=n.get(d.key);s.has(d.key)&&(m===void 0||m.mutation instanceof zt)?i=i.insert(d.key,d):m!==void 0?(a.set(d.key,m.mutation.getFieldMask()),Yr(m.mutation,d,m.mutation.getFieldMask(),ot.now())):a.set(d.key,Ot.empty())}),this.recalculateAndSaveOverlays(t,i).next(l=>(l.forEach((d,m)=>a.set(d,m)),e.forEach((d,m)=>c.set(d,new jc(m,a.get(d)??null))),c))}recalculateAndSaveOverlays(t,e){let n=Xr(),s=new st((a,c)=>a-c),i=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let c of a)c.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let m=n.get(l)||Ot.empty();m=c.applyToLocalView(d,m),n.set(l,m);let p=(s.get(c.batchId)||K()).add(l);s=s.insert(c.batchId,p)})}).next(()=>{let a=[],c=s.getReverseIterator();for(;c.hasNext();){let l=c.getNext(),d=l.key,m=l.value,p=nm();m.forEach(w=>{if(!i.has(w)){let R=cm(e.get(w),n.get(w));R!==null&&p.set(w,R),i=i.add(w)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,p))}return b.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,s){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Jf(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(i=>{let a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):b.resolve(Wt()),c=zn,l=i;return a.next(d=>b.forEach(d,(m,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),i.get(m)?b.resolve():this.remoteDocumentCache.getEntry(t,m).next(w=>{l=l.insert(m,w)}))).next(()=>this.populateOverlays(t,d,i)).next(()=>this.computeViews(t,l,d,K())).next(m=>({batchId:c,changes:em(m)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(n=>{let s=Gr();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){let i=e.collectionGroup,a=Gr();return this.indexManager.getCollectionParents(t,i).next(c=>b.forEach(c,l=>{let d=function(p,w){return new De(w,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,l.child(i));return this.getDocumentsMatchingCollectionQuery(t,d,n,s).next(m=>{m.forEach((p,w)=>{a=a.insert(p,w)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s))).next(a=>{i.forEach((l,d)=>{let m=d.getKey();a.get(m)===null&&(a=a.insert(m,It.newInvalidDocument(m)))});let c=Gr();return a.forEach((l,d)=>{let m=i.get(l);m!==void 0&&Yr(m.mutation,d,Ot.empty(),ot.now()),Ss(e,d)&&(c=c.insert(l,d))}),c})}};var zc=class{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return b.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:Pt(s.createTime)}}(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(s){return{name:s.name,query:vm(s.bundledQuery),readTime:Pt(s.readTime)}}(e)),b.resolve()}};var Gc=class{constructor(){this.overlays=new st(M.comparator),this.qr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){let n=Wt();return b.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((s,i)=>{this.St(t,e,i)}),b.resolve()}removeOverlaysForBatchId(t,e,n){let s=this.qr.get(n);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(n)),b.resolve()}getOverlaysForCollection(t,e,n){let s=Wt(),i=e.length+1,a=new M(e.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){let l=c.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>n&&s.set(l.getKey(),l)}return b.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new st((d,m)=>d-m),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let m=i.get(d.largestBatchId);m===null&&(m=Wt(),i=i.insert(d.largestBatchId,m)),m.set(d.getKey(),d)}}let c=Wt(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,m)=>c.set(d,m)),!(c.size()>=s)););return b.resolve(c)}St(t,e,n){let s=this.overlays.get(n.key);if(s!==null){let a=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ms(e,n));let i=this.qr.get(e);i===void 0&&(i=K(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}};var $c=class{constructor(){this.sessionToken=ft.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}};var _s=class{constructor(){this.Qr=new et(lt.$r),this.Ur=new et(lt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){let n=new lt(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Gr(new lt(t,e))}zr(t,e){t.forEach(n=>this.removeReference(n,e))}jr(t){let e=new M(new Y([])),n=new lt(e,t),s=new lt(e,t+1),i=[];return this.Ur.forEachInRange([n,s],a=>{this.Gr(a),i.push(a.key)}),i}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){let e=new M(new Y([])),n=new lt(e,t),s=new lt(e,t+1),i=K();return this.Ur.forEachInRange([n,s],a=>{i=i.add(a.key)}),i}containsKey(t){let e=new lt(t,0),n=this.Qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},lt=class{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return M.comparator(t.key,e.key)||z(t.Yr,e.Yr)}static Kr(t,e){return z(t.Yr,e.Yr)||M.comparator(t.key,e.key)}};var Kc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new et(lt.$r)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new fs(i,e,n,s);this.mutationQueue.push(a);for(let c of s)this.Zr=this.Zr.add(new lt(c.key,i)),this.indexManager.addToCollectionParentIndex(t,c.key.path.popLast());return b.resolve(a)}lookupMutationBatch(t,e){return b.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=this.ei(n),i=s<0?0:s;return b.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?sn:this.tr-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new lt(e,0),s=new lt(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,s],a=>{let c=this.Xr(a.Yr);i.push(c)}),b.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z);return e.forEach(s=>{let i=new lt(s,0),a=new lt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],c=>{n=n.add(c.Yr)})}),b.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=n;M.isDocumentKey(i)||(i=i.child(""));let a=new lt(new M(i),0),c=new et(z);return this.Zr.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(c=c.add(l.Yr)),!0)},a),b.resolve(this.ti(c))}ti(t){let e=[];return t.forEach(n=>{let s=this.Xr(n);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){B(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return b.forEach(e.mutations,s=>{let i=new lt(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){let n=new lt(e,0),s=this.Zr.firstAfterOrEqual(n);return b.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){let e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Qc=class{constructor(t){this.ri=t,this.docs=function(){return new st(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return b.resolve(n?n.document.mutableCopy():It.newInvalidDocument(e))}getEntries(t,e){let n=Mt();return e.forEach(s=>{let i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():It.newInvalidDocument(s))}),b.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Mt(),a=e.path,c=new M(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){let{key:d,value:{document:m}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Gu(If(m),n)<=0||(s.has(m.key)||Ss(e,m))&&(i=i.insert(m.key,m.mutableCopy()))}return b.resolve(i)}getAllFromCollectionGroup(t,e,n,s){F(9500)}ii(t,e){return b.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Wc(this)}getSize(t){return b.resolve(this.size)}},Wc=class extends Gi{constructor(t){super(),this.Nr=t}applyChanges(t){let e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)}),b.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}};var Hc=class{constructor(t){this.persistence=t,this.si=new jt(e=>hn(e),bs),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.oi=0,this._i=new _s,this.targetCount=0,this.ai=sr.ur()}forEachTarget(t,e){return this.si.forEach((n,s)=>e(s)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),b.resolve()}Pr(t){this.si.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.ai=new sr(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.Pr(e),b.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,n){let s=0,i=[];return this.si.forEach((a,c)=>{c.sequenceNumber<=e&&n.get(c.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(t,c.targetId)),s++)}),b.waitFor(i).next(()=>s)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){let n=this.si.get(e)||null;return b.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),b.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);let s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(a=>{i.push(s.markPotentiallyOrphaned(t,a))}),b.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),b.resolve()}getMatchingKeysForTargetId(t,e){let n=this._i.Hr(e);return b.resolve(n)}containsKey(t,e){return b.resolve(this._i.containsKey(e))}};var ws=class{constructor(t,e){this.ui={},this.overlays={},this.ci=new kt(0),this.li=!1,this.li=!0,this.hi=new $c,this.referenceDelegate=t(this),this.Pi=new Hc(this),this.indexManager=new kc,this.remoteDocumentCache=function(s){return new Qc(s)}(n=>this.referenceDelegate.Ti(n)),this.serializer=new Mi(e),this.Ii=new zc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Gc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new Kc(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){D("MemoryPersistence","Starting transaction:",t);let s=new Jc(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(t,e){return b.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}},Jc=class extends yi{constructor(t){super(),this.currentSequenceNumber=t}},Ki=class r{constructor(t){this.persistence=t,this.Ri=new _s,this.Vi=null}static mi(t){return new r(t)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),b.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),b.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(s=>this.fi.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,n=>{let s=M.fromPath(n);return this.gi(t,s).next(i=>{i||e.removeEntry(s,q.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(n=>{n?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return b.or([()=>b.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}},Qi=class r{constructor(t,e){this.persistence=t,this.pi=new jt(n=>At(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=Vm(this,e)}static mi(t,e){return new r(t,e)}Ei(){}di(t){return b.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){let e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}wr(t){let e=0;return this.pr(t,n=>{e++}).next(()=>e)}pr(t,e){return b.forEach(this.pi,(n,s)=>this.br(t,n,s).next(i=>i?b.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(t,a=>this.br(t,a,e).next(c=>{c||(n++,i.removeEntry(a,q.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),b.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),b.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ui(t.data.value)),e}br(t,e,n){return b.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.pi.get(e);return b.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Xc=class{constructor(t){this.serializer=t}k(t,e,n,s){let i=new _i("createOrUpgrade",e);n<1&&s>=1&&(function(l){l.createObjectStore(As)}(t),function(l){l.createObjectStore(ss,{keyPath:uy}),l.createObjectStore(Ut,{keyPath:ud,autoIncrement:!0}).createIndex(tn,ld,{unique:!0}),l.createObjectStore(Kn)}(t),Jd(t),function(l){l.createObjectStore(He)}(t));let a=b.resolve();return n<3&&s>=3&&(n!==0&&(function(l){l.deleteObjectStore(Wn),l.deleteObjectStore(Qn),l.deleteObjectStore(on)}(t),Jd(t)),a=a.next(()=>function(l){let d=l.store(on),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:q.min().toTimestamp(),targetCount:0};return d.put(Ii,m)}(i))),n<4&&s>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store(Ut).J().next(p=>{l.deleteObjectStore(Ut),l.createObjectStore(Ut,{keyPath:ud,autoIncrement:!0}).createIndex(tn,ld,{unique:!0});let w=d.store(Ut),R=p.map(N=>w.put(N));return b.waitFor(R)})}(t,i))),a=a.next(()=>{(function(l){l.createObjectStore(Hn,{keyPath:_y})})(t)})),n<5&&s>=5&&(a=a.next(()=>this.yi(i))),n<6&&s>=6&&(a=a.next(()=>(function(l){l.createObjectStore(is)}(t),this.wi(i)))),n<7&&s>=7&&(a=a.next(()=>this.Si(i))),n<8&&s>=8&&(a=a.next(()=>this.bi(t,i))),n<9&&s>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&s>=10&&(a=a.next(()=>this.Di(i))),n<11&&s>=11&&(a=a.next(()=>{(function(l){l.createObjectStore(Eo,{keyPath:wy})})(t),function(l){l.createObjectStore(Io,{keyPath:Ey})}(t)})),n<12&&s>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore(To,{keyPath:Ry});d.createIndex(ec,Py,{unique:!1}),d.createIndex(Df,Cy,{unique:!1})})(t)})),n<13&&s>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore(Ei,{keyPath:hy});d.createIndex(ai,dy),d.createIndex(Sf,fy)}(t)).next(()=>this.Ci(t,i)).next(()=>t.deleteObjectStore(He))),n<14&&s>=14&&(a=a.next(()=>this.Fi(t,i))),n<15&&s>=15&&(a=a.next(()=>function(l){l.createObjectStore(Qu,{keyPath:Iy,autoIncrement:!0}).createIndex(tc,Ty,{unique:!1}),l.createObjectStore(Qr,{keyPath:vy}).createIndex(Pf,Ay,{unique:!1}),l.createObjectStore(Wr,{keyPath:by}).createIndex(Cf,Sy,{unique:!1})}(t))),n<16&&s>=16&&(a=a.next(()=>{e.objectStore(Qr).clear()}).next(()=>{e.objectStore(Wr).clear()})),n<17&&s>=17&&(a=a.next(()=>{(function(l){l.createObjectStore(Wu,{keyPath:Dy})})(t)})),n<18&&s>=18&&la()&&(a=a.next(()=>{e.objectStore(Qr).clear()}).next(()=>{e.objectStore(Wr).clear()})),a}wi(t){let e=0;return t.store(He).ee((n,s)=>{e+=qi(s)}).next(()=>{let n={byteSize:e};return t.store(is).put(Za,n)})}yi(t){let e=t.store(ss),n=t.store(Ut);return e.J().next(s=>b.forEach(s,i=>{let a=IDBKeyRange.bound([i.userId,sn],[i.userId,i.lastAcknowledgedBatchId]);return n.J(tn,a).next(c=>b.forEach(c,l=>{B(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});let d=Xe(this.serializer,l);return Rm(t,i.userId,d).next(()=>{})}))}))}Si(t){let e=t.store(Wn),n=t.store(He);return t.store(on).get(Ii).next(s=>{let i=[];return n.ee((a,c)=>{let l=new Y(a),d=function(p){return[0,At(p)]}(l);i.push(e.get(d).next(m=>m?b.resolve():(p=>e.put({targetId:0,path:At(p),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>b.waitFor(i))})}bi(t,e){t.createObjectStore(os,{keyPath:yy});let n=e.store(os),s=new ys,i=a=>{if(s.add(a)){let c=a.lastSegment(),l=a.popLast();return n.put({collectionId:c,parent:At(l)})}};return e.store(He).ee({X:!0},(a,c)=>{let l=new Y(a);return i(l.popLast())}).next(()=>e.store(Kn).ee({X:!0},([a,c,l],d)=>{let m=Qt(c);return i(m.popLast())}))}Di(t){let e=t.store(Qn);return e.ee((n,s)=>{let i=$r(s),a=Tm(this.serializer,i);return e.put(a)})}Ci(t,e){let n=e.store(He),s=[];return n.ee((i,a)=>{let c=e.store(Ei),l=function(p){return p.document?new M(Y.fromString(p.document.name).popFirst(5)):p.noDocument?M.fromSegments(p.noDocument.path):p.unknownDocument?M.fromSegments(p.unknownDocument.path):F(36783)}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(c.put(d))}).next(()=>b.waitFor(s))}Fi(t,e){let n=e.store(Ut),s=xm(this.serializer),i=new ws(Ki.mi,this.serializer.yt);return n.J().next(a=>{let c=new Map;return a.forEach(l=>{let d=c.get(l.userId)??K();Xe(this.serializer,l).keys().forEach(m=>d=d.add(m)),c.set(l.userId,d)}),b.forEach(c,(l,d)=>{let m=new ht(d),p=Li.wt(this.serializer,m),w=i.getIndexManager(m),R=ji.wt(m,this.serializer,w,i.referenceDelegate);return new $i(s,R,p,w).recalculateAndSaveOverlaysForDocumentKeys(new as(e,kt.ce),l).next()})})}};function Jd(r){r.createObjectStore(Wn,{keyPath:py}).createIndex(Ku,gy,{unique:!0}),r.createObjectStore(Qn,{keyPath:"targetId"}).createIndex(Rf,my,{unique:!0}),r.createObjectStore(on)}var Ee="IndexedDbPersistence",ka=18e5,Oa=5e3,Ma="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",p_="main",Yc=class r{constructor(t,e,n,s,i,a,c,l,d,m,p=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Mi=i,this.window=a,this.document=c,this.xi=d,this.Oi=m,this.Ni=p,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=w=>Promise.resolve(),!r.v())throw new x(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Bc(this,s),this.$i=e+p_,this.serializer=new Mi(l),this.Ui=new $n(this.$i,this.Ni,new Xc(this.serializer)),this.hi=new Rc,this.Pi=new Mc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=xm(this.serializer),this.Ii=new Sc,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,m===!1&&ct(Ee,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Ma);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Pi.getHighestSequenceNumber(t))}).then(t=>{this.ci=new kt(t,this.xi)}).then(()=>{this.li=!0}).catch(t=>(this.Ui&&this.Ui.close(),Promise.reject(t)))}Ji(t){return this.Qi=e=>C(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ui.$(e=>C(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Mi.enqueueAndForget(()=>C(this,null,function*(){this.started&&(yield this.Wi())})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>si(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(t).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(t)).next(e=>this.isPrimary&&!e?this.Zi(t).next(()=>!1):!!e&&this.Xi(t).next(()=>!0))).catch(t=>{if(Fe(t))return D(Ee,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return D(Ee,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Mi.enqueueRetryable(()=>this.Qi(t)),this.isPrimary=t})}Hi(t){return zr(t).get(bn).next(e=>b.resolve(this.es(e)))}ts(t){return si(t).delete(this.clientId)}ns(){return C(this,null,function*(){if(this.isPrimary&&!this.rs(this.qi,ka)){this.qi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=gt(e,Hn);return n.J().next(s=>{let i=this.ss(s,ka),a=s.filter(c=>i.indexOf(c)===-1);return b.forEach(a,c=>n.delete(c.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ki)for(let e of t)this.Ki.removeItem(this._s(e.clientId))}})}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(t){return!!t&&t.ownerId===this.clientId}Yi(t){return this.Oi?b.resolve(!0):zr(t).get(bn).next(e=>{if(e!==null&&this.rs(e.leaseTimestampMs,Oa)&&!this.us(e.ownerId)){if(this.es(e)&&this.networkEnabled)return!0;if(!this.es(e)){if(!e.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Ma);return!1}}return!(!this.networkEnabled||!this.inForeground)||si(t).J().next(n=>this.ss(n,Oa).find(s=>{if(this.clientId!==s.clientId){let i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,c=this.networkEnabled===s.networkEnabled;if(i||a&&c)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&D(Ee,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return C(this,null,function*(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),yield this.Ui.runTransaction("shutdown","readwrite",[As,Hn],t=>{let e=new as(t,kt.ce);return this.Zi(e).next(()=>this.ts(e))}),this.Ui.close(),this.Ps()})}ss(t,e){return t.filter(n=>this.rs(n.updateTimeMs,e)&&!this.us(n.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",t=>si(t).J().next(e=>this.ss(e,ka).map(n=>n.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(t,e){return ji.wt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Oc(t,this.serializer.yt.databaseId)}getDocumentOverlayCache(t){return Li.wt(this.serializer,t)}getBundleCache(){return this.Ii}runTransaction(t,e,n){D(Ee,"Starting transaction:",t);let s=e==="readonly"?"readonly":"readwrite",i=function(l){return l===18?Ny:l===17?kf:l===16?xy:l===15?Hu:l===14?Nf:l===13?xf:l===12?Vy:l===11?Vf:void F(60245)}(this.Ni),a;return this.Ui.runTransaction(t,s,i,c=>(a=new as(c,this.ci?this.ci.next():kt.ce),e==="readwrite-primary"?this.Hi(a).next(l=>!!l||this.Yi(a)).next(l=>{if(!l)throw ct(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new x(P.FAILED_PRECONDITION,Tf);return n(a)}).next(l=>this.Xi(a).next(()=>l)):this.Is(a).next(()=>n(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}Is(t){return zr(t).get(bn).next(e=>{if(e!==null&&this.rs(e.leaseTimestampMs,Oa)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new x(P.FAILED_PRECONDITION,Ma)})}Xi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return zr(t).put(bn,e)}static v(){return $n.v()}Zi(t){let e=zr(t);return e.get(bn).next(n=>this.es(n)?(D(Ee,"Releasing primary lease."),e.delete(bn)):b.resolve())}rs(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ct(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();let t=/(?:Version|Mobile)\/1[456]/;ua()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(t){try{let e=this.Ki?.getItem(this._s(t))!==null;return D(Ee,`Client '${t}' ${e?"is":"is not"} zombied in LocalStorage`),e}catch(e){return ct(Ee,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(t){ct("Failed to set zombie client id.",t)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function zr(r){return gt(r,As)}function si(r){return gt(r,Hn)}function Nm(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var Zc=class r{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=K(),s=K();for(let i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new r(t,e.fromCache,n,s)}};var tu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Wi=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return ua()?8:vf($e())>0?6:4}()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){let i={result:null};return this.ys(t,e).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ws(t,e,s,n).next(a=>{i.result=a})}).next(()=>{if(i.result)return;let a=new tu;return this.Ss(t,e,a).next(c=>{if(i.result=c,this.Vs)return this.bs(t,e,a,c.size)})}).next(()=>i.result)}bs(t,e,n,s){return n.documentReadCount<this.fs?(Vn()<=H.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",xn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(Vn()<=H.DEBUG&&D("QueryEngine","Query:",xn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(Vn()<=H.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",xn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ft(e))):b.resolve())}ys(t,e){if(Td(e))return b.resolve(null);let n=Ft(e);return this.indexManager.getIndexType(t,n).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Pi(e,null,"F"),n=Ft(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{let a=K(...i);return this.ps.getDocuments(t,a).next(c=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.Ds(e,c);return this.Cs(e,d,a,l.readTime)?this.ys(t,Pi(e,null,"F")):this.vs(t,d,e,l)}))})))}ws(t,e,n,s){return Td(e)||s.isEqual(q.min())?b.resolve(null):this.ps.getDocuments(t,n).next(i=>{let a=this.Ds(e,i);return this.Cs(e,a,n,s)?b.resolve(null):(Vn()<=H.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),xn(e)),this.vs(t,a,e,Ef(s,zn)).next(c=>c))})}Ds(t,e){let n=new et(Zf(t));return e.forEach((s,i)=>{Ss(t,i)&&(n=n.add(i))}),n}Cs(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(t,e,n){return Vn()<=H.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",xn(e)),this.ps.getDocumentsMatchingQuery(t,e,Lt.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next(i=>(e.forEach(a=>{i=i.insert(a.key,a)}),i))}};var sl="LocalStore",g_=3e8,eu=class{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new st(z),this.xs=new jt(i=>hn(i),bs),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new $i(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}};function km(r,t,e,n){return new eu(r,t,e,n)}function Om(r,t){return C(this,null,function*(){let e=L(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(i=>{let a=[],c=[],l=K();for(let d of s){a.push(d.batchId);for(let m of d.mutations)l=l.add(m.key)}for(let d of i){c.push(d.batchId);for(let m of d.mutations)l=l.add(m.key)}return e.localDocuments.getDocuments(n,l).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:c}))})})})}function y_(r,t){let e=L(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=t.batch.keys(),i=e.Ns.newChangeBuffer({trackRemovals:!0});return function(c,l,d,m){let p=d.batch,w=p.keys(),R=b.resolve();return w.forEach(N=>{R=R.next(()=>m.getEntry(l,N)).next(O=>{let V=d.docVersions.get(N);B(V!==null,48541),O.version.compareTo(V)<0&&(p.applyToRemoteDocument(O,d),O.isValidDocument()&&(O.setReadTime(d.commitVersion),m.addEntry(O)))})}),R.next(()=>c.mutationQueue.removeMutationBatch(l,p))}(e,n,t,i).next(()=>i.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let l=K();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(l=l.add(c.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,s))})}function Mm(r){let t=L(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function __(r,t){let e=L(r),n=t.snapshotVersion,s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;let c=[];t.targetChanges.forEach((m,p)=>{let w=s.get(p);if(!w)return;c.push(e.Pi.removeMatchingKeys(i,m.removedDocuments,p).next(()=>e.Pi.addMatchingKeys(i,m.addedDocuments,p)));let R=w.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(p)!==null?R=R.withResumeToken(ft.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):m.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(m.resumeToken,n)),s=s.insert(p,R),function(O,V,G){return O.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=g_?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(w,R,m)&&c.push(e.Pi.updateTargetData(i,R))});let l=Mt(),d=K();if(t.documentUpdates.forEach(m=>{t.resolvedLimboDocuments.has(m)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(i,m))}),c.push(w_(i,a,t.documentUpdates).next(m=>{l=m.ks,d=m.qs})),!n.isEqual(q.min())){let m=e.Pi.getLastRemoteSnapshotVersion(i).next(p=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(m)}return b.waitFor(c).next(()=>a.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,l,d)).next(()=>l)}).then(i=>(e.Ms=s,i))}function w_(r,t,e){let n=K(),s=K();return e.forEach(i=>n=n.add(i)),t.getEntries(r,n).next(i=>{let a=Mt();return e.forEach((c,l)=>{let d=i.get(c);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),l.isNoDocument()&&l.version.isEqual(q.min())?(t.removeEntry(c,l.readTime),a=a.insert(c,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(c,l)):D(sl,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",l.version)}),{ks:a,qs:s}})}function E_(r,t){let e=L(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=sn),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Hi(r,t){let e=L(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return e.Pi.getTargetData(n,t).next(i=>i?(s=i,b.resolve(s)):e.Pi.allocateTargetId(n).next(a=>(s=new rr(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=e.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n})}function ir(r,t,e){return C(this,null,function*(){let n=L(r),s=n.Ms.get(t),i=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",i,a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Fe(a))throw a;D(sl,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ms=n.Ms.remove(t),n.xs.delete(s.target)})}function nu(r,t,e){let n=L(r),s=q.min(),i=K();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,m){let p=L(l),w=p.xs.get(m);return w!==void 0?b.resolve(p.Ms.get(w)):p.Pi.getTargetData(d,m)}(n,a,Ft(t)).next(c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,c.targetId).next(l=>{i=l})}).next(()=>n.Fs.getDocumentsMatchingQuery(a,t,e?s:q.min(),e?i:K())).next(c=>(Bm(n,Yf(t),c),{documents:c,Qs:i})))}function Fm(r,t){let e=L(r),n=L(e.Pi),s=e.Ms.get(t);return s?Promise.resolve(s.target):e.persistence.runTransaction("Get target data","readonly",i=>n.At(i,t).next(a=>a?a.target:null))}function Lm(r,t){let e=L(r),n=e.Os.get(t)||q.min();return e.persistence.runTransaction("Get new document changes","readonly",s=>e.Ns.getAllFromCollectionGroup(s,t,Ef(n,zn),Number.MAX_SAFE_INTEGER)).then(s=>(Bm(e,t,s),s))}function Bm(r,t,e){let n=r.Os.get(t)||q.min();e.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.Os.set(t,n)}var Um="firestore_clients";function Xd(r,t){return`${Um}_${r}_${t}`}var qm="firestore_mutations";function Yd(r,t,e){let n=`${qm}_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}var jm="firestore_targets";function Fa(r,t){return`${jm}_${r}_${t}`}var Kt="SharedClientState",Ji=class r{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ws(t,e,n){let s=JSON.parse(n),i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new x(s.error.code,s.error.message))),a?new r(t,e,s.state,i):(ct(Kt,`Failed to parse mutation state for ID '${e}': ${n}`),null)}Gs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Zr=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ws(t,e){let n=JSON.parse(e),s,i=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return i&&n.error&&(i=typeof n.error.message=="string"&&typeof n.error.code=="string",i&&(s=new x(n.error.code,n.error.message))),i?new r(t,n.state,s):(ct(Kt,`Failed to parse target state for ID '${t}': ${e}`),null)}Gs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Xi=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ws(t,e){let n=JSON.parse(e),s=typeof n=="object"&&n.activeTargetIds instanceof Array,i=tl();for(let a=0;s&&a<n.activeTargetIds.length;++a)s=Af(n.activeTargetIds[a]),i=i.add(n.activeTargetIds[a]);return s?new r(t,i):(ct(Kt,`Failed to parse client data for instance '${t}': ${e}`),null)}},ru=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Ws(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ct(Kt,`Failed to parse online state: ${t}`),null)}},Es=class{constructor(){this.activeTargetIds=tl()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},ts=class{constructor(t,e,n,s,i){this.window=t,this.Mi=e,this.persistenceKey=n,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new st(z),this.started=!1,this.Xs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=Xd(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Es),this.ro=new RegExp(`^${Um}_${a}_([^_]*)$`),this.io=new RegExp(`^${qm}_${a}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${jm}_${a}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(t){return!(!t||!t.localStorage)}start(){return C(this,null,function*(){let t=yield this.syncEngine.Ts();for(let n of t){if(n===this.Js)continue;let s=this.getItem(Xd(this.persistenceKey,n));if(s){let i=Xi.Ws(n,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();let e=this.storage.getItem(this.oo);if(e){let n=this.uo(e);n&&this.co(n)}for(let n of this.Xs)this.Ys(n);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.no,JSON.stringify(t))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(t){let e=!1;return this.Zs.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.ho(t,"pending")}updateMutationState(t,e,n){this.ho(t,e,n),this.Po(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let s=this.storage.getItem(Fa(this.persistenceKey,t));if(s){let i=Zr.Ws(t,s);i&&(n=i.state)}}return e&&this.To.zs(t),this.ao(),n}removeLocalQueryTarget(t){this.To.js(t),this.ao()}isLocalQueryTarget(t){return this.To.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Fa(this.persistenceKey,t))}updateQueryState(t,e,n){this.Io(t,e,n)}handleUserChange(t,e,n){e.forEach(s=>{this.Po(s)}),this.currentUser=t,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(t){this.Eo(t)}notifyBundleLoaded(t){this.Ao(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return D(Kt,"READ",t,e),e}setItem(t,e){D(Kt,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){D(Kt,"REMOVE",t),this.storage.removeItem(t)}Ys(t){let e=t;if(e.storageArea===this.storage){if(D(Kt,"EVENT",e.key,e.newValue),e.key===this.eo)return void ct("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(()=>C(this,null,function*(){if(this.started){if(e.key!==null){if(this.ro.test(e.key)){if(e.newValue==null){let n=this.Ro(e.key);return this.Vo(n,null)}{let n=this.mo(e.key,e.newValue);if(n)return this.Vo(n.clientId,n)}}else if(this.io.test(e.key)){if(e.newValue!==null){let n=this.fo(e.key,e.newValue);if(n)return this.po(n)}}else if(this.so.test(e.key)){if(e.newValue!==null){let n=this.yo(e.key,e.newValue);if(n)return this.wo(n)}}else if(e.key===this.oo){if(e.newValue!==null){let n=this.uo(e.newValue);if(n)return this.co(n)}}else if(e.key===this.no){let n=function(i){let a=kt.ce;if(i!=null)try{let c=JSON.parse(i);B(typeof c=="number",30636,{So:i}),a=c}catch(c){ct(Kt,"Failed to read sequence number from WebStorage",c)}return a}(e.newValue);n!==kt.ce&&this.sequenceNumberHandler(n)}else if(e.key===this._o){let n=this.bo(e.newValue);yield Promise.all(n.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(e)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(t,e,n){let s=new Ji(this.currentUser,t,e,n),i=Yd(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Gs())}Po(t){let e=Yd(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Eo(t){let e={clientId:this.Js,onlineState:t};this.storage.setItem(this.oo,JSON.stringify(e))}Io(t,e,n){let s=Fa(this.persistenceKey,t),i=new Zr(t,e,n);this.setItem(s,i.Gs())}Ao(t){let e=JSON.stringify(Array.from(t));this.setItem(this._o,e)}Ro(t){let e=this.ro.exec(t);return e?e[1]:null}mo(t,e){let n=this.Ro(t);return Xi.Ws(n,e)}fo(t,e){let n=this.io.exec(t),s=Number(n[1]),i=n[2]!==void 0?n[2]:null;return Ji.Ws(new ht(i),s,e)}yo(t,e){let n=this.so.exec(t),s=Number(n[1]);return Zr.Ws(s,e)}uo(t){return ru.Ws(t)}bo(t){return JSON.parse(t)}po(t){return C(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Co(t.batchId,t.state,t.error);D(Kt,`Ignoring mutation for non-active user ${t.user.uid}`)})}wo(t){return this.syncEngine.vo(t.targetId,t.state,t.error)}Vo(t,e){let n=e?this.Zs.insert(t,e):this.Zs.remove(t),s=this.lo(this.Zs),i=this.lo(n),a=[],c=[];return i.forEach(l=>{s.has(l)||a.push(l)}),s.forEach(l=>{i.has(l)||c.push(l)}),this.syncEngine.Fo(a,c).then(()=>{this.Zs=n})}co(t){this.Zs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}lo(t){let e=tl();return t.forEach((n,s)=>{e=e.unionWith(s.activeTargetIds)}),e}},Yi=class{constructor(){this.Mo=new Es,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Es,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var su=class{Oo(t){}shutdown(){}};var Zd="ConnectivityMonitor",Zi=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){D(Zd,"Network connectivity changed: AVAILABLE");for(let t of this.qo)t(0)}ko(){D(Zd,"Network connectivity changed: UNAVAILABLE");for(let t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ii=null;function iu(){return ii===null?ii=function(){return 268435456+Math.round(2147483648*Math.random())}():ii++,"0x"+ii.toString(16)}var La="RestConnection",I_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ou=class{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===us?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,i){let a=iu(),c=this.zo(t,e.toUriEncodedString());D(La,`Sending RPC '${t}' ${a}:`,c,n);let l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);let{host:d}=new URL(c),m=Mr(d);return this.Jo(t,c,l,n,m).then(p=>(D(La,`Received RPC '${t}' ${a}: `,p),p),p=>{throw qn(La,`RPC '${t}' ${a} failed with error: `,p,"url: ",c,"request:",n),p})}Ho(t,e,n,s,i,a){return this.Go(t,e,n,s,i)}jo(t,e,n){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+hr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,i)=>t[i]=s),n&&n.headers.forEach((s,i)=>t[i]=s)}zo(t,e){let n=I_[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}};var au=class{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}};var vt="WebChannelConnection",cu=class extends ou{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,i){let a=iu();return new Promise((c,l)=>{let d=new Ra;d.setWithCredentials(!0),d.listenOnce(Pa.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Br.NO_ERROR:let p=d.getResponseJson();D(vt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(p)),c(p);break;case Br.TIMEOUT:D(vt,`RPC '${t}' ${a} timed out`),l(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case Br.HTTP_ERROR:let w=d.getStatus();if(D(vt,`RPC '${t}' ${a} failed with status:`,w,"response text:",d.getResponseText()),w>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let N=R?.error;if(N&&N.status&&N.message){let O=function(G){let j=G.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(j)>=0?j:P.UNKNOWN}(N.status);l(new x(O,N.message))}else l(new x(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new x(P.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{D(vt,`RPC '${t}' ${a} completed.`)}});let m=JSON.stringify(s);D(vt,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",m,n,15)})}T_(t,e,n){let s=iu(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Va(),c=Da(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let m=i.join("");D(vt,`Creating RPC '${t}' stream ${s}: ${m}`,l);let p=a.createWebChannel(m,l);this.I_(p);let w=!1,R=!1,N=new au({Yo:V=>{R?D(vt,`Not sending because RPC '${t}' stream ${s} is closed:`,V):(w||(D(vt,`Opening RPC '${t}' stream ${s} transport.`),p.open(),w=!0),D(vt,`RPC '${t}' stream ${s} sending:`,V),p.send(V))},Zo:()=>p.close()}),O=(V,G,j)=>{V.listen(G,U=>{try{j(U)}catch(tt){setTimeout(()=>{throw tt},0)}})};return O(p,An.EventType.OPEN,()=>{R||(D(vt,`RPC '${t}' stream ${s} transport opened.`),N.o_())}),O(p,An.EventType.CLOSE,()=>{R||(R=!0,D(vt,`RPC '${t}' stream ${s} transport closed`),N.a_(),this.E_(p))}),O(p,An.EventType.ERROR,V=>{R||(R=!0,qn(vt,`RPC '${t}' stream ${s} transport errored. Name:`,V.name,"Message:",V.message),N.a_(new x(P.UNAVAILABLE,"The operation could not be completed")))}),O(p,An.EventType.MESSAGE,V=>{if(!R){let G=V.data[0];B(!!G,16349);let j=G,U=j?.error||j[0]?.error;if(U){D(vt,`RPC '${t}' stream ${s} received error:`,U);let tt=U.status,X=function(g){let _=ut[g];if(_!==void 0)return lm(_)}(tt),W=U.message;X===void 0&&(X=P.INTERNAL,W="Unknown error status: "+tt+" with message "+U.message),R=!0,N.a_(new x(X,W)),p.close()}else D(vt,`RPC '${t}' stream ${s} received:`,G),N.u_(G)}}),O(c,Ca.STAT_EVENT,V=>{V.stat===ti.PROXY?D(vt,`RPC '${t}' stream ${s} detected buffering proxy`):V.stat===ti.NOPROXY&&D(vt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{N.__()},0),N}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}};function zm(){return typeof window<"u"?window:null}function fi(){return typeof document<"u"?document:null}function Ro(r){return new Ic(r,!0)}var to=class{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();let e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&D("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var tf="PersistentStream",eo=class{constructor(t,e,n,s,i,a,c,l){this.Mi=t,this.S_=n,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new to(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return C(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}k_(){return C(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return C(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(ct(e.toString()),ct("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.r_(e)})}K_(){}auth(){this.state=1;let t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.D_===e&&this.G_(n,s)},n=>{t(()=>{let s=new x(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)})})}G_(t,e){let n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{n(()=>this.z_(s))}),this.stream.onMessage(s=>{n(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(()=>C(this,null,function*(){this.state=0,this.start()}))}z_(t){return D(tf,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(D(tf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},uu=class extends eo{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();let e=i_(this.serializer,t),n=function(i){if(!("targetChange"in i))return q.min();let a=i.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?Pt(a.readTime):q.min()}(t);return this.listener.H_(e,n)}Y_(t){let e={};e.database=Ac(this.serializer),e.addTarget=function(i,a){let c,l=a.target;if(c=Si(l)?{documents:gm(i,l)}:{query:ym(i,l).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=hm(i,a.resumeToken);let d=Tc(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){c.readTime=nr(i,a.snapshotVersion.toTimestamp());let d=Tc(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,t);let n=a_(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){let e={};e.database=Ac(this.serializer),e.removeTarget=t,this.q_(e)}},lu=class extends eo{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return B(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,B(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){B(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();let e=o_(t.writeResults,t.commitTime),n=Pt(t.commitTime);return this.listener.na(n,e)}ra(){let t={};t.database=Ac(this.serializer),this.q_(t)}ea(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Oi(this.serializer,n))};this.q_(e)}};var hu=class{},du=class extends hu{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Go(t,vc(e,n),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new x(P.UNKNOWN,i.toString())})}Ho(t,e,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Ho(t,vc(e,n),s,a,c,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},fu=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ct(e),this.aa=!1):D("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var yn="RemoteStore",mu=class{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(a=>{n.enqueueAndForget(()=>C(this,null,function*(){wn(this)&&(D(yn,"Restarting streams for network reachability change."),yield function(l){return C(this,null,function*(){let d=L(l);d.Ea.add(4),yield Rs(d),d.Ra.set("Unknown"),d.Ea.delete(4),yield Po(d)})}(this))}))}),this.Ra=new fu(n,s)}};function Po(r){return C(this,null,function*(){if(wn(r))for(let t of r.da)yield t(!0)})}function Rs(r){return C(this,null,function*(){for(let t of r.da)yield t(!1)})}function Co(r,t){let e=L(r);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),al(e)?ol(e):fr(e).O_()&&il(e,t))}function or(r,t){let e=L(r),n=fr(e);e.Ia.delete(t),n.O_()&&Gm(e,t),e.Ia.size===0&&(n.O_()?n.L_():wn(e)&&e.Ra.set("Unknown"))}function il(r,t){if(r.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(q.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}fr(r).Y_(t)}function Gm(r,t){r.Va.Ue(t),fr(r).Z_(t)}function ol(r){r.Va=new Ec({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),At:t=>r.Ia.get(t)||null,ht:()=>r.datastore.serializer.databaseId}),fr(r).start(),r.Ra.ua()}function al(r){return wn(r)&&!fr(r).x_()&&r.Ia.size>0}function wn(r){return L(r).Ea.size===0}function $m(r){r.Va=void 0}function T_(r){return C(this,null,function*(){r.Ra.set("Online")})}function v_(r){return C(this,null,function*(){r.Ia.forEach((t,e)=>{il(r,t)})})}function A_(r,t){return C(this,null,function*(){$m(r),al(r)?(r.Ra.ha(t),ol(r)):r.Ra.set("Unknown")})}function b_(r,t,e){return C(this,null,function*(){if(r.Ra.set("Online"),t instanceof xi&&t.state===2&&t.cause)try{yield function(s,i){return C(this,null,function*(){let a=i.cause;for(let c of i.targetIds)s.Ia.has(c)&&(yield s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.Va.removeTarget(c))})}(r,t)}catch(n){D(yn,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield no(r,n)}else if(t instanceof Ln?r.Va.Ze(t):t instanceof Vi?r.Va.st(t):r.Va.tt(t),!e.isEqual(q.min()))try{let n=yield Mm(r.localStore);e.compareTo(n)>=0&&(yield function(i,a){let c=i.Va.Tt(a);return c.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let m=i.Ia.get(d);m&&i.Ia.set(d,m.withResumeToken(l.resumeToken,a))}}),c.targetMismatches.forEach((l,d)=>{let m=i.Ia.get(l);if(!m)return;i.Ia.set(l,m.withResumeToken(ft.EMPTY_BYTE_STRING,m.snapshotVersion)),Gm(i,l);let p=new rr(m.target,l,d,m.sequenceNumber);il(i,p)}),i.remoteSyncer.applyRemoteEvent(c)}(r,e))}catch(n){D(yn,"Failed to raise snapshot:",n),yield no(r,n)}})}function no(r,t,e){return C(this,null,function*(){if(!Fe(t))throw t;r.Ea.add(1),yield Rs(r),r.Ra.set("Offline"),e||(e=()=>Mm(r.localStore)),r.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){D(yn,"Retrying IndexedDB access"),yield e(),r.Ea.delete(1),yield Po(r)}))})}function Km(r,t){return t().catch(e=>no(r,e,t))}function dr(r){return C(this,null,function*(){let t=L(r),e=Ne(t),n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:sn;for(;S_(t);)try{let s=yield E_(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,R_(t,s)}catch(s){yield no(t,s)}Qm(t)&&Wm(t)})}function S_(r){return wn(r)&&r.Ta.length<10}function R_(r,t){r.Ta.push(t);let e=Ne(r);e.O_()&&e.X_&&e.ea(t.mutations)}function Qm(r){return wn(r)&&!Ne(r).x_()&&r.Ta.length>0}function Wm(r){Ne(r).start()}function P_(r){return C(this,null,function*(){Ne(r).ra()})}function C_(r){return C(this,null,function*(){let t=Ne(r);for(let e of r.Ta)t.ea(e.mutations)})}function D_(r,t,e){return C(this,null,function*(){let n=r.Ta.shift(),s=yc.from(n,t,e);yield Km(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield dr(r)})}function V_(r,t){return C(this,null,function*(){t&&Ne(r).X_&&(yield function(n,s){return C(this,null,function*(){if(function(a){return Jy(a)&&a!==P.ABORTED}(s.code)){let i=n.Ta.shift();Ne(n).B_(),yield Km(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield dr(n)}})}(r,t)),Qm(r)&&Wm(r)})}function ef(r,t){return C(this,null,function*(){let e=L(r);e.asyncQueue.verifyOperationInProgress(),D(yn,"RemoteStore received new credentials");let n=wn(e);e.Ea.add(3),yield Rs(e),n&&e.Ra.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),yield Po(e)})}function pu(r,t){return C(this,null,function*(){let e=L(r);t?(e.Ea.delete(2),yield Po(e)):t||(e.Ea.add(2),yield Rs(e),e.Ra.set("Unknown"))})}function fr(r){return r.ma||(r.ma=function(e,n,s){let i=L(e);return i.sa(),new uu(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Xo:T_.bind(null,r),t_:v_.bind(null,r),r_:A_.bind(null,r),H_:b_.bind(null,r)}),r.da.push(t=>C(this,null,function*(){t?(r.ma.B_(),al(r)?ol(r):r.Ra.set("Unknown")):(yield r.ma.stop(),$m(r))}))),r.ma}function Ne(r){return r.fa||(r.fa=function(e,n,s){let i=L(e);return i.sa(),new lu(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:P_.bind(null,r),r_:V_.bind(null,r),ta:C_.bind(null,r),na:D_.bind(null,r)}),r.da.push(t=>C(this,null,function*(){t?(r.fa.B_(),yield dr(r)):(yield r.fa.stop(),r.Ta.length>0&&(D(yn,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}var gu=class r{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){let a=Date.now()+n,c=new r(t,e,a,s,i);return c.start(n),c}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function cl(r,t){if(ct("AsyncQueue",`${t}: ${r}`),Fe(r))return new x(P.UNAVAILABLE,`${t}: ${r}`);throw r}var ro=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||M.comparator(e.key,n.key):(e,n)=>M.comparator(e.key,n.key),this.keyedMap=Gr(),this.sortedSet=new st(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var so=class{constructor(){this.ga=new st(M.comparator)}track(t){let e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):F(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){let t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}},ar=class r{constructor(t,e,n,s,i,a,c,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,s,i){let a=[];return e.forEach(c=>{a.push({type:0,doc:c})}),new r(t,e,ro.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&So(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}};var yu=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}},_u=class{constructor(){this.queries=nf(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){let s=L(e),i=s.queries;s.queries=nf(),i.forEach((a,c)=>{for(let l of c.Sa)l.onError(n)})})(this,new x(P.ABORTED,"Firestore shutting down"))}};function nf(){return new jt(r=>Xf(r),So)}function x_(r,t){return C(this,null,function*(){let e=L(r),n=3,s=t.query,i=e.queries.get(s);i?!i.ba()&&t.Da()&&(n=2):(i=new yu,n=t.Da()?0:1);try{switch(n){case 0:i.wa=yield e.onListen(s,!0);break;case 1:i.wa=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(a){let c=cl(a,`Initialization of query '${xn(t.query)}' failed`);return void t.onError(c)}e.queries.set(s,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&ul(e)})}function N_(r,t){return C(this,null,function*(){let e=L(r),n=t.query,s=3,i=e.queries.get(n);if(i){let a=i.Sa.indexOf(t);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=t.Da()?0:1:!i.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function k_(r,t){let e=L(r),n=!1;for(let s of t){let i=s.query,a=e.queries.get(i);if(a){for(let c of a.Sa)c.Fa(s)&&(n=!0);a.wa=s}}n&&ul(e)}function O_(r,t,e){let n=L(r),s=n.queries.get(t);if(s)for(let i of s.Sa)i.onError(e);n.queries.delete(t)}function ul(r){r.Ca.forEach(t=>{t.next()})}var wu,rf;(rf=wu||(wu={})).Ma="default",rf.Cache="cache";var Eu=class{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){let n=[];for(let s of t.docChanges)s.type!==3&&n.push(s);t=new ar(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;let n=e!=="Offline";return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;let e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=ar.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==wu.Cache}};var io=class{constructor(t){this.key=t}},oo=class{constructor(t){this.key=t}},Iu=class{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=K(),this.mutatedKeys=K(),this.eu=Zf(t),this.tu=new ro(this.eu)}get nu(){return this.Ya}ru(t,e){let n=e?e.iu:new so,s=e?e.tu:this.tu,i=e?e.mutatedKeys:this.mutatedKeys,a=s,c=!1,l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((m,p)=>{let w=s.get(m),R=Ss(this.query,p)?p:null,N=!!w&&this.mutatedKeys.has(w.key),O=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),V=!1;w&&R?w.data.isEqual(R.data)?N!==O&&(n.track({type:3,doc:R}),V=!0):this.su(w,R)||(n.track({type:2,doc:R}),V=!0,(l&&this.eu(R,l)>0||d&&this.eu(R,d)<0)&&(c=!0)):!w&&R?(n.track({type:0,doc:R}),V=!0):w&&!R&&(n.track({type:1,doc:w}),V=!0,(l||d)&&(c=!0)),V&&(R?(a=a.add(R),i=O?i.add(m):i.delete(m)):(a=a.delete(m),i=i.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),i=i.delete(m.key),n.track({type:1,doc:m})}return{tu:a,iu:n,Cs:c,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){let i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;let a=t.iu.ya();a.sort((m,p)=>function(R,N){let O=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:V})}};return O(R)-O(N)}(m.type,p.type)||this.eu(m.doc,p.doc)),this.ou(n),s=s??!1;let c=e&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,d=l!==this.Za;return this.Za=l,a.length!==0||d?{snapshot:new ar(this.query,t.tu,i,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new so,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=t.current)}_u(){if(!this.current)return[];let t=this.Xa;this.Xa=K(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});let e=[];return t.forEach(n=>{this.Xa.has(n)||e.push(new oo(n))}),this.Xa.forEach(n=>{t.has(n)||e.push(new io(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=K();let e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return ar.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},mr="SyncEngine",Tu=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},vu=class{constructor(t){this.key=t,this.hu=!1}},Au=class{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new jt(c=>Xf(c),So),this.Iu=new Map,this.Eu=new Set,this.du=new st(M.comparator),this.Au=new Map,this.Ru=new _s,this.Vu={},this.mu=new Map,this.fu=sr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function M_(r,t,e=!0){return C(this,null,function*(){let n=Do(r),s,i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=yield Hm(n,t,e,!0),s})}function F_(r,t){return C(this,null,function*(){let e=Do(r);yield Hm(e,t,!0,!1)})}function Hm(r,t,e,n){return C(this,null,function*(){let s=yield Hi(r.localStore,Ft(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e),c;return n&&(c=yield ll(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&Co(r.remoteStore,s),c})}function ll(r,t,e,n,s){return C(this,null,function*(){r.pu=(p,w,R)=>function(O,V,G,j){return C(this,null,function*(){let U=V.view.ru(G);U.Cs&&(U=yield nu(O.localStore,V.query,!1).then(({documents:E})=>V.view.ru(E,U)));let tt=j&&j.targetChanges.get(V.targetId),X=j&&j.targetMismatches.get(V.targetId)!=null,W=V.view.applyChanges(U,O.isPrimaryClient,tt,X);return bu(O,V.targetId,W.au),W.snapshot})}(r,p,w,R);let i=yield nu(r.localStore,t,!0),a=new Iu(t,i.Qs),c=a.ru(i.documents),l=gs.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),d=a.applyChanges(c,r.isPrimaryClient,l);bu(r,e,d.au);let m=new Tu(t,e,a);return r.Tu.set(t,m),r.Iu.has(e)?r.Iu.get(e).push(t):r.Iu.set(e,[t]),d.snapshot})}function L_(r,t,e){return C(this,null,function*(){let n=L(r),s=n.Tu.get(t),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter(a=>!So(a,t))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield ir(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),e&&or(n.remoteStore,s.targetId),cr(n,s.targetId)}).catch(Me))):(cr(n,s.targetId),yield ir(n.localStore,s.targetId,!0))})}function B_(r,t){return C(this,null,function*(){let e=L(r),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),or(e.remoteStore,n.targetId))})}function U_(r,t,e){return C(this,null,function*(){let n=ml(r);try{let s=yield function(a,c){let l=L(a),d=ot.now(),m=c.reduce((R,N)=>R.add(N.key),K()),p,w;return l.persistence.runTransaction("Locally write mutations","readwrite",R=>{let N=Mt(),O=K();return l.Ns.getEntries(R,m).next(V=>{N=V,N.forEach((G,j)=>{j.isValidDocument()||(O=O.add(G))})}).next(()=>l.localDocuments.getOverlayedDocuments(R,N)).next(V=>{p=V;let G=[];for(let j of c){let U=Hy(j,p.get(j.key).overlayedDocument);U!=null&&G.push(new zt(j.key,U,zf(U.value.mapValue),Et.exists(!0)))}return l.mutationQueue.addMutationBatch(R,d,G,c)}).next(V=>{w=V;let G=V.applyToLocalDocumentSet(p,O);return l.documentOverlayCache.saveOverlays(R,V.batchId,G)})}).then(()=>({batchId:w.batchId,changes:em(p)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),function(a,c,l){let d=a.Vu[a.currentUser.toKey()];d||(d=new st(z)),d=d.insert(c,l),a.Vu[a.currentUser.toKey()]=d}(n,s.batchId,e),yield Be(n,s.changes),yield dr(n.remoteStore)}catch(s){let i=cl(s,"Failed to persist write");e.reject(i)}})}function Jm(r,t){return C(this,null,function*(){let e=L(r);try{let n=yield __(e.localStore,t);t.targetChanges.forEach((s,i)=>{let a=e.Au.get(i);a&&(B(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?B(a.hu,14607):s.removedDocuments.size>0&&(B(a.hu,42227),a.hu=!1))}),yield Be(e,n,t)}catch(n){yield Me(n)}})}function sf(r,t,e){let n=L(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let s=[];n.Tu.forEach((i,a)=>{let c=a.view.va(t);c.snapshot&&s.push(c.snapshot)}),function(a,c){let l=L(a);l.onlineState=c;let d=!1;l.queries.forEach((m,p)=>{for(let w of p.Sa)w.va(c)&&(d=!0)}),d&&ul(l)}(n.eventManager,t),s.length&&n.Pu.H_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function q_(r,t,e){return C(this,null,function*(){let n=L(r);n.sharedClientState.updateQueryState(t,"rejected",e);let s=n.Au.get(t),i=s&&s.key;if(i){let a=new st(M.comparator);a=a.insert(i,It.newNoDocument(i,q.min()));let c=K().add(i),l=new ps(q.min(),new Map,new st(z),a,c);yield Jm(n,l),n.du=n.du.remove(i),n.Au.delete(t),fl(n)}else yield ir(n.localStore,t,!1).then(()=>cr(n,t,e)).catch(Me)})}function j_(r,t){return C(this,null,function*(){let e=L(r),n=t.batch.batchId;try{let s=yield y_(e.localStore,t);dl(e,n,null),hl(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield Be(e,s)}catch(s){yield Me(s)}})}function z_(r,t,e){return C(this,null,function*(){let n=L(r);try{let s=yield function(a,c){let l=L(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let m;return l.mutationQueue.lookupMutationBatch(d,c).next(p=>(B(p!==null,37113),m=p.keys(),l.mutationQueue.removeMutationBatch(d,p))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,m,c)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,m)).next(()=>l.localDocuments.getDocuments(d,m))})}(n.localStore,t);dl(n,t,e),hl(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield Be(n,s)}catch(s){yield Me(s)}})}function hl(r,t){(r.mu.get(t)||[]).forEach(e=>{e.resolve()}),r.mu.delete(t)}function dl(r,t,e){let n=L(r),s=n.Vu[n.currentUser.toKey()];if(s){let i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Vu[n.currentUser.toKey()]=s}}function cr(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Iu.get(t))r.Tu.delete(n),e&&r.Pu.yu(n,e);r.Iu.delete(t),r.isPrimaryClient&&r.Ru.jr(t).forEach(n=>{r.Ru.containsKey(n)||Xm(r,n)})}function Xm(r,t){r.Eu.delete(t.path.canonicalString());let e=r.du.get(t);e!==null&&(or(r.remoteStore,e),r.du=r.du.remove(t),r.Au.delete(e),fl(r))}function bu(r,t,e){for(let n of e)n instanceof io?(r.Ru.addReference(n.key,t),G_(r,n)):n instanceof oo?(D(mr,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,t),r.Ru.containsKey(n.key)||Xm(r,n.key)):F(19791,{wu:n})}function G_(r,t){let e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Eu.has(n)||(D(mr,"New document in limbo: "+e),r.Eu.add(n),fl(r))}function fl(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let t=r.Eu.values().next().value;r.Eu.delete(t);let e=new M(Y.fromString(t)),n=r.fu.next();r.Au.set(n,new vu(e)),r.du=r.du.insert(e,n),Co(r.remoteStore,new rr(Ft(bo(e.path)),n,"TargetPurposeLimboResolution",kt.ce))}}function Be(r,t,e){return C(this,null,function*(){let n=L(r),s=[],i=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach((c,l)=>{a.push(n.pu(l,t,e).then(d=>{if((d||e)&&n.isPrimaryClient){let m=d?!d.fromCache:e?.targetChanges.get(l.targetId)?.current;n.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(d){s.push(d);let m=Zc.As(l.targetId,d);i.push(m)}}))}),yield Promise.all(a),n.Pu.H_(s),yield function(l,d){return C(this,null,function*(){let m=L(l);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(d,w=>b.forEach(w.Es,R=>m.persistence.referenceDelegate.addReference(p,w.targetId,R)).next(()=>b.forEach(w.ds,R=>m.persistence.referenceDelegate.removeReference(p,w.targetId,R)))))}catch(p){if(!Fe(p))throw p;D(sl,"Failed to update sequence numbers: "+p)}for(let p of d){let w=p.targetId;if(!p.fromCache){let R=m.Ms.get(w),N=R.snapshotVersion,O=R.withLastLimboFreeSnapshotVersion(N);m.Ms=m.Ms.insert(w,O)}}})}(n.localStore,i))})}function $_(r,t){return C(this,null,function*(){let e=L(r);if(!e.currentUser.isEqual(t)){D(mr,"User change. New user:",t.toKey());let n=yield Om(e.localStore,t);e.currentUser=t,function(i,a){i.mu.forEach(c=>{c.forEach(l=>{l.reject(new x(P.CANCELLED,a))})}),i.mu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield Be(e,n.Ls)}})}function K_(r,t){let e=L(r),n=e.Au.get(t);if(n&&n.hu)return K().add(n.key);{let s=K(),i=e.Iu.get(t);if(!i)return s;for(let a of i){let c=e.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function Q_(r,t){return C(this,null,function*(){let e=L(r),n=yield nu(e.localStore,t.query,!0),s=t.view.cu(n);return e.isPrimaryClient&&bu(e,t.targetId,s.au),s})}function W_(r,t){return C(this,null,function*(){let e=L(r);return Lm(e.localStore,t).then(n=>Be(e,n))})}function H_(r,t,e,n){return C(this,null,function*(){let s=L(r),i=yield function(c,l){let d=L(c),m=L(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",p=>m.er(p,l).next(w=>w?d.localDocuments.getDocuments(p,w):b.resolve(null)))}(s.localStore,t);i!==null?(e==="pending"?yield dr(s.remoteStore):e==="acknowledged"||e==="rejected"?(dl(s,t,n||null),hl(s,t),function(c,l){L(L(c).mutationQueue).ir(l)}(s.localStore,t)):F(6720,"Unknown batchState",{Su:e}),yield Be(s,i)):D(mr,"Cannot apply mutation batch with id: "+t)})}function J_(r,t){return C(this,null,function*(){let e=L(r);if(Do(e),ml(e),t===!0&&e.gu!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),s=yield of(e,n.toArray());e.gu=!0,yield pu(e.remoteStore,!0);for(let i of s)Co(e.remoteStore,i)}else if(t===!1&&e.gu!==!1){let n=[],s=Promise.resolve();e.Iu.forEach((i,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):s=s.then(()=>(cr(e,a),ir(e.localStore,a,!0))),or(e.remoteStore,a)}),yield s,yield of(e,n),function(a){let c=L(a);c.Au.forEach((l,d)=>{or(c.remoteStore,d)}),c.Ru.Jr(),c.Au=new Map,c.du=new st(M.comparator)}(e),e.gu=!1,yield pu(e.remoteStore,!1)}})}function of(r,t,e){return C(this,null,function*(){let n=L(r),s=[],i=[];for(let a of t){let c,l=n.Iu.get(a);if(l&&l.length!==0){c=yield Hi(n.localStore,Ft(l[0]));for(let d of l){let m=n.Tu.get(d),p=yield Q_(n,m);p.snapshot&&i.push(p.snapshot)}}else{let d=yield Fm(n.localStore,a);c=yield Hi(n.localStore,d),yield ll(n,Ym(d),a,!1,c.resumeToken)}s.push(c)}return n.Pu.H_(i),s})}function Ym(r){return Hf(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function X_(r){return function(e){return L(L(e).persistence).Ts()}(L(r).localStore)}function Y_(r,t,e,n){return C(this,null,function*(){let s=L(r);if(s.gu)return void D(mr,"Ignoring unexpected query state notification.");let i=s.Iu.get(t);if(i&&i.length>0)switch(e){case"current":case"not-current":{let a=yield Lm(s.localStore,Yf(i[0])),c=ps.createSynthesizedRemoteEventForCurrentChange(t,e==="current",ft.EMPTY_BYTE_STRING);yield Be(s,a,c);break}case"rejected":yield ir(s.localStore,t,!0),cr(s,t,n);break;default:F(64155,e)}})}function Z_(r,t,e){return C(this,null,function*(){let n=Do(r);if(n.gu){for(let s of t){if(n.Iu.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){D(mr,"Adding an already active target "+s);continue}let i=yield Fm(n.localStore,s),a=yield Hi(n.localStore,i);yield ll(n,Ym(i),a.targetId,!1,a.resumeToken),Co(n.remoteStore,a)}for(let s of e)n.Iu.has(s)&&(yield ir(n.localStore,s,!1).then(()=>{or(n.remoteStore,s),cr(n,s)}).catch(Me))}})}function Do(r){let t=L(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Jm.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=K_.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=q_.bind(null,t),t.Pu.H_=k_.bind(null,t.eventManager),t.Pu.yu=O_.bind(null,t.eventManager),t}function ml(r){let t=L(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=j_.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=z_.bind(null,t),t}var pl=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){this.serializer=Ro(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,n){return null}Mu(e,n){return null}vu(e){return km(this.persistence,new Wi,e.initialUser,this.serializer)}Cu(e){return new ws(Ki.mi,this.serializer)}Du(e){return new Yi}terminate(){return C(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),Su=class extends pl{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){B(this.persistence.referenceDelegate instanceof Qi,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new zi(n,t.asyncQueue,e)}Cu(t){let e=this.cacheSizeBytes!==void 0?Dt.withCacheSize(this.cacheSizeBytes):Dt.DEFAULT;return new ws(n=>Qi.mi(n,e),this.serializer)}},ao=class r extends pl{constructor(t,e,n){super(),this.xu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return C(this,null,function*(){yield na(r.prototype,this,"initialize").call(this,t),yield this.xu.initialize(this,t),yield ml(this.xu.syncEngine),yield dr(this.xu.remoteStore),yield this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(t){return km(this.persistence,new Wi,t.initialUser,this.serializer)}Fu(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new zi(n,t.asyncQueue,e)}Mu(t,e){let n=new Ya(e,this.persistence);return new Xa(t.asyncQueue,n)}Cu(t){let e=Nm(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Dt.withCacheSize(this.cacheSizeBytes):Dt.DEFAULT;return new Yc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,zm(),fi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(t){return new Yi}},Ru=class r extends ao{constructor(t,e){super(t,e,!1),this.xu=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return C(this,null,function*(){yield na(r.prototype,this,"initialize").call(this,t);let e=this.xu.syncEngine;this.sharedClientState instanceof ts&&(this.sharedClientState.syncEngine={Co:H_.bind(null,e),vo:Y_.bind(null,e),Fo:Z_.bind(null,e),Ts:X_.bind(null,e),Do:W_.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.Ji(n=>C(this,null,function*(){yield J_(this.xu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Du(t){let e=zm();if(!ts.v(e))throw new x(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Nm(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new ts(e,t.asyncQueue,n,t.clientId,t.initialUser)}},gl=(()=>{class r{initialize(e,n){return C(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>sf(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=$_.bind(null,this.syncEngine),yield pu(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new _u}()}createDatastore(e){let n=Ro(e.databaseInfo.databaseId),s=function(a){return new cu(a)}(e.databaseInfo);return function(a,c,l,d){return new du(a,c,l,d)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,i,a,c,l){return new mu(s,i,a,c,l)}(this.localStore,this.datastore,e.asyncQueue,n=>sf(this.syncEngine,n,0),function(){return Zi.v()?new Zi:new su}())}createSyncEngine(e,n){return function(i,a,c,l,d,m,p){let w=new Au(i,a,c,l,d,m);return p&&(w.gu=!0),w}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return C(this,null,function*(){yield function(n){return C(this,null,function*(){let s=L(n);D(yn,"RemoteStore shutting down."),s.Ea.add(5),yield Rs(s),s.Aa.shutdown(),s.Ra.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return r.provider={build:()=>new r},r})();var Pu=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):ct("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var ke="FirestoreClient",Cu=class{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=ht.UNAUTHENTICATED,this.clientId=es.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,a=>C(this,null,function*(){D(ke,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(D(ke,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=cl(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function Ba(r,t){return C(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),D(ke,"Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(s=>C(this,null,function*(){n.isEqual(s)||(yield Om(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function af(r,t){return C(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield tw(r);D(ke,"Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>ef(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>ef(t.remoteStore,s)),r._onlineComponents=t})}function tw(r){return C(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){D(ke,"Using user provided OfflineComponentProvider");try{yield Ba(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;qn("Error using user provided cache. Falling back to memory cache: "+e),yield Ba(r,new pl)}}else D(ke,"Using default OfflineComponentProvider"),yield Ba(r,new Su(void 0));return r._offlineComponents})}function Zm(r){return C(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(D(ke,"Using user provided OnlineComponentProvider"),yield af(r,r._uninitializedComponentsProvider._online)):(D(ke,"Using default OnlineComponentProvider"),yield af(r,new gl))),r._onlineComponents})}function ew(r){return Zm(r).then(t=>t.syncEngine)}function cf(r){return C(this,null,function*(){let t=yield Zm(r),e=t.eventManager;return e.onListen=M_.bind(null,t.syncEngine),e.onUnlisten=L_.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=F_.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=B_.bind(null,t.syncEngine),e})}function tp(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var uf=new Map;var ep="firestore.googleapis.com",lf=!0,co=class{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ep,this.ssl=lf}else this.host=t.host,this.ssl=t.ssl??lf;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Sm;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Dm)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}oy("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tp(t.experimentalLongPollingOptions??{}),function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},ur=class{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new co({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new co(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new qa;switch(n.type){case"firstParty":return new $a(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return C(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=uf.get(e);n&&(D("ComponentProvider","Removing Datastore"),uf.delete(e),n.terminate())}(this),Promise.resolve()}};function nw(r,t,e,n={}){r=qt(r,ur);let s=Mr(t),i=r._getSettings(),a=xr(wt({},i),{emulatorOptions:r._getEmulatorOptions()}),c=`${t}:${e}`;s&&(ca(`https://${c}`),Nh("Firestore",!0)),i.host!==ep&&i.host!==c&&qn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l=xr(wt({},i),{host:c,ssl:s,emulatorOptions:n});if(!pe(l,a)&&(r._setSettings(l),n.mockUserToken)){let d,m;if(typeof n.mockUserToken=="string")d=n.mockUserToken,m=ht.MOCK_USER;else{d=xh(n.mockUserToken,r._app?.options.projectId);let p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new ht(p)}r._authCredentials=new ja(new mi(d,m))}}var Oe=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},_t=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ve(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(vs(e,r._jsonSchema))return new r(t,n||null,new M(Y.fromString(e.referencePath)))}};_t._jsonSchemaVersion="firestore/documentReference/1.0",_t._jsonSchema={type:dt("string",_t._jsonSchemaVersion),referencePath:dt("string")};var ve=class r extends Oe{constructor(t,e,n){super(t,e,bo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new _t(this.firestore,null,new M(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function uE(r,t,...e){if(r=xt(r),_f("collection","path",t),r instanceof ur){let n=Y.fromString(t,...e);return sd(n),new ve(r,null,n)}{if(!(r instanceof _t||r instanceof ve))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(t,...e));return sd(n),new ve(r.firestore,null,n)}}function rw(r,t,...e){if(r=xt(r),arguments.length===1&&(t=es.newId()),_f("doc","path",t),r instanceof ur){let n=Y.fromString(t,...e);return rd(n),new _t(r,null,new M(n))}{if(!(r instanceof _t||r instanceof ve))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Y.fromString(t,...e));return rd(n),new _t(r.firestore,r instanceof ve?r.converter:null,new M(n))}}var hf="AsyncQueue",uo=class{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new to(this,"async_queue_retry"),this._c=()=>{let n=fi();n&&D(hf,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;let e=fi();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;let e=fi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});let e=new Ht;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}lc(){return C(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Fe(t))throw t;D(hf,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(t){let e=this.ac.then(()=>(this.rc=!0,t().catch(n=>{throw this.nc=n,this.rc=!1,ct("INTERNAL UNHANDLED ERROR: ",df(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);let s=gu.createAndSchedule(this,t,e,n,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&F(47125,{Pc:df(this.nc)})}verifyOperationInProgress(){}Tc(){return C(this,null,function*(){let t;do t=this.ac,yield t;while(t!==this.ac)})}Ic(t){for(let e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){let e=this.tc.indexOf(t);this.tc.splice(e,1)}};function df(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function ff(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let s=e;for(let i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}(r,["next","error","complete"])}var Yt=class extends ur{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new uo,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return C(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new uo(t),this._firestoreClient=void 0,yield t}})}};function lE(r,t,e){e||(e=us);let n=ba(r,"firestore");if(n.isInitialized(e)){let s=n.getImmediate({identifier:e}),i=n.getOptions(e);if(pe(i,t))return s;throw new x(P.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new x(P.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Dm)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&Mr(t.host)&&ca(t.host),n.initialize({options:t,instanceIdentifier:e})}function np(r,t){let e=typeof r=="object"?r:Ys(),n=typeof r=="string"?r:t||us,s=ba(e,"firestore").getImmediate({identifier:n});if(!s._initialized){let i=Vh("firestore");i&&nw(s,...i)}return s}function yl(r){if(r._terminated)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||sw(r),r._firestoreClient}function sw(r){let t=r._freezeSettings(),e=function(s,i,a,c){return new nc(s,i,a,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,tp(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)}(r._databaseId,r._app?.options.appId||"",r._persistenceKey,t);r._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),r._firestoreClient=new Cu(r._authCredentials,r._appCheckCredentials,r._queue,e,r._componentsProvider&&function(s){let i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}}(r._componentsProvider))}var Ae=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(ft.fromBase64String(t))}catch(e){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(ft.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(vs(t,r._jsonSchema))return r.fromBase64String(t.bytes)}};Ae._jsonSchemaVersion="firestore/bytes/1.0",Ae._jsonSchema={type:dt("string",Ae._jsonSchemaVersion),bytes:dt("string")};var _n=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var lr=class{constructor(t){this._methodName=t}};var be=class r{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(t){if(vs(t,r._jsonSchema))return new r(t.latitude,t.longitude)}};be._jsonSchemaVersion="firestore/geoPoint/1.0",be._jsonSchema={type:dt("string",be._jsonSchemaVersion),latitude:dt("number"),longitude:dt("number")};var Se=class r{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,t._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(vs(t,r._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new r(t.vectorValues);throw new x(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Se._jsonSchemaVersion="firestore/vectorValue/1.0",Se._jsonSchema={type:dt("string",Se._jsonSchemaVersion),vectorValues:dt("object")};var iw=/^__.*__$/,Du=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new zt(t,this.data,this.fieldMask,e,this.fieldTransforms):new xe(t,this.data,e,this.fieldTransforms)}},lo=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new zt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function rp(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:r})}}var ho=class r{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new r(wt(wt({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){let e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){let e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return mo(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(rp(this.Ac)&&iw.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}},Vu=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ro(t)}Cc(t,e,n,s=!1){return new ho({Ac:t,methodName:e,Dc:n,path:pt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ps(r){let t=r._freezeSettings(),e=Ro(r._databaseId);return new Vu(r._databaseId,!!t.ignoreUndefinedProperties,e)}function _l(r,t,e,n,s,i={}){let a=r.Cc(i.merge||i.mergeFields?2:0,t,e,s);wl("Data must be an object, but it was:",a,n);let c=op(n,a),l,d;if(i.merge)l=new Ot(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){let m=[];for(let p of i.mergeFields){let w=Nu(t,p,e);if(!a.contains(w))throw new x(P.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);cp(m,w)||m.push(w)}l=new Ot(m),d=a.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,d=a.fieldTransforms;return new Du(new Rt(c),l,d)}var fo=class r extends lr{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function ow(r,t,e){return new ho({Ac:3,Dc:t.settings.Dc,methodName:r._methodName,fc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var xu=class r extends lr{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=ow(this,t,!0),n=this.vc.map(i=>pr(i,e)),s=new ae(n);return new Ci(t.path,s)}isEqual(t){return t instanceof r&&pe(this.vc,t.vc)}};function sp(r,t,e,n){let s=r.Cc(1,t,e);wl("Data must be an object, but it was:",s,n);let i=[],a=Rt.empty();Le(n,(l,d)=>{let m=El(t,l,e);d=xt(d);let p=s.yc(m);if(d instanceof fo)i.push(m);else{let w=pr(d,p);w!=null&&(i.push(m),a.set(m,w))}});let c=new Ot(i);return new lo(a,c,s.fieldTransforms)}function ip(r,t,e,n,s,i){let a=r.Cc(1,t,e),c=[Nu(t,n,e)],l=[s];if(i.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<i.length;w+=2)c.push(Nu(t,i[w])),l.push(i[w+1]);let d=[],m=Rt.empty();for(let w=c.length-1;w>=0;--w)if(!cp(d,c[w])){let R=c[w],N=l[w];N=xt(N);let O=a.yc(R);if(N instanceof fo)d.push(R);else{let V=pr(N,O);V!=null&&(d.push(R),m.set(R,V))}}let p=new Ot(d);return new lo(m,p,a.fieldTransforms)}function aw(r,t,e,n=!1){return pr(e,r.Cc(n?4:3,t))}function pr(r,t){if(ap(r=xt(r)))return wl("Unsupported field value:",t,r),op(r,t);if(r instanceof lr)return function(n,s){if(!rp(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);let i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return function(n,s){let i=[],a=0;for(let c of n){let l=pr(c,s.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}}(r,t)}return function(n,s){if((n=xt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Gy(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let i=ot.fromDate(n);return{timestampValue:nr(s.serializer,i)}}if(n instanceof ot){let i=new ot(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:nr(s.serializer,i)}}if(n instanceof be)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ae)return{bytesValue:hm(s.serializer,n._byteString)};if(n instanceof _t){let i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:nl(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Se)return function(a,c){return{mapValue:{fields:{[Xu]:{stringValue:Yu},[Xn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw c.Sc("VectorValues must only contain numeric values.");return el(c.serializer,d)})}}}}}}(n,s);throw s.Sc(`Unsupported field value: ${_o(n)}`)}(r,t)}function op(r,t){let e={};return Of(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Le(r,(n,s)=>{let i=pr(s,t.mc(n));i!=null&&(e[n]=i)}),{mapValue:{fields:e}}}function ap(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ot||r instanceof be||r instanceof Ae||r instanceof _t||r instanceof lr||r instanceof Se)}function wl(r,t,e){if(!ap(e)||!wf(e)){let n=_o(e);throw n==="an object"?t.Sc(r+" a custom object"):t.Sc(r+" "+n)}}function Nu(r,t,e){if((t=xt(t))instanceof _n)return t._internalPath;if(typeof t=="string")return El(r,t);throw mo("Field path arguments must be of type string or ",r,!1,void 0,e)}var cw=new RegExp("[~\\*/\\[\\]]");function El(r,t,e){if(t.search(cw)>=0)throw mo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new _n(...t.split("."))._internalPath}catch{throw mo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function mo(r,t,e,n,s){let i=n&&!n.isEmpty(),a=s!==void 0,c=`Function ${t}() called with invalid data`;e&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${s}`),l+=")"),new x(P.INVALID_ARGUMENT,c+r+l)}function cp(r,t){return r.some(e=>e.isEqual(t))}var po=class{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new _t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new ku(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Vo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},ku=class extends po{data(){return super.data()}};function Vo(r,t){return typeof t=="string"?El(r,t):t instanceof _n?t._internalPath:t._delegate._internalPath}function uw(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Is=class{},Ts=class extends Is{};function hE(r,t,...e){let n=[];t instanceof Is&&n.push(t),n=n.concat(e),function(i){let a=i.filter(l=>l instanceof Ou).length,c=i.filter(l=>l instanceof go).length;if(a>1||a>0&&c>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let s of n)r=s._apply(r);return r}var go=class r extends Ts{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return up(t._query,e),new Oe(t.firestore,t.converter,pc(t._query,e))}_parse(t){let e=Ps(t.firestore);return function(i,a,c,l,d,m,p){let w;if(d.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){pf(p,m);let N=[];for(let O of p)N.push(mf(l,i,O));w={arrayValue:{values:N}}}else w=mf(l,i,p)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||pf(p,m),w=aw(c,a,p,m==="in"||m==="not-in");return Q.create(d,m,w)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function dE(r,t,e){let n=t,s=Vo("where",r);return go._create(s,n,e)}var Ou=class r extends Is{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:Z.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(s,i){let a=s,c=i.getFlattenedFilters();for(let l of c)up(a,l),a=pc(a,l)}(t._query,e),new Oe(t.firestore,t.converter,pc(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Mu=class r extends Ts{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(s,i,a){if(s.startAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ln(i,a)}(t._query,this._field,this._direction);return new Oe(t.firestore,t.converter,function(s,i){let a=s.explicitOrderBy.concat([i]);return new De(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}};function fE(r,t="asc"){let e=t,n=Vo("orderBy",r);return Mu._create(n,e)}var Fu=class r extends Ts{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new Oe(t.firestore,t.converter,Pi(t._query,this._limit,this._limitType))}};function mE(r){return ay("limit",r),Fu._create("limit",r,"F")}function mf(r,t,e){if(typeof(e=xt(e))=="string"){if(e==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jf(t)&&e.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(Y.fromString(e));if(!M.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return hs(r,new M(n))}if(e instanceof _t)return hs(r,e._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_o(e)}.`)}function pf(r,t){if(!Array.isArray(r)||r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function up(r,t){let e=function(s,i){for(let a of s)for(let c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var Lu=class{convertValue(t,e="none"){switch(Re(t)){case 0:return null;case 1:return t.booleanValue;case 2:return it(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(oe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return Le(t,(s,i)=>{n[s]=this.convertValue(i,e)}),n}convertVectorValue(t){let e=t.fields?.[Xn].arrayValue?.values?.map(n=>it(n.doubleValue));return new Se(e)}convertGeoPoint(t){return new be(it(t.latitude),it(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=vo(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(cs(t));default:return null}}convertTimestamp(t){let e=ie(t);return new ot(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=Y.fromString(t);B(Im(n),9688,{name:t});let s=new Jn(n.get(1),n.get(3)),i=new M(n.popFirst(5));return s.isEqual(e)||ct(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}};function Il(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var nn=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},cn=class r extends po{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Bn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(Vo("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=r._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};cn._jsonSchemaVersion="firestore/documentSnapshot/1.0",cn._jsonSchema={type:dt("string",cn._jsonSchemaVersion),bundleSource:dt("string","DocumentSnapshot"),bundleName:dt("string"),bundle:dt("string")};var Bn=class extends cn{data(t={}){return super.data(t)}},Un=class r{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new nn(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Bn(this._firestore,this._userDataWriter,n.key,n,new nn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(c=>{let l=new Bn(s._firestore,s._userDataWriter,c.doc.key,c.doc,new nn(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{let l=new Bn(s._firestore,s._userDataWriter,c.doc.key,c.doc,new nn(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter),d=-1,m=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),m=a.indexOf(c.doc.key)),{type:lw(c.type),doc:l,oldIndex:d,newIndex:m}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=r._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=es.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],n=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function lw(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:r})}}Un._jsonSchemaVersion="firestore/querySnapshot/1.0",Un._jsonSchema={type:dt("string",Un._jsonSchemaVersion),bundleSource:dt("string","QuerySnapshot"),bundleName:dt("string"),bundle:dt("string")};var yo=class extends Lu{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ae(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new _t(this.firestore,null,e)}};function pE(r,t,e){r=qt(r,_t);let n=qt(r.firestore,Yt),s=Il(r.converter,t,e);return Cs(n,[_l(Ps(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,Et.none())])}function gE(r,t,e,...n){r=qt(r,_t);let s=qt(r.firestore,Yt),i=Ps(s),a;return a=typeof(t=xt(t))=="string"||t instanceof _n?ip(i,"updateDoc",r._key,t,e,n):sp(i,"updateDoc",r._key,t),Cs(s,[a.toMutation(r._key,Et.exists(!0))])}function yE(r){return Cs(qt(r.firestore,Yt),[new mn(r._key,Et.none())])}function _E(r,t){let e=qt(r.firestore,Yt),n=rw(r),s=Il(r.converter,t);return Cs(e,[_l(Ps(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,Et.exists(!1))]).then(()=>n)}function wE(r,...t){r=xt(r);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||ff(t[n])||(e=t[n++]);let s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(ff(t[n])){let l=t[n];t[n]=l.next?.bind(l),t[n+1]=l.error?.bind(l),t[n+2]=l.complete?.bind(l)}let i,a,c;if(r instanceof _t)a=qt(r.firestore,Yt),c=bo(r._key.path),i={next:l=>{t[n]&&t[n](hw(a,r,l))},error:t[n+1],complete:t[n+2]};else{let l=qt(r,Oe);a=qt(l.firestore,Yt),c=l._query;let d=new yo(a);i={next:m=>{t[n]&&t[n](new Un(a,d,l,m))},error:t[n+1],complete:t[n+2]},uw(r._query)}return function(d,m,p,w){let R=new Pu(w),N=new Eu(m,R,p);return d.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return x_(yield cf(d),N)})),()=>{R.Nu(),d.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return N_(yield cf(d),N)}))}}(yl(a),c,s,i)}function Cs(r,t){return function(n,s){let i=new Ht;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return U_(yield ew(n),s,i)})),i.promise}(yl(r),t)}function hw(r,t,e){let n=e.docs.get(t._key),s=new yo(r);return new cn(r,s,t._key,n,new nn(e.hasPendingWrites,e.fromCache),t.converter)}var Bu=class{constructor(t){let e;this.kind="persistent",t?.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=dw(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}};function EE(r){return new Bu(r)}var Uu=class{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=gl.provider,this._offlineComponentProvider={build:e=>new ao(e,t?.cacheSizeBytes,this.forceOwnership)}}},qu=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=gl.provider,this._offlineComponentProvider={build:e=>new Ru(e,t?.cacheSizeBytes)}}};function dw(r){return new Uu(r?.forceOwnership)}function IE(){return new qu}var ju=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Ps(t)}set(t,e,n){this._verifyNotCommitted();let s=Ua(t,this._firestore),i=Il(s.converter,e,n),a=_l(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(a.toMutation(s._key,Et.none())),this}update(t,e,n,...s){this._verifyNotCommitted();let i=Ua(t,this._firestore),a;return a=typeof(e=xt(e))=="string"||e instanceof _n?ip(this._dataReader,"WriteBatch.update",i._key,e,n,s):sp(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(a.toMutation(i._key,Et.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Ua(t,this._firestore);return this._mutations=this._mutations.concat(new mn(e._key,Et.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ua(r,t){if((r=xt(r)).firestore!==t)throw new x(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function TE(...r){return new xu("arrayUnion",r)}function vE(r){return yl(r=qt(r,Yt)),new ju(r,t=>Cs(r,t))}(function(t,e=!0){(function(s){hr=s})(Hh),Fr(new te("firestore",(n,{instanceIdentifier:s,options:i})=>{let a=n.getProvider("app").getImmediate(),c=new Yt(new za(n.getProvider("auth-internal")),new Ka(a,n.getProvider("app-check-internal")),function(d,m){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jn(d.options.projectId,m)}(a,s),a);return i=wt({useFetchStreams:e},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),ye(td,ed,t),ye(td,ed,"esm2020")})();var fw="firebase",mw="12.6.0";ye(fw,mw,"app");var kE=(()=>{class r{constructor(){this.app=Ys(),this.db=np(this.app)}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275prov=Ah({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{Dh as a,Kp as b,yw as c,Mr as d,ca as e,Nh as f,$e as g,_w as h,ww as i,Ew as j,Iw as k,Tw as l,Ws as m,Oh as n,vw as o,Zt as p,Or as q,Aw as r,pe as s,bw as t,Sw as u,xt as v,te as w,H as x,vn as y,jh as z,Mw as A,Fr as B,ba as C,Wh as D,Hh as E,Kg as F,Ys as G,ye as H,ot as I,uE as J,rw as K,lE as L,hE as M,dE as N,fE as O,mE as P,pE as Q,gE as R,yE as S,_E as T,wE as U,EE as V,IE as W,TE as X,vE as Y,kE as Z};
