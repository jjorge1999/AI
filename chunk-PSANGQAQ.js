import{a as Tn}from"./chunk-2ZM6CYAQ.js";import{a as bn}from"./chunk-QIGGX7RR.js";import{$c as R,Ac as fn,B as ut,Bc as pn,Cc as gn,D as nn,Dc as me,Ec as B,Fc as mn,Gc as Oe,Hc as ye,Ic as In,Jc as N,K as dt,Kc as V,Lc as ht,M as j,Ma as ie,Mc as _n,Nc as Ee,Oc as De,P as pe,Pc as q,Qb as ge,Qc as z,Rc as C,Sc as Ie,U as L,Uc as Te,Vc as W,Wc as Sn,Xc as w,Yc as y,Zc as vn,_c as wn,ad as k,bd as ft,cd as pt,ed as yn,fd as Le,g as P,gd as re,hd as _e,i as F,id as Se,j as x,jd as ve,k as b,kd as En,md as Me,nd as Ue,o as fe,oc as rn,pc as sn,qc as lt,rc as Ce,sc as on,tc as an,uc as A,vc as cn,wc as un,x as ct,xc as dn,yc as ln,zc as hn}from"./chunk-PYKLABYS.js";import{a as f,b as I,d as at,f as ne,g as c}from"./chunk-7QOE2ANW.js";function Vn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var qn=Vn,Wn=new B("auth","Firebase",Vn());var We=new _n("@firebase/auth");function rr(n,...t){We.logLevel<=ht.WARN&&We.warn(`Auth (${Ie}): ${n}`,...t)}function xe(n,...t){We.logLevel<=ht.ERROR&&We.error(`Auth (${Ie}): ${n}`,...t)}function X(n,...t){throw Lt(n,...t)}function se(n,...t){return Lt(n,...t)}function Hn(n,t,e){let i=I(f({},qn()),{[t]:e});return new B("auth","Firebase",i).create(t,{appName:n.name})}function Q(n){return Hn(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Lt(n,...t){if(typeof n!="string"){let e=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(e,...i)}return Wn.create(n,...t)}function g(n,t,...e){if(!n)throw Lt(t,...e)}function H(n){let t="INTERNAL ASSERTION FAILED: "+n;throw xe(t),new Error(t)}function Z(n,t){n||H(t)}function _t(){return typeof self<"u"&&self.location?.href||""}function sr(){return An()==="http:"||An()==="https:"}function An(){return typeof self<"u"&&self.location?.protocol||null}function or(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sr()||dn()||"connection"in navigator)?navigator.onLine:!0}function ar(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var oe=class{constructor(t,e){this.shortDelay=t,this.longDelay=e,Z(e>t,"Short delay should be less than long delay!"),this.isMobile=cn()||ln()}get(){return or()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Mt(n,t){Z(n.emulator,"Emulator should always be set here");let{url:e}=n.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}var He=class{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;H("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;H("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;H("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var cr={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var ur=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],dr=new oe(3e4,6e4);function et(n,t){return n.tenantId&&!t.tenantId?I(f({},t),{tenantId:n.tenantId}):t}function we(s,o,a,u){return c(this,arguments,function*(n,t,e,i,r={}){return $n(n,r,()=>c(this,null,function*(){let d={},l={};i&&(t==="GET"?l=i:d={body:JSON.stringify(i)});let h=ye(f({key:n.config.apiKey},l)).slice(1),p=yield n._getAdditionalHeaders();p["Content-Type"]="application/json",n.languageCode&&(p["X-Firebase-Locale"]=n.languageCode);let _=f({method:t,headers:p},d);return un()||(_.referrerPolicy="no-referrer"),n.emulatorConfig&&Ce(n.emulatorConfig.host)&&(_.credentials="include"),He.fetch()(yield Gn(n,n.config.apiHost,e,h),_)}))})}function $n(n,t,e){return c(this,null,function*(){n._canInitEmulator=!1;let i=f(f({},cr),t);try{let r=new St(n),s=yield Promise.race([e(),r.promise]);r.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw Fe(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[u,d]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Fe(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw Fe(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw Fe(n,"user-disabled",o);let l=i[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Hn(n,l,d);X(n,l)}}catch(r){if(r instanceof me)throw r;X(n,"network-request-failed",{message:String(r)})}})}function Kn(s,o,a,u){return c(this,arguments,function*(n,t,e,i,r={}){let d=yield we(n,t,e,i,r);return"mfaPendingCredential"in d&&X(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function Gn(n,t,e,i){return c(this,null,function*(){let r=`${t}${e}?${i}`,s=n,o=s.config.emulator?Mt(n.config,r):`${n.config.apiScheme}://${r}`;return ur.includes(e)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}var St=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,i)=>{this.timer=setTimeout(()=>i(se(this.auth,"network-request-failed")),dr.get())})}};function Fe(n,t,e){let i={appName:n.name};e.email&&(i.email=e.email),e.phoneNumber&&(i.phoneNumber=e.phoneNumber);let r=se(n,t,i);return r.customData._tokenResponse=e,r}function lr(n,t){return c(this,null,function*(){return we(n,"POST","/v1/accounts:delete",t)})}function $e(n,t){return c(this,null,function*(){return we(n,"POST","/v1/accounts:lookup",t)})}function be(n){if(n)try{let t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}function Bn(n,t=!1){return c(this,null,function*(){let e=N(n),i=yield e.getIdToken(t),r=Ut(i);g(r&&r.exp&&r.auth_time&&r.iat,e.auth,"internal-error");let s=typeof r.firebase=="object"?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:be(gt(r.auth_time)),issuedAtTime:be(gt(r.iat)),expirationTime:be(gt(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function gt(n){return Number(n)*1e3}function Ut(n){let[t,e,i]=n.split(".");if(t===void 0||e===void 0||i===void 0)return xe("JWT malformed, contained fewer than 3 sections"),null;try{let r=rn(e);return r?JSON.parse(r):(xe("Failed to decode base64 JWT payload"),null)}catch(r){return xe("Caught error parsing JWT payload as JSON",r?.toString()),null}}function kn(n){let t=Ut(n);return g(t,"internal-error"),g(typeof t.exp<"u","internal-error"),g(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}function ke(n,t,e=!1){return c(this,null,function*(){if(e)return t;try{return yield t}catch(i){throw i instanceof me&&hr(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function hr({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var vt=class{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){let e=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),e}else{this.errorBackoff=3e4;let i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(t=!1){if(!this.isRunning)return;let e=this.getInterval(t);this.timerId=setTimeout(()=>c(this,null,function*(){yield this.iteration()}),e)}iteration(){return c(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Pe=class{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=be(this.lastLoginAt),this.creationTime=be(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Ke(n){return c(this,null,function*(){let t=n.auth,e=yield n.getIdToken(),i=yield ke(n,$e(t,{idToken:e}));g(i?.users.length,t,"internal-error");let r=i.users[0];n._notifyReloadListener(r);let s=r.providerUserInfo?.length?Jn(r.providerUserInfo):[],o=fr(n.providerData,s),a=n.isAnonymous,u=!(n.email&&r.passwordHash)&&!o?.length,d=a?u:!1,l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Pe(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(n,l)})}function zn(n){return c(this,null,function*(){let t=N(n);yield Ke(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}function fr(n,t){return[...n.filter(i=>!t.some(r=>r.providerId===i.providerId)),...t]}function Jn(n){return n.map(i=>{var r=i,{providerId:t}=r,e=at(r,["providerId"]);return{providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}})}function pr(n,t){return c(this,null,function*(){let e=yield $n(n,{},()=>c(this,null,function*(){let i=ye({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=yield Gn(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:a,body:i};return n.emulatorConfig&&Ce(n.emulatorConfig.host)&&(u.credentials="include"),He.fetch()(o,u)}));return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}})}function gr(n,t){return c(this,null,function*(){return we(n,"POST","/v2/accounts:revokeToken",et(n,t))})}var Ae=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){g(t.idToken,"internal-error"),g(typeof t.idToken<"u","internal-error"),g(typeof t.refreshToken<"u","internal-error");let e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):kn(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){g(t.length!==0,"internal-error");let e=kn(t);this.updateTokensAndExpiration(t,null,e)}getToken(t,e=!1){return c(this,null,function*(){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(g(this.refreshToken,t,"user-token-expired"),this.refreshToken?(yield this.refresh(t,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(t,e){return c(this,null,function*(){let{accessToken:i,refreshToken:r,expiresIn:s}=yield pr(t,e);this.updateTokensAndExpiration(i,r,Number(s))})}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,e){let{refreshToken:i,accessToken:r,expirationTime:s}=e,o=new n;return i&&(g(typeof i=="string","internal-error",{appName:t}),o.refreshToken=i),r&&(g(typeof r=="string","internal-error",{appName:t}),o.accessToken=r),s&&(g(typeof s=="number","internal-error",{appName:t}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return H("not implemented")}};function J(n,t){g(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}var Y=class n{constructor(s){var o=s,{uid:t,auth:e,stsTokenManager:i}=o,r=at(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new vt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=e,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Pe(r.createdAt||void 0,r.lastLoginAt||void 0)}getIdToken(t){return c(this,null,function*(){let e=yield ke(this,this.stsTokenManager.getToken(this.auth,t));return g(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e})}getIdTokenResult(t){return Bn(this,t)}reload(){return zn(this)}_assign(t){this!==t&&(g(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>f({},e)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){let e=new n(I(f({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){g(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(t,e=!1){return c(this,null,function*(){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&(yield Ke(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return c(this,null,function*(){if(C(this.auth.app))return Promise.reject(Q(this.auth));let t=yield this.getIdToken();return yield ke(this,lr(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return I(f({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>f({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){let i=e.displayName??void 0,r=e.email??void 0,s=e.phoneNumber??void 0,o=e.photoURL??void 0,a=e.tenantId??void 0,u=e._redirectEventId??void 0,d=e.createdAt??void 0,l=e.lastLoginAt??void 0,{uid:h,emailVerified:p,isAnonymous:_,providerData:O,stsTokenManager:T}=e;g(h&&T,t,"internal-error");let ee=Ae.fromJSON(this.name,T);g(typeof h=="string",t,"internal-error"),J(i,t.name),J(r,t.name),g(typeof p=="boolean",t,"internal-error"),g(typeof _=="boolean",t,"internal-error"),J(s,t.name),J(o,t.name),J(a,t.name),J(u,t.name),J(d,t.name),J(l,t.name);let G=new n({uid:h,auth:t,email:r,emailVerified:p,displayName:i,isAnonymous:_,photoURL:o,phoneNumber:s,tenantId:a,stsTokenManager:ee,createdAt:d,lastLoginAt:l});return O&&Array.isArray(O)&&(G.providerData=O.map(U=>f({},U))),u&&(G._redirectEventId=u),G}static _fromIdTokenResponse(t,e,i=!1){return c(this,null,function*(){let r=new Ae;r.updateFromServerResponse(e);let s=new n({uid:e.localId,auth:t,stsTokenManager:r,isAnonymous:i});return yield Ke(s),s})}static _fromGetAccountInfoResponse(t,e,i){return c(this,null,function*(){let r=e.users[0];g(r.localId!==void 0,"internal-error");let s=r.providerUserInfo!==void 0?Jn(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!s?.length,a=new Ae;a.updateFromIdToken(i);let u=new n({uid:r.localId,auth:t,stsTokenManager:a,isAnonymous:o}),d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Pe(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(u,d),u})}};var Pn=new Map;function $(n){Z(n instanceof Function,"Expected a class definition");let t=Pn.get(n);return t?(Z(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,Pn.set(n,t),t)}var mr=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return c(this,null,function*(){return!0})}_set(e,i){return c(this,null,function*(){this.storage[e]=i})}_get(e){return c(this,null,function*(){let i=this.storage[e];return i===void 0?null:i})}_remove(e){return c(this,null,function*(){delete this.storage[e]})}_addListener(e,i){}_removeListener(e,i){}}return n.type="NONE",n})(),wt=mr;function je(n,t,e){return`firebase:${n}:${t}:${e}`}var Ge=class n{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;let{config:r,name:s}=this.auth;this.fullUserKey=je(this.userKey,r.apiKey,s),this.fullPersistenceKey=je("persistence",r.apiKey,s),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}getCurrentUser(){return c(this,null,function*(){let t=yield this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){let e=yield $e(this.auth,{idToken:t}).catch(()=>{});return e?Y._fromGetAccountInfoResponse(this.auth,e,t):null}return Y._fromJSON(this.auth,t)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(t){return c(this,null,function*(){if(this.persistence===t)return;let e=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(t,e,i="authUser"){return c(this,null,function*(){if(!e.length)return new n($(wt),t,i);let r=(yield Promise.all(e.map(d=>c(this,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),s=r[0]||$(wt),o=je(i,t.config.apiKey,t.name),a=null;for(let d of e)try{let l=yield d._get(o);if(l){let h;if(typeof l=="string"){let p=yield $e(t,{idToken:l}).catch(()=>{});if(!p)break;h=yield Y._fromGetAccountInfoResponse(t,p,l)}else h=Y._fromJSON(t,l);d!==s&&(a=h),s=d;break}}catch{}let u=r.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,t,i):(s=u[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(e.map(d=>c(this,null,function*(){if(d!==s)try{yield d._remove(o)}catch{}}))),new n(s,t,i))})}};function Rn(n){let t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Zn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Yn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ti(t))return"Blackberry";if(ni(t))return"Webos";if(Qn(t))return"Safari";if((t.includes("chrome/")||Xn(t))&&!t.includes("edge/"))return"Chrome";if(ei(t))return"Android";{let e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(e);if(i?.length===2)return i[1]}return"Other"}function Yn(n=A()){return/firefox\//i.test(n)}function Qn(n=A()){let t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Xn(n=A()){return/crios\//i.test(n)}function Zn(n=A()){return/iemobile/i.test(n)}function ei(n=A()){return/android/i.test(n)}function ti(n=A()){return/blackberry/i.test(n)}function ni(n=A()){return/webos/i.test(n)}function Ft(n=A()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Ir(n=A()){return Ft(n)&&!!window.navigator?.standalone}function _r(){return hn()&&document.documentMode===10}function ii(n=A()){return Ft(n)||ei(n)||ni(n)||ti(n)||/windows phone/i.test(n)||Zn(n)}function ri(n,t=[]){let e;switch(n){case"Browser":e=Rn(A());break;case"Worker":e=`${Rn(A())}-${n}`;break;default:e=n}let i=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${Ie}/${i}`}var yt=class{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){let i=s=>new Promise((o,a)=>{try{let u=t(s);o(u)}catch(u){a(u)}});i.onAbort=e,this.queue.push(i);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(t){return c(this,null,function*(){if(this.auth.currentUser===t)return;let e=[];try{for(let i of this.queue)yield i(t),i.onAbort&&e.push(i.onAbort)}catch(i){e.reverse();for(let r of e)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function Sr(e){return c(this,arguments,function*(n,t={}){return we(n,"GET","/v2/passwordPolicy",et(n,t))})}var vr=6,Et=class{constructor(t){let e=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=e.minPasswordLength??vr,e.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=e.maxPasswordLength),e.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=e.containsLowercaseCharacter),e.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=e.containsUppercaseCharacter),e.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=e.containsNumericCharacter),e.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=e.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){let e={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,e),this.validatePasswordCharacterOptions(t,e),e.isValid&&(e.isValid=e.meetsMinPasswordLength??!0),e.isValid&&(e.isValid=e.meetsMaxPasswordLength??!0),e.isValid&&(e.isValid=e.containsLowercaseLetter??!0),e.isValid&&(e.isValid=e.containsUppercaseLetter??!0),e.isValid&&(e.isValid=e.containsNumericCharacter??!0),e.isValid&&(e.isValid=e.containsNonAlphanumericCharacter??!0),e}validatePasswordLengthOptions(t,e){let i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(e.meetsMinPasswordLength=t.length>=i),r&&(e.meetsMaxPasswordLength=t.length<=r)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let i;for(let r=0;r<t.length;r++)i=t.charAt(r),this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,e,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=s))}};var Tt=class{constructor(t,e,i,r){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Be(this),this.idTokenSubscription=new Be(this),this.beforeStateQueue=new yt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Wn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=$(e)),this._initializationPromise=this.queue(()=>c(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield Ge.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(e),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return c(this,null,function*(){if(this._deleted)return;let t=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(t,!0)}})}initializeCurrentUserFromIdToken(t){return c(this,null,function*(){try{let e=yield $e(this,{idToken:t}),i=yield Y._fromGetAccountInfoResponse(this,e,t);yield this.directlySetCurrentUser(i)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(t){return c(this,null,function*(){if(C(this.app)){let s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}let e=yield this.assertedPersistence.getCurrentUser(),i=e,r=!1;if(t&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let s=this.redirectUser?._redirectEventId,o=i?._redirectEventId,a=yield this.tryRedirectSignIn(t);(!s||s===o)&&a?.user&&(i=a.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{yield this.beforeStateQueue.runMiddleware(i)}catch(s){i=e,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return g(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(t){return c(this,null,function*(){let e=null;try{e=yield this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{yield this._setRedirectUser(null)}return e})}reloadAndSetCurrentUserOrClear(t){return c(this,null,function*(){try{yield Ke(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)})}useDeviceLanguage(){this.languageCode=ar()}_delete(){return c(this,null,function*(){this._deleted=!0})}updateCurrentUser(t){return c(this,null,function*(){if(C(this.app))return Promise.reject(Q(this));let e=t?N(t):null;return e&&g(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))})}_updateCurrentUser(t,e=!1){return c(this,null,function*(){if(!this._deleted)return t&&g(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||(yield this.beforeStateQueue.runMiddleware(t)),this.queue(()=>c(this,null,function*(){yield this.directlySetCurrentUser(t),this.notifyAuthListeners()}))})}signOut(){return c(this,null,function*(){return C(this.app)?Promise.reject(Q(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(t){return C(this.app)?Promise.reject(Q(this)):this.queue(()=>c(this,null,function*(){yield this.assertedPersistence.setPersistence($(t))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(t){return c(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return c(this,null,function*(){let t=yield Sr(this),e=new Et(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new B("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{let i=this.onAuthStateChanged(()=>{i(),t()},e)}})}revokeAccessToken(t){return c(this,null,function*(){if(this.currentUser){let e=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(i.tenantId=this.tenantId),yield gr(this,i)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(t,e){return c(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(e);return t===null?i.removeCurrentUser():i.setCurrentUser(t)})}getOrInitRedirectPersistenceManager(t){return c(this,null,function*(){if(!this.redirectPersistenceManager){let e=t&&$(t)||this._popupRedirectResolver;g(e,this,"argument-error"),this.redirectPersistenceManager=yield Ge.create(this,[$(e._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(t){return c(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>c(this,null,function*(){}))),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null})}_persistUserIfCurrent(t){return c(this,null,function*(){if(t===this.currentUser)return this.queue(()=>c(this,null,function*(){return this.directlySetCurrentUser(t)}))})}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,r){if(this._deleted)return()=>{};let s=typeof e=="function"?e:e.next.bind(e),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(g(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof e=="function"){let u=t.addObserver(e,i,r);return()=>{o=!0,u()}}else{let u=t.addObserver(e);return()=>{o=!0,u()}}}directlySetCurrentUser(t){return c(this,null,function*(){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?yield this.assertedPersistence.setCurrentUser(t):yield this.assertedPersistence.removeCurrentUser()})}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return g(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=ri(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return c(this,null,function*(){let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let e=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();e&&(t["X-Firebase-Client"]=e);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return c(this,null,function*(){if(C(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return t?.error&&rr(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function tt(n){return N(n)}var Be=class{constructor(t){this.auth=t,this.observer=null,this.addObserver=In(e=>this.observer=e)}get next(){return g(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var xt={loadJS(){return c(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function wr(n){xt=n}function yr(n){return xt.loadJS(n)}function Er(){return xt.gapiScript}function si(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function oi(n,t){let e=z(n,"auth");if(e.isInitialized()){let r=e.getImmediate(),s=e.getOptions();if(Oe(s,t??{}))return r;X(r,"already-initialized")}return e.initialize({options:t})}function Tr(n,t){let e=t?.persistence||[],i=(Array.isArray(e)?e:[e]).map($);t?.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(i,t?.popupRedirectResolver)}function ai(n,t,e){let i=tt(n);g(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=!!e?.disableWarnings,s=ci(t),{host:o,port:a}=br(t),u=a===null?"":`:${a}`,d={url:`${s}//${o}${u}/`},l=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){g(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),g(Oe(d,i.config.emulator)&&Oe(l,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=d,i.emulatorConfig=l,i.settings.appVerificationDisabledForTesting=!0,Ce(o)?(on(`${s}//${o}${u}`),an("Auth",!0)):r||Ar()}function ci(n){let t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function br(n){let t=ci(n),e=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!e)return{host:"",port:null};let i=e[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let s=r[1];return{host:s,port:Nn(i.substr(s.length+1))}}else{let[s,o]=i.split(":");return{host:s,port:Nn(o)}}}function Nn(n){if(!n)return null;let t=Number(n);return isNaN(t)?null:t}function Ar(){function n(){let t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var ze=class{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return H("not implemented")}_getIdTokenResponse(t){return H("not implemented")}_linkToIdToken(t,e){return H("not implemented")}_getReauthenticationResolver(t){return H("not implemented")}};function mt(n,t){return c(this,null,function*(){return Kn(n,"POST","/v1/accounts:signInWithIdp",et(n,t))})}var Je=class{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}};var bt=class extends Je{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}};function kr(n,t){return c(this,null,function*(){return Kn(n,"POST","/v1/accounts:signUp",et(n,t))})}var ae=class n{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static _fromIdTokenResponse(t,e,i,r=!1){return c(this,null,function*(){let s=yield Y._fromIdTokenResponse(t,i,r),o=Cn(i);return new n({user:s,providerId:o,_tokenResponse:i,operationType:e})})}static _forOperation(t,e,i){return c(this,null,function*(){yield t._updateTokensIfNecessary(i,!0);let r=Cn(i);return new n({user:t,providerId:r,_tokenResponse:i,operationType:e})})}};function Cn(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}function jt(n){return c(this,null,function*(){if(C(n.app))return Promise.reject(Q(n));let t=tt(n);if(yield t._initializationPromise,t.currentUser?.isAnonymous)return new ae({user:t.currentUser,providerId:null,operationType:"signIn"});let e=yield kr(t,{returnSecureToken:!0}),i=yield ae._fromIdTokenResponse(t,"signIn",e,!0);return yield t._updateCurrentUser(i.user),i})}var At=class n extends me{constructor(t,e,i,r){super(e.code,e.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,n.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:e.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(t,e,i,r){return new n(t,e,i,r)}};function ui(n,t,e,i){return(t==="reauthenticate"?e._getReauthenticationResolver(n):e._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?At._fromErrorAndOperation(n,s,t,i):s})}function Pr(n,t,e=!1){return c(this,null,function*(){let i=yield ke(n,t._linkToIdToken(n.auth,yield n.getIdToken()),e);return ae._forOperation(n,"link",i)})}function Rr(n,t,e=!1){return c(this,null,function*(){let{auth:i}=n;if(C(i.app))return Promise.reject(Q(i));let r="reauthenticate";try{let s=yield ke(n,ui(i,r,t,n),e);g(s.idToken,i,"internal-error");let o=Ut(s.idToken);g(o,i,"internal-error");let{sub:a}=o;return g(n.uid===a,i,"user-mismatch"),ae._forOperation(n,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&X(i,"user-mismatch"),s}})}function Nr(n,t,e=!1){return c(this,null,function*(){if(C(n.app))return Promise.reject(Q(n));let i="signIn",r=yield ui(n,i,t),s=yield ae._fromIdTokenResponse(n,i,r);return e||(yield n._updateCurrentUser(s.user)),s})}function di(n,t,e,i){return N(n).onIdTokenChanged(t,e,i)}function li(n,t,e){return N(n).beforeAuthStateChanged(t,e)}var Ye="__sak";var Qe=class{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Ye,"1"),this.storage.removeItem(Ye),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){let e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}};var Cr=1e3,Or=10,Dr=(()=>{class n extends Qe{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ii(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let i of Object.keys(this.listeners)){let r=this.storage.getItem(i),s=this.localCache[i];r!==s&&e(i,s,r)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((a,u,d)=>{this.notifyListeners(a,d)});return}let r=e.key;i?this.detachListener():this.stopPolling();let s=()=>{let a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);_r()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Or):s()}notifyListeners(e,i){this.localCache[e]=i;let r=this.listeners[e];if(r)for(let s of Array.from(r))s(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:r}),!0)})},Cr)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(e,i){return c(this,null,function*(){yield ne(n.prototype,this,"_set").call(this,e,i),this.localCache[e]=JSON.stringify(i)})}_get(e){return c(this,null,function*(){let i=yield ne(n.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(i),i})}_remove(e){return c(this,null,function*(){yield ne(n.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}return n.type="LOCAL",n})(),hi=Dr;var Lr=(()=>{class n extends Qe{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}return n.type="SESSION",n})(),Vt=Lr;function Mr(n){return Promise.all(n.map(t=>c(this,null,function*(){try{return{fulfilled:!0,value:yield t}}catch(e){return{fulfilled:!1,reason:e}}})))}var Ur=(()=>{class n{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let i=this.receivers.find(s=>s.isListeningto(e));if(i)return i;let r=new n(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}handleEvent(e){return c(this,null,function*(){let i=e,{eventId:r,eventType:s,data:o}=i.data,a=this.handlersMap[s];if(!a?.size)return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:s});let u=Array.from(a).map(l=>c(this,null,function*(){return l(i.origin,o)})),d=yield Mr(u);i.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:d})})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function fi(n="",t=10){let e="";for(let i=0;i<t;i++)e+=Math.floor(Math.random()*10);return n+e}var kt=class{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}_send(t,e,i=50){return c(this,null,function*(){let r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,u)=>{let d=fi("",20);r.port1.start();let l=setTimeout(()=>{u(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(h){let p=h;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(l),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(p.data.response);break;default:clearTimeout(l),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:d,data:e},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function M(){return window}function Fr(n){M().location.href=n}function pi(){return typeof M().WorkerGlobalScope<"u"&&typeof M().importScripts=="function"}function xr(){return c(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function jr(){return navigator?.serviceWorker?.controller||null}function Vr(){return pi()?self:null}var gi="firebaseLocalStorageDb",qr=1,Xe="firebaseLocalStorage",mi="fbase_key",ce=class{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}};function nt(n,t){return n.transaction([Xe],t?"readwrite":"readonly").objectStore(Xe)}function Wr(){let n=indexedDB.deleteDatabase(gi);return new ce(n).toPromise()}function Pt(){let n=indexedDB.open(gi,qr);return new Promise((t,e)=>{n.addEventListener("error",()=>{e(n.error)}),n.addEventListener("upgradeneeded",()=>{let i=n.result;try{i.createObjectStore(Xe,{keyPath:mi})}catch(r){e(r)}}),n.addEventListener("success",()=>c(this,null,function*(){let i=n.result;i.objectStoreNames.contains(Xe)?t(i):(i.close(),yield Wr(),t(yield Pt()))}))})}function On(n,t,e){return c(this,null,function*(){let i=nt(n,!0).put({[mi]:t,value:e});return new ce(i).toPromise()})}function Hr(n,t){return c(this,null,function*(){let e=nt(n,!1).get(t),i=yield new ce(e).toPromise();return i===void 0?null:i.value})}function Dn(n,t){let e=nt(n,!0).delete(t);return new ce(e).toPromise()}var $r=800,Kr=3,Gr=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return c(this,null,function*(){return this.db?this.db:(this.db=yield Pt(),this.db)})}_withRetries(e){return c(this,null,function*(){let i=0;for(;;)try{let r=yield this._openDb();return yield e(r)}catch(r){if(i++>Kr)throw r;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return c(this,null,function*(){return pi()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return c(this,null,function*(){this.receiver=Ur._getInstance(Vr()),this.receiver._subscribe("keyChanged",(e,i)=>c(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(i.key)}})),this.receiver._subscribe("ping",(e,i)=>c(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return c(this,null,function*(){if(this.activeServiceWorker=yield xr(),!this.activeServiceWorker)return;this.sender=new kt(this.activeServiceWorker);let e=yield this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return c(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||jr()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return c(this,null,function*(){try{if(!indexedDB)return!1;let e=yield Pt();return yield On(e,Ye,"1"),yield Dn(e,Ye),!0}catch{}return!1})}_withPendingWrite(e){return c(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,i){return c(this,null,function*(){return this._withPendingWrite(()=>c(this,null,function*(){return yield this._withRetries(r=>On(r,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)}))})}_get(e){return c(this,null,function*(){let i=yield this._withRetries(r=>Hr(r,e));return this.localCache[e]=i,i})}_remove(e){return c(this,null,function*(){return this._withPendingWrite(()=>c(this,null,function*(){return yield this._withRetries(i=>Dn(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return c(this,null,function*(){let e=yield this._withRetries(s=>{let o=nt(s,!1).getAll();return new ce(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];let i=[],r=new Set;if(e.length!==0)for(let{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),i.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),i.push(s));return i})}notifyListeners(e,i){this.localCache[e]=i;let r=this.listeners[e];if(r)for(let s of Array.from(r))s(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>c(this,null,function*(){return this._poll()}),$r)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Ii=Gr;var Sa=si("rcb"),va=new oe(3e4,6e4);function Br(n,t){return t?$(t):(g(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Re=class extends ze{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return mt(t,this._buildIdpRequest())}_linkToIdToken(t,e){return mt(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return mt(t,this._buildIdpRequest())}_buildIdpRequest(t){let e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}};function zr(n){return Nr(n.auth,new Re(n),n.bypassAuthState)}function Jr(n){let{auth:t,user:e}=n;return g(e,t,"internal-error"),Rr(e,new Re(n),n.bypassAuthState)}function Yr(n){return c(this,null,function*(){let{auth:t,user:e}=n;return g(e,t,"internal-error"),Pr(e,new Re(n),n.bypassAuthState)})}var Rt=class{constructor(t,e,i,r,s=!1){this.auth=t,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((t,e)=>c(this,null,function*(){this.pendingPromise={resolve:t,reject:e};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}}))}onAuthEvent(t){return c(this,null,function*(){let{urlResponse:e,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=t;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:e,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(u))}catch(d){this.reject(d)}})}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return zr;case"linkViaPopup":case"linkViaRedirect":return Yr;case"reauthViaPopup":case"reauthViaRedirect":return Jr;default:X(this.auth,"internal-error")}}resolve(t){Z(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Z(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var wa=new oe(2e3,1e4);var Qr="pendingRedirect",Ve=new Map,Nt=class n extends Rt{constructor(t,e,i=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,i),this.eventId=null}execute(){return c(this,null,function*(){let t=Ve.get(this.auth._key());if(!t){try{let i=(yield Xr(this.resolver,this.auth))?yield ne(n.prototype,this,"execute").call(this):null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}Ve.set(this.auth._key(),t)}return this.bypassAuthState||Ve.set(this.auth._key(),()=>Promise.resolve(null)),t()})}onAuthEvent(t){return c(this,null,function*(){if(t.type==="signInViaRedirect")return ne(n.prototype,this,"onAuthEvent").call(this,t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){let e=yield this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,ne(n.prototype,this,"onAuthEvent").call(this,t);this.resolve(null)}})}onExecution(){return c(this,null,function*(){})}cleanUp(){}};function Xr(n,t){return c(this,null,function*(){let e=ts(t),i=es(n);if(!(yield i._isAvailable()))return!1;let r=(yield i._get(e))==="true";return yield i._remove(e),r})}function Zr(n,t){Ve.set(n._key(),t)}function es(n){return $(n._redirectPersistence)}function ts(n){return je(Qr,n.config.apiKey,n.name)}function ns(n,t,e=!1){return c(this,null,function*(){if(C(n.app))return Promise.reject(Q(n));let i=tt(n),r=Br(i,t),o=yield new Nt(i,r,e).execute();return o&&!e&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,t)),o})}var is=10*60*1e3,Ct=class{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(t,i)&&(e=!0,this.sendToConsumer(t,i),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!rs(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){if(t.error&&!_i(t)){let i=t.error.code?.split("auth/")[1]||"internal-error";e.onError(se(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){let i=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=is&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ln(t))}saveEventToCache(t){this.cachedEventUids.add(Ln(t)),this.lastProcessedEventTime=Date.now()}};function Ln(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function _i({type:n,error:t}){return n==="unknown"&&t?.code==="auth/no-auth-event"}function rs(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _i(n);default:return!1}}function ss(e){return c(this,arguments,function*(n,t={}){return we(n,"GET","/v1/projects",t)})}var os=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,as=/^https?/;function cs(n){return c(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:t}=yield ss(n);for(let e of t)try{if(us(e))return}catch{}X(n,"unauthorized-domain")})}function us(n){let t=_t(),{protocol:e,hostname:i}=new URL(t);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&i===""?e==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&o.hostname===i}if(!as.test(e))return!1;if(os.test(n))return i===n;let r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}var ds=new oe(3e4,6e4);function Mn(){let n=M().___jsl;if(n?.H){for(let t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let e=0;e<n.CP.length;e++)n.CP[e]=null}}function ls(n){return new Promise((t,e)=>{function i(){Mn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Mn(),e(se(n,"network-request-failed"))},timeout:ds.get()})}if(M().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(M().gapi?.load)i();else{let r=si("iframefcb");return M()[r]=()=>{gapi.load?i():e(se(n,"network-request-failed"))},yr(`${Er()}?onload=${r}`).catch(s=>e(s))}}).catch(t=>{throw qe=null,t})}var qe=null;function hs(n){return qe=qe||ls(n),qe}var fs=new oe(5e3,15e3),ps="__/auth/iframe",gs="emulator/auth/iframe",ms={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Is=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _s(n){let t=n.config;g(t.authDomain,n,"auth-domain-config-required");let e=t.emulator?Mt(t,gs):`https://${n.config.authDomain}/${ps}`,i={apiKey:t.apiKey,appName:n.name,v:Ie},r=Is.get(n.config.apiHost);r&&(i.eid=r);let s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${e}?${ye(i).slice(1)}`}function Ss(n){return c(this,null,function*(){let t=yield hs(n),e=M().gapi;return g(e,n,"internal-error"),t.open({where:document.body,url:_s(n),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ms,dontclear:!0},i=>new Promise((r,s)=>c(this,null,function*(){yield i.restyle({setHideOnLeave:!1});let o=se(n,"network-request-failed"),a=M().setTimeout(()=>{s(o)},fs.get());function u(){M().clearTimeout(a),r(i)}i.ping(u).then(u,()=>{s(o)})})))})}var vs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ws=500,ys=600,Es="_blank",Ts="http://localhost",Ze=class{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function bs(n,t,e,i=ws,r=ys){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",u=I(f({},vs),{width:i.toString(),height:r.toString(),top:s,left:o}),d=A().toLowerCase();e&&(a=Xn(d)?Es:e),Yn(d)&&(t=t||Ts,u.scrollbars="yes");let l=Object.entries(u).reduce((p,[_,O])=>`${p}${_}=${O},`,"");if(Ir(d)&&a!=="_self")return As(t||"",a),new Ze(null);let h=window.open(t||"",a,l);g(h,n,"popup-blocked");try{h.focus()}catch{}return new Ze(h)}function As(n,t){let e=document.createElement("a");e.href=n,e.target=t;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(i)}var ks="__/auth/handler",Ps="emulator/auth/handler",Rs=encodeURIComponent("fac");function Un(n,t,e,i,r,s){return c(this,null,function*(){g(n.config.authDomain,n,"auth-domain-config-required"),g(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:e,redirectUrl:i,v:Ie,eventId:r};if(t instanceof Je){t.setDefaultLanguage(n.languageCode),o.providerId=t.providerId||"",mn(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(let[l,h]of Object.entries(s||{}))o[l]=h}if(t instanceof bt){let l=t.getScopes().filter(h=>h!=="");l.length>0&&(o.scopes=l.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let l of Object.keys(a))a[l]===void 0&&delete a[l];let u=yield n._getAppCheckToken(),d=u?`#${Rs}=${encodeURIComponent(u)}`:"";return`${Ns(n)}?${ye(a).slice(1)}${d}`})}function Ns({config:n}){return n.emulator?Mt(n,Ps):`https://${n.authDomain}/${ks}`}var It="webStorageSupport",Ot=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Vt,this._completeRedirectFn=ns,this._overrideRedirectResult=Zr}_openPopup(t,e,i,r){return c(this,null,function*(){Z(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()");let s=yield Un(t,e,i,_t(),r);return bs(t,s,fi())})}_openRedirect(t,e,i,r){return c(this,null,function*(){yield this._originValidation(t);let s=yield Un(t,e,i,_t(),r);return Fr(s),new Promise(()=>{})})}_initialize(t){let e=t._key();if(this.eventManagers[e]){let{manager:r,promise:s}=this.eventManagers[e];return r?Promise.resolve(r):(Z(s,"If manager is not set, promise should be"),s)}let i=this.initAndGetManager(t);return this.eventManagers[e]={promise:i},i.catch(()=>{delete this.eventManagers[e]}),i}initAndGetManager(t){return c(this,null,function*(){let e=yield Ss(t),i=new Ct(t);return e.register("authEvent",r=>(g(r?.authEvent,t,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:i},this.iframes[t._key()]=e,i})}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(It,{type:It},r=>{let s=r?.[0]?.[It];s!==void 0&&e(!!s),X(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){let e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=cs(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return ii()||Qn()||Ft()}},Si=Ot;var Fn="@firebase/auth",xn="1.11.1";var Dt=class{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(t){return c(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(t)}:null})}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;let e=this.auth.onIdTokenChanged(i=>{t(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();let e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){g(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Cs(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Os(n){q(new V("auth",(t,{options:e})=>{let i=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;g(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let u={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ri(n)},d=new Tt(i,r,s,u);return Tr(d,e),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,i)=>{t.getProvider("auth-internal").initialize()})),q(new V("auth-internal",t=>{let e=tt(t.getProvider("auth").getImmediate());return(i=>new Dt(i))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),W(Fn,xn,Cs(n)),W(Fn,xn,"esm2020")}var Ds=5*60,Ls=lt("authIdTokenMaxAge")||Ds,jn=null,Ms=n=>t=>c(void 0,null,function*(){let e=t&&(yield t.getIdTokenResult()),i=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(i&&i>Ls)return;let r=e?.token;jn!==r&&(jn=r,yield fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});function qt(n=Te()){let t=z(n,"auth");if(t.isInitialized())return t.getImmediate();let e=oi(n,{popupRedirectResolver:Si,persistence:[Ii,hi,Vt]}),i=lt("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(i,location.origin);if(location.origin===s.origin){let o=Ms(s.toString());li(e,o,()=>o(e.currentUser)),di(e,a=>o(a))}}let r=sn("auth");return r&&ai(e,`http://${r}`),e}function Us(){return document.getElementsByTagName("head")?.[0]??document}wr({loadJS(n){return new Promise((t,e)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=t,i.onerror=r=>{let s=se("internal-error");s.customData=r,e(s)},i.type="text/javascript",i.charset="UTF-8",Us().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Os("Browser");var wi=(()=>{class n{constructor(){this.maintenanceModeSubject=new P(!1),this.isMaintenanceMode$=this.maintenanceModeSubject.asObservable(),this.maintenanceMessageSubject=new P("System is currently undergoing maintenance. Please try again later."),this.maintenanceMessage$=this.maintenanceMessageSubject.asObservable()}setMaintenanceMode(e,i){i&&this.maintenanceMessageSubject.next(i),this.maintenanceModeSubject.next(e),e&&console.warn("Maintenance Mode Activated:",i||"No message")}isMaintenanceMode(){return this.maintenanceModeSubject.value}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ti="@firebase/installations",Kt="0.6.19";var bi=1e4,Ai=`w:${Kt}`,ki="FIS_v2",xs="https://firebaseinstallations.googleapis.com/v1",js=60*60*1e3,Vs="installations",qs="Installations";var Ws={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},de=new B(Vs,qs,Ws);function Pi(n){return n instanceof me&&n.code.includes("request-failed")}function Ri({projectId:n}){return`${xs}/projects/${n}/installations`}function Ni(n){return{token:n.token,requestStatus:2,expiresIn:$s(n.expiresIn),creationTime:Date.now()}}function Ci(n,t){return c(this,null,function*(){let i=(yield t.json()).error;return de.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})})}function Oi({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Hs(n,{refreshToken:t}){let e=Oi(n);return e.append("Authorization",Ks(t)),e}function Di(n){return c(this,null,function*(){let t=yield n();return t.status>=500&&t.status<600?n():t})}function $s(n){return Number(n.replace("s","000"))}function Ks(n){return`${ki} ${n}`}function Gs(i,r){return c(this,arguments,function*({appConfig:n,heartbeatServiceProvider:t},{fid:e}){let s=Ri(n),o=Oi(n),a=t.getImmediate({optional:!0});if(a){let h=yield a.getHeartbeatsHeader();h&&o.append("x-firebase-client",h)}let u={fid:e,authVersion:ki,appId:n.appId,sdkVersion:Ai},d={method:"POST",headers:o,body:JSON.stringify(u)},l=yield Di(()=>fetch(s,d));if(l.ok){let h=yield l.json();return{fid:h.fid||e,registrationStatus:2,refreshToken:h.refreshToken,authToken:Ni(h.authToken)}}else throw yield Ci("Create Installation",l)})}function Li(n){return new Promise(t=>{setTimeout(t,n)})}function Bs(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}var zs=/^[cdef][\w-]{21}$/,$t="";function Js(){try{let n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;let e=Ys(n);return zs.test(e)?e:$t}catch{return $t}}function Ys(n){return Bs(n).substr(0,22)}function rt(n){return`${n.appName}!${n.appId}`}var Mi=new Map;function Ui(n,t){let e=rt(n);Fi(e,t),Qs(e,t)}function Fi(n,t){let e=Mi.get(n);if(e)for(let i of e)i(t)}function Qs(n,t){let e=Xs();e&&e.postMessage({key:n,fid:t}),Zs()}var ue=null;function Xs(){return!ue&&"BroadcastChannel"in self&&(ue=new BroadcastChannel("[Firebase] FID Change"),ue.onmessage=n=>{Fi(n.data.key,n.data.fid)}),ue}function Zs(){Mi.size===0&&ue&&(ue.close(),ue=null)}var eo="firebase-installations-database",to=1,le="firebase-installations-store",Wt=null;function Gt(){return Wt||(Wt=Ee(eo,to,{upgrade:(n,t)=>{switch(t){case 0:n.createObjectStore(le)}}})),Wt}function it(n,t){return c(this,null,function*(){let e=rt(n),r=(yield Gt()).transaction(le,"readwrite"),s=r.objectStore(le),o=yield s.get(e);return yield s.put(t,e),yield r.done,(!o||o.fid!==t.fid)&&Ui(n,t.fid),t})}function xi(n){return c(this,null,function*(){let t=rt(n),i=(yield Gt()).transaction(le,"readwrite");yield i.objectStore(le).delete(t),yield i.done})}function st(n,t){return c(this,null,function*(){let e=rt(n),r=(yield Gt()).transaction(le,"readwrite"),s=r.objectStore(le),o=yield s.get(e),a=t(o);return a===void 0?yield s.delete(e):yield s.put(a,e),yield r.done,a&&(!o||o.fid!==a.fid)&&Ui(n,a.fid),a})}function Bt(n){return c(this,null,function*(){let t,e=yield st(n.appConfig,i=>{let r=no(i),s=io(n,r);return t=s.registrationPromise,s.installationEntry});return e.fid===$t?{installationEntry:yield t}:{installationEntry:e,registrationPromise:t}})}function no(n){let t=n||{fid:Js(),registrationStatus:0};return ji(t)}function io(n,t){if(t.registrationStatus===0){if(!navigator.onLine){let r=Promise.reject(de.create("app-offline"));return{installationEntry:t,registrationPromise:r}}let e={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=ro(n,e);return{installationEntry:e,registrationPromise:i}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:so(n)}:{installationEntry:t}}function ro(n,t){return c(this,null,function*(){try{let e=yield Gs(n,t);return it(n.appConfig,e)}catch(e){throw Pi(e)&&e.customData.serverCode===409?yield xi(n.appConfig):yield it(n.appConfig,{fid:t.fid,registrationStatus:0}),e}})}function so(n){return c(this,null,function*(){let t=yield yi(n.appConfig);for(;t.registrationStatus===1;)yield Li(100),t=yield yi(n.appConfig);if(t.registrationStatus===0){let{installationEntry:e,registrationPromise:i}=yield Bt(n);return i||e}return t})}function yi(n){return st(n,t=>{if(!t)throw de.create("installation-not-found");return ji(t)})}function ji(n){return oo(n)?{fid:n.fid,registrationStatus:0}:n}function oo(n){return n.registrationStatus===1&&n.registrationTime+bi<Date.now()}function ao(i,r){return c(this,arguments,function*({appConfig:n,heartbeatServiceProvider:t},e){let s=co(n,e),o=Hs(n,e),a=t.getImmediate({optional:!0});if(a){let h=yield a.getHeartbeatsHeader();h&&o.append("x-firebase-client",h)}let u={installation:{sdkVersion:Ai,appId:n.appId}},d={method:"POST",headers:o,body:JSON.stringify(u)},l=yield Di(()=>fetch(s,d));if(l.ok){let h=yield l.json();return Ni(h)}else throw yield Ci("Generate Auth Token",l)})}function co(n,{fid:t}){return`${Ri(n)}/${t}/authTokens:generate`}function zt(n,t=!1){return c(this,null,function*(){let e,i=yield st(n.appConfig,s=>{if(!Vi(s))throw de.create("not-registered");let o=s.authToken;if(!t&&ho(o))return s;if(o.requestStatus===1)return e=uo(n,t),s;{if(!navigator.onLine)throw de.create("app-offline");let a=po(s);return e=lo(n,a),a}});return e?yield e:i.authToken})}function uo(n,t){return c(this,null,function*(){let e=yield Ei(n.appConfig);for(;e.authToken.requestStatus===1;)yield Li(100),e=yield Ei(n.appConfig);let i=e.authToken;return i.requestStatus===0?zt(n,t):i})}function Ei(n){return st(n,t=>{if(!Vi(t))throw de.create("not-registered");let e=t.authToken;return go(e)?I(f({},t),{authToken:{requestStatus:0}}):t})}function lo(n,t){return c(this,null,function*(){try{let e=yield ao(n,t),i=I(f({},t),{authToken:e});return yield it(n.appConfig,i),e}catch(e){if(Pi(e)&&(e.customData.serverCode===401||e.customData.serverCode===404))yield xi(n.appConfig);else{let i=I(f({},t),{authToken:{requestStatus:0}});yield it(n.appConfig,i)}throw e}})}function Vi(n){return n!==void 0&&n.registrationStatus===2}function ho(n){return n.requestStatus===2&&!fo(n)}function fo(n){let t=Date.now();return t<n.creationTime||n.creationTime+n.expiresIn<t+js}function po(n){let t={requestStatus:1,requestTime:Date.now()};return I(f({},n),{authToken:t})}function go(n){return n.requestStatus===1&&n.requestTime+bi<Date.now()}function mo(n){return c(this,null,function*(){let t=n,{installationEntry:e,registrationPromise:i}=yield Bt(t);return i?i.catch(console.error):zt(t).catch(console.error),e.fid})}function Io(n,t=!1){return c(this,null,function*(){let e=n;return yield _o(e),(yield zt(e,t)).token})}function _o(n){return c(this,null,function*(){let{registrationPromise:t}=yield Bt(n);t&&(yield t)})}function So(n){if(!n||!n.options)throw Ht("App Configuration");if(!n.name)throw Ht("App Name");let t=["projectId","apiKey","appId"];for(let e of t)if(!n.options[e])throw Ht(e);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Ht(n){return de.create("missing-app-config-values",{valueName:n})}var qi="installations",vo="installations-internal",wo=n=>{let t=n.getProvider("app").getImmediate(),e=So(t),i=z(t,"heartbeat");return{app:t,appConfig:e,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},yo=n=>{let t=n.getProvider("app").getImmediate(),e=z(t,qi).getImmediate();return{getId:()=>mo(e),getToken:r=>Io(e,r)}};function Eo(){q(new V(qi,wo,"PUBLIC")),q(new V(vo,yo,"PRIVATE"))}Eo();W(Ti,Kt);W(Ti,Kt,"esm2020");var To="/firebase-messaging-sw.js",bo="/firebase-cloud-messaging-push-scope",zi="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Ao="https://fcmregistrations.googleapis.com/v1",Ji="google.c.a.c_id",ko="google.c.a.c_l",Po="google.c.a.ts",Ro="google.c.a.e",Wi=1e4;var ot=function(n){return n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked",n}(ot||{});function K(n){let t=new Uint8Array(n);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function No(n){let t="=".repeat((4-n.length%4)%4),e=(n+t).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(e),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}var Jt="fcm_token_details_db",Co=5,Hi="fcm_token_object_Store";function Oo(n){return c(this,null,function*(){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(s=>s.name).includes(Jt))return null;let t=null;return(yield Ee(Jt,Co,{upgrade:(i,r,s,o)=>c(this,null,function*(){if(r<2||!i.objectStoreNames.contains(Hi))return;let a=o.objectStore(Hi),u=yield a.index("fcmSenderId").get(n);if(yield a.clear(),!!u){if(r===2){let d=u;if(!d.auth||!d.p256dh||!d.endpoint)return;t={token:d.fcmToken,createTime:d.createTime??Date.now(),subscriptionOptions:{auth:d.auth,p256dh:d.p256dh,endpoint:d.endpoint,swScope:d.swScope,vapidKey:typeof d.vapidKey=="string"?d.vapidKey:K(d.vapidKey)}}}else if(r===3){let d=u;t={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:K(d.auth),p256dh:K(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:K(d.vapidKey)}}}else if(r===4){let d=u;t={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:K(d.auth),p256dh:K(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:K(d.vapidKey)}}}}})})).close(),yield De(Jt),yield De("fcm_vapid_details_db"),yield De("undefined"),Do(t)?t:null})}function Do(n){if(!n||!n.subscriptionOptions)return!1;let{subscriptionOptions:t}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof t.auth=="string"&&t.auth.length>0&&typeof t.p256dh=="string"&&t.p256dh.length>0&&typeof t.endpoint=="string"&&t.endpoint.length>0&&typeof t.swScope=="string"&&t.swScope.length>0&&typeof t.vapidKey=="string"&&t.vapidKey.length>0}var Lo="firebase-messaging-database",Mo=1,Ne="firebase-messaging-store",Yt=null;function Yi(){return Yt||(Yt=Ee(Lo,Mo,{upgrade:(n,t)=>{switch(t){case 0:n.createObjectStore(Ne)}}})),Yt}function Uo(n){return c(this,null,function*(){let t=Qi(n),i=yield(yield Yi()).transaction(Ne).objectStore(Ne).get(t);if(i)return i;{let r=yield Oo(n.appConfig.senderId);if(r)return yield Zt(n,r),r}})}function Zt(n,t){return c(this,null,function*(){let e=Qi(n),r=(yield Yi()).transaction(Ne,"readwrite");return yield r.objectStore(Ne).put(t,e),yield r.done,t})}function Qi({appConfig:n}){return n.appId}var Fo={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},E=new B("messaging","Messaging",Fo);function xo(n,t){return c(this,null,function*(){let e=yield tn(n),i=Xi(t),r={method:"POST",headers:e,body:JSON.stringify(i)},s;try{s=yield(yield fetch(en(n.appConfig),r)).json()}catch(o){throw E.create("token-subscribe-failed",{errorInfo:o?.toString()})}if(s.error){let o=s.error.message;throw E.create("token-subscribe-failed",{errorInfo:o})}if(!s.token)throw E.create("token-subscribe-no-token");return s.token})}function jo(n,t){return c(this,null,function*(){let e=yield tn(n),i=Xi(t.subscriptionOptions),r={method:"PATCH",headers:e,body:JSON.stringify(i)},s;try{s=yield(yield fetch(`${en(n.appConfig)}/${t.token}`,r)).json()}catch(o){throw E.create("token-update-failed",{errorInfo:o?.toString()})}if(s.error){let o=s.error.message;throw E.create("token-update-failed",{errorInfo:o})}if(!s.token)throw E.create("token-update-no-token");return s.token})}function Vo(n,t){return c(this,null,function*(){let i={method:"DELETE",headers:yield tn(n)};try{let s=yield(yield fetch(`${en(n.appConfig)}/${t}`,i)).json();if(s.error){let o=s.error.message;throw E.create("token-unsubscribe-failed",{errorInfo:o})}}catch(r){throw E.create("token-unsubscribe-failed",{errorInfo:r?.toString()})}})}function en({projectId:n}){return`${Ao}/projects/${n}/registrations`}function tn(e){return c(this,arguments,function*({appConfig:n,installations:t}){let i=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${i}`})})}function Xi({p256dh:n,auth:t,endpoint:e,vapidKey:i}){let r={web:{endpoint:e,auth:t,p256dh:n}};return i!==zi&&(r.web.applicationPubKey=i),r}var qo=7*24*60*60*1e3;function Wo(n){return c(this,null,function*(){let t=yield $o(n.swRegistration,n.vapidKey),e={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:t.endpoint,auth:K(t.getKey("auth")),p256dh:K(t.getKey("p256dh"))},i=yield Uo(n.firebaseDependencies);if(i){if(Ko(i.subscriptionOptions,e))return Date.now()>=i.createTime+qo?Ho(n,{token:i.token,createTime:Date.now(),subscriptionOptions:e}):i.token;try{yield Vo(n.firebaseDependencies,i.token)}catch(r){console.warn(r)}return $i(n.firebaseDependencies,e)}else return $i(n.firebaseDependencies,e)})}function Ho(n,t){return c(this,null,function*(){try{let e=yield jo(n.firebaseDependencies,t),i=I(f({},t),{token:e,createTime:Date.now()});return yield Zt(n.firebaseDependencies,i),e}catch(e){throw e}})}function $i(n,t){return c(this,null,function*(){let i={token:yield xo(n,t),createTime:Date.now(),subscriptionOptions:t};return yield Zt(n,i),i.token})}function $o(n,t){return c(this,null,function*(){let e=yield n.pushManager.getSubscription();return e||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:No(t)})})}function Ko(n,t){let e=t.vapidKey===n.vapidKey,i=t.endpoint===n.endpoint,r=t.auth===n.auth,s=t.p256dh===n.p256dh;return e&&i&&r&&s}function Ki(n){let t={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return Go(t,n),Bo(t,n),zo(t,n),t}function Go(n,t){if(!t.notification)return;n.notification={};let e=t.notification.title;e&&(n.notification.title=e);let i=t.notification.body;i&&(n.notification.body=i);let r=t.notification.image;r&&(n.notification.image=r);let s=t.notification.icon;s&&(n.notification.icon=s)}function Bo(n,t){t.data&&(n.data=t.data)}function zo(n,t){if(!t.fcmOptions&&!t.notification?.click_action)return;n.fcmOptions={};let e=t.fcmOptions?.link??t.notification?.click_action;e&&(n.fcmOptions.link=e);let i=t.fcmOptions?.analytics_label;i&&(n.fcmOptions.analyticsLabel=i)}function Jo(n){return typeof n=="object"&&!!n&&Ji in n}Yo("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function Yo(n,t){let e=[];for(let i=0;i<n.length;i++)e.push(n.charAt(i)),i<t.length&&e.push(t.charAt(i));return e.join("")}function Qo(n){if(!n||!n.options)throw Qt("App Configuration Object");if(!n.name)throw Qt("App Name");let t=["projectId","apiKey","appId","messagingSenderId"],{options:e}=n;for(let i of t)if(!e[i])throw Qt(i);return{appName:n.name,projectId:e.projectId,apiKey:e.apiKey,appId:e.appId,senderId:e.messagingSenderId}}function Qt(n){return E.create("missing-app-config-values",{valueName:n})}var Xt=class{constructor(t,e,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;let r=Qo(t);this.firebaseDependencies={app:t,appConfig:r,installations:e,analyticsProvider:i}}_delete(){return Promise.resolve()}};function Xo(n){return c(this,null,function*(){try{n.swRegistration=yield navigator.serviceWorker.register(To,{scope:bo}),n.swRegistration.update().catch(()=>{}),yield Zo(n.swRegistration)}catch(t){throw E.create("failed-service-worker-registration",{browserErrorMessage:t?.message})}})}function Zo(n){return c(this,null,function*(){return new Promise((t,e)=>{let i=setTimeout(()=>e(new Error(`Service worker not registered after ${Wi} ms`)),Wi),r=n.installing||n.waiting;n.active?(clearTimeout(i),t()):r?r.onstatechange=s=>{s.target?.state==="activated"&&(r.onstatechange=null,clearTimeout(i),t())}:(clearTimeout(i),e(new Error("No incoming service worker found.")))})})}function ea(n,t){return c(this,null,function*(){if(!t&&!n.swRegistration&&(yield Xo(n)),!(!t&&n.swRegistration)){if(!(t instanceof ServiceWorkerRegistration))throw E.create("invalid-sw-registration");n.swRegistration=t}})}function ta(n,t){return c(this,null,function*(){t?n.vapidKey=t:n.vapidKey||(n.vapidKey=zi)})}function Zi(n,t){return c(this,null,function*(){if(!navigator)throw E.create("only-available-in-window");if(Notification.permission==="default"&&(yield Notification.requestPermission()),Notification.permission!=="granted")throw E.create("permission-blocked");return yield ta(n,t?.vapidKey),yield ea(n,t?.serviceWorkerRegistration),Wo(n)})}function na(n,t,e){return c(this,null,function*(){let i=ia(t);(yield n.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:e[Ji],message_name:e[ko],message_time:e[Po],message_device_time:Math.floor(Date.now()/1e3)})})}function ia(n){switch(n){case ot.NOTIFICATION_CLICKED:return"notification_open";case ot.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function ra(n,t){return c(this,null,function*(){let e=t.data;if(!e.isFirebaseMessaging)return;n.onMessageHandler&&e.messageType===ot.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(Ki(e)):n.onMessageHandler.next(Ki(e)));let i=e.data;Jo(i)&&i[Ro]==="1"&&(yield na(n,e.messageType,i))})}var Gi="@firebase/messaging",Bi="0.12.23";var sa=n=>{let t=new Xt(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>ra(t,e)),t},oa=n=>{let t=n.getProvider("messaging").getImmediate();return{getToken:i=>Zi(t,i)}};function aa(){q(new V("messaging",sa,"PUBLIC")),q(new V("messaging-internal",oa,"PRIVATE")),W(Gi,Bi),W(Gi,Bi,"esm2020")}function ca(){return c(this,null,function*(){try{yield pn()}catch{return!1}return typeof window<"u"&&fn()&&gn()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})}function ua(n,t){if(!navigator)throw E.create("only-available-in-window");return n.onMessageHandler=t,()=>{n.onMessageHandler=null}}function er(n=Te()){return ca().then(t=>{if(!t)throw E.create("unsupported-browser")},t=>{throw E.create("indexed-db-unsupported")}),z(N(n),"messaging").getImmediate()}function tr(n,t){return c(this,null,function*(){return n=N(n),Zi(n,t)})}function nr(n,t){return n=N(n),ua(n,t)}aa();var ir=(()=>{class n{constructor(e,i){this.firebaseService=e,this.storeService=i,this.currentTokenSubject=new P(null),this.currentToken$=this.currentTokenSubject.asObservable(),this.notificationCountSubject=new P(0),this.notificationCount$=this.notificationCountSubject.asObservable(),this.notificationsSubject=new P([]),this.notifications$=this.notificationsSubject.asObservable(),this.activeStoreId=null,this.storeSubscription=null,this.hasInitialized=!1,this.db=this.firebaseService.db,this.messaging=er(this.firebaseService.app),this.migrateOldNotifications(),this.storeSubscription=this.storeService.activeStoreId$.subscribe(r=>{let s=r!==this.activeStoreId;this.activeStoreId=r,(!this.hasInitialized||s)&&(this.hasInitialized=!0,this.loadPersistedNotifications())})}migrateOldNotifications(){let e="jjm_admin_notifications";localStorage.getItem(e)&&(localStorage.removeItem(e),console.log("NotificationService: Cleared old non-store-specific notifications"))}getStorageKey(){return this.activeStoreId?`jjm_admin_notifications_${this.activeStoreId}`:"jjm_admin_notifications"}loadPersistedNotifications(){let e=localStorage.getItem(this.getStorageKey());if(e)try{let r=JSON.parse(e).map(o=>I(f({},o),{timestamp:new Date(o.timestamp)}));this.notificationsSubject.next(r);let s=r.filter(o=>!o.read).length;this.notificationCountSubject.next(s)}catch(i){console.error("Failed to load persisted notifications",i),this.notificationsSubject.next([]),this.notificationCountSubject.next(0)}else this.notificationsSubject.next([]),this.notificationCountSubject.next(0)}persistNotifications(){localStorage.setItem(this.getStorageKey(),JSON.stringify(this.notificationsSubject.value))}requestPermission(){return c(this,null,function*(){try{(yield Notification.requestPermission())==="granted"?(console.log("Notification permission granted."),yield this.saveToken()):console.warn("Notification permission denied.")}catch(e){console.error("Error requesting notification permission:",e)}})}saveToken(){return c(this,null,function*(){try{let e=yield tr(this.messaging,{vapidKey:"BGs-QyMYgOwh4Tou3a2TkUcwX2twiK6QJYhF2mg4Sfv1BJo6pGcpN5pG8d02Tl7uLQPVGKTJhqwWIgS7Ehh5HeA"});if(e){console.log("FCM Token:",e),this.currentTokenSubject.next(e);let i=localStorage.getItem("jjm_user_id");if(i){let r=y(this.db,"users",i);yield re(r,{fcmTokens:En(e)}).catch(s=>console.warn("Firestore direct update failed:",s))}}else console.log("No registration token available. Request permission to generate one.")}catch(e){console.error("An error occurred while retrieving token. ",e)}})}listenForMessages(){nr(this.messaging,e=>{console.log("Message received in foreground: ",e);let i=e.data?.storeId;this.pushNotification(e.notification?.title||"New Notification",e.notification?.body||"",this.determineType(e),i),e.notification&&new Notification(e.notification.title||"New Notification",{body:e.notification.body||"",icon:"/assets/icons/icon-72x72.png"})})}determineType(e){let i=e.data||{};return i.type==="chat_message"?"message":i.type==="new_reservation"?"reservation":i.type==="delivery_update"?"delivery":i.type==="delivery_reminder"?"reminder":"system"}pushNotification(e,i,r="system",s){if(console.log(`NotificationService: Pushing "${e}" for store: ${s||this.activeStoreId||"all"}`),s&&s!==this.activeStoreId)return console.log(`NotificationService: Skipping - notification is for store ${s}, but active store is ${this.activeStoreId}`),this.saveNotificationToStore(e,i,r,s),!1;if(this.notificationsSubject.value.some(u=>u.title===e&&u.body===i))return console.log(`NotificationService: "${e}" already exists, skipping duplicate.`),!1;let a={id:Date.now().toString(),title:e,body:i,timestamp:new Date,type:r,read:!1,storeId:s||this.activeStoreId||void 0};return this.addNotification(a),console.log("NotificationService: Notification added successfully."),!0}saveNotificationToStore(e,i,r,s){let o=`jjm_admin_notifications_${s}`,a=[],u=localStorage.getItem(o);if(u)try{a=JSON.parse(u).map(h=>I(f({},h),{timestamp:new Date(h.timestamp)}))}catch{console.error("Failed to parse stored notifications for store",s)}if(a.some(h=>h.title===e&&h.body===i))return;a=[{id:Date.now().toString(),title:e,body:i,timestamp:new Date,type:r,read:!1,storeId:s},...a].slice(0,15),localStorage.setItem(o,JSON.stringify(a)),console.log(`NotificationService: Saved notification to store ${s} storage`)}addNotification(e){let i=this.notificationsSubject.value,r=[e,...i].slice(0,15);this.notificationsSubject.next(r),this.notificationCountSubject.next(this.notificationCountSubject.value+1),this.persistNotifications()}resetNotificationCount(){this.notificationCountSubject.next(0);let e=this.notificationsSubject.value.map(i=>I(f({},i),{read:!0}));this.notificationsSubject.next(e),this.persistNotifications()}clearNotifications(){this.notificationsSubject.next([]),this.notificationCountSubject.next(0),this.persistNotifications()}static{this.\u0275fac=function(i){return new(i||n)(L(Me),L(Ue))}}static{this.\u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var yu=(()=>{class n{constructor(e,i,r,s,o,a){this.loggingService=e,this.customerService=i,this.firebaseService=r,this.storeService=s,this.maintenanceService=o,this.notificationService=a,this._products=ie([]),this.products=this._products.asReadonly(),this._sales=ie([]),this.sales=this._sales.asReadonly(),this._expenses=ie([]),this.expenses=this._expenses.asReadonly(),this._categories=ie([]),this.categories=this._categories.asReadonly(),this._stats=ie(null),this.stats=this._stats.asReadonly(),this._offlineQueueCount=ie(0),this.offlineQueueCount=this._offlineQueueCount.asReadonly(),this.productsSubject=new P([]),this.salesSubject=new P([]),this.expensesSubject=new P([]),this.categoriesSubject=new P([]),this.products$=this.productsSubject.asObservable(),this.sales$=this.salesSubject.asObservable(),this.expenses$=this.expensesSubject.asObservable(),this.categories$=this.categoriesSubject.asObservable(),this.statsSubject=new P(null),this.stats$=this.statsSubject.asObservable(),this.firebaseUser=null,this.unsubscribes=[],this.pollingInterval=null,this.DB_NAME="JJM_Offline_DB",this.STORE_NAME="offline_queue",this.listenersInitialized=!1,this.storeSubscription=null,this.cachedFirestoreId="",this.cachedLegacyId="",this.app=this.firebaseService.app,this.db=this.firebaseService.db,this.auth=qt(this.app),this.hydrateFromCache(),this.updateOfflineQueueCount(),ge(()=>this.saveToCache("products",this._products())),ge(()=>this.saveToCache("sales",this._sales())),ge(()=>this.saveToCache("expenses",this._expenses())),ge(()=>this.saveToCache("categories",this._categories())),ge(()=>this.saveToCache("stats",this._stats()))}getCurrentUser(){return localStorage.getItem("jjm_user_id")||"guest"}isDataSaverMode(){return localStorage.getItem("jjm_data_saver_mode")==="true"}getDB(){return new Promise((e,i)=>{let r=indexedDB.open(this.DB_NAME,1);r.onupgradeneeded=()=>{let s=r.result;s.objectStoreNames.contains(this.STORE_NAME)||s.createObjectStore(this.STORE_NAME,{keyPath:"id",autoIncrement:!0})},r.onsuccess=()=>e(r.result),r.onerror=()=>i(r.error)})}updateOfflineQueueCount(){return c(this,null,function*(){try{let s=(yield this.getDB()).transaction(this.STORE_NAME,"readonly").objectStore(this.STORE_NAME).count();s.onsuccess=()=>{this._offlineQueueCount.set(s.result)}}catch(e){console.warn("Failed to update offline queue count:",e)}})}queueOfflineWrite(e,i,r){return c(this,null,function*(){try{let o=(yield this.getDB()).transaction(this.STORE_NAME,"readwrite"),a=o.objectStore(this.STORE_NAME),u={operation:e,collection:i,data:r,timestamp:new Date().toISOString(),storeId:this.storeService.getActiveStoreId()};a.add(u),o.oncomplete=()=>{console.log(`Queued offline ${e} for ${i} in IndexedDB`),this.updateOfflineQueueCount()}}catch(s){console.error("Failed to queue offline write to IndexedDB:",s)}})}syncOfflineQueue(){return c(this,null,function*(){try{let s=(yield this.getDB()).transaction(this.STORE_NAME,"readonly").objectStore(this.STORE_NAME).getAll();s.onsuccess=()=>c(this,null,function*(){let o=s.result;if(o.length===0){console.log("No offline writes to sync from IndexedDB.");return}console.log(`Syncing ${o.length} offline writes from IndexedDB...`);for(let a of o)try{a.operation==="create"?yield Se(w(this.db,a.collection),a.data):a.operation==="update"?yield re(y(this.db,a.collection,a.data.id),a.data):a.operation==="delete"&&(yield _e(y(this.db,a.collection,a.data.id))),console.log(`Synced ${a.operation} for ${a.collection}`)}catch(u){console.error(`Failed to sync ${a.operation}:`,u)}this.clearOfflineQueue()})}catch(e){console.error("Failed to sync offline queue from IndexedDB:",e)}})}clearOfflineQueue(){return c(this,null,function*(){try{let i=(yield this.getDB()).transaction(this.STORE_NAME,"readwrite");i.objectStore(this.STORE_NAME).clear(),i.oncomplete=()=>{console.log("IndexedDB offline queue cleared."),this.updateOfflineQueueCount()}}catch(e){console.error("Failed to clear IndexedDB offline queue:",e)}})}getFirestoreUserId(){return this.firebaseUser?this.firebaseUser.uid:localStorage.getItem("firebase_auth_disabled")==="true"?this.getCurrentUser():(console.warn("Firestore User ID requested but not authenticated. Using legacy fallback."),this.getCurrentUser())}reloadData(){this.startRealtimeListeners()}enableFullSync(){if(this.isDataSaverMode()){console.log("InventoryService: enableFullSync blocked because Data Saver Mode is ON.");return}console.log("Enabling Full Firestore Sync..."),localStorage.setItem("jjm_force_full_load","true"),this.reloadData()}stopRealtimeListeners(){console.log("InventoryService: Stopping all real-time listeners."),this.unsubscribes.forEach(e=>e()),this.unsubscribes=[],this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}disableFirestoreNetwork(){return c(this,null,function*(){console.warn("InventoryService: DISABLING Firestore Network Connection.");try{yield wn(this.db)}catch(e){console.error("Failed to disable Firestore network:",e)}})}enableFirestoreNetwork(){return c(this,null,function*(){if(this.isDataSaverMode()){console.warn("InventoryService: enableFirestoreNetwork BLOCKED. Data Saver is currently ON.");return}console.log("InventoryService: ENABLING Firestore Network Connection.");try{yield vn(this.db)}catch(e){console.error("Failed to enable Firestore network:",e)}})}clearAllData(){console.log("InventoryService: Clearing all data..."),this.stopRealtimeListeners(),this.listenersInitialized=!1,this._products.set([]),this._sales.set([]),this._expenses.set([]),this._categories.set([]),this._stats.set({totalRevenue:0,mtdRevenue:0,todayRevenue:0,todayOrdersCount:0,totalProductsCount:0,lowStockCount:0,lastUpdated:new Date,storeId:""}),this.productsSubject.next([]),this.salesSubject.next([]),this.expensesSubject.next([]),this.categoriesSubject.next([]),this.statsSubject.next(this._stats()),this.firebaseUser=null}hydrateFromCache(){let e=this.storeService.getActiveStoreId();if(!e){console.log("InventoryService: No store context - skipping cache hydration for security.");return}try{[{key:"products",signal:this._products,subject:this.productsSubject},{key:"sales",signal:this._sales,subject:this.salesSubject},{key:"expenses",signal:this._expenses,subject:this.expensesSubject},{key:"categories",signal:this._categories,subject:this.categoriesSubject},{key:"stats",signal:this._stats,subject:this.statsSubject}].forEach(r=>{let s=`jjm_${e}_${r.key}`,o=localStorage.getItem(s);if(o){let a=JSON.parse(o);r.signal.set(a),r.subject.next(a),console.log(`Hydrated ${r.key} from cache for store ${e}`)}})}catch(i){console.warn("InventoryService: Failed to hydrate from cache",i)}}saveToCache(e,i){let r=this.storeService.getActiveStoreId();if(r)try{let s=`jjm_${r}_${e}`;localStorage.setItem(s,JSON.stringify(i))}catch(s){console.error(`InventoryService: Failed to save ${e} to cache`,s)}}handleFirestoreError(e,i){console.error(`${i}:`,e),e.code==="permission-denied"&&console.warn(`PERMISSIONS ERROR in ${i}: The client is blocked from accessing this data. Please update Firestore Security Rules to allow access.`),(e.code==="resource-exhausted"||e.code===8||e.status===429||e.message&&e.message.toLowerCase().includes("quota")||e.error&&e.error.message&&e.error.message.toLowerCase().includes("quota"))&&this.maintenanceService.setMaintenanceMode(!0,"Firebase Quota Exhausted. System is in read-only maintenance mode.")}startRealtimeListeners(){if(localStorage.getItem("jjm_data_saver_mode")==="true"){console.log("Data Saver Mode is ON - Ensuring network is disabled and using cache."),this.stopRealtimeListeners(),this.disableFirestoreNetwork(),this.hydrateFromCache();return}this.enableFirestoreNetwork().then(()=>{this.stopRealtimeListeners();let i=this.getCurrentUser();if(!i||i==="guest")return;if(localStorage.getItem("firebase_auth_disabled")==="true"){console.log("Auth previously failed. Skipping to Public/Fallback Mode."),this.setupFirestoreListeners(i,i);return}let s=this.auth.currentUser;if(s){console.log("Already Authenticated. Starting Secure Listeners."),this.firebaseUser=s,this.setupFirestoreListeners(s.uid,i);return}jt(this.auth).then(o=>{console.log("Signed In Anonymously. Starting Secure Listeners."),this.firebaseUser=o.user,this.setupFirestoreListeners(o.user.uid,i)}).catch(o=>{console.warn("Anonymous Auth unavailable. Attempting Public Realtime Mode with Legacy ID."),localStorage.setItem("firebase_auth_disabled","true"),this.setupFirestoreListeners(i,i)})})}setupFirestoreListeners(e,i){if(this.cachedFirestoreId=e,this.cachedLegacyId=i,this.listenersInitialized){let r=this.storeService.getActiveStoreId();this.doSetupFirestoreListeners(e,i,r);return}this.listenersInitialized=!0,this.storeSubscription=this.storeService.activeStoreId$.pipe(nn()).subscribe(r=>{this.doSetupFirestoreListeners(this.cachedFirestoreId,this.cachedLegacyId,r)})}doSetupFirestoreListeners(e,i,r){this.unsubscribes.forEach(h=>h()),this.unsubscribes=[],r&&this.hydrateFromCache(),this.setupStatsListener(r);let s=localStorage.getItem("jjm_force_full_load")==="true",o=!!localStorage.getItem("customer_id");if(!s&&!o){console.log("Optimized Mode: Stats Only. Raw data listeners skipped.");return}let a;o?(console.log("InventoryService: Customer Mode - Fetching ALL products for AI"),a=R(w(this.db,"products"),ft("name","asc"),pt(100))):(a=R(w(this.db,"products"),k("userId","==",i)),r&&(a=R(w(this.db,"products"),k("userId","==",i),k("storeId","==",r)))),this.unsubscribes.push(ve(a,h=>{console.log("Products Snapshot:",h.docs.length);let p=h.docs.map(_=>f({id:_.id},_.data()));this._products.set(p),this.productsSubject.next(p),!o&&p.length===0&&(this.migrateProducts(i,e),this.migrateChat(i,e))},h=>{h.code==="permission-denied"?(console.warn("Permission Denied. Falling back to Legacy Polling."),this.fallbackToLegacyPolling()):this.handleFirestoreError(h,"Products Listener Error")}));let u;o?(console.log("InventoryService: Customer Mode - Querying RECENT sales for fuzzy matching"),u=R(w(this.db,"sales"),ft("timestamp","desc"),pt(100))):(u=R(w(this.db,"sales"),k("userId","==",i)),r&&(u=R(w(this.db,"sales"),k("userId","==",i),k("storeId","==",r)))),this.unsubscribes.push(ve(u,h=>{console.log("Sales Snapshot:",h.docs.length);let p=h.docs.map(_=>this.transformSale(f({id:_.id},_.data())));this._sales.set(p),this.salesSubject.next(p),!o&&p.length===0&&this.migrateSales(i,e)},h=>this.handleFirestoreError(h,"Sales Listener Error")));let d=R(w(this.db,"expenses"),k("userId","==",e));r&&(d=R(w(this.db,"expenses"),k("userId","==",e),k("storeId","==",r))),this.unsubscribes.push(ve(d,h=>{console.log("Expenses Snapshot:",h.docs.length);let p=h.docs.map(_=>f({id:_.id},_.data()));this._expenses.set(p),this.expensesSubject.next(p),p.length===0&&this.migrateExpenses(i,e)},h=>this.handleFirestoreError(h,"Expenses Listener Error")));let l=R(w(this.db,"categories"),k("userId","==",i));r&&(l=R(w(this.db,"categories"),k("userId","==",i),k("storeId","==",r))),this.unsubscribes.push(ve(l,h=>{console.log("Categories Snapshot:",h.docs.length);let p=h.docs.map(_=>f({id:_.id},_.data()));this._categories.set(p),this.categoriesSubject.next(p)},h=>this.handleFirestoreError(h,"Categories Listener Error")))}fallbackToLegacyPolling(){this.pollingInterval||(console.log("Starting Legacy Polling (Fallback Mode)..."),this.fetchAllLegacyData(),this.pollingInterval=setInterval(()=>this.fetchAllLegacyData(),1e4))}fetchAllLegacyData(){this.fetchProducts(),this.fetchSales(),this.fetchExpenses()}setupStatsListener(e){if(!e)return;let i=y(this.db,"stats",e);this.unsubscribes.push(ve(i,r=>{if(r.exists()){let s=r.data(),o=I(f({},s),{lastUpdated:s.lastUpdated instanceof Sn?s.lastUpdated.toDate():new Date(s.lastUpdated)});this._stats.set(o),this.statsSubject.next(o)}else{console.log("No aggregation document found for this store."),this._stats.set(null),this.statsSubject.next(null);let s=localStorage.getItem(`jjm_${e}_products`),o=localStorage.getItem(`jjm_${e}_sales`);!(localStorage.getItem("jjm_force_full_load")==="true")&&!s&&!o?(console.log("No cached data found for this store. Enabling Full Sync to fetch raw data..."),this.enableFullSync()):(s||o)&&console.log("Using cached data for this store. Quota preserved.")}},r=>this.handleFirestoreError(r,"Stats Listener Error")))}migrateProducts(e,i){console.log("Migration deprecated - data should already exist in Firestore")}migrateChat(e,i){console.log("Migration deprecated - data should already exist in Firestore")}migrateSales(e,i){console.log("Migration deprecated - data should already exist in Firestore")}migrateExpenses(e,i){console.log("Migration deprecated - data should already exist in Firestore")}loadProducts(){console.log("Products loading handled by realtime listeners")}loadProductsForUser(e){let i=R(w(this.db,"products"),k("userId","==",e));yn(i).then(r=>{let s=r.docs.map(o=>f({id:o.id},o.data()));this.productsSubject.next(s)}).catch(r=>console.error("Error fetching products for user:",r))}fetchProducts(){console.log("fetchProducts - data loaded via realtime listeners")}fetchSales(){console.log("fetchSales - data loaded via realtime listeners")}fetchExpenses(){console.log("fetchExpenses - data loaded via realtime listeners")}getProducts(){return this.products$}getSales(){return this.sales$}getExpenses(){return this.expenses$}getCategories(){return this.categories$}addCategory(e){let i=this.storeService.getActiveStoreId();if(!i)return b(()=>new Error("Store selection required for this transaction."));let r={name:e,createdAt:new Date,storeId:i,userId:this.getCurrentUser()};if(this.isDataSaverMode()){let s=`offline_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=f({id:s},r);this.queueOfflineWrite("create","categories",r);let u=[...this.categoriesSubject.value,o];return this._categories.set(u),this.categoriesSubject.next(u),this.loggingService.logActivity("create","category",s,e,"(Queued Offline)"),x(o)}return F(Se(w(this.db,"categories"),r)).pipe(fe(s=>f({id:s.id},r)),j(s=>{let a=[...this.categoriesSubject.value,s];this._categories.set(a),this.categoriesSubject.next(a)}),ct(s=>(this.handleFirestoreError(s,"Error adding category"),b(()=>s))))}deleteCategory(e){if(this.isDataSaverMode()){this.queueOfflineWrite("delete","categories",{id:e});let r=this.categoriesSubject.value.filter(s=>s.id!==e);return this._categories.set(r),this.categoriesSubject.next(r),this.loggingService.logActivity("delete","category",e,"Category","(Queued Offline)"),x(void 0)}return F(_e(y(this.db,"categories",e))).pipe(j(()=>{let r=this.categoriesSubject.value.filter(s=>s.id!==e);this._categories.set(r),this.categoriesSubject.next(r)}),ct(i=>(this.handleFirestoreError(i,"Error deleting category"),b(()=>i))))}addExpense(e){let i=this.storeService.getActiveStoreId();if(!i)return b(()=>new Error("Store selection required for this transaction."));let r=I(f({},e),{timestamp:new Date,storeId:i,userId:this.getFirestoreUserId()});if(this.isDataSaverMode()){let s=`offline_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=f({id:s},r);this.queueOfflineWrite("create","expenses",r);let u=[...this.expensesSubject.value,o];return this._expenses.set(u),this.expensesSubject.next(u),this.loggingService.logActivity("create","expense",s,o.productName,"(Queued Offline)"),x(o)}return F(Se(w(this.db,"expenses"),r)).pipe(fe(s=>f({id:s.id},r)),j({next:s=>{let o=this.expensesSubject.value;if(!o.find(a=>a.id===s.id)){let a=[...o,s];this._expenses.set(a),this.expensesSubject.next(a)}this.loggingService.logActivity("create","expense",s.id,s.productName,`$${s.price.toFixed(2)}`)},error:s=>console.error("Error adding expense:",s)}))}deleteExpense(e){if(!this.storeService.getActiveStoreId())return b(()=>new Error("Store selection required for this transaction."));if(this.isDataSaverMode()){this.queueOfflineWrite("delete","expenses",{id:e});let r=this.expensesSubject.value,s=r.find(a=>a.id===e),o=r.filter(a=>a.id!==e);return this._expenses.set(o),this.expensesSubject.next(o),s&&this.loggingService.logActivity("delete","expense",e,s.productName,"(Queued Offline)"),x(void 0)}return F(_e(y(this.db,"expenses",e))).pipe(j({next:()=>{let r=this.expensesSubject.value,s=r.find(a=>a.id===e),o=r.filter(a=>a.id!==e);this._expenses.set(o),this.expensesSubject.next(o),s&&this.loggingService.logActivity("delete","expense",e,s.productName,"Expense Deleted")},error:r=>console.error("Error deleting expense:",r)}))}addProduct(e){let i=this.storeService.getActiveStoreId();return i?this.storeService.stores$.pipe(ut(1),dt(r=>{let o=r.find(l=>l.id===i)?.subscriptionPlan||"Free",a=this.productsSubject.value.length,u=1/0;if(o==="Free"?u=10:(o==="Starter"||o.includes("Starter"))&&(u=2e3),a>=u)return b(()=>new Error(`Product Limit Reached for ${o} plan (${u}). Upgrade to store more.`));let d=I(f({},e),{createdAt:new Date,storeId:i,userId:this.getFirestoreUserId()});if(this.isDataSaverMode()){let l=`offline_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h=f({id:l},d);this.queueOfflineWrite("create","products",d);let _=[...this.productsSubject.value,h];return this._products.set(_),this.productsSubject.next(_),this.loggingService.logActivity("create","product",l,h.name,"(Queued Offline)"),this.recalculateAndSaveStats(),x(h)}return F(Se(w(this.db,"products"),d)).pipe(fe(l=>f({id:l.id},d)),j({next:l=>{let h=this.productsSubject.value;if(!h.find(p=>p.id===l.id)){let p=[...h,l];this._products.set(p),this.productsSubject.next(p)}this.loggingService.logActivity("create","product",l.id,l.name),this.recalculateAndSaveStats()},error:l=>this.handleFirestoreError(l,"Error adding product")}))})):b(()=>new Error("Store selection required for this transaction."))}deleteProduct(e){if(!this.storeService.getActiveStoreId())return b(()=>new Error("Store selection required for this transaction."));let s=this.productsSubject.value.find(o=>o.id===e);if(this.isDataSaverMode()){this.queueOfflineWrite("delete","products",{id:e});let a=this.productsSubject.value.filter(u=>u.id!==e);return this._products.set(a),this.productsSubject.next(a),this.loggingService.logActivity("delete","product",e,s?.name||"Product","(Queued Offline)"),x(void 0)}return F(_e(y(this.db,"products",e))).pipe(j({next:()=>{let a=this.productsSubject.value.filter(u=>u.id!==e);this._products.set(a),this.productsSubject.next(a),this.loggingService.logActivity("delete","product",e,s?.name||"Product","Deleted")},error:o=>{this.handleFirestoreError(o,"Error deleting product")}}))}recordSale(e,i,r,s,o,a,u=0,d="amount",l){let p=this.productsSubject.value.find(ee=>ee.id===e);if(!p)return b(()=>new Error("Product not found"));if(p.quantity<i)return b(()=>new Error("Insufficient quantity"));let _=p.price*i;u>0&&(d==="percent"?_=_-_*(u/100):_=_-u),_=Math.max(0,Math.round(_*100)/100);let O=r-_;if(O<0)return b(()=>new Error("Insufficient cash"));let T=this.storeService.getActiveStoreId();return T?this.storeService.stores$.pipe(ut(1),dt(ee=>{let G=ee.find(v=>v.id===T);if(!this.storeService.hasTransactionCredits(T))return b(()=>new Error("Transaction Limit Reached. Please Upgrade to Pro or Top Up."));let U={productId:p.id,productName:p.name,category:p.category,price:p.price,quantitySold:i,total:_,cashReceived:r,change:O,pending:!0,discount:u,discountType:d,timestamp:new Date,storeId:T};s&&(U.deliveryDate=s),o&&(U.deliveryNotes=o),a&&(U.customerId=a),l&&(U.orderId=l);let he=I(f({},U),{userId:this.getFirestoreUserId()});if(this.isDataSaverMode()){let v=`offline_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,te=f({id:v},he);this.queueOfflineWrite("create","sales",he),this.storeService.deductTransactionCredit(T);let D=this.salesSubject.value,m=[te,...D];return this._sales.set(m),this.salesSubject.next(m),this.loggingService.logActivity("create","sale",v,p.name,`Sold ${i} units (Queued Offline)`),this.recalculateAndSaveStats(),x(te)}return F(Se(w(this.db,"sales"),he)).pipe(fe(v=>f({id:v.id},he)),j({next:v=>{this.storeService.deductTransactionCredit(T);let te=this.salesSubject.value;if(!te.find(D=>D.id===v.id)){let D=[v,...te];this._sales.set(D),this.salesSubject.next(D)}this.loggingService.logActivity("create","sale",v.id,p.name,`Sold ${i} units (Pending Delivery)`),this.recalculateAndSaveStats()},error:v=>{this.handleFirestoreError(v,"Error recording sale")}}))})):b(()=>new Error("Store selection required for this transaction."))}completePendingSale(e){let i=this.salesSubject.value,r=i.find(a=>a.id===e);if(!r){console.error("Sale not found via ID");return}let s=()=>{let a=i.map(l=>l.id===e?I(f({},l),{pending:!1}):l);this._sales.set(a),this.salesSubject.next(a);let u=this.productsSubject.value;if(u.find(l=>l.id===r.productId)){let l=u.map(h=>h.id===r.productId?I(f({},h),{quantity:h.quantity-r.quantitySold}):h);this._products.set(l),this.productsSubject.next(l)}this.loggingService.logActivity("complete","sale",e,r.productName,`Marked as delivered & Deducted ${r.quantitySold} units`),this.recalculateAndSaveStats()};if(this.isDataSaverMode()){this.queueOfflineWrite("update","sales",{id:e,pending:!1});let a=this.productsSubject.value.find(u=>u.id===r.productId);a&&this.queueOfflineWrite("update","products",{id:r.productId,quantity:a.quantity-r.quantitySold}),s(),this.notificationService.pushNotification("Delivery Confirmed! \u2705 (Offline)",`The order for ${r.customerName||"a customer"} has been delivered.`,"delivery");return}let o=y(this.db,"sales",e);re(o,{pending:!1}).then(()=>{let a=i.map(l=>l.id===e?I(f({},l),{pending:!1}):l);this._sales.set(a),this.salesSubject.next(a);let d=this.productsSubject.value.find(l=>l.id===r.productId);if(d){let l=I(f({},d),{quantity:d.quantity-r.quantitySold});this.updateProduct(l).subscribe()}if(r.customerId){let l=this.customerService.getCustomerById(r.customerId);if(l){let h=Math.floor(r.total/5e3);if(h>0){let p=l.credits||0;this.customerService.updateCustomer(l.id,{credits:p+h}),this.loggingService.logActivity("update","customer",l.id,l.name,`Awarded ${h} credits for purchase`)}}}this.loggingService.logActivity("complete","sale",e,r.productName,`Marked as delivered & Deducted ${r.quantitySold} units`),this.notificationService.pushNotification("Delivery Confirmed! \u2705",`The order for ${r.customerName||"a customer"} has been delivered.`,"delivery"),this.recalculateAndSaveStats()}).catch(a=>console.error("Error completing sale:",a))}updateSale(e){let i=this.storeService.getActiveStoreId();if(!i){console.error("Store selection required to update sale.");return}let r=I(f({},e),{storeId:i});if(this.isDataSaverMode()){this.queueOfflineWrite("update","sales",r);let a=this.salesSubject.value.map(u=>u.id===e.id?I(f({},this.transformSale(r)),{id:e.id}):u);this._sales.set(a),this.salesSubject.next(a),this.loggingService.logActivity("update","sale",e.id,e.productName,"(Queued Offline)");return}let s=y(this.db,"sales",e.id);Le(s,r,{merge:!0}).then(()=>{let a=this.salesSubject.value.map(u=>u.id===e.id?I(f({},this.transformSale(r)),{id:e.id}):u);this._sales.set(a),this.salesSubject.next(a),this.loggingService.logActivity("update","sale",e.id,e.productName,"Updated delivery details")}).catch(o=>console.error("Error updating sale:",o))}confirmReservation(e){if(!this.productsSubject.value.find(o=>o.id===e.productId)){console.error("Product not found for confirmation stock deduction");return}if(this.isDataSaverMode()){this.queueOfflineWrite("update","sales",{id:e.id,reservationStatus:"confirmed"});let a=this.salesSubject.value.map(u=>u.id===e.id?I(f({},u),{reservationStatus:"confirmed"}):u);this._sales.set(a),this.salesSubject.next(a),this.loggingService.logActivity("update","sale",e.id,e.productName,"Confirmed reservation (Queued Offline)");return}let s=y(this.db,"sales",e.id);re(s,{reservationStatus:"confirmed"}).then(()=>{let a=this.salesSubject.value.map(u=>u.id===e.id?I(f({},u),{reservationStatus:"confirmed"}):u);this._sales.set(a),this.salesSubject.next(a),this.loggingService.logActivity("update","sale",e.id,e.productName,"Confirmed reservation (Stock deduction pending delivery)")}).catch(o=>console.error("Error confirming reservation:",o))}transformSale(e){return I(f({},e),{timestamp:this.parseDate(e.timestamp),deliveryDate:e.deliveryDate?this.parseDate(e.deliveryDate):void 0})}parseDate(e){if(!e)return new Date;if(e instanceof Date)return e;if(e&&typeof e.toDate=="function")return e.toDate();if(e&&(e.seconds!==void 0||e._seconds!==void 0)){let i=e.seconds??e._seconds;return new Date(i*1e3)}return typeof e=="string"?new Date(e):new Date(e)}restockProduct(e,i){let s=this.productsSubject.value.find(o=>o.id===e);if(s){let o=I(f({},s),{quantity:s.quantity+i});this.updateProduct(o).subscribe(),this.loggingService.logActivity("restock","product",e,s.name,`Added ${i} units`)}}deleteSale(e){if(this.isDataSaverMode()){this.queueOfflineWrite("delete","sales",{id:e});let r=this.salesSubject.value.filter(s=>s.id!==e);this._sales.set(r),this.salesSubject.next(r),this.loggingService.logActivity("delete","sale",e,"Sale","(Queued Offline)"),this.recalculateAndSaveStats();return}_e(y(this.db,"sales",e)).then(()=>{let r=this.salesSubject.value.filter(s=>s.id!==e);this.salesSubject.next(r),this._sales.set(r),this.loggingService.logActivity("delete","sale",e,"Reservation/Sale","Deleted sale record"),this.recalculateAndSaveStats()}).catch(i=>console.error("Error deleting sale:",i))}updateProduct(e){let i=this.storeService.getActiveStoreId();if(!i)return b(()=>new Error("Store selection required for this transaction."));let r=I(f({},e),{storeId:i,userId:this.getFirestoreUserId()}),s=()=>{let a=this.productsSubject.value.map(l=>l.id===e.id?e:l);this._products.set(a),this.productsSubject.next(a);let u=this.salesSubject.value;if(u.filter(l=>l.productId===e.id&&l.productName!==e.name).length>0){let l=u.map(h=>h.productId===e.id?I(f({},h),{productName:e.name}):h);this._sales.set(l),this.salesSubject.next(l)}};return this.isDataSaverMode()?(this.queueOfflineWrite("update","products",r),s(),this.loggingService.logActivity("update","product",e.id,e.name,"(Queued Offline)"),this.recalculateAndSaveStats(),x(e)):F(Le(y(this.db,"products",e.id),r,{merge:!0})).pipe(fe(()=>e),j({next:()=>{let a=this.productsSubject.value.map(l=>l.id===e.id?e:l);this.productsSubject.next(a),this._products.set(a);let u=this.salesSubject.value,d=u.filter(l=>l.productId===e.id&&l.productName!==e.name);if(d.length>0){let l=u.map(h=>h.productId===e.id?I(f({},h),{productName:e.name}):h);this.salesSubject.next(l),this._sales.set(l),d.forEach(h=>{re(y(this.db,"sales",h.id),{productName:e.name}).catch(p=>console.error(`Error updating sale ${h.id} name:`,p))})}this.loggingService.logActivity("update","product",e.id,e.name),this.recalculateAndSaveStats()},error:o=>{this.handleFirestoreError(o,"Error updating product")}}))}recalculateAndSaveStats(){let e=this.storeService.getActiveStoreId();if(!e)return;let i=this.productsSubject.value,r=this.salesSubject.value,s=r.reduce((m,S)=>m+(S.total||0),0),o=new Date,a=new Date(o.getFullYear(),o.getMonth(),1),u=r.filter(m=>new Date(m.timestamp)>=a).reduce((m,S)=>m+(S.total||0),0),d=o.toISOString().split("T")[0],l=r.filter(m=>new Date(m.timestamp).toISOString().split("T")[0]===d),h=l.reduce((m,S)=>m+(S.total||0),0),p=l.length,_=i.length,O=i.filter(m=>(m.quantity||0)<=5).length,T={};r.forEach(m=>{let S=m.productId||m.productName;T[S]||(T[S]={name:m.productName,units:0,rev:0}),T[S].units+=m.quantitySold||1,T[S].rev+=m.total||0});let ee=Object.values(T).sort((m,S)=>S.rev-m.rev).slice(0,5).map(m=>({name:m.name,unitsSold:m.units,revenue:m.rev})),G={};i.forEach(m=>{let S=m.category||"Others";G[S]=(G[S]||0)+1});let U=Object.entries(G).map(([m,S])=>({name:m,percentage:Math.round(S/(i.length||1)*100)})),he=[...r].sort((m,S)=>new Date(S.timestamp).getTime()-new Date(m.timestamp).getTime()).slice(0,5),v={};r.forEach(m=>{let S=m.customerId||m.customerName||"Walk-in";v[S]||(v[S]={name:m.customerName||"Customer",totalSpent:0,ordersCount:0}),v[S].totalSpent+=m.total||0,v[S].ordersCount+=1});let te=Object.values(v).sort((m,S)=>S.totalSpent-m.totalSpent).slice(0,5),D={totalRevenue:s,mtdRevenue:u,todayRevenue:h,todayOrdersCount:p,totalProductsCount:_,lowStockCount:O,lastUpdated:new Date,storeId:e,topSellingProducts:ee,categoryDistribution:U,recentOrders:he,topCustomers:te};if(this._stats.set(D),this.statsSubject.next(D),this.isDataSaverMode()){console.log("Data Saver Mode: Skipping stats Firestore update");return}Le(y(this.db,"stats",e),D).catch(m=>console.error("Error updating aggregation document:",m))}static{this.\u0275fac=function(i){return new(i||n)(L(Tn),L(bn),L(Me),L(Ue),L(wi),L(ir))}}static{this.\u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{wi as a,ir as b,yu as c};
