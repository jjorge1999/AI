import{M as c,P as l,U as n,g as h,j as a,k as p,mc as f,o as d,pc as S,qc as g}from"./chunk-BT24UGZY.js";import{a as u,b as m}from"./chunk-7QOE2ANW.js";var U=(()=>{class o{constructor(e,t){this.http=e,this.storeService=t,this.apiUrl=S.apiUrl,this.customersSubject=new h([]),this.customers$=this.customersSubject.asObservable()}loadCustomers(){this.fetchCustomers()}loadInitialData(){this.fetchCustomers()}getCurrentUser(){return localStorage.getItem("jjm_user_id")||"guest"}reloadData(){this.loadInitialData()}fetchCustomers(){let e=this.getCurrentUser(),t=this.storeService.getActiveStoreId();if(!e||e==="guest"||!t){t||this.customersSubject.next([]);return}let s=`${this.apiUrl}/customers?userId=${e}&storeId=${t}`;this.http.get(s).subscribe({next:r=>this.customersSubject.next(r),error:r=>console.error("Error fetching customers:",r)})}getCustomers(){return this.customers$}getCustomerByName(e){let t=this.storeService.getActiveStoreId();return t?this.http.get(`${this.apiUrl}/customers?name=${encodeURIComponent(e)}&storeId=${t}`).pipe(d(s=>s.map(r=>m(u({},r),{phoneNumber:r.phoneNumber,deliveryAddress:"***",gpsCoordinates:"***",userId:"***"})))):a([])}getCustomerByPhone(e){return this.http.get(`${this.apiUrl}/customers?phoneNumber=${encodeURIComponent(e)}`)}addCustomer(e){let t=this.storeService.getActiveStoreId();if(!t)return p(()=>new Error("Store selection required for this transaction."));let s=u({userId:this.getCurrentUser(),storeId:t},e);return this.http.post(`${this.apiUrl}/customers`,s).pipe(c({next:r=>{let i=this.customersSubject.value;this.customersSubject.next([...i,r])},error:r=>console.error("Error adding customer:",r)}))}updateCustomer(e,t){return this.http.put(`${this.apiUrl}/customers/${e}`,t).pipe(c({next:()=>{let r=this.customersSubject.value.map(i=>i.id===e?u(u({},i),t):i);this.customersSubject.next(r)},error:s=>console.error("Error updating customer:",s)}))}deleteCustomer(e){return this.http.delete(`${this.apiUrl}/customers/${e}`).pipe(c({next:()=>{let s=this.customersSubject.value.filter(r=>r.id!==e);this.customersSubject.next(s)},error:t=>console.error("Error deleting customer:",t)}))}getCustomerById(e){return this.customersSubject.value.find(t=>t.id===e)}static{this.\u0275fac=function(t){return new(t||o)(n(f),n(g))}}static{this.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{U as a};
