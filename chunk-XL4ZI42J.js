import{a as Rn}from"./chunk-HOWFVV4B.js";import{a as Pn}from"./chunk-WZ7GYO3P.js";import{$c as _t,Ac as Sn,B as U,Bc as En,Cc as vn,D as dn,Dc as Ie,E as b,Ec as Y,Fc as yn,Gc as Ue,Hc as Te,Ic as Tn,Jc as O,K as gt,Kc as V,La as B,Lc as It,M as P,Mc as bn,Nc as be,Oc as Fe,P as me,Pb as se,Pc as q,Qc as J,Rc as D,Sc as _e,U as k,Uc as Ae,Vc as W,Wc as An,Xc as v,Yc as y,Zc as C,_c as F,ad as wt,cd as xe,dd as je,ed as oe,fd as we,g as A,gd as Se,hd as ke,i as S,id as kn,j as cn,k as E,kd as Ve,ld as qe,md as We,nc as Le,o as re,oc as ln,pc as hn,qc as mt,rc as Me,sc as fn,tc as pn,u as un,uc as R,vc as gn,wc as mn,x as ge,xc as In,yc as _n,zc as wn}from"./chunk-57FNYN7I.js";import{a as f,b as _,d as pt,f as ie,g as c}from"./chunk-7QOE2ANW.js";var x=function(n){return n.MESSAGE="message",n.RESERVATION="reservation",n.DELIVERY="delivery",n.SYSTEM="system",n.REMINDER="reminder",n}(x||{});function $n(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Kn=$n,zn=new Y("auth","Firebase",$n());var Be=new bn("@firebase/auth");function fr(n,...t){Be.logLevel<=It.WARN&&Be.warn(`Auth (${_e}): ${n}`,...t)}function $e(n,...t){Be.logLevel<=It.ERROR&&Be.error(`Auth (${_e}): ${n}`,...t)}function ee(n,...t){throw jt(n,...t)}function ae(n,...t){return jt(n,...t)}function Gn(n,t,e){let i=_(f({},Kn()),{[t]:e});return new Y("auth","Firebase",i).create(t,{appName:n.name})}function Z(n){return Gn(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function jt(n,...t){if(typeof n!="string"){let e=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(e,...i)}return zn.create(n,...t)}function p(n,t,...e){if(!n)throw jt(t,...e)}function H(n){let t="INTERNAL ASSERTION FAILED: "+n;throw $e(t),new Error(t)}function te(n,t){n||H(t)}function yt(){return typeof self<"u"&&self.location?.href||""}function pr(){return Cn()==="http:"||Cn()==="https:"}function Cn(){return typeof self<"u"&&self.location?.protocol||null}function gr(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(pr()||In()||"connection"in navigator)?navigator.onLine:!0}function mr(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var ce=class{constructor(t,e){this.shortDelay=t,this.longDelay=e,te(e>t,"Short delay should be less than long delay!"),this.isMobile=gn()||_n()}get(){return gr()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Vt(n,t){te(n.emulator,"Emulator should always be set here");let{url:e}=n.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}var Ye=class{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;H("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;H("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;H("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Ir={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var _r=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],wr=new ce(3e4,6e4);function ot(n,t){return n.tenantId&&!t.tenantId?_(f({},t),{tenantId:n.tenantId}):t}function Ee(s,o,a,u){return c(this,arguments,function*(n,t,e,i,r={}){return Bn(n,r,()=>c(this,null,function*(){let d={},l={};i&&(t==="GET"?l=i:d={body:JSON.stringify(i)});let h=Te(f({key:n.config.apiKey},l)).slice(1),m=yield n._getAdditionalHeaders();m["Content-Type"]="application/json",n.languageCode&&(m["X-Firebase-Locale"]=n.languageCode);let w=f({method:t,headers:m},d);return mn()||(w.referrerPolicy="no-referrer"),n.emulatorConfig&&Me(n.emulatorConfig.host)&&(w.credentials="include"),Ye.fetch()(yield Jn(n,n.config.apiHost,e,h),w)}))})}function Bn(n,t,e){return c(this,null,function*(){n._canInitEmulator=!1;let i=f(f({},Ir),t);try{let r=new Tt(n),s=yield Promise.race([e(),r.promise]);r.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw He(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[u,d]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw He(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw He(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw He(n,"user-disabled",o);let l=i[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Gn(n,l,d);ee(n,l)}}catch(r){if(r instanceof Ie)throw r;ee(n,"network-request-failed",{message:String(r)})}})}function Yn(s,o,a,u){return c(this,arguments,function*(n,t,e,i,r={}){let d=yield Ee(n,t,e,i,r);return"mfaPendingCredential"in d&&ee(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function Jn(n,t,e,i){return c(this,null,function*(){let r=`${t}${e}?${i}`,s=n,o=s.config.emulator?Vt(n.config,r):`${n.config.apiScheme}://${r}`;return _r.includes(e)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}var Tt=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,i)=>{this.timer=setTimeout(()=>i(ae(this.auth,"network-request-failed")),wr.get())})}};function He(n,t,e){let i={appName:n.name};e.email&&(i.email=e.email),e.phoneNumber&&(i.phoneNumber=e.phoneNumber);let r=ae(n,t,i);return r.customData._tokenResponse=e,r}function Sr(n,t){return c(this,null,function*(){return Ee(n,"POST","/v1/accounts:delete",t)})}function Je(n,t){return c(this,null,function*(){return Ee(n,"POST","/v1/accounts:lookup",t)})}function Re(n){if(n)try{let t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}function Xn(n,t=!1){return c(this,null,function*(){let e=O(n),i=yield e.getIdToken(t),r=qt(i);p(r&&r.exp&&r.auth_time&&r.iat,e.auth,"internal-error");let s=typeof r.firebase=="object"?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:Re(St(r.auth_time)),issuedAtTime:Re(St(r.iat)),expirationTime:Re(St(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function St(n){return Number(n)*1e3}function qt(n){let[t,e,i]=n.split(".");if(t===void 0||e===void 0||i===void 0)return $e("JWT malformed, contained fewer than 3 sections"),null;try{let r=ln(e);return r?JSON.parse(r):($e("Failed to decode base64 JWT payload"),null)}catch(r){return $e("Caught error parsing JWT payload as JSON",r?.toString()),null}}function Nn(n){let t=qt(n);return p(t,"internal-error"),p(typeof t.exp<"u","internal-error"),p(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}function Ce(n,t,e=!1){return c(this,null,function*(){if(e)return t;try{return yield t}catch(i){throw i instanceof Ie&&Er(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function Er({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var bt=class{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){let e=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),e}else{this.errorBackoff=3e4;let i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(t=!1){if(!this.isRunning)return;let e=this.getInterval(t);this.timerId=setTimeout(()=>c(this,null,function*(){yield this.iteration()}),e)}iteration(){return c(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Ne=class{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Re(this.lastLoginAt),this.creationTime=Re(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Xe(n){return c(this,null,function*(){let t=n.auth,e=yield n.getIdToken(),i=yield Ce(n,Je(t,{idToken:e}));p(i?.users.length,t,"internal-error");let r=i.users[0];n._notifyReloadListener(r);let s=r.providerUserInfo?.length?Zn(r.providerUserInfo):[],o=vr(n.providerData,s),a=n.isAnonymous,u=!(n.email&&r.passwordHash)&&!o?.length,d=a?u:!1,l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Ne(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(n,l)})}function Qn(n){return c(this,null,function*(){let t=O(n);yield Xe(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}function vr(n,t){return[...n.filter(i=>!t.some(r=>r.providerId===i.providerId)),...t]}function Zn(n){return n.map(i=>{var r=i,{providerId:t}=r,e=pt(r,["providerId"]);return{providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}})}function yr(n,t){return c(this,null,function*(){let e=yield Bn(n,{},()=>c(this,null,function*(){let i=Te({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=yield Jn(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:a,body:i};return n.emulatorConfig&&Me(n.emulatorConfig.host)&&(u.credentials="include"),Ye.fetch()(o,u)}));return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}})}function Tr(n,t){return c(this,null,function*(){return Ee(n,"POST","/v2/accounts:revokeToken",ot(n,t))})}var Pe=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){p(t.idToken,"internal-error"),p(typeof t.idToken<"u","internal-error"),p(typeof t.refreshToken<"u","internal-error");let e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Nn(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){p(t.length!==0,"internal-error");let e=Nn(t);this.updateTokensAndExpiration(t,null,e)}getToken(t,e=!1){return c(this,null,function*(){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(p(this.refreshToken,t,"user-token-expired"),this.refreshToken?(yield this.refresh(t,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(t,e){return c(this,null,function*(){let{accessToken:i,refreshToken:r,expiresIn:s}=yield yr(t,e);this.updateTokensAndExpiration(i,r,Number(s))})}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,e){let{refreshToken:i,accessToken:r,expirationTime:s}=e,o=new n;return i&&(p(typeof i=="string","internal-error",{appName:t}),o.refreshToken=i),r&&(p(typeof r=="string","internal-error",{appName:t}),o.accessToken=r),s&&(p(typeof s=="number","internal-error",{appName:t}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return H("not implemented")}};function X(n,t){p(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}var Q=class n{constructor(s){var o=s,{uid:t,auth:e,stsTokenManager:i}=o,r=pt(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new bt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=e,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Ne(r.createdAt||void 0,r.lastLoginAt||void 0)}getIdToken(t){return c(this,null,function*(){let e=yield Ce(this,this.stsTokenManager.getToken(this.auth,t));return p(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e})}getIdTokenResult(t){return Xn(this,t)}reload(){return Qn(this)}_assign(t){this!==t&&(p(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>f({},e)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){let e=new n(_(f({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){p(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(t,e=!1){return c(this,null,function*(){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&(yield Xe(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return c(this,null,function*(){if(D(this.auth.app))return Promise.reject(Z(this.auth));let t=yield this.getIdToken();return yield Ce(this,Sr(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return _(f({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>f({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){let i=e.displayName??void 0,r=e.email??void 0,s=e.phoneNumber??void 0,o=e.photoURL??void 0,a=e.tenantId??void 0,u=e._redirectEventId??void 0,d=e.createdAt??void 0,l=e.lastLoginAt??void 0,{uid:h,emailVerified:m,isAnonymous:w,providerData:L,stsTokenManager:M}=e;p(h&&M,t,"internal-error");let ne=Pe.fromJSON(this.name,M);p(typeof h=="string",t,"internal-error"),X(i,t.name),X(r,t.name),p(typeof m=="boolean",t,"internal-error"),p(typeof w=="boolean",t,"internal-error"),X(s,t.name),X(o,t.name),X(a,t.name),X(u,t.name),X(d,t.name),X(l,t.name);let pe=new n({uid:h,auth:t,email:r,emailVerified:m,displayName:i,isAnonymous:w,photoURL:o,phoneNumber:s,tenantId:a,stsTokenManager:ne,createdAt:d,lastLoginAt:l});return L&&Array.isArray(L)&&(pe.providerData=L.map(z=>f({},z))),u&&(pe._redirectEventId=u),pe}static _fromIdTokenResponse(t,e,i=!1){return c(this,null,function*(){let r=new Pe;r.updateFromServerResponse(e);let s=new n({uid:e.localId,auth:t,stsTokenManager:r,isAnonymous:i});return yield Xe(s),s})}static _fromGetAccountInfoResponse(t,e,i){return c(this,null,function*(){let r=e.users[0];p(r.localId!==void 0,"internal-error");let s=r.providerUserInfo!==void 0?Zn(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!s?.length,a=new Pe;a.updateFromIdToken(i);let u=new n({uid:r.localId,auth:t,stsTokenManager:a,isAnonymous:o}),d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Ne(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(u,d),u})}};var On=new Map;function $(n){te(n instanceof Function,"Expected a class definition");let t=On.get(n);return t?(te(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,On.set(n,t),t)}var br=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return c(this,null,function*(){return!0})}_set(e,i){return c(this,null,function*(){this.storage[e]=i})}_get(e){return c(this,null,function*(){let i=this.storage[e];return i===void 0?null:i})}_remove(e){return c(this,null,function*(){delete this.storage[e]})}_addListener(e,i){}_removeListener(e,i){}}return n.type="NONE",n})(),At=br;function Ke(n,t,e){return`firebase:${n}:${t}:${e}`}var Qe=class n{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;let{config:r,name:s}=this.auth;this.fullUserKey=Ke(this.userKey,r.apiKey,s),this.fullPersistenceKey=Ke("persistence",r.apiKey,s),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}getCurrentUser(){return c(this,null,function*(){let t=yield this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){let e=yield Je(this.auth,{idToken:t}).catch(()=>{});return e?Q._fromGetAccountInfoResponse(this.auth,e,t):null}return Q._fromJSON(this.auth,t)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(t){return c(this,null,function*(){if(this.persistence===t)return;let e=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(t,e,i="authUser"){return c(this,null,function*(){if(!e.length)return new n($(At),t,i);let r=(yield Promise.all(e.map(d=>c(this,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),s=r[0]||$(At),o=Ke(i,t.config.apiKey,t.name),a=null;for(let d of e)try{let l=yield d._get(o);if(l){let h;if(typeof l=="string"){let m=yield Je(t,{idToken:l}).catch(()=>{});if(!m)break;h=yield Q._fromGetAccountInfoResponse(t,m,l)}else h=Q._fromJSON(t,l);d!==s&&(a=h),s=d;break}}catch{}let u=r.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,t,i):(s=u[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(e.map(d=>c(this,null,function*(){if(d!==s)try{yield d._remove(o)}catch{}}))),new n(s,t,i))})}};function Dn(n){let t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ii(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ei(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(si(t))return"Blackberry";if(oi(t))return"Webos";if(ti(t))return"Safari";if((t.includes("chrome/")||ni(t))&&!t.includes("edge/"))return"Chrome";if(ri(t))return"Android";{let e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(e);if(i?.length===2)return i[1]}return"Other"}function ei(n=R()){return/firefox\//i.test(n)}function ti(n=R()){let t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ni(n=R()){return/crios\//i.test(n)}function ii(n=R()){return/iemobile/i.test(n)}function ri(n=R()){return/android/i.test(n)}function si(n=R()){return/blackberry/i.test(n)}function oi(n=R()){return/webos/i.test(n)}function Wt(n=R()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Ar(n=R()){return Wt(n)&&!!window.navigator?.standalone}function kr(){return wn()&&document.documentMode===10}function ai(n=R()){return Wt(n)||ri(n)||oi(n)||si(n)||/windows phone/i.test(n)||ii(n)}function ci(n,t=[]){let e;switch(n){case"Browser":e=Dn(R());break;case"Worker":e=`${Dn(R())}-${n}`;break;default:e=n}let i=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${_e}/${i}`}var kt=class{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){let i=s=>new Promise((o,a)=>{try{let u=t(s);o(u)}catch(u){a(u)}});i.onAbort=e,this.queue.push(i);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(t){return c(this,null,function*(){if(this.auth.currentUser===t)return;let e=[];try{for(let i of this.queue)yield i(t),i.onAbort&&e.push(i.onAbort)}catch(i){e.reverse();for(let r of e)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function Rr(e){return c(this,arguments,function*(n,t={}){return Ee(n,"GET","/v2/passwordPolicy",ot(n,t))})}var Pr=6,Rt=class{constructor(t){let e=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=e.minPasswordLength??Pr,e.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=e.maxPasswordLength),e.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=e.containsLowercaseCharacter),e.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=e.containsUppercaseCharacter),e.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=e.containsNumericCharacter),e.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=e.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){let e={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,e),this.validatePasswordCharacterOptions(t,e),e.isValid&&(e.isValid=e.meetsMinPasswordLength??!0),e.isValid&&(e.isValid=e.meetsMaxPasswordLength??!0),e.isValid&&(e.isValid=e.containsLowercaseLetter??!0),e.isValid&&(e.isValid=e.containsUppercaseLetter??!0),e.isValid&&(e.isValid=e.containsNumericCharacter??!0),e.isValid&&(e.isValid=e.containsNonAlphanumericCharacter??!0),e}validatePasswordLengthOptions(t,e){let i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(e.meetsMinPasswordLength=t.length>=i),r&&(e.meetsMaxPasswordLength=t.length<=r)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let i;for(let r=0;r<t.length;r++)i=t.charAt(r),this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,e,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=s))}};var Pt=class{constructor(t,e,i,r){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ze(this),this.idTokenSubscription=new Ze(this),this.beforeStateQueue=new kt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=zn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=$(e)),this._initializationPromise=this.queue(()=>c(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield Qe.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(e),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return c(this,null,function*(){if(this._deleted)return;let t=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(t,!0)}})}initializeCurrentUserFromIdToken(t){return c(this,null,function*(){try{let e=yield Je(this,{idToken:t}),i=yield Q._fromGetAccountInfoResponse(this,e,t);yield this.directlySetCurrentUser(i)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(t){return c(this,null,function*(){if(D(this.app)){let s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}let e=yield this.assertedPersistence.getCurrentUser(),i=e,r=!1;if(t&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let s=this.redirectUser?._redirectEventId,o=i?._redirectEventId,a=yield this.tryRedirectSignIn(t);(!s||s===o)&&a?.user&&(i=a.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{yield this.beforeStateQueue.runMiddleware(i)}catch(s){i=e,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return p(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(t){return c(this,null,function*(){let e=null;try{e=yield this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{yield this._setRedirectUser(null)}return e})}reloadAndSetCurrentUserOrClear(t){return c(this,null,function*(){try{yield Xe(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)})}useDeviceLanguage(){this.languageCode=mr()}_delete(){return c(this,null,function*(){this._deleted=!0})}updateCurrentUser(t){return c(this,null,function*(){if(D(this.app))return Promise.reject(Z(this));let e=t?O(t):null;return e&&p(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))})}_updateCurrentUser(t,e=!1){return c(this,null,function*(){if(!this._deleted)return t&&p(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||(yield this.beforeStateQueue.runMiddleware(t)),this.queue(()=>c(this,null,function*(){yield this.directlySetCurrentUser(t),this.notifyAuthListeners()}))})}signOut(){return c(this,null,function*(){return D(this.app)?Promise.reject(Z(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(t){return D(this.app)?Promise.reject(Z(this)):this.queue(()=>c(this,null,function*(){yield this.assertedPersistence.setPersistence($(t))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(t){return c(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return c(this,null,function*(){let t=yield Rr(this),e=new Rt(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new Y("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{let i=this.onAuthStateChanged(()=>{i(),t()},e)}})}revokeAccessToken(t){return c(this,null,function*(){if(this.currentUser){let e=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(i.tenantId=this.tenantId),yield Tr(this,i)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(t,e){return c(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(e);return t===null?i.removeCurrentUser():i.setCurrentUser(t)})}getOrInitRedirectPersistenceManager(t){return c(this,null,function*(){if(!this.redirectPersistenceManager){let e=t&&$(t)||this._popupRedirectResolver;p(e,this,"argument-error"),this.redirectPersistenceManager=yield Qe.create(this,[$(e._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(t){return c(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>c(this,null,function*(){}))),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null})}_persistUserIfCurrent(t){return c(this,null,function*(){if(t===this.currentUser)return this.queue(()=>c(this,null,function*(){return this.directlySetCurrentUser(t)}))})}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,r){if(this._deleted)return()=>{};let s=typeof e=="function"?e:e.next.bind(e),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(p(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof e=="function"){let u=t.addObserver(e,i,r);return()=>{o=!0,u()}}else{let u=t.addObserver(e);return()=>{o=!0,u()}}}directlySetCurrentUser(t){return c(this,null,function*(){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?yield this.assertedPersistence.setCurrentUser(t):yield this.assertedPersistence.removeCurrentUser()})}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return p(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=ci(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return c(this,null,function*(){let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let e=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();e&&(t["X-Firebase-Client"]=e);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return c(this,null,function*(){if(D(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return t?.error&&fr(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function at(n){return O(n)}var Ze=class{constructor(t){this.auth=t,this.observer=null,this.addObserver=Tn(e=>this.observer=e)}get next(){return p(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Ht={loadJS(){return c(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Cr(n){Ht=n}function Nr(n){return Ht.loadJS(n)}function Or(){return Ht.gapiScript}function ui(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function di(n,t){let e=J(n,"auth");if(e.isInitialized()){let r=e.getImmediate(),s=e.getOptions();if(Ue(s,t??{}))return r;ee(r,"already-initialized")}return e.initialize({options:t})}function Dr(n,t){let e=t?.persistence||[],i=(Array.isArray(e)?e:[e]).map($);t?.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(i,t?.popupRedirectResolver)}function li(n,t,e){let i=at(n);p(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=!!e?.disableWarnings,s=hi(t),{host:o,port:a}=Lr(t),u=a===null?"":`:${a}`,d={url:`${s}//${o}${u}/`},l=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){p(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),p(Ue(d,i.config.emulator)&&Ue(l,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=d,i.emulatorConfig=l,i.settings.appVerificationDisabledForTesting=!0,Me(o)?(fn(`${s}//${o}${u}`),pn("Auth",!0)):r||Mr()}function hi(n){let t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function Lr(n){let t=hi(n),e=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!e)return{host:"",port:null};let i=e[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let s=r[1];return{host:s,port:Ln(i.substr(s.length+1))}}else{let[s,o]=i.split(":");return{host:s,port:Ln(o)}}}function Ln(n){if(!n)return null;let t=Number(n);return isNaN(t)?null:t}function Mr(){function n(){let t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var et=class{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return H("not implemented")}_getIdTokenResponse(t){return H("not implemented")}_linkToIdToken(t,e){return H("not implemented")}_getReauthenticationResolver(t){return H("not implemented")}};function Et(n,t){return c(this,null,function*(){return Yn(n,"POST","/v1/accounts:signInWithIdp",ot(n,t))})}var tt=class{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}};var Ct=class extends tt{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}};function Ur(n,t){return c(this,null,function*(){return Yn(n,"POST","/v1/accounts:signUp",ot(n,t))})}var ue=class n{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static _fromIdTokenResponse(t,e,i,r=!1){return c(this,null,function*(){let s=yield Q._fromIdTokenResponse(t,i,r),o=Mn(i);return new n({user:s,providerId:o,_tokenResponse:i,operationType:e})})}static _forOperation(t,e,i){return c(this,null,function*(){yield t._updateTokensIfNecessary(i,!0);let r=Mn(i);return new n({user:t,providerId:r,_tokenResponse:i,operationType:e})})}};function Mn(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}function $t(n){return c(this,null,function*(){if(D(n.app))return Promise.reject(Z(n));let t=at(n);if(yield t._initializationPromise,t.currentUser?.isAnonymous)return new ue({user:t.currentUser,providerId:null,operationType:"signIn"});let e=yield Ur(t,{returnSecureToken:!0}),i=yield ue._fromIdTokenResponse(t,"signIn",e,!0);return yield t._updateCurrentUser(i.user),i})}var Nt=class n extends Ie{constructor(t,e,i,r){super(e.code,e.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,n.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:e.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(t,e,i,r){return new n(t,e,i,r)}};function fi(n,t,e,i){return(t==="reauthenticate"?e._getReauthenticationResolver(n):e._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Nt._fromErrorAndOperation(n,s,t,i):s})}function Fr(n,t,e=!1){return c(this,null,function*(){let i=yield Ce(n,t._linkToIdToken(n.auth,yield n.getIdToken()),e);return ue._forOperation(n,"link",i)})}function xr(n,t,e=!1){return c(this,null,function*(){let{auth:i}=n;if(D(i.app))return Promise.reject(Z(i));let r="reauthenticate";try{let s=yield Ce(n,fi(i,r,t,n),e);p(s.idToken,i,"internal-error");let o=qt(s.idToken);p(o,i,"internal-error");let{sub:a}=o;return p(n.uid===a,i,"user-mismatch"),ue._forOperation(n,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&ee(i,"user-mismatch"),s}})}function jr(n,t,e=!1){return c(this,null,function*(){if(D(n.app))return Promise.reject(Z(n));let i="signIn",r=yield fi(n,i,t),s=yield ue._fromIdTokenResponse(n,i,r);return e||(yield n._updateCurrentUser(s.user)),s})}function pi(n,t,e,i){return O(n).onIdTokenChanged(t,e,i)}function gi(n,t,e){return O(n).beforeAuthStateChanged(t,e)}var nt="__sak";var it=class{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(nt,"1"),this.storage.removeItem(nt),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){let e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}};var Vr=1e3,qr=10,Wr=(()=>{class n extends it{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ai(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let i of Object.keys(this.listeners)){let r=this.storage.getItem(i),s=this.localCache[i];r!==s&&e(i,s,r)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((a,u,d)=>{this.notifyListeners(a,d)});return}let r=e.key;i?this.detachListener():this.stopPolling();let s=()=>{let a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);kr()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,qr):s()}notifyListeners(e,i){this.localCache[e]=i;let r=this.listeners[e];if(r)for(let s of Array.from(r))s(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:r}),!0)})},Vr)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(e,i){return c(this,null,function*(){yield ie(n.prototype,this,"_set").call(this,e,i),this.localCache[e]=JSON.stringify(i)})}_get(e){return c(this,null,function*(){let i=yield ie(n.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(i),i})}_remove(e){return c(this,null,function*(){yield ie(n.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}return n.type="LOCAL",n})(),mi=Wr;var Hr=(()=>{class n extends it{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}return n.type="SESSION",n})(),Kt=Hr;function $r(n){return Promise.all(n.map(t=>c(this,null,function*(){try{return{fulfilled:!0,value:yield t}}catch(e){return{fulfilled:!1,reason:e}}})))}var Kr=(()=>{class n{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let i=this.receivers.find(s=>s.isListeningto(e));if(i)return i;let r=new n(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}handleEvent(e){return c(this,null,function*(){let i=e,{eventId:r,eventType:s,data:o}=i.data,a=this.handlersMap[s];if(!a?.size)return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:s});let u=Array.from(a).map(l=>c(this,null,function*(){return l(i.origin,o)})),d=yield $r(u);i.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:d})})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Ii(n="",t=10){let e="";for(let i=0;i<t;i++)e+=Math.floor(Math.random()*10);return n+e}var Ot=class{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}_send(t,e,i=50){return c(this,null,function*(){let r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,u)=>{let d=Ii("",20);r.port1.start();let l=setTimeout(()=>{u(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(h){let m=h;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(l),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(m.data.response);break;default:clearTimeout(l),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:d,data:e},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function j(){return window}function zr(n){j().location.href=n}function _i(){return typeof j().WorkerGlobalScope<"u"&&typeof j().importScripts=="function"}function Gr(){return c(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function Br(){return navigator?.serviceWorker?.controller||null}function Yr(){return _i()?self:null}var wi="firebaseLocalStorageDb",Jr=1,rt="firebaseLocalStorage",Si="fbase_key",de=class{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}};function ct(n,t){return n.transaction([rt],t?"readwrite":"readonly").objectStore(rt)}function Xr(){let n=indexedDB.deleteDatabase(wi);return new de(n).toPromise()}function Dt(){let n=indexedDB.open(wi,Jr);return new Promise((t,e)=>{n.addEventListener("error",()=>{e(n.error)}),n.addEventListener("upgradeneeded",()=>{let i=n.result;try{i.createObjectStore(rt,{keyPath:Si})}catch(r){e(r)}}),n.addEventListener("success",()=>c(this,null,function*(){let i=n.result;i.objectStoreNames.contains(rt)?t(i):(i.close(),yield Xr(),t(yield Dt()))}))})}function Un(n,t,e){return c(this,null,function*(){let i=ct(n,!0).put({[Si]:t,value:e});return new de(i).toPromise()})}function Qr(n,t){return c(this,null,function*(){let e=ct(n,!1).get(t),i=yield new de(e).toPromise();return i===void 0?null:i.value})}function Fn(n,t){let e=ct(n,!0).delete(t);return new de(e).toPromise()}var Zr=800,es=3,ts=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return c(this,null,function*(){return this.db?this.db:(this.db=yield Dt(),this.db)})}_withRetries(e){return c(this,null,function*(){let i=0;for(;;)try{let r=yield this._openDb();return yield e(r)}catch(r){if(i++>es)throw r;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return c(this,null,function*(){return _i()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return c(this,null,function*(){this.receiver=Kr._getInstance(Yr()),this.receiver._subscribe("keyChanged",(e,i)=>c(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(i.key)}})),this.receiver._subscribe("ping",(e,i)=>c(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return c(this,null,function*(){if(this.activeServiceWorker=yield Gr(),!this.activeServiceWorker)return;this.sender=new Ot(this.activeServiceWorker);let e=yield this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return c(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||Br()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return c(this,null,function*(){try{if(!indexedDB)return!1;let e=yield Dt();return yield Un(e,nt,"1"),yield Fn(e,nt),!0}catch{}return!1})}_withPendingWrite(e){return c(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,i){return c(this,null,function*(){return this._withPendingWrite(()=>c(this,null,function*(){return yield this._withRetries(r=>Un(r,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)}))})}_get(e){return c(this,null,function*(){let i=yield this._withRetries(r=>Qr(r,e));return this.localCache[e]=i,i})}_remove(e){return c(this,null,function*(){return this._withPendingWrite(()=>c(this,null,function*(){return yield this._withRetries(i=>Fn(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return c(this,null,function*(){let e=yield this._withRetries(s=>{let o=ct(s,!1).getAll();return new de(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];let i=[],r=new Set;if(e.length!==0)for(let{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),i.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),i.push(s));return i})}notifyListeners(e,i){this.localCache[e]=i;let r=this.listeners[e];if(r)for(let s of Array.from(r))s(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>c(this,null,function*(){return this._poll()}),Zr)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Ei=ts;var Na=ui("rcb"),Oa=new ce(3e4,6e4);function ns(n,t){return t?$(t):(p(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Oe=class extends et{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Et(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Et(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Et(t,this._buildIdpRequest())}_buildIdpRequest(t){let e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}};function is(n){return jr(n.auth,new Oe(n),n.bypassAuthState)}function rs(n){let{auth:t,user:e}=n;return p(e,t,"internal-error"),xr(e,new Oe(n),n.bypassAuthState)}function ss(n){return c(this,null,function*(){let{auth:t,user:e}=n;return p(e,t,"internal-error"),Fr(e,new Oe(n),n.bypassAuthState)})}var Lt=class{constructor(t,e,i,r,s=!1){this.auth=t,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((t,e)=>c(this,null,function*(){this.pendingPromise={resolve:t,reject:e};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}}))}onAuthEvent(t){return c(this,null,function*(){let{urlResponse:e,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=t;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:e,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(u))}catch(d){this.reject(d)}})}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return is;case"linkViaPopup":case"linkViaRedirect":return ss;case"reauthViaPopup":case"reauthViaRedirect":return rs;default:ee(this.auth,"internal-error")}}resolve(t){te(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){te(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var Da=new ce(2e3,1e4);var os="pendingRedirect",ze=new Map,Mt=class n extends Lt{constructor(t,e,i=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,i),this.eventId=null}execute(){return c(this,null,function*(){let t=ze.get(this.auth._key());if(!t){try{let i=(yield as(this.resolver,this.auth))?yield ie(n.prototype,this,"execute").call(this):null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}ze.set(this.auth._key(),t)}return this.bypassAuthState||ze.set(this.auth._key(),()=>Promise.resolve(null)),t()})}onAuthEvent(t){return c(this,null,function*(){if(t.type==="signInViaRedirect")return ie(n.prototype,this,"onAuthEvent").call(this,t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){let e=yield this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,ie(n.prototype,this,"onAuthEvent").call(this,t);this.resolve(null)}})}onExecution(){return c(this,null,function*(){})}cleanUp(){}};function as(n,t){return c(this,null,function*(){let e=ds(t),i=us(n);if(!(yield i._isAvailable()))return!1;let r=(yield i._get(e))==="true";return yield i._remove(e),r})}function cs(n,t){ze.set(n._key(),t)}function us(n){return $(n._redirectPersistence)}function ds(n){return Ke(os,n.config.apiKey,n.name)}function ls(n,t,e=!1){return c(this,null,function*(){if(D(n.app))return Promise.reject(Z(n));let i=at(n),r=ns(i,t),o=yield new Mt(i,r,e).execute();return o&&!e&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,t)),o})}var hs=10*60*1e3,Ut=class{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(t,i)&&(e=!0,this.sendToConsumer(t,i),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!fs(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){if(t.error&&!vi(t)){let i=t.error.code?.split("auth/")[1]||"internal-error";e.onError(ae(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){let i=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=hs&&this.cachedEventUids.clear(),this.cachedEventUids.has(xn(t))}saveEventToCache(t){this.cachedEventUids.add(xn(t)),this.lastProcessedEventTime=Date.now()}};function xn(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function vi({type:n,error:t}){return n==="unknown"&&t?.code==="auth/no-auth-event"}function fs(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return vi(n);default:return!1}}function ps(e){return c(this,arguments,function*(n,t={}){return Ee(n,"GET","/v1/projects",t)})}var gs=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ms=/^https?/;function Is(n){return c(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:t}=yield ps(n);for(let e of t)try{if(_s(e))return}catch{}ee(n,"unauthorized-domain")})}function _s(n){let t=yt(),{protocol:e,hostname:i}=new URL(t);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&i===""?e==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&o.hostname===i}if(!ms.test(e))return!1;if(gs.test(n))return i===n;let r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}var ws=new ce(3e4,6e4);function jn(){let n=j().___jsl;if(n?.H){for(let t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let e=0;e<n.CP.length;e++)n.CP[e]=null}}function Ss(n){return new Promise((t,e)=>{function i(){jn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{jn(),e(ae(n,"network-request-failed"))},timeout:ws.get()})}if(j().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(j().gapi?.load)i();else{let r=ui("iframefcb");return j()[r]=()=>{gapi.load?i():e(ae(n,"network-request-failed"))},Nr(`${Or()}?onload=${r}`).catch(s=>e(s))}}).catch(t=>{throw Ge=null,t})}var Ge=null;function Es(n){return Ge=Ge||Ss(n),Ge}var vs=new ce(5e3,15e3),ys="__/auth/iframe",Ts="emulator/auth/iframe",bs={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},As=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ks(n){let t=n.config;p(t.authDomain,n,"auth-domain-config-required");let e=t.emulator?Vt(t,Ts):`https://${n.config.authDomain}/${ys}`,i={apiKey:t.apiKey,appName:n.name,v:_e},r=As.get(n.config.apiHost);r&&(i.eid=r);let s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${e}?${Te(i).slice(1)}`}function Rs(n){return c(this,null,function*(){let t=yield Es(n),e=j().gapi;return p(e,n,"internal-error"),t.open({where:document.body,url:ks(n),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bs,dontclear:!0},i=>new Promise((r,s)=>c(this,null,function*(){yield i.restyle({setHideOnLeave:!1});let o=ae(n,"network-request-failed"),a=j().setTimeout(()=>{s(o)},vs.get());function u(){j().clearTimeout(a),r(i)}i.ping(u).then(u,()=>{s(o)})})))})}var Ps={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Cs=500,Ns=600,Os="_blank",Ds="http://localhost",st=class{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function Ls(n,t,e,i=Cs,r=Ns){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",u=_(f({},Ps),{width:i.toString(),height:r.toString(),top:s,left:o}),d=R().toLowerCase();e&&(a=ni(d)?Os:e),ei(d)&&(t=t||Ds,u.scrollbars="yes");let l=Object.entries(u).reduce((m,[w,L])=>`${m}${w}=${L},`,"");if(Ar(d)&&a!=="_self")return Ms(t||"",a),new st(null);let h=window.open(t||"",a,l);p(h,n,"popup-blocked");try{h.focus()}catch{}return new st(h)}function Ms(n,t){let e=document.createElement("a");e.href=n,e.target=t;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(i)}var Us="__/auth/handler",Fs="emulator/auth/handler",xs=encodeURIComponent("fac");function Vn(n,t,e,i,r,s){return c(this,null,function*(){p(n.config.authDomain,n,"auth-domain-config-required"),p(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:e,redirectUrl:i,v:_e,eventId:r};if(t instanceof tt){t.setDefaultLanguage(n.languageCode),o.providerId=t.providerId||"",yn(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(let[l,h]of Object.entries(s||{}))o[l]=h}if(t instanceof Ct){let l=t.getScopes().filter(h=>h!=="");l.length>0&&(o.scopes=l.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let l of Object.keys(a))a[l]===void 0&&delete a[l];let u=yield n._getAppCheckToken(),d=u?`#${xs}=${encodeURIComponent(u)}`:"";return`${js(n)}?${Te(a).slice(1)}${d}`})}function js({config:n}){return n.emulator?Vt(n,Fs):`https://${n.authDomain}/${Us}`}var vt="webStorageSupport",Ft=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Kt,this._completeRedirectFn=ls,this._overrideRedirectResult=cs}_openPopup(t,e,i,r){return c(this,null,function*(){te(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()");let s=yield Vn(t,e,i,yt(),r);return Ls(t,s,Ii())})}_openRedirect(t,e,i,r){return c(this,null,function*(){yield this._originValidation(t);let s=yield Vn(t,e,i,yt(),r);return zr(s),new Promise(()=>{})})}_initialize(t){let e=t._key();if(this.eventManagers[e]){let{manager:r,promise:s}=this.eventManagers[e];return r?Promise.resolve(r):(te(s,"If manager is not set, promise should be"),s)}let i=this.initAndGetManager(t);return this.eventManagers[e]={promise:i},i.catch(()=>{delete this.eventManagers[e]}),i}initAndGetManager(t){return c(this,null,function*(){let e=yield Rs(t),i=new Ut(t);return e.register("authEvent",r=>(p(r?.authEvent,t,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:i},this.iframes[t._key()]=e,i})}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(vt,{type:vt},r=>{let s=r?.[0]?.[vt];s!==void 0&&e(!!s),ee(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){let e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=Is(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return ai()||ti()||Wt()}},yi=Ft;var qn="@firebase/auth",Wn="1.11.1";var xt=class{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(t){return c(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(t)}:null})}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;let e=this.auth.onIdTokenChanged(i=>{t(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();let e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){p(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Vs(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function qs(n){q(new V("auth",(t,{options:e})=>{let i=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;p(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let u={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ci(n)},d=new Pt(i,r,s,u);return Dr(d,e),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,i)=>{t.getProvider("auth-internal").initialize()})),q(new V("auth-internal",t=>{let e=at(t.getProvider("auth").getImmediate());return(i=>new xt(i))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),W(qn,Wn,Vs(n)),W(qn,Wn,"esm2020")}var Ws=5*60,Hs=mt("authIdTokenMaxAge")||Ws,Hn=null,$s=n=>t=>c(void 0,null,function*(){let e=t&&(yield t.getIdTokenResult()),i=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(i&&i>Hs)return;let r=e?.token;Hn!==r&&(Hn=r,yield fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});function zt(n=Ae()){let t=J(n,"auth");if(t.isInitialized())return t.getImmediate();let e=di(n,{popupRedirectResolver:yi,persistence:[Ei,mi,Kt]}),i=mt("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(i,location.origin);if(location.origin===s.origin){let o=$s(s.toString());gi(e,o,()=>o(e.currentUser)),pi(e,a=>o(a))}}let r=hn("auth");return r&&li(e,`http://${r}`),e}function Ks(){return document.getElementsByTagName("head")?.[0]??document}Cr({loadJS(n){return new Promise((t,e)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=t,i.onerror=r=>{let s=ae("internal-error");s.customData=r,e(s)},i.type="text/javascript",i.charset="UTF-8",Ks().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});qs("Browser");var bi=(()=>{class n{constructor(){this.maintenanceModeSubject=new A(!1),this.isMaintenanceMode$=this.maintenanceModeSubject.asObservable(),this.maintenanceMessageSubject=new A("System is currently undergoing maintenance. Please try again later."),this.maintenanceMessage$=this.maintenanceMessageSubject.asObservable()}setMaintenanceMode(e,i){i&&this.maintenanceMessageSubject.next(i),this.maintenanceModeSubject.next(e),e&&console.warn("Maintenance Mode Activated:",i||"No message")}isMaintenanceMode(){return this.maintenanceModeSubject.value}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ri="@firebase/installations",Jt="0.6.19";var Pi=1e4,Ci=`w:${Jt}`,Ni="FIS_v2",Gs="https://firebaseinstallations.googleapis.com/v1",Bs=60*60*1e3,Ys="installations",Js="Installations";var Xs={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},he=new Y(Ys,Js,Xs);function Oi(n){return n instanceof Ie&&n.code.includes("request-failed")}function Di({projectId:n}){return`${Gs}/projects/${n}/installations`}function Li(n){return{token:n.token,requestStatus:2,expiresIn:Zs(n.expiresIn),creationTime:Date.now()}}function Mi(n,t){return c(this,null,function*(){let i=(yield t.json()).error;return he.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})})}function Ui({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Qs(n,{refreshToken:t}){let e=Ui(n);return e.append("Authorization",eo(t)),e}function Fi(n){return c(this,null,function*(){let t=yield n();return t.status>=500&&t.status<600?n():t})}function Zs(n){return Number(n.replace("s","000"))}function eo(n){return`${Ni} ${n}`}function to(i,r){return c(this,arguments,function*({appConfig:n,heartbeatServiceProvider:t},{fid:e}){let s=Di(n),o=Ui(n),a=t.getImmediate({optional:!0});if(a){let h=yield a.getHeartbeatsHeader();h&&o.append("x-firebase-client",h)}let u={fid:e,authVersion:Ni,appId:n.appId,sdkVersion:Ci},d={method:"POST",headers:o,body:JSON.stringify(u)},l=yield Fi(()=>fetch(s,d));if(l.ok){let h=yield l.json();return{fid:h.fid||e,registrationStatus:2,refreshToken:h.refreshToken,authToken:Li(h.authToken)}}else throw yield Mi("Create Installation",l)})}function xi(n){return new Promise(t=>{setTimeout(t,n)})}function no(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}var io=/^[cdef][\w-]{21}$/,Yt="";function ro(){try{let n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;let e=so(n);return io.test(e)?e:Yt}catch{return Yt}}function so(n){return no(n).substr(0,22)}function dt(n){return`${n.appName}!${n.appId}`}var ji=new Map;function Vi(n,t){let e=dt(n);qi(e,t),oo(e,t)}function qi(n,t){let e=ji.get(n);if(e)for(let i of e)i(t)}function oo(n,t){let e=ao();e&&e.postMessage({key:n,fid:t}),co()}var le=null;function ao(){return!le&&"BroadcastChannel"in self&&(le=new BroadcastChannel("[Firebase] FID Change"),le.onmessage=n=>{qi(n.data.key,n.data.fid)}),le}function co(){ji.size===0&&le&&(le.close(),le=null)}var uo="firebase-installations-database",lo=1,fe="firebase-installations-store",Gt=null;function Xt(){return Gt||(Gt=be(uo,lo,{upgrade:(n,t)=>{switch(t){case 0:n.createObjectStore(fe)}}})),Gt}function ut(n,t){return c(this,null,function*(){let e=dt(n),r=(yield Xt()).transaction(fe,"readwrite"),s=r.objectStore(fe),o=yield s.get(e);return yield s.put(t,e),yield r.done,(!o||o.fid!==t.fid)&&Vi(n,t.fid),t})}function Wi(n){return c(this,null,function*(){let t=dt(n),i=(yield Xt()).transaction(fe,"readwrite");yield i.objectStore(fe).delete(t),yield i.done})}function lt(n,t){return c(this,null,function*(){let e=dt(n),r=(yield Xt()).transaction(fe,"readwrite"),s=r.objectStore(fe),o=yield s.get(e),a=t(o);return a===void 0?yield s.delete(e):yield s.put(a,e),yield r.done,a&&(!o||o.fid!==a.fid)&&Vi(n,a.fid),a})}function Qt(n){return c(this,null,function*(){let t,e=yield lt(n.appConfig,i=>{let r=ho(i),s=fo(n,r);return t=s.registrationPromise,s.installationEntry});return e.fid===Yt?{installationEntry:yield t}:{installationEntry:e,registrationPromise:t}})}function ho(n){let t=n||{fid:ro(),registrationStatus:0};return Hi(t)}function fo(n,t){if(t.registrationStatus===0){if(!navigator.onLine){let r=Promise.reject(he.create("app-offline"));return{installationEntry:t,registrationPromise:r}}let e={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=po(n,e);return{installationEntry:e,registrationPromise:i}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:go(n)}:{installationEntry:t}}function po(n,t){return c(this,null,function*(){try{let e=yield to(n,t);return ut(n.appConfig,e)}catch(e){throw Oi(e)&&e.customData.serverCode===409?yield Wi(n.appConfig):yield ut(n.appConfig,{fid:t.fid,registrationStatus:0}),e}})}function go(n){return c(this,null,function*(){let t=yield Ai(n.appConfig);for(;t.registrationStatus===1;)yield xi(100),t=yield Ai(n.appConfig);if(t.registrationStatus===0){let{installationEntry:e,registrationPromise:i}=yield Qt(n);return i||e}return t})}function Ai(n){return lt(n,t=>{if(!t)throw he.create("installation-not-found");return Hi(t)})}function Hi(n){return mo(n)?{fid:n.fid,registrationStatus:0}:n}function mo(n){return n.registrationStatus===1&&n.registrationTime+Pi<Date.now()}function Io(i,r){return c(this,arguments,function*({appConfig:n,heartbeatServiceProvider:t},e){let s=_o(n,e),o=Qs(n,e),a=t.getImmediate({optional:!0});if(a){let h=yield a.getHeartbeatsHeader();h&&o.append("x-firebase-client",h)}let u={installation:{sdkVersion:Ci,appId:n.appId}},d={method:"POST",headers:o,body:JSON.stringify(u)},l=yield Fi(()=>fetch(s,d));if(l.ok){let h=yield l.json();return Li(h)}else throw yield Mi("Generate Auth Token",l)})}function _o(n,{fid:t}){return`${Di(n)}/${t}/authTokens:generate`}function Zt(n,t=!1){return c(this,null,function*(){let e,i=yield lt(n.appConfig,s=>{if(!$i(s))throw he.create("not-registered");let o=s.authToken;if(!t&&Eo(o))return s;if(o.requestStatus===1)return e=wo(n,t),s;{if(!navigator.onLine)throw he.create("app-offline");let a=yo(s);return e=So(n,a),a}});return e?yield e:i.authToken})}function wo(n,t){return c(this,null,function*(){let e=yield ki(n.appConfig);for(;e.authToken.requestStatus===1;)yield xi(100),e=yield ki(n.appConfig);let i=e.authToken;return i.requestStatus===0?Zt(n,t):i})}function ki(n){return lt(n,t=>{if(!$i(t))throw he.create("not-registered");let e=t.authToken;return To(e)?_(f({},t),{authToken:{requestStatus:0}}):t})}function So(n,t){return c(this,null,function*(){try{let e=yield Io(n,t),i=_(f({},t),{authToken:e});return yield ut(n.appConfig,i),e}catch(e){if(Oi(e)&&(e.customData.serverCode===401||e.customData.serverCode===404))yield Wi(n.appConfig);else{let i=_(f({},t),{authToken:{requestStatus:0}});yield ut(n.appConfig,i)}throw e}})}function $i(n){return n!==void 0&&n.registrationStatus===2}function Eo(n){return n.requestStatus===2&&!vo(n)}function vo(n){let t=Date.now();return t<n.creationTime||n.creationTime+n.expiresIn<t+Bs}function yo(n){let t={requestStatus:1,requestTime:Date.now()};return _(f({},n),{authToken:t})}function To(n){return n.requestStatus===1&&n.requestTime+Pi<Date.now()}function bo(n){return c(this,null,function*(){let t=n,{installationEntry:e,registrationPromise:i}=yield Qt(t);return i?i.catch(console.error):Zt(t).catch(console.error),e.fid})}function Ao(n,t=!1){return c(this,null,function*(){let e=n;return yield ko(e),(yield Zt(e,t)).token})}function ko(n){return c(this,null,function*(){let{registrationPromise:t}=yield Qt(n);t&&(yield t)})}function Ro(n){if(!n||!n.options)throw Bt("App Configuration");if(!n.name)throw Bt("App Name");let t=["projectId","apiKey","appId"];for(let e of t)if(!n.options[e])throw Bt(e);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Bt(n){return he.create("missing-app-config-values",{valueName:n})}var Ki="installations",Po="installations-internal",Co=n=>{let t=n.getProvider("app").getImmediate(),e=Ro(t),i=J(t,"heartbeat");return{app:t,appConfig:e,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},No=n=>{let t=n.getProvider("app").getImmediate(),e=J(t,Ki).getImmediate();return{getId:()=>bo(e),getToken:r=>Ao(e,r)}};function Oo(){q(new V(Ki,Co,"PUBLIC")),q(new V(Po,No,"PRIVATE"))}Oo();W(Ri,Jt);W(Ri,Jt,"esm2020");var Do="/firebase-messaging-sw.js",Lo="/firebase-cloud-messaging-push-scope",Qi="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Mo="https://fcmregistrations.googleapis.com/v1",Zi="google.c.a.c_id",Uo="google.c.a.c_l",Fo="google.c.a.ts",xo="google.c.a.e",zi=1e4;var ht=function(n){return n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked",n}(ht||{});function K(n){let t=new Uint8Array(n);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function jo(n){let t="=".repeat((4-n.length%4)%4),e=(n+t).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(e),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}var en="fcm_token_details_db",Vo=5,Gi="fcm_token_object_Store";function qo(n){return c(this,null,function*(){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(s=>s.name).includes(en))return null;let t=null;return(yield be(en,Vo,{upgrade:(i,r,s,o)=>c(this,null,function*(){if(r<2||!i.objectStoreNames.contains(Gi))return;let a=o.objectStore(Gi),u=yield a.index("fcmSenderId").get(n);if(yield a.clear(),!!u){if(r===2){let d=u;if(!d.auth||!d.p256dh||!d.endpoint)return;t={token:d.fcmToken,createTime:d.createTime??Date.now(),subscriptionOptions:{auth:d.auth,p256dh:d.p256dh,endpoint:d.endpoint,swScope:d.swScope,vapidKey:typeof d.vapidKey=="string"?d.vapidKey:K(d.vapidKey)}}}else if(r===3){let d=u;t={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:K(d.auth),p256dh:K(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:K(d.vapidKey)}}}else if(r===4){let d=u;t={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:K(d.auth),p256dh:K(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:K(d.vapidKey)}}}}})})).close(),yield Fe(en),yield Fe("fcm_vapid_details_db"),yield Fe("undefined"),Wo(t)?t:null})}function Wo(n){if(!n||!n.subscriptionOptions)return!1;let{subscriptionOptions:t}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof t.auth=="string"&&t.auth.length>0&&typeof t.p256dh=="string"&&t.p256dh.length>0&&typeof t.endpoint=="string"&&t.endpoint.length>0&&typeof t.swScope=="string"&&t.swScope.length>0&&typeof t.vapidKey=="string"&&t.vapidKey.length>0}var Ho="firebase-messaging-database",$o=1,De="firebase-messaging-store",tn=null;function er(){return tn||(tn=be(Ho,$o,{upgrade:(n,t)=>{switch(t){case 0:n.createObjectStore(De)}}})),tn}function Ko(n){return c(this,null,function*(){let t=tr(n),i=yield(yield er()).transaction(De).objectStore(De).get(t);if(i)return i;{let r=yield qo(n.appConfig.senderId);if(r)return yield sn(n,r),r}})}function sn(n,t){return c(this,null,function*(){let e=tr(n),r=(yield er()).transaction(De,"readwrite");return yield r.objectStore(De).put(t,e),yield r.done,t})}function tr({appConfig:n}){return n.appId}var zo={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},T=new Y("messaging","Messaging",zo);function Go(n,t){return c(this,null,function*(){let e=yield an(n),i=nr(t),r={method:"POST",headers:e,body:JSON.stringify(i)},s;try{s=yield(yield fetch(on(n.appConfig),r)).json()}catch(o){throw T.create("token-subscribe-failed",{errorInfo:o?.toString()})}if(s.error){let o=s.error.message;throw T.create("token-subscribe-failed",{errorInfo:o})}if(!s.token)throw T.create("token-subscribe-no-token");return s.token})}function Bo(n,t){return c(this,null,function*(){let e=yield an(n),i=nr(t.subscriptionOptions),r={method:"PATCH",headers:e,body:JSON.stringify(i)},s;try{s=yield(yield fetch(`${on(n.appConfig)}/${t.token}`,r)).json()}catch(o){throw T.create("token-update-failed",{errorInfo:o?.toString()})}if(s.error){let o=s.error.message;throw T.create("token-update-failed",{errorInfo:o})}if(!s.token)throw T.create("token-update-no-token");return s.token})}function Yo(n,t){return c(this,null,function*(){let i={method:"DELETE",headers:yield an(n)};try{let s=yield(yield fetch(`${on(n.appConfig)}/${t}`,i)).json();if(s.error){let o=s.error.message;throw T.create("token-unsubscribe-failed",{errorInfo:o})}}catch(r){throw T.create("token-unsubscribe-failed",{errorInfo:r?.toString()})}})}function on({projectId:n}){return`${Mo}/projects/${n}/registrations`}function an(e){return c(this,arguments,function*({appConfig:n,installations:t}){let i=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${i}`})})}function nr({p256dh:n,auth:t,endpoint:e,vapidKey:i}){let r={web:{endpoint:e,auth:t,p256dh:n}};return i!==Qi&&(r.web.applicationPubKey=i),r}var Jo=7*24*60*60*1e3;function Xo(n){return c(this,null,function*(){let t=yield Zo(n.swRegistration,n.vapidKey),e={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:t.endpoint,auth:K(t.getKey("auth")),p256dh:K(t.getKey("p256dh"))},i=yield Ko(n.firebaseDependencies);if(i){if(ea(i.subscriptionOptions,e))return Date.now()>=i.createTime+Jo?Qo(n,{token:i.token,createTime:Date.now(),subscriptionOptions:e}):i.token;try{yield Yo(n.firebaseDependencies,i.token)}catch(r){console.warn(r)}return Bi(n.firebaseDependencies,e)}else return Bi(n.firebaseDependencies,e)})}function Qo(n,t){return c(this,null,function*(){try{let e=yield Bo(n.firebaseDependencies,t),i=_(f({},t),{token:e,createTime:Date.now()});return yield sn(n.firebaseDependencies,i),e}catch(e){throw e}})}function Bi(n,t){return c(this,null,function*(){let i={token:yield Go(n,t),createTime:Date.now(),subscriptionOptions:t};return yield sn(n,i),i.token})}function Zo(n,t){return c(this,null,function*(){let e=yield n.pushManager.getSubscription();return e||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:jo(t)})})}function ea(n,t){let e=t.vapidKey===n.vapidKey,i=t.endpoint===n.endpoint,r=t.auth===n.auth,s=t.p256dh===n.p256dh;return e&&i&&r&&s}function Yi(n){let t={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return ta(t,n),na(t,n),ia(t,n),t}function ta(n,t){if(!t.notification)return;n.notification={};let e=t.notification.title;e&&(n.notification.title=e);let i=t.notification.body;i&&(n.notification.body=i);let r=t.notification.image;r&&(n.notification.image=r);let s=t.notification.icon;s&&(n.notification.icon=s)}function na(n,t){t.data&&(n.data=t.data)}function ia(n,t){if(!t.fcmOptions&&!t.notification?.click_action)return;n.fcmOptions={};let e=t.fcmOptions?.link??t.notification?.click_action;e&&(n.fcmOptions.link=e);let i=t.fcmOptions?.analytics_label;i&&(n.fcmOptions.analyticsLabel=i)}function ra(n){return typeof n=="object"&&!!n&&Zi in n}sa("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function sa(n,t){let e=[];for(let i=0;i<n.length;i++)e.push(n.charAt(i)),i<t.length&&e.push(t.charAt(i));return e.join("")}function oa(n){if(!n||!n.options)throw nn("App Configuration Object");if(!n.name)throw nn("App Name");let t=["projectId","apiKey","appId","messagingSenderId"],{options:e}=n;for(let i of t)if(!e[i])throw nn(i);return{appName:n.name,projectId:e.projectId,apiKey:e.apiKey,appId:e.appId,senderId:e.messagingSenderId}}function nn(n){return T.create("missing-app-config-values",{valueName:n})}var rn=class{constructor(t,e,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;let r=oa(t);this.firebaseDependencies={app:t,appConfig:r,installations:e,analyticsProvider:i}}_delete(){return Promise.resolve()}};function aa(n){return c(this,null,function*(){try{n.swRegistration=yield navigator.serviceWorker.register(Do,{scope:Lo}),n.swRegistration.update().catch(()=>{}),yield ca(n.swRegistration)}catch(t){throw T.create("failed-service-worker-registration",{browserErrorMessage:t?.message})}})}function ca(n){return c(this,null,function*(){return new Promise((t,e)=>{let i=setTimeout(()=>e(new Error(`Service worker not registered after ${zi} ms`)),zi),r=n.installing||n.waiting;n.active?(clearTimeout(i),t()):r?r.onstatechange=s=>{s.target?.state==="activated"&&(r.onstatechange=null,clearTimeout(i),t())}:(clearTimeout(i),e(new Error("No incoming service worker found.")))})})}function ua(n,t){return c(this,null,function*(){if(!t&&!n.swRegistration&&(yield aa(n)),!(!t&&n.swRegistration)){if(!(t instanceof ServiceWorkerRegistration))throw T.create("invalid-sw-registration");n.swRegistration=t}})}function da(n,t){return c(this,null,function*(){t?n.vapidKey=t:n.vapidKey||(n.vapidKey=Qi)})}function ir(n,t){return c(this,null,function*(){if(!navigator)throw T.create("only-available-in-window");if(Notification.permission==="default"&&(yield Notification.requestPermission()),Notification.permission!=="granted")throw T.create("permission-blocked");return yield da(n,t?.vapidKey),yield ua(n,t?.serviceWorkerRegistration),Xo(n)})}function la(n,t,e){return c(this,null,function*(){let i=ha(t);(yield n.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:e[Zi],message_name:e[Uo],message_time:e[Fo],message_device_time:Math.floor(Date.now()/1e3)})})}function ha(n){switch(n){case ht.NOTIFICATION_CLICKED:return"notification_open";case ht.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function fa(n,t){return c(this,null,function*(){let e=t.data;if(!e.isFirebaseMessaging)return;n.onMessageHandler&&e.messageType===ht.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(Yi(e)):n.onMessageHandler.next(Yi(e)));let i=e.data;ra(i)&&i[xo]==="1"&&(yield la(n,e.messageType,i))})}var Ji="@firebase/messaging",Xi="0.12.23";var pa=n=>{let t=new rn(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>fa(t,e)),t},ga=n=>{let t=n.getProvider("messaging").getImmediate();return{getToken:i=>ir(t,i)}};function ma(){q(new V("messaging",pa,"PUBLIC")),q(new V("messaging-internal",ga,"PRIVATE")),W(Ji,Xi),W(Ji,Xi,"esm2020")}function Ia(){return c(this,null,function*(){try{yield En()}catch{return!1}return typeof window<"u"&&Sn()&&vn()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})}function _a(n,t){if(!navigator)throw T.create("only-available-in-window");return n.onMessageHandler=t,()=>{n.onMessageHandler=null}}function rr(n=Ae()){return Ia().then(t=>{if(!t)throw T.create("unsupported-browser")},t=>{throw T.create("indexed-db-unsupported")}),J(O(n),"messaging").getImmediate()}function sr(n,t){return c(this,null,function*(){return n=O(n),ir(n,t)})}function or(n,t){return n=O(n),_a(n,t)}ma();var ar=(()=>{class n{constructor(e,i,r,s){this.firebaseService=e,this.storeService=i,this.indexedDbService=r,this.loadingService=s,this.currentTokenSubject=new A(null),this.currentToken$=this.currentTokenSubject.asObservable(),this.notificationCountSubject=new A(0),this.notificationCount$=this.notificationCountSubject.asObservable(),this.notificationsSubject=new A([]),this.notifications$=this.notificationsSubject.asObservable(),this.activeStoreId=null,this.storeSubscription=null,this.hasInitialized=!1,this.db=this.firebaseService.db,this.messaging=rr(this.firebaseService.app),this.migrateOldNotifications(),this.storeSubscription=this.storeService.activeStoreId$.subscribe(o=>{let a=o!==this.activeStoreId;this.activeStoreId=o,(!this.hasInitialized||a)&&(this.hasInitialized=!0,this.loadPersistedNotifications())})}migrateOldNotifications(){return c(this,null,function*(){let e="jjm_admin_notifications";localStorage.getItem(e)&&(localStorage.removeItem(e),console.log("NotificationService: Cleared old non-store-specific notifications (LocalStorage)"))})}getStorageKey(){return this.activeStoreId?`jjm_admin_notifications_${this.activeStoreId}`:"jjm_admin_notifications"}loadPersistedNotifications(){this.indexedDbService.get(this.getStorageKey()).pipe(U(1)).subscribe({next:e=>{if(e)try{let i=e.map(r=>_(f({},r),{timestamp:new Date(r.timestamp)}));this.notificationsSubject.next(i),this.updateUnreadCount(i)}catch(i){console.warn("Failed to parse saved notifications",i),this.notificationsSubject.next([]),this.updateUnreadCount([])}else this.notificationsSubject.next([]),this.updateUnreadCount([])},error:e=>{console.warn("Failed to load notifications from cache",e),this.notificationsSubject.next([]),this.updateUnreadCount([])}})}persistNotifications(e){this.activeStoreId&&this.indexedDbService.set(this.getStorageKey(),e).pipe(U(1)).subscribe({error:i=>console.error("Failed to persist notifications",i)})}updateUnreadCount(e){let i=e.filter(r=>!r.read).length;this.notificationCountSubject.next(i)}requestPermission(){return c(this,null,function*(){try{(yield Notification.requestPermission())==="granted"?(console.log("Notification permission granted."),yield this.saveToken()):console.warn("Notification permission denied.")}catch(e){console.error("Error requesting notification permission:",e)}})}saveToken(){return c(this,null,function*(){try{let e=yield sr(this.messaging,{vapidKey:"BGs-QyMYgOwh4Tou3a2TkUcwX2twiK6QJYhF2mg4Sfv1BJo6pGcpN5pG8d02Tl7uLQPVGKTJhqwWIgS7Ehh5HeA"});if(e){console.log("FCM Token:",e),this.currentTokenSubject.next(e);let i=localStorage.getItem("jjm_user_id");if(i){let r=y(this.db,"users",i);yield oe(r,{fcmTokens:kn(e)}).catch(s=>console.warn("Firestore direct update failed:",s))}}else console.log("No registration token available. Request permission to generate one.")}catch(e){console.error("An error occurred while retrieving token. ",e)}})}listenForMessages(){or(this.messaging,e=>{console.log("Message received in foreground: ",e);let i=e.data?.storeId;this.pushNotification(e.notification?.title||"New Notification",e.notification?.body||"",this.determineType(e),i),e.notification&&new Notification(e.notification.title||"New Notification",{body:e.notification.body||"",icon:"/assets/icons/icon-72x72.png"})})}determineType(e){let i=e.data||{};return i.type==="chat_message"?x.MESSAGE:i.type==="new_reservation"?x.RESERVATION:i.type==="delivery_update"?x.DELIVERY:i.type==="delivery_reminder"?x.REMINDER:x.SYSTEM}pushNotification(e,i,r=x.SYSTEM,s){if(console.log(`NotificationService: Pushing "${e}" for store: ${s||this.activeStoreId||"all"}`),s&&s!==this.activeStoreId)return console.log(`NotificationService: Skipping - notification is for store ${s}, but active store is ${this.activeStoreId}`),this.saveNotificationToStore(e,i,r,s),!1;if(this.notificationsSubject.value.some(u=>u.title===e&&u.body===i))return console.log(`NotificationService: "${e}" already exists, skipping duplicate.`),!1;let a={id:Date.now().toString(),title:e,body:i,timestamp:new Date,type:r,read:!1,storeId:s||this.activeStoreId||void 0};return this.addNotification(a),console.log("NotificationService: Notification added successfully."),!0}saveNotificationToStore(e,i,r,s){let o=`jjm_admin_notifications_${s}`,a=[];this.indexedDbService.get(o).pipe(U(1)).subscribe({next:u=>{if(u)try{a=u.map(h=>_(f({},h),{timestamp:new Date(h.timestamp)}))}catch(h){console.error("Failed to parse stored notifications for store",s,h)}let l=[{id:Date.now().toString(),title:e,body:i,timestamp:new Date,type:r,read:!1,storeId:s},...a].slice(0,15);this.indexedDbService.set(o,l).pipe(U(1)).subscribe({error:h=>console.error("Failed to save updated notifications for store",s,h)}),this.activeStoreId===s&&(this.notificationsSubject.next(l),this.updateUnreadCount(l))},error:u=>{console.error("Failed to get notifications for store",s,u)}})}addNotification(e){let i=this.notificationsSubject.value,r=[e,...i].slice(0,15);this.notificationsSubject.next(r),this.notificationCountSubject.next(this.notificationCountSubject.value+1),this.persistNotifications(r)}resetNotificationCount(){this.notificationCountSubject.next(0);let e=this.notificationsSubject.value.map(i=>_(f({},i),{read:!0}));this.notificationsSubject.next(e),this.persistNotifications(e)}clearNotifications(){this.notificationsSubject.next([]),this.notificationCountSubject.next(0),this.persistNotifications([])}static{this.\u0275fac=function(i){return new(i||n)(k(Ve),k(We),k(qe),k(Le))}}static{this.\u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Fu=(()=>{class n{constructor(e,i,r,s,o,a,u,d){this.loggingService=e,this.customerService=i,this.firebaseService=r,this.storeService=s,this.maintenanceService=o,this.notificationService=a,this.indexedDbService=u,this.loadingService=d,this._products=B([]),this.products=this._products.asReadonly(),this._sales=B([]),this.sales=this._sales.asReadonly(),this._expenses=B([]),this.expenses=this._expenses.asReadonly(),this._categories=B([]),this.categories=this._categories.asReadonly(),this._rawMaterials=B([]),this.rawMaterials=this._rawMaterials.asReadonly(),this._stats=B(null),this.stats=this._stats.asReadonly(),this._initialized=B(!1),this.initialized=this._initialized.asReadonly(),this.productsSubject=new A([]),this.salesSubject=new A([]),this.expensesSubject=new A([]),this.categoriesSubject=new A([]),this.rawMaterialsSubject=new A([]),this.products$=this.productsSubject.asObservable(),this.sales$=this.salesSubject.asObservable(),this.expenses$=this.expensesSubject.asObservable(),this.categories$=this.categoriesSubject.asObservable(),this.rawMaterials$=this.rawMaterialsSubject.asObservable(),this.statsSubject=new A(null),this.stats$=this.statsSubject.asObservable(),this.firebaseUser=null,this.unsubscribes=[],this.pollingInterval=null,this.listenersInitialized=!1,this.storeSubscription=null,this.cachedFirestoreId="",this.cachedLegacyId="",this.app=this.firebaseService.app,this.db=this.firebaseService.db,this.auth=zt(this.app),this.storeService.activeStoreId$.subscribe(l=>{l&&this.hydrateFromCache()}),se(()=>this.saveToCache("products",this._products())),se(()=>this.saveToCache("sales",this._sales())),se(()=>this.saveToCache("expenses",this._expenses())),se(()=>this.saveToCache("categories",this._categories())),se(()=>this.saveToCache("rawMaterials",this._rawMaterials())),se(()=>this.saveToCache("stats",this._stats()))}getCurrentUser(){return localStorage.getItem("jjm_user_id")||"guest"}getFirestoreUserId(){return this.firebaseUser?this.firebaseUser.uid:localStorage.getItem("firebase_auth_disabled")==="true"?this.getCurrentUser():(console.warn("Firestore User ID requested but not authenticated. Using legacy fallback."),this.getCurrentUser())}reloadData(){this.startRealtimeListeners()}enableFullSync(){console.log("Enabling Full Firestore Sync..."),localStorage.setItem("jjm_force_full_load","true"),this.reloadData()}stopRealtimeListeners(){this.unsubscribes.forEach(e=>e()),this.unsubscribes=[],this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}clearAllData(){console.log("InventoryService: Clearing all data..."),this.stopRealtimeListeners(),this.listenersInitialized=!1,this._products.set([]),this._sales.set([]),this._expenses.set([]),this._categories.set([]),this._rawMaterials.set([]),this._stats.set({totalRevenue:0,mtdRevenue:0,todayRevenue:0,totalProfit:0,mtdProfit:0,todayProfit:0,todayOrdersCount:0,totalProductsCount:0,lowStockCount:0,lastUpdated:new Date,storeId:""}),this.productsSubject.next([]),this.salesSubject.next([]),this.expensesSubject.next([]),this.categoriesSubject.next([]),this.rawMaterialsSubject.next([]),this.statsSubject.next(this._stats()),this.firebaseUser=null}hydrateFromCache(){let e=this.storeService.getActiveStoreId();if(!e){console.log("InventoryService: No store context - skipping cache hydration for security."),this._initialized.set(!0);return}this.loadingService.show("Loading data...");let r=[{key:"products",signal:this._products,subject:this.productsSubject},{key:"sales",signal:this._sales,subject:this.salesSubject},{key:"expenses",signal:this._expenses,subject:this.expensesSubject},{key:"categories",signal:this._categories,subject:this.categoriesSubject},{key:"rawMaterials",signal:this._rawMaterials,subject:this.rawMaterialsSubject},{key:"stats",signal:this._stats,subject:this.statsSubject}].map(s=>{let o=`jjm_${e}_${s.key}`;return this.indexedDbService.get(o).pipe(U(1),P(a=>{a&&(s.signal.set(a),s.subject.next(a),console.log(`Hydrated ${s.key} from IndexedDB for store ${e}`))}),ge(a=>(console.warn(`Failed to hydrate ${s.key}`,a),cn(null))))});un(r).subscribe({next:()=>{this._initialized.set(!0),this.loadingService.hide()},error:s=>{console.error("InventoryService: Error during hydration",s),this._initialized.set(!0),this.loadingService.hide()}})}saveToCache(e,i){let r=this.storeService.getActiveStoreId();if(!r||!i)return;let s=`jjm_${r}_${e}`;this.indexedDbService.set(s,i).pipe(U(1)).subscribe({error:o=>console.error(`InventoryService: Failed to save ${e} to cache`,o)})}handleFirestoreError(e,i){console.error(`${i}:`,e),e.code==="permission-denied"&&console.warn(`PERMISSIONS ERROR in ${i}: The client is blocked from accessing this data. Please update Firestore Security Rules to allow access.`),(e.code==="resource-exhausted"||e.code===8||e.status===429||e.message&&e.message.toLowerCase().includes("quota")||e.error&&e.error.message&&e.error.message.toLowerCase().includes("quota"))&&this.maintenanceService.setMaintenanceMode(!0,"Firebase Quota Exhausted. System is in read-only maintenance mode.")}startRealtimeListeners(){this.stopRealtimeListeners();let e=this.getCurrentUser();if(!e||e==="guest")return;if(localStorage.getItem("firebase_auth_disabled")==="true"){console.log("Auth previously failed. Skipping to Public/Fallback Mode."),this.setupFirestoreListeners(e,e);return}let r=this.auth.currentUser;if(r){console.log("Already Authenticated. Starting Secure Listeners."),this.firebaseUser=r,this.setupFirestoreListeners(r.uid,e);return}S($t(this.auth)).subscribe({next:s=>{console.log("Signed In Anonymously. Starting Secure Listeners."),this.firebaseUser=s.user,this.setupFirestoreListeners(s.user.uid,e)},error:s=>{console.warn("Anonymous Auth unavailable. Attempting Public Realtime Mode with Legacy ID."),localStorage.setItem("firebase_auth_disabled","true"),this.setupFirestoreListeners(e,e)}})}setupFirestoreListeners(e,i){if(this.cachedFirestoreId=e,this.cachedLegacyId=i,this.listenersInitialized){let r=this.storeService.getActiveStoreId();this.doSetupFirestoreListeners(e,i,r);return}this.listenersInitialized=!0,this.storeSubscription=this.storeService.activeStoreId$.pipe(dn()).subscribe(r=>{this.doSetupFirestoreListeners(this.cachedFirestoreId,this.cachedLegacyId,r)})}doSetupFirestoreListeners(e,i,r){this.unsubscribes.forEach(o=>o()),this.unsubscribes=[],r&&this.hydrateFromCache(),this.setupStatsListener(r);let s=!!localStorage.getItem("customer_id");this.setupProductsListener(r,i,e,s),this.setupSalesListener(r,i,e,s),this.setupExpensesListener(r,i,e),this.loadCategories(r),this.loadRawMaterials(r)}setupProductsListener(e,i,r,s){let o;s?(console.log("InventoryService: Customer Mode - Fetching ALL products for AI"),o=C(v(this.db,"products"),_t("name","asc"),wt(100))):e?o=C(v(this.db,"products"),F("storeId","==",e)):o=C(v(this.db,"products"),F("storeId","==","none")),this.unsubscribes.push(ke(o,a=>{console.log("Products Snapshot:",a.docs.length);let u=a.docs.map(d=>f({id:d.id},d.data()));this._products.set(u),this.productsSubject.next(u),!s&&u.length===0&&(this.migrateProducts(i,r),this.migrateChat(i,r))},a=>{a.code==="permission-denied"?(console.warn("Permission Denied. Falling back to Legacy Polling."),this.fallbackToLegacyPolling()):this.handleFirestoreError(a,"Products Listener Error")}))}setupSalesListener(e,i,r,s){let o;s?(console.log("InventoryService: Customer Mode - Querying RECENT sales for fuzzy matching"),o=C(v(this.db,"sales"),_t("timestamp","desc"),wt(100))):e?o=C(v(this.db,"sales"),F("storeId","==",e)):o=C(v(this.db,"sales"),F("storeId","==","none")),this.unsubscribes.push(ke(o,a=>{console.log("Sales Snapshot:",a.docs.length);let u=a.docs.map(d=>this.transformSale(f({id:d.id},d.data())));this._sales.set(u),this.salesSubject.next(u),!s&&u.length===0&&this.migrateSales(i,r)},a=>this.handleFirestoreError(a,"Sales Listener Error")))}setupExpensesListener(e,i,r){let s;e?s=C(v(this.db,"expenses"),F("storeId","==",e)):s=C(v(this.db,"expenses"),F("storeId","==","none")),this.unsubscribes.push(ke(s,o=>{console.log("Expenses Snapshot:",o.docs.length);let a=o.docs.map(u=>f({id:u.id},u.data()));this._expenses.set(a),this.expensesSubject.next(a),a.length===0&&this.migrateExpenses(i,r)},o=>this.handleFirestoreError(o,"Expenses Listener Error")))}loadCategories(e){if(!e)return;let i=5*60*1e3,r=Number(localStorage.getItem(`jjm_${e}_categories_ts`)||0),s=Date.now();if(s-r<i){console.log("InventoryService: Categories cache is fresh. Skipping network fetch.");return}let o=C(v(this.db,"categories"),F("storeId","==",e));S(xe(o)).subscribe({next:a=>{console.log("Categories Fetched:",a.docs.length);let u=a.docs.map(h=>f({id:h.id},h.data())),d=[],l=new Set;u.forEach(h=>{let m=h.name.trim().toLowerCase();l.has(m)||(l.add(m),d.push(h))}),this._categories.set(d),this.categoriesSubject.next(d),localStorage.setItem(`jjm_${e}_categories_ts`,s.toString())},error:a=>this.handleFirestoreError(a,"Categories Fetch Error")})}loadRawMaterials(e){if(!e)return;let i=5*60*1e3,r=Number(localStorage.getItem(`jjm_${e}_rawMaterials_ts`)||0),s=Date.now();if(s-r<i){console.log("InventoryService: RawMaterials cache is fresh. Skipping network fetch.");return}let o=C(v(this.db,"rawMaterials"),F("storeId","==",e));S(xe(o)).subscribe({next:a=>{let u=a.docs.map(d=>f({id:d.id},d.data()));this._rawMaterials.set(u),this.rawMaterialsSubject.next(u),localStorage.setItem(`jjm_${e}_rawMaterials_ts`,s.toString())},error:a=>this.handleFirestoreError(a,"Raw Materials Fetch Error")})}fallbackToLegacyPolling(){this.pollingInterval||(console.log("Starting Legacy Polling (Fallback Mode)..."),this.fetchAllLegacyData(),this.pollingInterval=setInterval(()=>this.fetchAllLegacyData(),1e4))}fetchAllLegacyData(){this.fetchProducts(),this.fetchSales(),this.fetchExpenses()}setupStatsListener(e){if(!e)return;let i=y(this.db,"stats",e);this.unsubscribes.push(ke(i,r=>{if(r.exists()){let s=r.data(),o=_(f({},s),{lastUpdated:s.lastUpdated instanceof An?s.lastUpdated.toDate():new Date(s.lastUpdated)});this._stats.set(o),this.statsSubject.next(o)}else{console.log("No aggregation document found for this store."),this._stats.set(null),this.statsSubject.next(null);let s=localStorage.getItem(`jjm_${e}_products`),o=localStorage.getItem(`jjm_${e}_sales`);!(localStorage.getItem("jjm_force_full_load")==="true")&&!s&&!o?(console.log("No cached data found for this store. Enabling Full Sync to fetch raw data..."),this.enableFullSync()):(s||o)&&console.log("Using cached data for this store. Quota preserved.")}},r=>this.handleFirestoreError(r,"Stats Listener Error")))}migrateProducts(e,i){console.log("Migration deprecated - data should already exist in Firestore")}migrateChat(e,i){console.log("Migration deprecated - data should already exist in Firestore")}migrateSales(e,i){console.log("Migration deprecated - data should already exist in Firestore")}migrateExpenses(e,i){console.log("Migration deprecated - data should already exist in Firestore")}loadProducts(){console.log("Products loading handled by realtime listeners")}loadProductsForStore(e){let i=C(v(this.db,"products"),F("storeId","==",e));S(xe(i)).subscribe({next:r=>{let s=r.docs.map(o=>f({id:o.id},o.data()));this.productsSubject.next(s)},error:r=>console.error("Error fetching products for store:",r)})}fetchProducts(){console.log("fetchProducts - data loaded via realtime listeners")}fetchSales(){console.log("fetchSales - data loaded via realtime listeners")}fetchExpenses(){console.log("fetchExpenses - data loaded via realtime listeners")}getProducts(){return this.products$}getSales(){return this.sales$}getExpenses(){return this.expenses$}getCategories(){return this.categories$}addCategory(e){let i=this.storeService.getActiveStoreId();if(!i)return E(()=>new Error("Store selection required for this transaction."));let r=e.trim().toLowerCase();if(this.categoriesSubject.value.find(a=>a.name.toLowerCase()===r))return E(()=>new Error("Category already exists."));let o={name:e.trim(),createdAt:new Date,storeId:i,userId:this.getCurrentUser()};return this.loadingService.show("Adding category..."),S(Se(v(this.db,"categories"),o)).pipe(re(a=>f({id:a.id},o)),P(a=>{let d=[...this._categories(),a];this._categories.set(d),this.categoriesSubject.next(d)}),ge(a=>(this.handleFirestoreError(a,"Error adding category"),E(()=>a))),b(()=>this.loadingService.hide()))}deleteCategory(e){return this.loadingService.show("Deleting category..."),S(we(y(this.db,"categories",e))).pipe(P(()=>{let r=this._categories().filter(s=>s.id!==e);this._categories.set(r),this.categoriesSubject.next(r)}),ge(i=>(this.handleFirestoreError(i,"Error deleting category"),E(()=>i))),b(()=>this.loadingService.hide()))}addExpense(e){let i=this.storeService.getActiveStoreId();if(!i)return E(()=>new Error("Store selection required for this transaction."));let r=this.sanitizeData(_(f({},e),{timestamp:new Date,storeId:i,userId:this.getFirestoreUserId()}));return this.loadingService.show("Adding expense..."),S(Se(v(this.db,"expenses"),r)).pipe(re(s=>f({id:s.id},r)),P({next:s=>{this.loggingService.logActivity("create","expense",s.id,s.productName,`$${s.price.toFixed(2)}`)},error:s=>console.error("Error adding expense:",s)}),b(()=>this.loadingService.hide()))}deleteExpense(e){return this.storeService.getActiveStoreId()?(this.loadingService.show("Deleting expense..."),S(we(y(this.db,"expenses",e))).pipe(P({next:()=>{let s=this.expensesSubject.value.find(o=>o.id===e);s&&this.loggingService.logActivity("delete","expense",e,s.productName,"Expense Deleted")},error:r=>console.error("Error deleting expense:",r)}),b(()=>this.loadingService.hide()))):E(()=>new Error("Store selection required for this transaction."))}addProduct(e){let i=this.storeService.getActiveStoreId();return i?(this.loadingService.show("Adding product..."),this.storeService.stores$.pipe(U(1),gt(r=>{let o=r.find(l=>l.id===i)?.subscriptionPlan||"Free",a=this.productsSubject.value.length,u=1/0;if(o==="Free"?u=10:(o==="Starter"||o.includes("Starter"))&&(u=2e3),a>=u)return E(()=>new Error(`Product Limit Reached for ${o} plan (${u}). Upgrade to store more.`));let d=this.sanitizeData(_(f({},e),{createdAt:new Date,storeId:i,userId:this.getFirestoreUserId()}));return S(Se(v(this.db,"products"),d)).pipe(re(l=>f({id:l.id},d)),P({next:l=>{this.loggingService.logActivity("create","product",l.id,l.name),this.recalculateAndSaveStats()},error:l=>this.handleFirestoreError(l,"Error adding product")}))}),b(()=>this.loadingService.hide()))):E(()=>new Error("Store selection required for this transaction."))}deleteProduct(e){if(!this.storeService.getActiveStoreId())return E(()=>new Error("Store selection required for this transaction."));let s=this.productsSubject.value.find(o=>o.id===e);return this.loadingService.show("Deleting product..."),S(we(y(this.db,"products",e))).pipe(P({next:()=>{this.loggingService.logActivity("delete","product",e,s?.name||"Product","Deleted")},error:o=>{this.handleFirestoreError(o,"Error deleting product")}}),b(()=>this.loadingService.hide()))}recordSale(e,i,r,s,o,a,u=0,d="amount",l){let m=this.productsSubject.value.find(ne=>ne.id===e);if(!m)return E(()=>new Error("Product not found"));if(m.quantity<i)return E(()=>new Error("Insufficient quantity"));let w=m.price*i;u>0&&(d==="percent"?w=w-w*(u/100):w=w-u),w=Math.max(0,Math.round(w*100)/100);let L=r-w;if(L<0)return E(()=>new Error("Insufficient cash"));let M=this.storeService.getActiveStoreId();return M?(this.loadingService.show("Recording sale..."),this.storeService.stores$.pipe(U(1),gt(ne=>{let pe=ne.find(N=>N.id===M);if(!this.storeService.hasTransactionCredits(M))return E(()=>new Error("Transaction Limit Reached. Please Upgrade to Pro or Top Up."));let z=!s;console.log("[recordSale] deliveryDate:",s),console.log("[recordSale] isImmediate:",z),console.log("[recordSale] pending:",!z);let G=this.sanitizeData({productId:m.id,productName:m.name,category:m.category,price:m.price,costPrice:m.cost||0,quantitySold:i,total:w,cashReceived:r,change:L,pending:!z,discount:u,discountType:d,timestamp:new Date,storeId:M,deliveryDate:s,deliveryNotes:o,customerId:a,orderId:l,userId:this.getFirestoreUserId()});return S(Se(v(this.db,"sales"),G)).pipe(re(N=>f({id:N.id},G)),P({next:N=>{this.storeService.deductTransactionCredit(M),z?(this.processSaleDeliveryLogic(N),this.loggingService.logActivity("create","sale",N.id,m.name,`Sold ${i} units (Delivered)`)):this.loggingService.logActivity("create","sale",N.id,m.name,`Sold ${i} units (Pending Delivery)`),this.recalculateAndSaveStats()},error:N=>{this.handleFirestoreError(N,"Error recording sale")}}))}),b(()=>this.loadingService.hide()))):E(()=>new Error("Store selection required for this transaction."))}completePendingSale(e){let i=this.salesSubject.value,r=i.find(o=>o.id===e);if(!r){console.error("Sale not found via ID");return}let s=y(this.db,"sales",e);this.loadingService.show("Completing sale..."),S(oe(s,{pending:!1})).pipe(b(()=>this.loadingService.hide())).subscribe({next:()=>{let o=i.map(a=>a.id===e?_(f({},a),{pending:!1}):a);this.salesSubject.next(o),this.processSaleDeliveryLogic(r),this.loggingService.logActivity("complete","sale",e,r.productName,`Marked as delivered & Deducted ${r.quantitySold} units`),this.notificationService.pushNotification("Delivery Confirmed! \u2705",`The order for ${r.customerName||"a customer"} has been delivered.`,x.DELIVERY),this.recalculateAndSaveStats()},error:o=>console.error("Error completing sale:",o)})}processSaleDeliveryLogic(e){let i=this.productsSubject.value,r=i.find(o=>o.id===e.productId);if(!r)return;let s=_(f({},r),{quantity:r.quantity-e.quantitySold});if(this.updateProduct(s).subscribe(),r.recipe&&r.recipe.length>0){let o=this.rawMaterials();r.recipe.forEach(a=>{let u=(Number(a.quantity)||0)*e.quantitySold,d=(Number(a.unitCost)||0)*u,l=o.find(h=>h.id===a.productId);if(l)this.addExpense({productName:`[Recipe Use] ${l.name} (for ${r.name})`,price:d,notes:`Production: Sold ${e.quantitySold} units of ${r.name}. Used ${u} of ${l.name}.`}).subscribe();else{let h=i.find(m=>m.id===a.productId);if(h){let m=_(f({},h),{quantity:h.quantity-u});this.updateProduct(m).subscribe(),this.addExpense({productName:`[Recipe Use] ${h.name} (for ${r.name})`,price:d,notes:`Production: Sold ${e.quantitySold} units of ${r.name}. Deducted ${u} from ${h.name} stock.`}).subscribe()}}})}else{let o=(e.costPrice||0)*e.quantitySold;o>0&&this.addExpense({productName:`[COGS] ${r.name}`,price:o,notes:`Automated Expense: Cost of goods sold for ${e.quantitySold} units.`}).subscribe()}if(e.customerId){let o=this.customerService.getCustomerById(e.customerId);if(o){let a=Math.floor(e.total/5e3);if(a>0){let u=o.credits||0;this.customerService.updateCustomer(o.id,{credits:u+a}),this.loggingService.logActivity("update","customer",o.id,o.name,`Awarded ${a} credits for purchase`)}}}}updateSale(e){let i=this.storeService.getActiveStoreId();if(!i){console.error("Store selection required to update sale.");return}let r=y(this.db,"sales",e.id),s=this.sanitizeData(_(f({},e),{storeId:i}));S(je(r,s,{merge:!0})).subscribe({next:()=>{this.loggingService.logActivity("update","sale",e.id,e.productName,"Updated delivery details")},error:o=>console.error("Error updating sale:",o)})}confirmReservation(e){if(!this.productsSubject.value.find(o=>o.id===e.productId)){console.error("Product not found for confirmation stock deduction");return}let s=y(this.db,"sales",e.id);this.loadingService.show("Confirming reservation..."),S(oe(s,{reservationStatus:"confirmed"})).pipe(b(()=>this.loadingService.hide())).subscribe({next:()=>{let a=this.salesSubject.value.map(u=>u.id===e.id?_(f({},u),{reservationStatus:"confirmed"}):u);this.salesSubject.next(a),this.loggingService.logActivity("update","sale",e.id,e.productName,"Confirmed reservation (Stock deduction pending delivery)")},error:o=>console.error("Error confirming reservation:",o)})}transformSale(e){return _(f({},e),{timestamp:this.parseDate(e.timestamp),deliveryDate:e.deliveryDate?this.parseDate(e.deliveryDate):void 0})}parseDate(e){if(!e)return new Date;if(e instanceof Date)return e;if(e&&typeof e.toDate=="function")return e.toDate();if(e&&(e.seconds!==void 0||e._seconds!==void 0)){let i=e.seconds??e._seconds;return new Date(i*1e3)}return typeof e=="string"?new Date(e):new Date(e)}restockProduct(e,i){let s=this.productsSubject.value.find(o=>o.id===e);if(s){let o=_(f({},s),{quantity:s.quantity+i});this.updateProduct(o).subscribe(),this.loggingService.logActivity("restock","product",e,s.name,`Added ${i} units`)}}deleteSale(e){let i=this._sales().find(r=>r.id===e);i&&!i.pending&&this.restockProduct(i.productId,i.quantitySold),this.loadingService.show("Deleting sale..."),S(we(y(this.db,"sales",e))).pipe(b(()=>this.loadingService.hide())).subscribe({next:()=>{this.loggingService.logActivity("delete","sale",e,i?.productName||"Sale",`Deleted sale record ${i&&!i.pending?"& Restored Stock":""}`),this.recalculateAndSaveStats()},error:r=>console.error("Error deleting sale:",r)})}updateProduct(e){let i=this.storeService.getActiveStoreId();if(!i)return E(()=>new Error("Store selection required for this transaction."));let r=this.sanitizeData(_(f({},e),{storeId:i,userId:this.getFirestoreUserId()}));return this.loadingService.show("Updating product..."),S(je(y(this.db,"products",e.id),r,{merge:!0})).pipe(re(()=>e),P({next:()=>{let s=this.salesSubject.value,o=s.filter(a=>a.productId===e.id&&a.productName!==e.name);if(o.length>0){let a=s.map(u=>u.productId===e.id?_(f({},u),{productName:e.name}):u);this.salesSubject.next(a),this._sales.set(a),o.forEach(u=>{oe(y(this.db,"sales",u.id),{productName:e.name}).catch(d=>console.error(`Error updating sale ${u.id} name:`,d))})}this.loggingService.logActivity("update","product",e.id,e.name),this.recalculateAndSaveStats()},error:s=>{this.handleFirestoreError(s,"Error updating product")}}),b(()=>this.loadingService.hide()))}recalculateAndSaveStats(){let e=this.storeService.getActiveStoreId();if(!e)return;let i=this.productsSubject.value,r=this.salesSubject.value,s=r.reduce((g,I)=>g+(I.total||0),0),o=r.reduce((g,I)=>{let ye=(I.costPrice||0)*(I.quantitySold||1);return g+((I.total||0)-ye)},0),a=new Date,u=new Date(a.getFullYear(),a.getMonth(),1),d=r.filter(g=>new Date(g.timestamp)>=u),l=d.reduce((g,I)=>g+(I.total||0),0),h=d.reduce((g,I)=>{let ye=(I.costPrice||0)*(I.quantitySold||1);return g+((I.total||0)-ye)},0),m=a.toISOString().split("T")[0],w=r.filter(g=>new Date(g.timestamp).toISOString().split("T")[0]===m),L=w.reduce((g,I)=>g+(I.total||0),0),M=w.reduce((g,I)=>{let ye=(I.costPrice||0)*(I.quantitySold||1);return g+((I.total||0)-ye)},0),ne=w.length,pe=i.length,z=i.filter(g=>(g.quantity||0)<=5).length,G={};r.forEach(g=>{let I=g.productId||g.productName;G[I]||(G[I]={name:g.productName,units:0,rev:0}),G[I].units+=g.quantitySold||1,G[I].rev+=g.total||0});let N=Object.values(G).sort((g,I)=>I.rev-g.rev).slice(0,5).map(g=>({name:g.name,unitsSold:g.units,revenue:g.rev})),ft={};i.forEach(g=>{let I=g.category||"Others";ft[I]=(ft[I]||0)+1});let cr=Object.entries(ft).map(([g,I])=>({name:g,percentage:Math.round(I/(i.length||1)*100)})),ur=[...r].sort((g,I)=>new Date(I.timestamp).getTime()-new Date(g.timestamp).getTime()).slice(0,5),ve={};r.forEach(g=>{let I=g.customerId||g.customerName||"Walk-in";ve[I]||(ve[I]={name:g.customerName||"Customer",totalSpent:0,ordersCount:0}),ve[I].totalSpent+=g.total||0,ve[I].ordersCount+=1});let dr=Object.values(ve).sort((g,I)=>I.totalSpent-g.totalSpent).slice(0,5),lr={totalRevenue:s,mtdRevenue:l,todayRevenue:L,totalProfit:o,mtdProfit:h,todayProfit:M,todayOrdersCount:ne,totalProductsCount:pe,lowStockCount:z,lastUpdated:new Date,storeId:e,topSellingProducts:N,categoryDistribution:cr,recentOrders:ur,topCustomers:dr},hr=this.sanitizeData(lr);je(y(this.db,"stats",e),hr).catch(g=>console.error("Error updating aggregation document:",g))}sanitizeData(e){if(e===null||typeof e!="object"||e instanceof Date)return e;if(Array.isArray(e))return e.map(r=>this.sanitizeData(r));let i={};return Object.keys(e).forEach(r=>{let s=e[r];s!==void 0&&(i[r]=this.sanitizeData(s))}),i}addRawMaterial(e){let i=this.storeService.getActiveStoreId();if(!i)return E(()=>new Error("Store ID required."));let r=_(f({},e),{createdAt:new Date,storeId:i,userId:this.getFirestoreUserId()});return this.loadingService.show("Adding raw material..."),S(Se(v(this.db,"rawMaterials"),r)).pipe(re(s=>f({id:s.id},r)),P({next:s=>{let a=[...this._rawMaterials(),s];this._rawMaterials.set(a),this.rawMaterialsSubject.next(a),this.recalculateAndSaveStats()},error:s=>this.handleFirestoreError(s,"Error adding raw material")}),b(()=>this.loadingService.hide()))}updateRawMaterial(e){return this.loadingService.show("Updating raw material..."),S(oe(y(this.db,"rawMaterials",e.id),{name:e.name,cost:e.cost})).pipe(P(()=>{let r=this._rawMaterials().map(s=>s.id===e.id?e:s);this._rawMaterials.set(r),this.rawMaterialsSubject.next(r),this.recalculateAndSaveStats()}),ge(i=>E(()=>this.handleFirestoreError(i,"Error updating raw material"))),b(()=>this.loadingService.hide()))}deleteRawMaterial(e){return this.loadingService.show("Deleting raw material..."),S(we(y(this.db,"rawMaterials",e))).pipe(P(()=>{let r=this._rawMaterials().filter(s=>s.id!==e);this._rawMaterials.set(r),this.rawMaterialsSubject.next(r),this.recalculateAndSaveStats()}),ge(i=>E(()=>this.handleFirestoreError(i,"Error deleting raw material"))),b(()=>this.loadingService.hide()))}static{this.\u0275fac=function(i){return new(i||n)(k(Rn),k(Pn),k(Ve),k(We),k(bi),k(ar),k(qe),k(Le))}}static{this.\u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{bi as a,x as b,ar as c,Fu as d};
