import{P as Qc,pc as Wc}from"./chunk-BT24UGZY.js";import{a as dt,b as Vn,g as C}from"./chunk-7QOE2ANW.js";var Hc=()=>{};var Yc=function(n){let t=[],e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Td=function(n){let t=[],e=0,r=0;for(;e<n.length;){let s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){let o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){let o=n[e++],a=n[e++],l=n[e++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[e++],a=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return t.join("")},Zc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){let o=n[s],a=s+1<n.length,l=a?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,m=o>>2,E=(o&3)<<4|l>>4,A=(l&15)<<2|f>>6,R=f&63;h||(R=64,a||(A=64)),r.push(e[m],e[E],e[A],e[R])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Yc(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Td(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){let o=e[n.charAt(s++)],l=s<n.length?e[n.charAt(s)]:0;++s;let f=s<n.length?e[n.charAt(s)]:64;++s;let E=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||l==null||f==null||E==null)throw new Ys;let A=o<<2|l>>4;if(r.push(A),f!==64){let R=l<<4&240|f>>2;if(r.push(R),E!==64){let k=f<<6&192|E;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Ys=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},vd=function(n){let t=Yc(n);return Zc.encodeByteArray(t,!0)},Nn=function(n){return vd(n).replace(/\./g,"")},tu=function(n){try{return Zc.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function eu(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Ad=()=>eu().__FIREBASE_DEFAULTS__,bd=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Sd=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&tu(n[1]);return t&&JSON.parse(t)},br=()=>{try{return Hc()||Ad()||bd()||Sd()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Rd=n=>br()?.emulatorHosts?.[n],nu=n=>{let t=Rd(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},ti=()=>br()?.config,Wp=n=>br()?.[`_${n}`];var Ar=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}};function On(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function ei(n){return C(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function ru(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=dt({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Nn(JSON.stringify(e)),Nn(JSON.stringify(a)),""].join(".")}var xn={};function Pd(){let n={prod:[],emulator:[]};for(let t of Object.keys(xn))xn[t]?n.emulator.push(t):n.prod.push(t);return n}function Cd(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}var Jc=!1;function su(n,t){if(typeof window>"u"||typeof document>"u"||!On(window.location.host)||xn[n]===t||xn[n]||Jc)return;xn[n]=t;function e(A){return`__firebase__banner__${A}`}let r="__firebase__banner",o=Pd().prod.length>0;function a(){let A=document.getElementById(r);A&&A.remove()}function l(A){A.style.display="flex",A.style.background="#7faaf0",A.style.position="fixed",A.style.bottom="5px",A.style.left="5px",A.style.padding=".5em",A.style.borderRadius="5px",A.style.alignItems="center"}function h(A,R){A.setAttribute("width","24"),A.setAttribute("id",R),A.setAttribute("height","24"),A.setAttribute("viewBox","0 0 24 24"),A.setAttribute("fill","none"),A.style.marginLeft="-6px"}function f(){let A=document.createElement("span");return A.style.cursor="pointer",A.style.marginLeft="16px",A.style.fontSize="24px",A.innerHTML=" &times;",A.onclick=()=>{Jc=!0,a()},A}function m(A,R){A.setAttribute("id",R),A.innerText="Learn more",A.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",A.setAttribute("target","__blank"),A.style.paddingLeft="5px",A.style.textDecoration="underline"}function E(){let A=Cd(r),R=e("text"),k=document.getElementById(R)||document.createElement("span"),O=e("learnmore"),x=document.getElementById(O)||document.createElement("a"),$=e("preprendIcon"),K=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(A.created){let Q=A.element;l(Q),m(x,O);let gt=f();h(K,$),Q.append(K,k,x,gt),document.body.appendChild(Q)}o?(k.innerText="Preview backend disconnected.",K.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(K.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function Sr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Hp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Sr())}function Dd(){let n=br()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Jp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Xp(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Yp(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Zp(){let n=Sr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function iu(){return!Dd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ni(){try{return typeof indexedDB=="object"}catch{return!1}}function ou(){return new Promise((n,t)=>{try{let e=!0,r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}function tg(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}var Vd="FirebaseError",Ut=class n extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Vd,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kn.prototype.create)}},kn=class{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){let r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],a=o?xd(o,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new Ut(s,l,r)}};function xd(n,t){return n.replace(Nd,(e,r)=>{let s=t[r];return s!=null?String(s):`<${r}?>`})}var Nd=/\{\$([^}]+)}/g;function eg(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function se(n,t){if(n===t)return!0;let e=Object.keys(n),r=Object.keys(t);for(let s of e){if(!r.includes(s))return!1;let o=n[s],a=t[s];if(Xc(o)&&Xc(a)){if(!se(o,a))return!1}else if(o!==a)return!1}for(let s of r)if(!e.includes(s))return!1;return!0}function Xc(n){return n!==null&&typeof n=="object"}function ng(n){let t=[];for(let[e,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function rg(n,t){let e=new Zs(n,t);return e.subscribe.bind(e)}var Zs=class{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(r=>{this.error(r)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,r){let s;if(t===void 0&&e===void 0&&r===void 0)throw new Error("Missing Observer.");kd(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:r},s.next===void 0&&(s.next=Xs),s.error===void 0&&(s.error=Xs),s.complete===void 0&&(s.complete=Xs);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function kd(n,t){if(typeof n!="object"||n===null)return!1;for(let e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function Xs(){}var sg=4*60*60*1e3;function Tt(n){return n&&n._delegate?n._delegate:n}var qt=class{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var ve="[DEFAULT]";var ri=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let r=new Ar;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){let e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Md(t))try{this.getOrInitializeService({instanceIdentifier:ve})}catch{}for(let[e,r]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=ve){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return C(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=ve){return this.instances.has(t)}getOptions(t=ve){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(let[o,a]of this.instancesDeferred.entries()){let l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(s)}return s}onInit(t,e){let r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);let o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){let r=this.onInitCallbacks.get(e);if(r)for(let s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Od(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=ve){return this.component?this.component.multipleInstances?t:ve:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Od(n){return n===ve?void 0:n}function Md(n){return n.instantiationMode==="EAGER"}var Rr=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new ri(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var Fd=[],z=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(z||{}),Ld={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},Bd=z.INFO,Ud={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},qd=(n,t,...e)=>{if(t<n.logLevel)return;let r=new Date().toISOString(),s=Ud[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},Be=class{constructor(t){this.name=t,this._logLevel=Bd,this._logHandler=qd,this._userLogHandler=null,Fd.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in z))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ld[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...t),this._logHandler(this,z.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...t),this._logHandler(this,z.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,z.INFO,...t),this._logHandler(this,z.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,z.WARN,...t),this._logHandler(this,z.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...t),this._logHandler(this,z.ERROR,...t)}};var jd=(n,t)=>t.some(e=>n instanceof e),au,cu;function zd(){return au||(au=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Gd(){return cu||(cu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var uu=new WeakMap,ii=new WeakMap,lu=new WeakMap,si=new WeakMap,ai=new WeakMap;function $d(n){let t=new Promise((e,r)=>{let s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{e(Pt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&uu.set(e,n)}).catch(()=>{}),ai.set(t,n),t}function Kd(n){if(ii.has(n))return;let t=new Promise((e,r)=>{let s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{e(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});ii.set(n,t)}var oi={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return ii.get(n);if(t==="objectStoreNames")return n.objectStoreNames||lu.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Pt(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function hu(n){oi=n(oi)}function Qd(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let r=n.call(Pr(this),t,...e);return lu.set(r,t.sort?t.sort():[t]),Pt(r)}:Gd().includes(n)?function(...t){return n.apply(Pr(this),t),Pt(uu.get(this))}:function(...t){return Pt(n.apply(Pr(this),t))}}function Wd(n){return typeof n=="function"?Qd(n):(n instanceof IDBTransaction&&Kd(n),jd(n,zd())?new Proxy(n,oi):n)}function Pt(n){if(n instanceof IDBRequest)return $d(n);if(si.has(n))return si.get(n);let t=Wd(n);return t!==n&&(si.set(n,t),ai.set(t,n)),t}var Pr=n=>ai.get(n);function fu(n,t,{blocked:e,upgrade:r,blocking:s,terminated:o}={}){let a=indexedDB.open(n,t),l=Pt(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Pt(a.result),h.oldVersion,h.newVersion,Pt(a.transaction),h)}),e&&a.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}function fg(n,{blocked:t}={}){let e=indexedDB.deleteDatabase(n);return t&&e.addEventListener("blocked",r=>t(r.oldVersion,r)),Pt(e).then(()=>{})}var Hd=["get","getKey","getAll","getAllKeys","count"],Jd=["put","add","delete","clear"],ci=new Map;function du(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(ci.get(t))return ci.get(t);let e=t.replace(/FromIndex$/,""),r=t!==e,s=Jd.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Hd.includes(e)))return;let o=function(a,...l){return C(this,null,function*(){let h=this.transaction(a,s?"readwrite":"readonly"),f=h.store;return r&&(f=f.index(l.shift())),(yield Promise.all([f[e](...l),s&&h.done]))[0]})};return ci.set(t,o),o}hu(n=>Vn(dt({},n),{get:(t,e,r)=>du(t,e)||n.get(t,e,r),has:(t,e)=>!!du(t,e)||n.has(t,e)}));var li=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Xd(e)){let r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}};function Xd(n){return n.getComponent()?.type==="VERSION"}var hi="@firebase/app",mu="0.14.6";var jt=new Be("@firebase/app"),Yd="@firebase/app-compat",Zd="@firebase/analytics-compat",tf="@firebase/analytics",ef="@firebase/app-check-compat",nf="@firebase/app-check",rf="@firebase/auth",sf="@firebase/auth-compat",of="@firebase/database",af="@firebase/data-connect",cf="@firebase/database-compat",uf="@firebase/functions",lf="@firebase/functions-compat",hf="@firebase/installations",df="@firebase/installations-compat",ff="@firebase/messaging",mf="@firebase/messaging-compat",pf="@firebase/performance",gf="@firebase/performance-compat",yf="@firebase/remote-config",_f="@firebase/remote-config-compat",wf="@firebase/storage",Ef="@firebase/storage-compat",If="@firebase/firestore",Tf="@firebase/ai",vf="@firebase/firestore-compat",Af="firebase",bf="12.6.0";var di="[DEFAULT]",Sf={[hi]:"fire-core",[Yd]:"fire-core-compat",[tf]:"fire-analytics",[Zd]:"fire-analytics-compat",[nf]:"fire-app-check",[ef]:"fire-app-check-compat",[rf]:"fire-auth",[sf]:"fire-auth-compat",[of]:"fire-rtdb",[af]:"fire-data-connect",[cf]:"fire-rtdb-compat",[uf]:"fire-fn",[lf]:"fire-fn-compat",[hf]:"fire-iid",[df]:"fire-iid-compat",[ff]:"fire-fcm",[mf]:"fire-fcm-compat",[pf]:"fire-perf",[gf]:"fire-perf-compat",[yf]:"fire-rc",[_f]:"fire-rc-compat",[wf]:"fire-gcs",[Ef]:"fire-gcs-compat",[If]:"fire-fst",[vf]:"fire-fst-compat",[Tf]:"fire-vertex","fire-js":"fire-js",[Af]:"fire-js-all"};var Mn=new Map,Rf=new Map,fi=new Map;function pu(n,t){try{n.container.addComponent(t)}catch(e){jt.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function Fn(n){let t=n.name;if(fi.has(t))return jt.debug(`There were multiple attempts to register component ${t}.`),!1;fi.set(t,n);for(let e of Mn.values())pu(e,n);for(let e of Rf.values())pu(e,n);return!0}function yi(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function wu(n){return n==null?!1:n.settings!==void 0}var Pf={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ie=new kn("app","Firebase",Pf);var mi=class{constructor(t,e,r){this._isDeleted=!1,this._options=dt({},t),this._config=dt({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new qt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ie.create("app-deleted",{appName:this._name})}};var Eu=bf;function _i(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let r=dt({name:di,automaticDataCollectionEnabled:!0},t),s=r.name;if(typeof s!="string"||!s)throw ie.create("bad-app-name",{appName:String(s)});if(e||(e=ti()),!e)throw ie.create("no-options");let o=Mn.get(s);if(o){if(se(e,o.options)&&se(r,o.config))return o;throw ie.create("duplicate-app",{appName:s})}let a=new Rr(s);for(let h of fi.values())a.addComponent(h);let l=new mi(e,r,a);return Mn.set(s,l),l}function Cr(n=di){let t=Mn.get(n);if(!t&&n===di&&ti())return _i();if(!t)throw ie.create("no-app",{appName:n});return t}function Iu(){return Array.from(Mn.values())}function oe(n,t,e){let r=Sf[n]??n;e&&(r+=`-${e}`);let s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let a=[`Unable to register library "${r}" with version "${t}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),jt.warn(a.join(" "));return}Fn(new qt(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}var Cf="firebase-heartbeat-database",Df=1,Ln="firebase-heartbeat-store",ui=null;function Tu(){return ui||(ui=fu(Cf,Df,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Ln)}catch(e){console.warn(e)}}}}).catch(n=>{throw ie.create("idb-open",{originalErrorMessage:n.message})})),ui}function Vf(n){return C(this,null,function*(){try{let e=(yield Tu()).transaction(Ln),r=yield e.objectStore(Ln).get(vu(n));return yield e.done,r}catch(t){if(t instanceof Ut)jt.warn(t.message);else{let e=ie.create("idb-get",{originalErrorMessage:t?.message});jt.warn(e.message)}}})}function gu(n,t){return C(this,null,function*(){try{let r=(yield Tu()).transaction(Ln,"readwrite");yield r.objectStore(Ln).put(t,vu(n)),yield r.done}catch(e){if(e instanceof Ut)jt.warn(e.message);else{let r=ie.create("idb-set",{originalErrorMessage:e?.message});jt.warn(r.message)}}})}function vu(n){return`${n.name}!${n.options.appId}`}var xf=1024,Nf=30,pi=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new gi(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return C(this,null,function*(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=yu();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>Nf){let s=Of(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){jt.warn(t)}})}getHeartbeatsHeader(){return C(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=yu(),{heartbeatsToSend:e,unsentEntries:r}=kf(this._heartbeatsCache.heartbeats),s=Nn(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return jt.warn(t),""}})}};function yu(){return new Date().toISOString().substring(0,10)}function kf(n,t=xf){let e=[],r=n.slice();for(let s of n){let o=e.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),_u(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),_u(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}var gi=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return C(this,null,function*(){return ni()?ou().then(()=>!0).catch(()=>!1):!1})}read(){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield Vf(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return gu(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return gu(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return})}};function _u(n){return Nn(JSON.stringify({version:2,heartbeats:n})).length}function Of(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function Mf(n){Fn(new qt("platform-logger",t=>new li(t),"PRIVATE")),Fn(new qt("heartbeat",t=>new pi(t),"PRIVATE")),oe(hi,mu,n),oe(hi,mu,"esm2020"),oe("fire-js","")}Mf("");var Au=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bu={};var zt,wi;(function(){var n;function t(w,p){function y(){}y.prototype=p.prototype,w.F=p.prototype,w.prototype=new y,w.prototype.constructor=w,w.D=function(I,_,v){for(var g=Array(arguments.length-2),Et=2;Et<arguments.length;Et++)g[Et-2]=arguments[Et];return p.prototype[_].apply(I,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,e),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,p,y){y||(y=0);let I=Array(16);if(typeof p=="string")for(var _=0;_<16;++_)I[_]=p.charCodeAt(y++)|p.charCodeAt(y++)<<8|p.charCodeAt(y++)<<16|p.charCodeAt(y++)<<24;else for(_=0;_<16;++_)I[_]=p[y++]|p[y++]<<8|p[y++]<<16|p[y++]<<24;p=w.g[0],y=w.g[1],_=w.g[2];let v=w.g[3],g;g=p+(v^y&(_^v))+I[0]+3614090360&4294967295,p=y+(g<<7&4294967295|g>>>25),g=v+(_^p&(y^_))+I[1]+3905402710&4294967295,v=p+(g<<12&4294967295|g>>>20),g=_+(y^v&(p^y))+I[2]+606105819&4294967295,_=v+(g<<17&4294967295|g>>>15),g=y+(p^_&(v^p))+I[3]+3250441966&4294967295,y=_+(g<<22&4294967295|g>>>10),g=p+(v^y&(_^v))+I[4]+4118548399&4294967295,p=y+(g<<7&4294967295|g>>>25),g=v+(_^p&(y^_))+I[5]+1200080426&4294967295,v=p+(g<<12&4294967295|g>>>20),g=_+(y^v&(p^y))+I[6]+2821735955&4294967295,_=v+(g<<17&4294967295|g>>>15),g=y+(p^_&(v^p))+I[7]+4249261313&4294967295,y=_+(g<<22&4294967295|g>>>10),g=p+(v^y&(_^v))+I[8]+1770035416&4294967295,p=y+(g<<7&4294967295|g>>>25),g=v+(_^p&(y^_))+I[9]+2336552879&4294967295,v=p+(g<<12&4294967295|g>>>20),g=_+(y^v&(p^y))+I[10]+4294925233&4294967295,_=v+(g<<17&4294967295|g>>>15),g=y+(p^_&(v^p))+I[11]+2304563134&4294967295,y=_+(g<<22&4294967295|g>>>10),g=p+(v^y&(_^v))+I[12]+1804603682&4294967295,p=y+(g<<7&4294967295|g>>>25),g=v+(_^p&(y^_))+I[13]+4254626195&4294967295,v=p+(g<<12&4294967295|g>>>20),g=_+(y^v&(p^y))+I[14]+2792965006&4294967295,_=v+(g<<17&4294967295|g>>>15),g=y+(p^_&(v^p))+I[15]+1236535329&4294967295,y=_+(g<<22&4294967295|g>>>10),g=p+(_^v&(y^_))+I[1]+4129170786&4294967295,p=y+(g<<5&4294967295|g>>>27),g=v+(y^_&(p^y))+I[6]+3225465664&4294967295,v=p+(g<<9&4294967295|g>>>23),g=_+(p^y&(v^p))+I[11]+643717713&4294967295,_=v+(g<<14&4294967295|g>>>18),g=y+(v^p&(_^v))+I[0]+3921069994&4294967295,y=_+(g<<20&4294967295|g>>>12),g=p+(_^v&(y^_))+I[5]+3593408605&4294967295,p=y+(g<<5&4294967295|g>>>27),g=v+(y^_&(p^y))+I[10]+38016083&4294967295,v=p+(g<<9&4294967295|g>>>23),g=_+(p^y&(v^p))+I[15]+3634488961&4294967295,_=v+(g<<14&4294967295|g>>>18),g=y+(v^p&(_^v))+I[4]+3889429448&4294967295,y=_+(g<<20&4294967295|g>>>12),g=p+(_^v&(y^_))+I[9]+568446438&4294967295,p=y+(g<<5&4294967295|g>>>27),g=v+(y^_&(p^y))+I[14]+3275163606&4294967295,v=p+(g<<9&4294967295|g>>>23),g=_+(p^y&(v^p))+I[3]+4107603335&4294967295,_=v+(g<<14&4294967295|g>>>18),g=y+(v^p&(_^v))+I[8]+1163531501&4294967295,y=_+(g<<20&4294967295|g>>>12),g=p+(_^v&(y^_))+I[13]+2850285829&4294967295,p=y+(g<<5&4294967295|g>>>27),g=v+(y^_&(p^y))+I[2]+4243563512&4294967295,v=p+(g<<9&4294967295|g>>>23),g=_+(p^y&(v^p))+I[7]+1735328473&4294967295,_=v+(g<<14&4294967295|g>>>18),g=y+(v^p&(_^v))+I[12]+2368359562&4294967295,y=_+(g<<20&4294967295|g>>>12),g=p+(y^_^v)+I[5]+4294588738&4294967295,p=y+(g<<4&4294967295|g>>>28),g=v+(p^y^_)+I[8]+2272392833&4294967295,v=p+(g<<11&4294967295|g>>>21),g=_+(v^p^y)+I[11]+1839030562&4294967295,_=v+(g<<16&4294967295|g>>>16),g=y+(_^v^p)+I[14]+4259657740&4294967295,y=_+(g<<23&4294967295|g>>>9),g=p+(y^_^v)+I[1]+2763975236&4294967295,p=y+(g<<4&4294967295|g>>>28),g=v+(p^y^_)+I[4]+1272893353&4294967295,v=p+(g<<11&4294967295|g>>>21),g=_+(v^p^y)+I[7]+4139469664&4294967295,_=v+(g<<16&4294967295|g>>>16),g=y+(_^v^p)+I[10]+3200236656&4294967295,y=_+(g<<23&4294967295|g>>>9),g=p+(y^_^v)+I[13]+681279174&4294967295,p=y+(g<<4&4294967295|g>>>28),g=v+(p^y^_)+I[0]+3936430074&4294967295,v=p+(g<<11&4294967295|g>>>21),g=_+(v^p^y)+I[3]+3572445317&4294967295,_=v+(g<<16&4294967295|g>>>16),g=y+(_^v^p)+I[6]+76029189&4294967295,y=_+(g<<23&4294967295|g>>>9),g=p+(y^_^v)+I[9]+3654602809&4294967295,p=y+(g<<4&4294967295|g>>>28),g=v+(p^y^_)+I[12]+3873151461&4294967295,v=p+(g<<11&4294967295|g>>>21),g=_+(v^p^y)+I[15]+530742520&4294967295,_=v+(g<<16&4294967295|g>>>16),g=y+(_^v^p)+I[2]+3299628645&4294967295,y=_+(g<<23&4294967295|g>>>9),g=p+(_^(y|~v))+I[0]+4096336452&4294967295,p=y+(g<<6&4294967295|g>>>26),g=v+(y^(p|~_))+I[7]+1126891415&4294967295,v=p+(g<<10&4294967295|g>>>22),g=_+(p^(v|~y))+I[14]+2878612391&4294967295,_=v+(g<<15&4294967295|g>>>17),g=y+(v^(_|~p))+I[5]+4237533241&4294967295,y=_+(g<<21&4294967295|g>>>11),g=p+(_^(y|~v))+I[12]+1700485571&4294967295,p=y+(g<<6&4294967295|g>>>26),g=v+(y^(p|~_))+I[3]+2399980690&4294967295,v=p+(g<<10&4294967295|g>>>22),g=_+(p^(v|~y))+I[10]+4293915773&4294967295,_=v+(g<<15&4294967295|g>>>17),g=y+(v^(_|~p))+I[1]+2240044497&4294967295,y=_+(g<<21&4294967295|g>>>11),g=p+(_^(y|~v))+I[8]+1873313359&4294967295,p=y+(g<<6&4294967295|g>>>26),g=v+(y^(p|~_))+I[15]+4264355552&4294967295,v=p+(g<<10&4294967295|g>>>22),g=_+(p^(v|~y))+I[6]+2734768916&4294967295,_=v+(g<<15&4294967295|g>>>17),g=y+(v^(_|~p))+I[13]+1309151649&4294967295,y=_+(g<<21&4294967295|g>>>11),g=p+(_^(y|~v))+I[4]+4149444226&4294967295,p=y+(g<<6&4294967295|g>>>26),g=v+(y^(p|~_))+I[11]+3174756917&4294967295,v=p+(g<<10&4294967295|g>>>22),g=_+(p^(v|~y))+I[2]+718787259&4294967295,_=v+(g<<15&4294967295|g>>>17),g=y+(v^(_|~p))+I[9]+3951481745&4294967295,w.g[0]=w.g[0]+p&4294967295,w.g[1]=w.g[1]+(_+(g<<21&4294967295|g>>>11))&4294967295,w.g[2]=w.g[2]+_&4294967295,w.g[3]=w.g[3]+v&4294967295}r.prototype.v=function(w,p){p===void 0&&(p=w.length);let y=p-this.blockSize,I=this.C,_=this.h,v=0;for(;v<p;){if(_==0)for(;v<=y;)s(this,w,v),v+=this.blockSize;if(typeof w=="string"){for(;v<p;)if(I[_++]=w.charCodeAt(v++),_==this.blockSize){s(this,I),_=0;break}}else for(;v<p;)if(I[_++]=w[v++],_==this.blockSize){s(this,I),_=0;break}}this.h=_,this.o+=p},r.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var p=1;p<w.length-8;++p)w[p]=0;p=this.o*8;for(var y=w.length-8;y<w.length;++y)w[y]=p&255,p/=256;for(this.v(w),w=Array(16),p=0,y=0;y<4;++y)for(let I=0;I<32;I+=8)w[p++]=this.g[y]>>>I&255;return w};function o(w,p){var y=l;return Object.prototype.hasOwnProperty.call(y,w)?y[w]:y[w]=p(w)}function a(w,p){this.h=p;let y=[],I=!0;for(let _=w.length-1;_>=0;_--){let v=w[_]|0;I&&v==p||(y[_]=v,I=!1)}this.g=y}var l={};function h(w){return-128<=w&&w<128?o(w,function(p){return new a([p|0],p<0?-1:0)}):new a([w|0],w<0?-1:0)}function f(w){if(isNaN(w)||!isFinite(w))return E;if(w<0)return x(f(-w));let p=[],y=1;for(let I=0;w>=y;I++)p[I]=w/y|0,y*=4294967296;return new a(p,0)}function m(w,p){if(w.length==0)throw Error("number format error: empty string");if(p=p||10,p<2||36<p)throw Error("radix out of range: "+p);if(w.charAt(0)=="-")return x(m(w.substring(1),p));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');let y=f(Math.pow(p,8)),I=E;for(let v=0;v<w.length;v+=8){var _=Math.min(8,w.length-v);let g=parseInt(w.substring(v,v+_),p);_<8?(_=f(Math.pow(p,_)),I=I.j(_).add(f(g))):(I=I.j(y),I=I.add(f(g)))}return I}var E=h(0),A=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(O(this))return-x(this).m();let w=0,p=1;for(let y=0;y<this.g.length;y++){let I=this.i(y);w+=(I>=0?I:4294967296+I)*p,p*=4294967296}return w},n.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(O(this))return"-"+x(this).toString(w);let p=f(Math.pow(w,6));var y=this;let I="";for(;;){let _=gt(y,p).g;y=$(y,_.j(p));let v=((y.g.length>0?y.g[0]:y.h)>>>0).toString(w);if(y=_,k(y))return v+I;for(;v.length<6;)v="0"+v;I=v+I}},n.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(let p=0;p<w.g.length;p++)if(w.g[p]!=0)return!1;return!0}function O(w){return w.h==-1}n.l=function(w){return w=$(this,w),O(w)?-1:k(w)?0:1};function x(w){let p=w.g.length,y=[];for(let I=0;I<p;I++)y[I]=~w.g[I];return new a(y,~w.h).add(A)}n.abs=function(){return O(this)?x(this):this},n.add=function(w){let p=Math.max(this.g.length,w.g.length),y=[],I=0;for(let _=0;_<=p;_++){let v=I+(this.i(_)&65535)+(w.i(_)&65535),g=(v>>>16)+(this.i(_)>>>16)+(w.i(_)>>>16);I=g>>>16,v&=65535,g&=65535,y[_]=g<<16|v}return new a(y,y[y.length-1]&-2147483648?-1:0)};function $(w,p){return w.add(x(p))}n.j=function(w){if(k(this)||k(w))return E;if(O(this))return O(w)?x(this).j(x(w)):x(x(this).j(w));if(O(w))return x(this.j(x(w)));if(this.l(R)<0&&w.l(R)<0)return f(this.m()*w.m());let p=this.g.length+w.g.length,y=[];for(var I=0;I<2*p;I++)y[I]=0;for(I=0;I<this.g.length;I++)for(let _=0;_<w.g.length;_++){let v=this.i(I)>>>16,g=this.i(I)&65535,Et=w.i(_)>>>16,Xt=w.i(_)&65535;y[2*I+2*_]+=g*Xt,K(y,2*I+2*_),y[2*I+2*_+1]+=v*Xt,K(y,2*I+2*_+1),y[2*I+2*_+1]+=g*Et,K(y,2*I+2*_+1),y[2*I+2*_+2]+=v*Et,K(y,2*I+2*_+2)}for(w=0;w<p;w++)y[w]=y[2*w+1]<<16|y[2*w];for(w=p;w<2*p;w++)y[w]=0;return new a(y,0)};function K(w,p){for(;(w[p]&65535)!=w[p];)w[p+1]+=w[p]>>>16,w[p]&=65535,p++}function Q(w,p){this.g=w,this.h=p}function gt(w,p){if(k(p))throw Error("division by zero");if(k(w))return new Q(E,E);if(O(w))return p=gt(x(w),p),new Q(x(p.g),x(p.h));if(O(p))return p=gt(w,x(p)),new Q(x(p.g),p.h);if(w.g.length>30){if(O(w)||O(p))throw Error("slowDivide_ only works with positive integers.");for(var y=A,I=p;I.l(w)<=0;)y=wt(y),I=wt(I);var _=at(y,1),v=at(I,1);for(I=at(I,2),y=at(y,2);!k(I);){var g=v.add(I);g.l(w)<=0&&(_=_.add(y),v=g),I=at(I,1),y=at(y,1)}return p=$(w,_.j(p)),new Q(_,p)}for(_=E;w.l(p)>=0;){for(y=Math.max(1,Math.floor(w.m()/p.m())),I=Math.ceil(Math.log(y)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),v=f(y),g=v.j(p);O(g)||g.l(w)>0;)y-=I,v=f(y),g=v.j(p);k(v)&&(v=A),_=_.add(v),w=$(w,g)}return new Q(_,w)}n.B=function(w){return gt(this,w).h},n.and=function(w){let p=Math.max(this.g.length,w.g.length),y=[];for(let I=0;I<p;I++)y[I]=this.i(I)&w.i(I);return new a(y,this.h&w.h)},n.or=function(w){let p=Math.max(this.g.length,w.g.length),y=[];for(let I=0;I<p;I++)y[I]=this.i(I)|w.i(I);return new a(y,this.h|w.h)},n.xor=function(w){let p=Math.max(this.g.length,w.g.length),y=[];for(let I=0;I<p;I++)y[I]=this.i(I)^w.i(I);return new a(y,this.h^w.h)};function wt(w){let p=w.g.length+1,y=[];for(let I=0;I<p;I++)y[I]=w.i(I)<<1|w.i(I-1)>>>31;return new a(y,w.h)}function at(w,p){let y=p>>5;p%=32;let I=w.g.length-y,_=[];for(let v=0;v<I;v++)_[v]=p>0?w.i(v+y)>>>p|w.i(v+y+1)<<32-p:w.i(v+y);return new a(_,w.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,wi=bu.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=m,zt=bu.Integer=a}).apply(typeof Au<"u"?Au:typeof self<"u"?self:typeof window<"u"?window:{});var Dr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gt={};var Ei,Ff,Ue,Ii,Bn,Vr,Ti,vi,Ai;(function(){var n,t=Object.defineProperty;function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Dr=="object"&&Dr];for(var c=0;c<i.length;++c){var u=i[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=e(this);function s(i,c){if(c)t:{var u=r;i=i.split(".");for(var d=0;d<i.length-1;d++){var T=i[d];if(!(T in u))break t;u=u[T]}i=i[i.length-1],d=u[i],c=c(d),c!=d&&c!=null&&t(u,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var u=[],d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&u.push([d,c[d]]);return u}});var o=o||{},a=this||self;function l(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,u){return i.call.apply(i.bind,arguments)}function f(i,c,u){return f=h,f.apply(null,arguments)}function m(i,c){var u=Array.prototype.slice.call(arguments,1);return function(){var d=u.slice();return d.push.apply(d,arguments),i.apply(this,d)}}function E(i,c){function u(){}u.prototype=c.prototype,i.Z=c.prototype,i.prototype=new u,i.prototype.constructor=i,i.Ob=function(d,T,b){for(var D=Array(arguments.length-2),U=2;U<arguments.length;U++)D[U-2]=arguments[U];return c.prototype[T].apply(d,D)}}var A=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function R(i){let c=i.length;if(c>0){let u=Array(c);for(let d=0;d<c;d++)u[d]=i[d];return u}return[]}function k(i,c){for(let d=1;d<arguments.length;d++){let T=arguments[d];var u=typeof T;if(u=u!="object"?u:T?Array.isArray(T)?"array":u:"null",u=="array"||u=="object"&&typeof T.length=="number"){u=i.length||0;let b=T.length||0;i.length=u+b;for(let D=0;D<b;D++)i[u+D]=T[D]}else i.push(T)}}class O{constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function x(i){a.setTimeout(()=>{throw i},0)}function $(){var i=w;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class K{constructor(){this.h=this.g=null}add(c,u){let d=Q.get();d.set(c,u),this.h?this.h.next=d:this.g=d,this.h=d}}var Q=new O(()=>new gt,i=>i.reset());class gt{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let wt,at=!1,w=new K,p=()=>{let i=Promise.resolve(void 0);wt=()=>{i.then(y)}};function y(){for(var i;i=$();){try{i.h.call(i.g)}catch(u){x(u)}var c=Q;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}at=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}_.prototype.h=function(){this.defaultPrevented=!0};var v=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{let u=()=>{};a.addEventListener("test",u,c),a.removeEventListener("test",u,c)}catch{}return i}();function g(i){return/^[\s\xa0]*$/.test(i)}function Et(i,c){_.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}E(Et,_),Et.prototype.init=function(i,c){let u=this.type=i.type,d=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(u=="mouseover"?c=i.fromElement:u=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&Et.Z.h.call(this)},Et.prototype.h=function(){Et.Z.h.call(this);let i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Xt="closure_listenable_"+(Math.random()*1e6|0),$h=0;function Kh(i,c,u,d,T){this.listener=i,this.proxy=null,this.src=c,this.type=u,this.capture=!!d,this.ha=T,this.key=++$h,this.da=this.fa=!1}function cr(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function ur(i,c,u){for(let d in i)c.call(u,i[d],d,i)}function Qh(i,c){for(let u in i)c.call(void 0,i[u],u,i)}function $a(i){let c={};for(let u in i)c[u]=i[u];return c}let Ka="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qa(i,c){let u,d;for(let T=1;T<arguments.length;T++){d=arguments[T];for(u in d)i[u]=d[u];for(let b=0;b<Ka.length;b++)u=Ka[b],Object.prototype.hasOwnProperty.call(d,u)&&(i[u]=d[u])}}function lr(i){this.src=i,this.g={},this.h=0}lr.prototype.add=function(i,c,u,d,T){let b=i.toString();i=this.g[b],i||(i=this.g[b]=[],this.h++);let D=Ps(i,c,d,T);return D>-1?(c=i[D],u||(c.fa=!1)):(c=new Kh(c,this.src,b,!!d,T),c.fa=u,i.push(c)),c};function Rs(i,c){let u=c.type;if(u in i.g){var d=i.g[u],T=Array.prototype.indexOf.call(d,c,void 0),b;(b=T>=0)&&Array.prototype.splice.call(d,T,1),b&&(cr(c),i.g[u].length==0&&(delete i.g[u],i.h--))}}function Ps(i,c,u,d){for(let T=0;T<i.length;++T){let b=i[T];if(!b.da&&b.listener==c&&b.capture==!!u&&b.ha==d)return T}return-1}var Cs="closure_lm_"+(Math.random()*1e6|0),Ds={};function Wa(i,c,u,d,T){if(d&&d.once)return Ja(i,c,u,d,T);if(Array.isArray(c)){for(let b=0;b<c.length;b++)Wa(i,c[b],u,d,T);return null}return u=ks(u),i&&i[Xt]?i.J(c,u,l(d)?!!d.capture:!!d,T):Ha(i,c,u,!1,d,T)}function Ha(i,c,u,d,T,b){if(!c)throw Error("Invalid event type");let D=l(T)?!!T.capture:!!T,U=xs(i);if(U||(i[Cs]=U=new lr(i)),u=U.add(c,u,d,D,b),u.proxy)return u;if(d=Wh(),u.proxy=d,d.src=i,d.listener=u,i.addEventListener)v||(T=D),T===void 0&&(T=!1),i.addEventListener(c.toString(),d,T);else if(i.attachEvent)i.attachEvent(Ya(c.toString()),d);else if(i.addListener&&i.removeListener)i.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return u}function Wh(){function i(u){return c.call(i.src,i.listener,u)}let c=Hh;return i}function Ja(i,c,u,d,T){if(Array.isArray(c)){for(let b=0;b<c.length;b++)Ja(i,c[b],u,d,T);return null}return u=ks(u),i&&i[Xt]?i.K(c,u,l(d)?!!d.capture:!!d,T):Ha(i,c,u,!0,d,T)}function Xa(i,c,u,d,T){if(Array.isArray(c))for(var b=0;b<c.length;b++)Xa(i,c[b],u,d,T);else d=l(d)?!!d.capture:!!d,u=ks(u),i&&i[Xt]?(i=i.i,b=String(c).toString(),b in i.g&&(c=i.g[b],u=Ps(c,u,d,T),u>-1&&(cr(c[u]),Array.prototype.splice.call(c,u,1),c.length==0&&(delete i.g[b],i.h--)))):i&&(i=xs(i))&&(c=i.g[c.toString()],i=-1,c&&(i=Ps(c,u,d,T)),(u=i>-1?c[i]:null)&&Vs(u))}function Vs(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[Xt])Rs(c.i,i);else{var u=i.type,d=i.proxy;c.removeEventListener?c.removeEventListener(u,d,i.capture):c.detachEvent?c.detachEvent(Ya(u),d):c.addListener&&c.removeListener&&c.removeListener(d),(u=xs(c))?(Rs(u,i),u.h==0&&(u.src=null,c[Cs]=null)):cr(i)}}}function Ya(i){return i in Ds?Ds[i]:Ds[i]="on"+i}function Hh(i,c){if(i.da)i=!0;else{c=new Et(c,this);let u=i.listener,d=i.ha||i.src;i.fa&&Vs(i),i=u.call(d,c)}return i}function xs(i){return i=i[Cs],i instanceof lr?i:null}var Ns="__closure_events_fn_"+(Math.random()*1e9>>>0);function ks(i){return typeof i=="function"?i:(i[Ns]||(i[Ns]=function(c){return i.handleEvent(c)}),i[Ns])}function ft(){I.call(this),this.i=new lr(this),this.M=this,this.G=null}E(ft,I),ft.prototype[Xt]=!0,ft.prototype.removeEventListener=function(i,c,u,d){Xa(this,i,c,u,d)};function yt(i,c){var u,d=i.G;if(d)for(u=[];d;d=d.G)u.push(d);if(i=i.M,d=c.type||c,typeof c=="string")c=new _(c,i);else if(c instanceof _)c.target=c.target||i;else{var T=c;c=new _(d,i),Qa(c,T)}T=!0;let b,D;if(u)for(D=u.length-1;D>=0;D--)b=c.g=u[D],T=hr(b,d,!0,c)&&T;if(b=c.g=i,T=hr(b,d,!0,c)&&T,T=hr(b,d,!1,c)&&T,u)for(D=0;D<u.length;D++)b=c.g=u[D],T=hr(b,d,!1,c)&&T}ft.prototype.N=function(){if(ft.Z.N.call(this),this.i){var i=this.i;for(let c in i.g){let u=i.g[c];for(let d=0;d<u.length;d++)cr(u[d]);delete i.g[c],i.h--}}this.G=null},ft.prototype.J=function(i,c,u,d){return this.i.add(String(i),c,!1,u,d)},ft.prototype.K=function(i,c,u,d){return this.i.add(String(i),c,!0,u,d)};function hr(i,c,u,d){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let T=!0;for(let b=0;b<c.length;++b){let D=c[b];if(D&&!D.da&&D.capture==u){let U=D.listener,ot=D.ha||D.src;D.fa&&Rs(i.i,D),T=U.call(ot,d)!==!1&&T}}return T&&!d.defaultPrevented}function Jh(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Za(i){i.g=Jh(()=>{i.g=null,i.i&&(i.i=!1,Za(i))},i.l);let c=i.h;i.h=null,i.m.apply(null,c)}class Xh extends I{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Za(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function pn(i){I.call(this),this.h=i,this.g={}}E(pn,I);var tc=[];function ec(i){ur(i.g,function(c,u){this.g.hasOwnProperty(u)&&Vs(c)},i),i.g={}}pn.prototype.N=function(){pn.Z.N.call(this),ec(this)},pn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Os=a.JSON.stringify,Yh=a.JSON.parse,Zh=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function nc(){}function rc(){}var gn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ms(){_.call(this,"d")}E(Ms,_);function Fs(){_.call(this,"c")}E(Fs,_);var _e={},sc=null;function dr(){return sc=sc||new ft}_e.Ia="serverreachability";function ic(i){_.call(this,_e.Ia,i)}E(ic,_);function yn(i){let c=dr();yt(c,new ic(c))}_e.STAT_EVENT="statevent";function oc(i,c){_.call(this,_e.STAT_EVENT,i),this.stat=c}E(oc,_);function _t(i){let c=dr();yt(c,new oc(c,i))}_e.Ja="timingevent";function ac(i,c){_.call(this,_e.Ja,i),this.size=c}E(ac,_);function _n(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function wn(){this.g=!0}wn.prototype.ua=function(){this.g=!1};function td(i,c,u,d,T,b){i.info(function(){if(i.g)if(b){var D="",U=b.split("&");for(let H=0;H<U.length;H++){var ot=U[H].split("=");if(ot.length>1){let ct=ot[0];ot=ot[1];let Nt=ct.split("_");D=Nt.length>=2&&Nt[1]=="type"?D+(ct+"="+ot+"&"):D+(ct+"=redacted&")}}}else D=null;else D=b;return"XMLHTTP REQ ("+d+") [attempt "+T+"]: "+c+`
`+u+`
`+D})}function ed(i,c,u,d,T,b,D){i.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+T+"]: "+c+`
`+u+`
`+b+" "+D})}function Me(i,c,u,d){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+rd(i,u)+(d?" "+d:"")})}function nd(i,c){i.info(function(){return"TIMEOUT: "+c})}wn.prototype.info=function(){};function rd(i,c){if(!i.g)return c;if(!c)return null;try{let b=JSON.parse(c);if(b){for(i=0;i<b.length;i++)if(Array.isArray(b[i])){var u=b[i];if(!(u.length<2)){var d=u[1];if(Array.isArray(d)&&!(d.length<1)){var T=d[0];if(T!="noop"&&T!="stop"&&T!="close")for(let D=1;D<d.length;D++)d[D]=""}}}}return Os(b)}catch{return c}}var fr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},cc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},uc;function Ls(){}E(Ls,nc),Ls.prototype.g=function(){return new XMLHttpRequest},uc=new Ls;function En(i){return encodeURIComponent(String(i))}function sd(i){var c=1;i=i.split(":");let u=[];for(;c>0&&i.length;)u.push(i.shift()),c--;return i.length&&u.push(i.join(":")),u}function Yt(i,c,u,d){this.j=i,this.i=c,this.l=u,this.S=d||1,this.V=new pn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new lc}function lc(){this.i=null,this.g="",this.h=!1}var hc={},Bs={};function Us(i,c,u){i.M=1,i.A=pr(xt(c)),i.u=u,i.R=!0,dc(i,null)}function dc(i,c){i.F=Date.now(),mr(i),i.B=xt(i.A);var u=i.B,d=i.S;Array.isArray(d)||(d=[String(d)]),bc(u.i,"t",d),i.C=0,u=i.j.L,i.h=new lc,i.g=zc(i.j,u?c:null,!i.u),i.P>0&&(i.O=new Xh(f(i.Y,i,i.g),i.P)),c=i.V,u=i.g,d=i.ba;var T="readystatechange";Array.isArray(T)||(T&&(tc[0]=T.toString()),T=tc);for(let b=0;b<T.length;b++){let D=Wa(u,T[b],d||c.handleEvent,!1,c.h||c);if(!D)break;c.g[D.key]=D}c=i.J?$a(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),yn(),td(i.i,i.v,i.B,i.l,i.S,i.u)}Yt.prototype.ba=function(i){i=i.target;let c=this.O;c&&ee(i)==3?c.j():this.Y(i)},Yt.prototype.Y=function(i){try{if(i==this.g)t:{let U=ee(this.g),ot=this.g.ya(),H=this.g.ca();if(!(U<3)&&(U!=3||this.g&&(this.h.h||this.g.la()||xc(this.g)))){this.K||U!=4||ot==7||(ot==8||H<=0?yn(3):yn(2)),qs(this);var c=this.g.ca();this.X=c;var u=id(this);if(this.o=c==200,ed(this.i,this.v,this.B,this.l,this.S,U,c),this.o){if(this.U&&!this.L){e:{if(this.g){var d,T=this.g;if((d=T.g?T.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(d)){var b=d;break e}}b=null}if(i=b)Me(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,js(this,i);else{this.o=!1,this.m=3,_t(12),we(this),In(this);break t}}if(this.R){i=!0;let ct;for(;!this.K&&this.C<u.length;)if(ct=od(this,u),ct==Bs){U==4&&(this.m=4,_t(14),i=!1),Me(this.i,this.l,null,"[Incomplete Response]");break}else if(ct==hc){this.m=4,_t(15),Me(this.i,this.l,u,"[Invalid Chunk]"),i=!1;break}else Me(this.i,this.l,ct,null),js(this,ct);if(fc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),U!=4||u.length!=0||this.h.h||(this.m=1,_t(16),i=!1),this.o=this.o&&i,!i)Me(this.i,this.l,u,"[Invalid Chunked Response]"),we(this),In(this);else if(u.length>0&&!this.W){this.W=!0;var D=this.j;D.g==this&&D.aa&&!D.P&&(D.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),Hs(D),D.P=!0,_t(11))}}else Me(this.i,this.l,u,null),js(this,u);U==4&&we(this),this.o&&!this.K&&(U==4?Bc(this.j,this):(this.o=!1,mr(this)))}else Ed(this.g),c==400&&u.indexOf("Unknown SID")>0?(this.m=3,_t(12)):(this.m=0,_t(13)),we(this),In(this)}}}catch{}finally{}};function id(i){if(!fc(i))return i.g.la();let c=xc(i.g);if(c==="")return"";let u="",d=c.length,T=ee(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return we(i),In(i),"";i.h.i=new a.TextDecoder}for(let b=0;b<d;b++)i.h.h=!0,u+=i.h.i.decode(c[b],{stream:!(T&&b==d-1)});return c.length=0,i.h.g+=u,i.C=0,i.h.g}function fc(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function od(i,c){var u=i.C,d=c.indexOf(`
`,u);return d==-1?Bs:(u=Number(c.substring(u,d)),isNaN(u)?hc:(d+=1,d+u>c.length?Bs:(c=c.slice(d,d+u),i.C=d+u,c)))}Yt.prototype.cancel=function(){this.K=!0,we(this)};function mr(i){i.T=Date.now()+i.H,mc(i,i.H)}function mc(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=_n(f(i.aa,i),c)}function qs(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Yt.prototype.aa=function(){this.D=null;let i=Date.now();i-this.T>=0?(nd(this.i,this.B),this.M!=2&&(yn(),_t(17)),we(this),this.m=2,In(this)):mc(this,this.T-i)};function In(i){i.j.I==0||i.K||Bc(i.j,i)}function we(i){qs(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,ec(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function js(i,c){try{var u=i.j;if(u.I!=0&&(u.g==i||zs(u.h,i))){if(!i.L&&zs(u.h,i)&&u.I==3){try{var d=u.Ba.g.parse(c)}catch{d=null}if(Array.isArray(d)&&d.length==3){var T=d;if(T[0]==0){t:if(!u.v){if(u.g)if(u.g.F+3e3<i.F)Ir(u),wr(u);else break t;Ws(u),_t(18)}}else u.xa=T[1],0<u.xa-u.K&&T[2]<37500&&u.F&&u.A==0&&!u.C&&(u.C=_n(f(u.Va,u),6e3));yc(u.h)<=1&&u.ta&&(u.ta=void 0)}else Ie(u,11)}else if((i.L||u.g==i)&&Ir(u),!g(c))for(T=u.Ba.g.parse(c),c=0;c<T.length;c++){let H=T[c],ct=H[0];if(!(ct<=u.K))if(u.K=ct,H=H[1],u.I==2)if(H[0]=="c"){u.M=H[1],u.ba=H[2];let Nt=H[3];Nt!=null&&(u.ka=Nt,u.j.info("VER="+u.ka));let Te=H[4];Te!=null&&(u.za=Te,u.j.info("SVER="+u.za));let ne=H[5];ne!=null&&typeof ne=="number"&&ne>0&&(d=1.5*ne,u.O=d,u.j.info("backChannelRequestTimeoutMs_="+d)),d=u;let re=i.g;if(re){let vr=re.g?re.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vr){var b=d.h;b.g||vr.indexOf("spdy")==-1&&vr.indexOf("quic")==-1&&vr.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(Gs(b,b.h),b.h=null))}if(d.G){let Js=re.g?re.g.getResponseHeader("X-HTTP-Session-Id"):null;Js&&(d.wa=Js,J(d.J,d.G,Js))}}u.I=3,u.l&&u.l.ra(),u.aa&&(u.T=Date.now()-i.F,u.j.info("Handshake RTT: "+u.T+"ms")),d=u;var D=i;if(d.na=jc(d,d.L?d.ba:null,d.W),D.L){_c(d.h,D);var U=D,ot=d.O;ot&&(U.H=ot),U.D&&(qs(U),mr(U)),d.g=D}else Fc(d);u.i.length>0&&Er(u)}else H[0]!="stop"&&H[0]!="close"||Ie(u,7);else u.I==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?Ie(u,7):Qs(u):H[0]!="noop"&&u.l&&u.l.qa(H),u.A=0)}}yn(4)}catch{}}var ad=class{constructor(i,c){this.g=i,this.map=c}};function pc(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function gc(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function yc(i){return i.h?1:i.g?i.g.size:0}function zs(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Gs(i,c){i.g?i.g.add(c):i.h=c}function _c(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}pc.prototype.cancel=function(){if(this.i=wc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let i of this.g.values())i.cancel();this.g.clear()}};function wc(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(let u of i.g.values())c=c.concat(u.G);return c}return R(i.i)}var Ec=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function cd(i,c){if(i){i=i.split("&");for(let u=0;u<i.length;u++){let d=i[u].indexOf("="),T,b=null;d>=0?(T=i[u].substring(0,d),b=i[u].substring(d+1)):T=i[u],c(T,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function Zt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Zt?(this.l=i.l,Tn(this,i.j),this.o=i.o,this.g=i.g,vn(this,i.u),this.h=i.h,$s(this,Sc(i.i)),this.m=i.m):i&&(c=String(i).match(Ec))?(this.l=!1,Tn(this,c[1]||"",!0),this.o=An(c[2]||""),this.g=An(c[3]||"",!0),vn(this,c[4]),this.h=An(c[5]||"",!0),$s(this,c[6]||"",!0),this.m=An(c[7]||"")):(this.l=!1,this.i=new Sn(null,this.l))}Zt.prototype.toString=function(){let i=[];var c=this.j;c&&i.push(bn(c,Ic,!0),":");var u=this.g;return(u||c=="file")&&(i.push("//"),(c=this.o)&&i.push(bn(c,Ic,!0),"@"),i.push(En(u).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.u,u!=null&&i.push(":",String(u))),(u=this.h)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(bn(u,u.charAt(0)=="/"?hd:ld,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",bn(u,fd)),i.join("")},Zt.prototype.resolve=function(i){let c=xt(this),u=!!i.j;u?Tn(c,i.j):u=!!i.o,u?c.o=i.o:u=!!i.g,u?c.g=i.g:u=i.u!=null;var d=i.h;if(u)vn(c,i.u);else if(u=!!i.h){if(d.charAt(0)!="/")if(this.g&&!this.h)d="/"+d;else{var T=c.h.lastIndexOf("/");T!=-1&&(d=c.h.slice(0,T+1)+d)}if(T=d,T==".."||T==".")d="";else if(T.indexOf("./")!=-1||T.indexOf("/.")!=-1){d=T.lastIndexOf("/",0)==0,T=T.split("/");let b=[];for(let D=0;D<T.length;){let U=T[D++];U=="."?d&&D==T.length&&b.push(""):U==".."?((b.length>1||b.length==1&&b[0]!="")&&b.pop(),d&&D==T.length&&b.push("")):(b.push(U),d=!0)}d=b.join("/")}else d=T}return u?c.h=d:u=i.i.toString()!=="",u?$s(c,Sc(i.i)):u=!!i.m,u&&(c.m=i.m),c};function xt(i){return new Zt(i)}function Tn(i,c,u){i.j=u?An(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function vn(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function $s(i,c,u){c instanceof Sn?(i.i=c,md(i.i,i.l)):(u||(c=bn(c,dd)),i.i=new Sn(c,i.l))}function J(i,c,u){i.i.set(c,u)}function pr(i){return J(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function An(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function bn(i,c,u){return typeof i=="string"?(i=encodeURI(i).replace(c,ud),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function ud(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Ic=/[#\/\?@]/g,ld=/[#\?:]/g,hd=/[#\?]/g,dd=/[#\?@]/g,fd=/#/g;function Sn(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Ee(i){i.g||(i.g=new Map,i.h=0,i.i&&cd(i.i,function(c,u){i.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=Sn.prototype,n.add=function(i,c){Ee(this),this.i=null,i=Fe(this,i);let u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(c),this.h+=1,this};function Tc(i,c){Ee(i),c=Fe(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function vc(i,c){return Ee(i),c=Fe(i,c),i.g.has(c)}n.forEach=function(i,c){Ee(this),this.g.forEach(function(u,d){u.forEach(function(T){i.call(c,T,d,this)},this)},this)};function Ac(i,c){Ee(i);let u=[];if(typeof c=="string")vc(i,c)&&(u=u.concat(i.g.get(Fe(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)u=u.concat(i[c]);return u}n.set=function(i,c){return Ee(this),this.i=null,i=Fe(this,i),vc(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Ac(this,i),i.length>0?String(i[0]):c):c};function bc(i,c,u){Tc(i,c),u.length>0&&(i.i=null,i.g.set(Fe(i,c),R(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let i=[],c=Array.from(this.g.keys());for(let d=0;d<c.length;d++){var u=c[d];let T=En(u);u=Ac(this,u);for(let b=0;b<u.length;b++){let D=T;u[b]!==""&&(D+="="+En(u[b])),i.push(D)}}return this.i=i.join("&")};function Sc(i){let c=new Sn;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Fe(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function md(i,c){c&&!i.j&&(Ee(i),i.i=null,i.g.forEach(function(u,d){let T=d.toLowerCase();d!=T&&(Tc(this,d),bc(this,T,u))},i)),i.j=c}function pd(i,c){let u=new wn;if(a.Image){let d=new Image;d.onload=m(te,u,"TestLoadImage: loaded",!0,c,d),d.onerror=m(te,u,"TestLoadImage: error",!1,c,d),d.onabort=m(te,u,"TestLoadImage: abort",!1,c,d),d.ontimeout=m(te,u,"TestLoadImage: timeout",!1,c,d),a.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=i}else c(!1)}function gd(i,c){let u=new wn,d=new AbortController,T=setTimeout(()=>{d.abort(),te(u,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:d.signal}).then(b=>{clearTimeout(T),b.ok?te(u,"TestPingServer: ok",!0,c):te(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(T),te(u,"TestPingServer: error",!1,c)})}function te(i,c,u,d,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),d(u)}catch{}}function yd(){this.g=new Zh}function gr(i){this.i=i.Sb||null,this.h=i.ab||!1}E(gr,nc),gr.prototype.g=function(){return new yr(this.i,this.h)};function yr(i,c){ft.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}E(yr,ft),n=yr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Pn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Rn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Pn(this)),this.g&&(this.readyState=3,Pn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Rc(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Rc(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?Rn(this):Pn(this),this.readyState==3&&Rc(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,Rn(this))},n.Na=function(i){this.g&&(this.response=i,Rn(this))},n.ga=function(){this.g&&Rn(this)};function Rn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Pn(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let i=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=c.next();return i.join(`\r
`)};function Pn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(yr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Pc(i){let c="";return ur(i,function(u,d){c+=d,c+=":",c+=u,c+=`\r
`}),c}function Ks(i,c,u){t:{for(d in u){var d=!1;break t}d=!0}d||(u=Pc(u),typeof i=="string"?u!=null&&En(u):J(i,c,u))}function Z(i){ft.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}E(Z,ft);var _d=/^https?$/i,wd=["POST","PUT"];n=Z.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,u,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():uc.g(),this.g.onreadystatechange=A(f(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(b){Cc(this,b);return}if(i=u||"",u=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var T in d)u.set(T,d[T]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let b of d.keys())u.set(b,d.get(b));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(u.keys()).find(b=>b.toLowerCase()=="content-type"),T=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(wd,c,void 0)>=0)||d||T||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,D]of u)this.g.setRequestHeader(b,D);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(b){Cc(this,b)}};function Cc(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,Dc(i),_r(i)}function Dc(i){i.A||(i.A=!0,yt(i,"complete"),yt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,yt(this,"complete"),yt(this,"abort"),_r(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_r(this,!0)),Z.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Vc(this):this.Xa())},n.Xa=function(){Vc(this)};function Vc(i){if(i.h&&typeof o<"u"){if(i.v&&ee(i)==4)setTimeout(i.Ca.bind(i),0);else if(yt(i,"readystatechange"),ee(i)==4){i.h=!1;try{let b=i.ca();t:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var u;if(!(u=c)){var d;if(d=b===0){let D=String(i.D).match(Ec)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),d=!_d.test(D?D.toLowerCase():"")}u=d}if(u)yt(i,"complete"),yt(i,"success");else{i.o=6;try{var T=ee(i)>2?i.g.statusText:""}catch{T=""}i.l=T+" ["+i.ca()+"]",Dc(i)}}finally{_r(i)}}}}function _r(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);let u=i.g;i.g=null,c||yt(i,"ready");try{u.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ee(i){return i.g?i.g.readyState:0}n.ca=function(){try{return ee(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Yh(c)}};function xc(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Ed(i){let c={};i=(i.g&&ee(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<i.length;d++){if(g(i[d]))continue;var u=sd(i[d]);let T=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();let b=c[T]||[];c[T]=b,b.push(u)}Qh(c,function(d){return d.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Cn(i,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||c}function Nc(i){this.za=0,this.i=[],this.j=new wn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Cn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Cn("baseRetryDelayMs",5e3,i),this.Za=Cn("retryDelaySeedMs",1e4,i),this.Ta=Cn("forwardChannelMaxRetries",2,i),this.va=Cn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new pc(i&&i.concurrentRequestLimit),this.Ba=new yd,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Nc.prototype,n.ka=8,n.I=1,n.connect=function(i,c,u,d){_t(0),this.W=i,this.H=c||{},u&&d!==void 0&&(this.H.OSID=u,this.H.OAID=d),this.F=this.X,this.J=jc(this,null,this.W),Er(this)};function Qs(i){if(kc(i),i.I==3){var c=i.V++,u=xt(i.J);if(J(u,"SID",i.M),J(u,"RID",c),J(u,"TYPE","terminate"),Dn(i,u),c=new Yt(i,i.j,c),c.M=2,c.A=pr(xt(u)),u=!1,a.navigator&&a.navigator.sendBeacon)try{u=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!u&&a.Image&&(new Image().src=c.A,u=!0),u||(c.g=zc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),mr(c)}qc(i)}function wr(i){i.g&&(Hs(i),i.g.cancel(),i.g=null)}function kc(i){wr(i),i.v&&(a.clearTimeout(i.v),i.v=null),Ir(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Er(i){if(!gc(i.h)&&!i.m){i.m=!0;var c=i.Ea;wt||p(),at||(wt(),at=!0),w.add(c,i),i.D=0}}function Id(i,c){return yc(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=_n(f(i.Ea,i,c),Uc(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;let T=new Yt(this,this.j,i),b=this.o;if(this.U&&(b?(b=$a(b),Qa(b,this.U)):b=this.U),this.u!==null||this.R||(T.J=b,b=null),this.S)t:{for(var c=0,u=0;u<this.i.length;u++){e:{var d=this.i[u];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break e}d=void 0}if(d===void 0)break;if(c+=d,c>4096){c=u;break t}if(c===4096||u===this.i.length-1){c=u+1;break t}}c=1e3}else c=1e3;c=Mc(this,T,c),u=xt(this.J),J(u,"RID",i),J(u,"CVER",22),this.G&&J(u,"X-HTTP-Session-Id",this.G),Dn(this,u),b&&(this.R?c="headers="+En(Pc(b))+"&"+c:this.u&&Ks(u,this.u,b)),Gs(this.h,T),this.Ra&&J(u,"TYPE","init"),this.S?(J(u,"$req",c),J(u,"SID","null"),T.U=!0,Us(T,u,null)):Us(T,u,c),this.I=2}}else this.I==3&&(i?Oc(this,i):this.i.length==0||gc(this.h)||Oc(this))};function Oc(i,c){var u;c?u=c.l:u=i.V++;let d=xt(i.J);J(d,"SID",i.M),J(d,"RID",u),J(d,"AID",i.K),Dn(i,d),i.u&&i.o&&Ks(d,i.u,i.o),u=new Yt(i,i.j,u,i.D+1),i.u===null&&(u.J=i.o),c&&(i.i=c.G.concat(i.i)),c=Mc(i,u,1e3),u.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Gs(i.h,u),Us(u,d,c)}function Dn(i,c){i.H&&ur(i.H,function(u,d){J(c,d,u)}),i.l&&ur({},function(u,d){J(c,d,u)})}function Mc(i,c,u){u=Math.min(i.i.length,u);let d=i.l?f(i.l.Ka,i.l,i):null;t:{var T=i.i;let U=-1;for(;;){let ot=["count="+u];U==-1?u>0?(U=T[0].g,ot.push("ofs="+U)):U=0:ot.push("ofs="+U);let H=!0;for(let ct=0;ct<u;ct++){var b=T[ct].g;let Nt=T[ct].map;if(b-=U,b<0)U=Math.max(0,T[ct].g-100),H=!1;else try{b="req"+b+"_"||"";try{var D=Nt instanceof Map?Nt:Object.entries(Nt);for(let[Te,ne]of D){let re=ne;l(ne)&&(re=Os(ne)),ot.push(b+Te+"="+encodeURIComponent(re))}}catch(Te){throw ot.push(b+"type="+encodeURIComponent("_badmap")),Te}}catch{d&&d(Nt)}}if(H){D=ot.join("&");break t}}D=void 0}return i=i.i.splice(0,u),c.G=i,D}function Fc(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;wt||p(),at||(wt(),at=!0),w.add(c,i),i.A=0}}function Ws(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=_n(f(i.Da,i),Uc(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Lc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=_n(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,_t(10),wr(this),Lc(this))};function Hs(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Lc(i){i.g=new Yt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=xt(i.na);J(c,"RID","rpc"),J(c,"SID",i.M),J(c,"AID",i.K),J(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&J(c,"TO",i.ia),J(c,"TYPE","xmlhttp"),Dn(i,c),i.u&&i.o&&Ks(c,i.u,i.o),i.O&&(i.g.H=i.O);var u=i.g;i=i.ba,u.M=1,u.A=pr(xt(c)),u.u=null,u.R=!0,dc(u,i)}n.Va=function(){this.C!=null&&(this.C=null,wr(this),Ws(this),_t(19))};function Ir(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Bc(i,c){var u=null;if(i.g==c){Ir(i),Hs(i),i.g=null;var d=2}else if(zs(i.h,c))u=c.G,_c(i.h,c),d=1;else return;if(i.I!=0){if(c.o)if(d==1){u=c.u?c.u.length:0,c=Date.now()-c.F;var T=i.D;d=dr(),yt(d,new ac(d,u)),Er(i)}else Fc(i);else if(T=c.m,T==3||T==0&&c.X>0||!(d==1&&Id(i,c)||d==2&&Ws(i)))switch(u&&u.length>0&&(c=i.h,c.i=c.i.concat(u)),T){case 1:Ie(i,5);break;case 4:Ie(i,10);break;case 3:Ie(i,6);break;default:Ie(i,2)}}}function Uc(i,c){let u=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(u*=2),u*c}function Ie(i,c){if(i.j.info("Error code "+c),c==2){var u=f(i.bb,i),d=i.Ua;let T=!d;d=new Zt(d||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Tn(d,"https"),pr(d),T?pd(d.toString(),u):gd(d.toString(),u)}else _t(2);i.I=0,i.l&&i.l.pa(c),qc(i),kc(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),_t(2)):(this.j.info("Failed to ping google.com"),_t(1))};function qc(i){if(i.I=0,i.ja=[],i.l){let c=wc(i.h);(c.length!=0||i.i.length!=0)&&(k(i.ja,c),k(i.ja,i.i),i.h.i.length=0,R(i.i),i.i.length=0),i.l.oa()}}function jc(i,c,u){var d=u instanceof Zt?xt(u):new Zt(u);if(d.g!="")c&&(d.g=c+"."+d.g),vn(d,d.u);else{var T=a.location;d=T.protocol,c=c?c+"."+T.hostname:T.hostname,T=+T.port;let b=new Zt(null);d&&Tn(b,d),c&&(b.g=c),T&&vn(b,T),u&&(b.h=u),d=b}return u=i.G,c=i.wa,u&&c&&J(d,u,c),J(d,"VER",i.ka),Dn(i,d),d}function zc(i,c,u){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Z(new gr({ab:u})):new Z(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Gc(){}n=Gc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Tr(){}Tr.prototype.g=function(i,c){return new It(i,c)};function It(i,c){ft.call(this),this.g=new Nc(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!g(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Le(this)}E(It,ft),It.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},It.prototype.close=function(){Qs(this.g)},It.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.v&&(u={},u.__data__=Os(i),i=u);c.i.push(new ad(c.Ya++,i)),c.I==3&&Er(c)},It.prototype.N=function(){this.g.l=null,delete this.j,Qs(this.g),delete this.g,It.Z.N.call(this)};function $c(i){Ms.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){t:{for(let u in c){i=u;break t}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}E($c,Ms);function Kc(){Fs.call(this),this.status=1}E(Kc,Fs);function Le(i){this.g=i}E(Le,Gc),Le.prototype.ra=function(){yt(this.g,"a")},Le.prototype.qa=function(i){yt(this.g,new $c(i))},Le.prototype.pa=function(i){yt(this.g,new Kc)},Le.prototype.oa=function(){yt(this.g,"b")},Tr.prototype.createWebChannel=Tr.prototype.g,It.prototype.send=It.prototype.o,It.prototype.open=It.prototype.m,It.prototype.close=It.prototype.close,Ai=Gt.createWebChannelTransport=function(){return new Tr},vi=Gt.getStatEventTarget=function(){return dr()},Ti=Gt.Event=_e,Vr=Gt.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},fr.NO_ERROR=0,fr.TIMEOUT=8,fr.HTTP_ERROR=6,Bn=Gt.ErrorCode=fr,cc.COMPLETE="complete",Ii=Gt.EventType=cc,rc.EventType=gn,gn.OPEN="a",gn.CLOSE="b",gn.ERROR="c",gn.MESSAGE="d",ft.prototype.listen=ft.prototype.J,Ue=Gt.WebChannel=rc,Ff=Gt.FetchXmlHttpFactory=gr,Z.prototype.listenOnce=Z.prototype.K,Z.prototype.getLastError=Z.prototype.Ha,Z.prototype.getLastErrorCode=Z.prototype.ya,Z.prototype.getStatus=Z.prototype.ca,Z.prototype.getResponseJson=Z.prototype.La,Z.prototype.getResponseText=Z.prototype.la,Z.prototype.send=Z.prototype.ea,Z.prototype.setWithCredentials=Z.prototype.Fa,Ei=Gt.XhrIo=Z}).apply(typeof Dr<"u"?Dr:typeof self<"u"?self:typeof window<"u"?window:{});var Su="@firebase/firestore",Ru="4.9.2";var ut=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};ut.UNAUTHENTICATED=new ut(null),ut.GOOGLE_CREDENTIALS=new ut("google-credentials-uid"),ut.FIRST_PARTY=new ut("first-party-uid"),ut.MOCK_USER=new ut("mock-user");var ln="12.3.0";var Pe=new Be("@firebase/firestore");function qe(){return Pe.logLevel}function N(n,...t){if(Pe.logLevel<=z.DEBUG){let e=t.map(wa);Pe.debug(`Firestore (${ln}): ${n}`,...e)}}function Kt(n,...t){if(Pe.logLevel<=z.ERROR){let e=t.map(wa);Pe.error(`Firestore (${ln}): ${n}`,...e)}}function He(n,...t){if(Pe.logLevel<=z.WARN){let e=t.map(wa);Pe.warn(`Firestore (${ln}): ${n}`,...e)}}function wa(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function F(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,_l(n,r,e)}function _l(n,t,e){let r=`FIRESTORE (${ln}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Kt(r),new Error(r)}function W(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||_l(t,s,r)}function L(n,t){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends Ut{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var $t=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Lr=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Vi=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ut.UNAUTHENTICATED))}shutdown(){}},xi=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ni=class{constructor(t){this.t=t,this.currentUser=ut.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){W(this.o===void 0,42304);let r=this.i,s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve(),o=new $t;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new $t,t.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let h=o;t.enqueueRetryable(()=>C(this,null,function*(){yield h.promise,yield s(this.currentUser)}))},l=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new $t)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(W(typeof r.accessToken=="string",31837,{l:r}),new Lr(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return W(t===null||typeof t=="string",2055,{h:t}),new ut(t)}},ki=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=ut.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Oi=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new ki(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(ut.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Br=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Mi=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,wu(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){W(this.o===void 0,3512);let r=o=>{o.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};let s=o=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?s(o):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Br(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(W(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Br(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Lf(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var $n=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let s=Lf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}};function q(n,t){return n<t?-1:n>t?1:0}function Fi(n,t){let e=Math.min(n.length,t.length);for(let r=0;r<e;r++){let s=n.charAt(r),o=t.charAt(r);if(s!==o)return bi(s)===bi(o)?q(s,o):bi(s)?1:-1}return q(n.length,t.length)}var Bf=55296,Uf=57343;function bi(n){let t=n.charCodeAt(0);return t>=Bf&&t<=Uf}function Je(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}var Pu="__name__",Ur=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&F(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&F(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let o=n.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return q(t.length,e.length)}static compareSegments(t,e){let r=n.isNumericId(t),s=n.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?n.extractNumericId(t).compare(n.extractNumericId(e)):Fi(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return zt.fromString(t.substring(4,t.length-2))}},Y=class n extends Ur{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new V(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},qf=/^[_a-zA-Z][_a-zA-Z0-9]*$/,At=class n extends Ur{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return qf.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Pu}static keyField(){return new n([Pu])}static fromServerFormat(t){let e=[],r="",s=0,o=()=>{if(r.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},a=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new V(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new V(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(o(),s++)}if(o(),a)throw new V(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var M=class n{constructor(t){this.path=t}static fromPath(t){return new n(Y.fromString(t))}static fromName(t){return new n(Y.fromString(t).popFirst(5))}static empty(){return new n(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new Y(t.slice()))}};function wl(n,t,e){if(!e)throw new V(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function jf(n,t,e,r){if(t===!0&&r===!0)throw new V(S.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Cu(n){if(!M.isDocumentKey(n))throw new V(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Du(n){if(M.isDocumentKey(n))throw new V(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function El(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function _s(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":F(12329,{type:typeof n})}function Ct(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new V(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=_s(n);throw new V(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function zf(n,t){if(t<=0)throw new V(S.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}function st(n,t){let e={typeString:n};return t&&(e.value=t),e}function rr(n,t){if(!El(n))throw new V(S.INVALID_ARGUMENT,"JSON must be an object");let e;for(let r in t)if(t[r]){let s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}let a=n[r];if(s&&typeof a!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new V(S.INVALID_ARGUMENT,e);return!0}var Vu=-62135596800,xu=1e6,it=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*xu);return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new V(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Vu)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new V(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xu}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(rr(t,n._jsonSchema))return new n(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-Vu;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};it._jsonSchemaVersion="firestore/timestamp/1.0",it._jsonSchema={type:st("string",it._jsonSchemaVersion),seconds:st("number"),nanoseconds:st("number")};var B=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new it(0,0))}static max(){return new n(new it(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Kn=-1,Li=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};Li.UNKNOWN_ID=-1;function Gf(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=B.fromTimestamp(r===1e9?new it(e+1,0):new it(e,r));return new Ce(s,M.empty(),t)}function $f(n){return new Ce(n.readTime,n.key,Kn)}var Ce=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(B.min(),M.empty(),Kn)}static max(){return new n(B.max(),M.empty(),Kn)}};function Kf(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:q(n.largestBatchId,t.largestBatchId))}var Qf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Bi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function hn(n){return C(this,null,function*(){if(n.code!==S.FAILED_PRECONDITION||n.message!==Qf)throw n;N("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,o=0,a=!1;t.forEach(l=>{++s,l.next(()=>{++o,a&&o===s&&e()},h=>r(h))}),a=!0,o===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,o)=>{r.push(e.call(this,s,o))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let o=t.length,a=new Array(o),l=0;for(let h=0;h<o;h++){let f=h;e(t[f]).next(m=>{a[f]=m,++l,l===o&&r(a)},m=>s(m))}})}static doWhile(t,e){return new n((r,s)=>{let o=()=>{t()===!0?e().next(()=>{o()},s):r()};o()})}};function Wf(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function dn(n){return n.name==="IndexedDbTransactionError"}var Ea=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>r.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}n.ce=-1;return n})(),Ia=-1;function ws(n){return n==null}function Qn(n){return n===0&&1/n==-1/0}function Hf(n){return typeof n=="number"&&Number.isInteger(n)&&!Qn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Il="";function Jf(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Nu(t)),t=Xf(n.get(e),t);return Nu(t)}function Xf(n,t){let e=t,r=n.length;for(let s=0;s<r;s++){let o=n.charAt(s);switch(o){case"\0":e+="";break;case Il:e+="";break;default:e+=o}}return e}function Nu(n){return n+Il+""}var Yf="remoteDocuments",Tl="owner";var vl="mutationQueues";var Al="mutations";var bl="documentMutations",Zf="remoteDocumentsV14";var Sl="remoteDocumentGlobal";var Rl="targets";var Pl="targetDocuments";var Cl="targetGlobal",Dl="collectionParents";var Vl="clientMetadata";var xl="bundles";var Nl="namedQueries";var tm="indexConfiguration";var em="indexState";var nm="indexEntries";var kl="documentOverlays";var rm="globals";var sm=[vl,Al,bl,Yf,Rl,Tl,Cl,Pl,Vl,Sl,Dl,xl,Nl],qg=[...sm,kl],im=[vl,Al,bl,Zf,Rl,Tl,Cl,Pl,Vl,Sl,Dl,xl,Nl,kl],om=im,am=[...om,tm,em,nm];var jg=[...am,rm];function ku(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function ye(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Ol(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var tt=class n{constructor(t,e){this.comparator=t,this.root=e||kt.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,kt.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,kt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new $e(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new $e(this.root,t,this.comparator,!1)}getReverseIterator(){return new $e(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new $e(this.root,t,this.comparator,!0)}},$e=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},kt=class n{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new n(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw F(27949);return t+(this.isRed()?0:1)}};kt.EMPTY=null,kt.RED=!0,kt.BLACK=!1;kt.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new kt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var lt=class n{constructor(t){this.comparator=t,this.data=new tt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new qr(this.data.getIterator())}getIteratorFrom(t){return new qr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},qr=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Rt=class n{constructor(t){this.fields=t,t.sort(At.comparator)}static empty(){return new n([])}unionWith(t){let e=new lt(At.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Je(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var jr=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var pt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new jr("Invalid base64 string: "+o):o}}(t);return new n(e)}static fromUint8Array(t){let e=function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};pt.EMPTY_BYTE_STRING=new pt("");var cm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qt(n){if(W(!!n,39018),typeof n=="string"){let t=0,e=cm.exec(n);if(W(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:X(n.seconds),nanos:X(n.nanos)}}function X(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Wt(n){return typeof n=="string"?pt.fromBase64String(n):pt.fromUint8Array(n)}var Ml="server_timestamp",Fl="__type__",Ll="__previous_value__",Bl="__local_write_time__";function Ta(n){return(n?.mapValue?.fields||{})[Fl]?.stringValue===Ml}function Es(n){let t=n.mapValue.fields[Ll];return Ta(t)?Es(t):t}function Wn(n){let t=Qt(n.mapValue.fields[Bl].timestampValue);return new it(t.seconds,t.nanos)}var Ui=class{constructor(t,e,r,s,o,a,l,h,f,m){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=m}},Hn="(default)",zr=class n{constructor(t,e){this.projectId=t,this.database=e||Hn}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Hn}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var va="__type__",Ul="__max__",xr={mapValue:{fields:{__type__:{stringValue:Ul}}}},Aa="__vector__",Xe="value";function he(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ta(n)?4:jl(n)?9007199254740991:ql(n)?10:11:F(28295,{value:n})}function Ft(n,t){if(n===t)return!0;let e=he(n);if(e!==he(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Wn(n).isEqual(Wn(t));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;let a=Qt(s.timestampValue),l=Qt(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(s,o){return Wt(s.bytesValue).isEqual(Wt(o.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(s,o){return X(s.geoPointValue.latitude)===X(o.geoPointValue.latitude)&&X(s.geoPointValue.longitude)===X(o.geoPointValue.longitude)}(n,t);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return X(s.integerValue)===X(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){let a=X(s.doubleValue),l=X(o.doubleValue);return a===l?Qn(a)===Qn(l):isNaN(a)&&isNaN(l)}return!1}(n,t);case 9:return Je(n.arrayValue.values||[],t.arrayValue.values||[],Ft);case 10:case 11:return function(s,o){let a=s.mapValue.fields||{},l=o.mapValue.fields||{};if(ku(a)!==ku(l))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!Ft(a[h],l[h])))return!1;return!0}(n,t);default:return F(52216,{left:n})}}function Jn(n,t){return(n.values||[]).find(e=>Ft(e,t))!==void 0}function Ye(n,t){if(n===t)return 0;let e=he(n),r=he(t);if(e!==r)return q(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,t.booleanValue);case 2:return function(o,a){let l=X(o.integerValue||o.doubleValue),h=X(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1}(n,t);case 3:return Ou(n.timestampValue,t.timestampValue);case 4:return Ou(Wn(n),Wn(t));case 5:return Fi(n.stringValue,t.stringValue);case 6:return function(o,a){let l=Wt(o),h=Wt(a);return l.compareTo(h)}(n.bytesValue,t.bytesValue);case 7:return function(o,a){let l=o.split("/"),h=a.split("/");for(let f=0;f<l.length&&f<h.length;f++){let m=q(l[f],h[f]);if(m!==0)return m}return q(l.length,h.length)}(n.referenceValue,t.referenceValue);case 8:return function(o,a){let l=q(X(o.latitude),X(a.latitude));return l!==0?l:q(X(o.longitude),X(a.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return Mu(n.arrayValue,t.arrayValue);case 10:return function(o,a){let l=o.fields||{},h=a.fields||{},f=l[Xe]?.arrayValue,m=h[Xe]?.arrayValue,E=q(f?.values?.length||0,m?.values?.length||0);return E!==0?E:Mu(f,m)}(n.mapValue,t.mapValue);case 11:return function(o,a){if(o===xr.mapValue&&a===xr.mapValue)return 0;if(o===xr.mapValue)return 1;if(a===xr.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),f=a.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let E=0;E<h.length&&E<m.length;++E){let A=Fi(h[E],m[E]);if(A!==0)return A;let R=Ye(l[h[E]],f[m[E]]);if(R!==0)return R}return q(h.length,m.length)}(n.mapValue,t.mapValue);default:throw F(23264,{he:e})}}function Ou(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return q(n,t);let e=Qt(n),r=Qt(t),s=q(e.seconds,r.seconds);return s!==0?s:q(e.nanos,r.nanos)}function Mu(n,t){let e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){let o=Ye(e[s],r[s]);if(o)return o}return q(e.length,r.length)}function Ze(n){return qi(n)}function qi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=Qt(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Wt(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return M.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",s=!0;for(let o of e.values||[])s?s=!1:r+=",",r+=qi(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),s="{",o=!0;for(let a of r)o?o=!1:s+=",",s+=`${a}:${qi(e.fields[a])}`;return s+"}"}(n.mapValue):F(61005,{value:n})}function Or(n){switch(he(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=Es(n);return t?16+Or(t):16;case 5:return 2*n.stringValue.length;case 6:return Wt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+Or(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return ye(r.fields,(o,a)=>{s+=o.length+Or(a)}),s}(n.mapValue);default:throw F(13486,{value:n})}}function Fu(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function ji(n){return!!n&&"integerValue"in n}function ba(n){return!!n&&"arrayValue"in n}function Lu(n){return!!n&&"nullValue"in n}function Bu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Mr(n){return!!n&&"mapValue"in n}function ql(n){return(n?.mapValue?.fields||{})[va]?.stringValue===Aa}function qn(n){if(n.geoPointValue)return{geoPointValue:dt({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:dt({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return ye(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=qn(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=qn(n.arrayValue.values[e]);return t}return dt({},n)}function jl(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Ul}var Gg={mapValue:{fields:{[va]:{stringValue:Aa},[Xe]:{arrayValue:{}}}}};var vt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Mr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=qn(e)}setAll(t){let e=At.emptyPath(),r={},s=[];t.forEach((a,l)=>{if(!e.isImmediateParentOf(l)){let h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=l.popLast()}a?r[l.lastSegment()]=qn(a):s.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){let e=this.field(t.popLast());Mr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ft(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];Mr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){ye(e,(s,o)=>t[s]=o);for(let s of r)delete t[s]}clone(){return new n(qn(this.value))}};function zl(n){let t=[];return ye(n.fields,(e,r)=>{let s=new At([e]);if(Mr(r)){let o=zl(r.mapValue).fields;if(o.length===0)t.push(s);else for(let a of o)t.push(s.child(a))}else t.push(s)}),new Rt(t)}var Dt=class n{constructor(t,e,r,s,o,a,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(t){return new n(t,0,B.min(),B.min(),B.min(),vt.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,B.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,B.min(),B.min(),vt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,B.min(),B.min(),vt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=vt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var tn=class{constructor(t,e){this.position=t,this.inclusive=e}};function Uu(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let o=t[s],a=n.position[s];if(o.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),e.key):r=Ye(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function qu(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ft(n.position[e],t.position[e]))return!1;return!0}var De=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function um(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Gr=class{},rt=class n extends Gr{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Gi(t,e,r):e==="array-contains"?new Qi(t,r):e==="in"?new Wi(t,r):e==="not-in"?new Hi(t,r):e==="array-contains-any"?new Ji(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new $i(t,r):new Ki(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ye(e,this.value)):e!==null&&he(this.value)===he(e)&&this.matchesComparison(Ye(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Vt=class n extends Gr{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new n(t,e)}matches(t){return Gl(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Gl(n){return n.op==="and"}function $l(n){return lm(n)&&Gl(n)}function lm(n){for(let t of n.filters)if(t instanceof Vt)return!1;return!0}function zi(n){if(n instanceof rt)return n.field.canonicalString()+n.op.toString()+Ze(n.value);if($l(n))return n.filters.map(t=>zi(t)).join(",");{let t=n.filters.map(e=>zi(e)).join(",");return`${n.op}(${t})`}}function Kl(n,t){return n instanceof rt?function(r,s){return s instanceof rt&&r.op===s.op&&r.field.isEqual(s.field)&&Ft(r.value,s.value)}(n,t):n instanceof Vt?function(r,s){return s instanceof Vt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,a,l)=>o&&Kl(a,s.filters[l]),!0):!1}(n,t):void F(19439)}function Ql(n){return n instanceof rt?function(e){return`${e.field.canonicalString()} ${e.op} ${Ze(e.value)}`}(n):n instanceof Vt?function(e){return e.op.toString()+" {"+e.getFilters().map(Ql).join(" ,")+"}"}(n):"Filter"}var Gi=class extends rt{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},$i=class extends rt{constructor(t,e){super(t,"in",e),this.keys=Wl("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ki=class extends rt{constructor(t,e){super(t,"not-in",e),this.keys=Wl("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Wl(n,t){return(t.arrayValue?.values||[]).map(e=>M.fromName(e.referenceValue))}var Qi=class extends rt{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return ba(e)&&Jn(e.arrayValue,this.value)}},Wi=class extends rt{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Jn(this.value.arrayValue,e)}},Hi=class extends rt{constructor(t,e){super(t,"not-in",e)}matches(t){if(Jn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Jn(this.value.arrayValue,e)}},Ji=class extends rt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!ba(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Jn(this.value.arrayValue,r))}};var Xi=class{constructor(t,e=null,r=[],s=[],o=null,a=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}};function ju(n,t=null,e=[],r=[],s=null,o=null,a=null){return new Xi(n,t,e,r,s,o,a)}function Sa(n){let t=L(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>zi(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),ws(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>Ze(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>Ze(r)).join(",")),t.Te=e}return t.Te}function Ra(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!um(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Kl(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!qu(n.startAt,t.startAt)&&qu(n.endAt,t.endAt)}function Yi(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var de=class{constructor(t,e=null,r=[],s=[],o=null,a="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function hm(n,t,e,r,s,o,a,l){return new de(n,t,e,r,s,o,a,l)}function Pa(n){return new de(n)}function zu(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Hl(n){return n.collectionGroup!==null}function jn(n){let t=L(n);if(t.Ie===null){t.Ie=[];let e=new Set;for(let o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new lt(At.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new De(o,r))}),e.has(At.keyField().canonicalString())||t.Ie.push(new De(At.keyField(),r))}return t.Ie}function Ot(n){let t=L(n);return t.Ee||(t.Ee=dm(t,jn(n))),t.Ee}function dm(n,t){if(n.limitType==="F")return ju(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let o=s.dir==="desc"?"asc":"desc";return new De(s.field,o)});let e=n.endAt?new tn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new tn(n.startAt.position,n.startAt.inclusive):null;return ju(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Zi(n,t){let e=n.filters.concat([t]);return new de(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function $r(n,t,e){return new de(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Is(n,t){return Ra(Ot(n),Ot(t))&&n.limitType===t.limitType}function Jl(n){return`${Sa(Ot(n))}|lt:${n.limitType}`}function je(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>Ql(s)).join(", ")}]`),ws(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>Ze(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>Ze(s)).join(",")),`Target(${r})`}(Ot(n))}; limitType=${n.limitType})`}function Ts(n,t){return t.isFoundDocument()&&function(r,s){let o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,t)&&function(r,s){for(let o of jn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,t)&&function(r,s){for(let o of r.filters)if(!o.matches(s))return!1;return!0}(n,t)&&function(r,s){return!(r.startAt&&!function(a,l,h){let f=Uu(a,l,h);return a.inclusive?f<=0:f<0}(r.startAt,jn(r),s)||r.endAt&&!function(a,l,h){let f=Uu(a,l,h);return a.inclusive?f>=0:f>0}(r.endAt,jn(r),s))}(n,t)}function fm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Xl(n){return(t,e)=>{let r=!1;for(let s of jn(n)){let o=mm(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function mm(n,t,e){let r=n.field.isKeyField()?M.comparator(t.key,e.key):function(o,a,l){let h=a.data.field(o),f=l.data.field(o);return h!==null&&f!==null?Ye(h,f):F(42886)}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F(19790,{direction:n.dir})}}var Ht=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){ye(this.inner,(e,r)=>{for(let[s,o]of r)t(s,o)})}isEmpty(){return Ol(this.inner)}size(){return this.innerSize}};var pm=new tt(M.comparator);function Jt(){return pm}var Yl=new tt(M.comparator);function Un(...n){let t=Yl;for(let e of n)t=t.insert(e.key,e);return t}function Zl(n){let t=Yl;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function Ae(){return zn()}function th(){return zn()}function zn(){return new Ht(n=>n.toString(),(n,t)=>n.isEqual(t))}var gm=new tt(M.comparator),ym=new lt(M.comparator);function j(...n){let t=ym;for(let e of n)t=t.add(e);return t}var _m=new lt(q);function wm(){return _m}function Ca(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qn(t)?"-0":t}}function eh(n){return{integerValue:""+n}}function Em(n,t){return Hf(t)?eh(t):Ca(n,t)}var en=class{constructor(){this._=void 0}};function Im(n,t,e){return n instanceof nn?function(s,o){let a={fields:{[Fl]:{stringValue:Ml},[Bl]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Ta(o)&&(o=Es(o)),o&&(a.fields[Ll]=o),{mapValue:a}}(e,t):n instanceof fe?rh(n,t):n instanceof Ve?sh(n,t):function(s,o){let a=nh(s,o),l=Gu(a)+Gu(s.Ae);return ji(a)&&ji(s.Ae)?eh(l):Ca(s.serializer,l)}(n,t)}function Tm(n,t,e){return n instanceof fe?rh(n,t):n instanceof Ve?sh(n,t):e}function nh(n,t){return n instanceof rn?function(r){return ji(r)||function(o){return!!o&&"doubleValue"in o}(r)}(t)?t:{integerValue:0}:null}var nn=class extends en{},fe=class extends en{constructor(t){super(),this.elements=t}};function rh(n,t){let e=ih(t);for(let r of n.elements)e.some(s=>Ft(s,r))||e.push(r);return{arrayValue:{values:e}}}var Ve=class extends en{constructor(t){super(),this.elements=t}};function sh(n,t){let e=ih(t);for(let r of n.elements)e=e.filter(s=>!Ft(s,r));return{arrayValue:{values:e}}}var rn=class extends en{constructor(t,e){super(),this.serializer=t,this.Ae=e}};function Gu(n){return X(n.integerValue||n.doubleValue)}function ih(n){return ba(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var to=class{constructor(t,e){this.field=t,this.transform=e}};function vm(n,t){return n.field.isEqual(t.field)&&function(r,s){return r instanceof fe&&s instanceof fe||r instanceof Ve&&s instanceof Ve?Je(r.elements,s.elements,Ft):r instanceof rn&&s instanceof rn?Ft(r.Ae,s.Ae):r instanceof nn&&s instanceof nn}(n.transform,t.transform)}var eo=class{constructor(t,e){this.version=t,this.transformResults=e}},bt=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Fr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var sn=class{};function oh(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new on(n.key,bt.none()):new xe(n.key,n.data,bt.none());{let e=n.data,r=vt.empty(),s=new lt(At.comparator);for(let o of t.fields)if(!s.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new Lt(n.key,r,new Rt(s.toArray()),bt.none())}}function Am(n,t,e){n instanceof xe?function(s,o,a){let l=s.value.clone(),h=Ku(s.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,t,e):n instanceof Lt?function(s,o,a){if(!Fr(s.precondition,o))return void o.convertToUnknownDocument(a.version);let l=Ku(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(ah(s)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,t,e):function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Gn(n,t,e,r){return n instanceof xe?function(o,a,l,h){if(!Fr(o.precondition,a))return l;let f=o.value.clone(),m=Qu(o.fieldTransforms,h,a);return f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,t,e,r):n instanceof Lt?function(o,a,l,h){if(!Fr(o.precondition,a))return l;let f=Qu(o.fieldTransforms,h,a),m=a.data;return m.setAll(ah(o)),m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(E=>E.field))}(n,t,e,r):function(o,a,l){return Fr(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,t,e)}function bm(n,t){let e=null;for(let r of n.fieldTransforms){let s=t.data.field(r.field),o=nh(r.transform,s||null);o!=null&&(e===null&&(e=vt.empty()),e.set(r.field,o))}return e||null}function $u(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Je(r,s,(o,a)=>vm(o,a))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var xe=class extends sn{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Lt=class extends sn{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function ah(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Ku(n,t,e){let r=new Map;W(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){let o=n[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,Tm(a,l,e[s]))}return r}function Qu(n,t,e){let r=new Map;for(let s of n){let o=s.transform,a=e.data.field(s.field);r.set(s.field,Im(o,a,t))}return r}var on=class extends sn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},no=class extends sn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ro=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let o=this.mutations[s];o.key.isEqual(t.key)&&Am(o,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=Gn(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=Gn(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=th();return this.mutations.forEach(s=>{let o=t.get(s.key),a=o.overlayedDocument,l=this.applyToLocalView(a,o.mutatedFields);l=e.has(s.key)?null:l;let h=oh(a,l);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(B.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),j())}isEqual(t){return this.batchId===t.batchId&&Je(this.mutations,t.mutations,(e,r)=>$u(e,r))&&Je(this.baseMutations,t.baseMutations,(e,r)=>$u(e,r))}},so=class n{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){W(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let s=function(){return gm}(),o=t.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new n(t,e,r,s)}};var io=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var oo=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var et,G;function Sm(n){switch(n){case S.OK:return F(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return F(15467,{code:n})}}function ch(n){if(n===void 0)return Kt("GRPC error has no .code"),S.UNKNOWN;switch(n){case et.OK:return S.OK;case et.CANCELLED:return S.CANCELLED;case et.UNKNOWN:return S.UNKNOWN;case et.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case et.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case et.INTERNAL:return S.INTERNAL;case et.UNAVAILABLE:return S.UNAVAILABLE;case et.UNAUTHENTICATED:return S.UNAUTHENTICATED;case et.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case et.NOT_FOUND:return S.NOT_FOUND;case et.ALREADY_EXISTS:return S.ALREADY_EXISTS;case et.PERMISSION_DENIED:return S.PERMISSION_DENIED;case et.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case et.ABORTED:return S.ABORTED;case et.OUT_OF_RANGE:return S.OUT_OF_RANGE;case et.UNIMPLEMENTED:return S.UNIMPLEMENTED;case et.DATA_LOSS:return S.DATA_LOSS;default:return F(39323,{code:n})}}(G=et||(et={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";var Rm=null;function Pm(){return new TextEncoder}var Cm=new zt([4294967295,4294967295],0);function Wu(n){let t=Pm().encode(n),e=new wi;return e.update(t),new Uint8Array(e.digest())}function Hu(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new zt([e,r],0),new zt([s,o],0)]}var ao=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new be(`Invalid padding: ${e}`);if(r<0)throw new be(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new be(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new be(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=zt.fromNumber(this.ge)}ye(t,e,r){let s=t.add(e.multiply(zt.fromNumber(r)));return s.compare(Cm)===1&&(s=new zt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;let e=Wu(t),[r,s]=Hu(e);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(t,e,r){let s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new n(o,s,e);return r.forEach(l=>a.insert(l)),a}insert(t){if(this.ge===0)return;let e=Wu(t),[r,s]=Hu(e);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,s,o);this.Se(a)}}Se(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},be=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Kr=class n{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let s=new Map;return s.set(t,Xn.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(B.min(),s,new tt(q),Jt(),j())}},Xn=class n{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,j(),j(),j())}};var Ke=class{constructor(t,e,r,s){this.be=t,this.removedTargetIds=e,this.key=r,this.De=s}},Qr=class{constructor(t,e){this.targetId=t,this.Ce=e}},Wr=class{constructor(t,e,r=pt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}},Hr=class{constructor(){this.ve=0,this.Fe=Ju(),this.Me=pt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=j(),e=j(),r=j();return this.Fe.forEach((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:F(38017,{changeType:o})}}),new Xn(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=Ju()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,W(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},co=class{constructor(t){this.Ge=t,this.ze=new Map,this.je=Jt(),this.Je=Nr(),this.He=Nr(),this.Ye=new tt(q)}Ze(t){for(let e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(let e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{let r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:F(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((r,s)=>{this.rt(s)&&e(s)})}st(t){let e=t.targetId,r=t.Ce.count,s=this.ot(e);if(s){let o=s.target;if(Yi(o))if(r===0){let a=new M(o.path);this.et(e,a,Dt.newNoDocument(a,B.min()))}else W(r===1,20013,{expectedCount:r});else{let a=this._t(e);if(a!==r){let l=this.ut(t),h=l?this.ct(l,t,a):1;if(h!==0){this.it(e);let f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,f)}Rm?.lt(function(m,E,A,R,k){let O={localCacheCount:m,existenceFilterCount:E.count,databaseId:A.database,projectId:A.projectId},x=E.unchangedNames;return x&&(O.bloomFilter={applied:k===0,hashCount:x?.hashCount??0,bitmapLength:x?.bits?.bitmap?.length??0,padding:x?.bits?.padding??0,mightContain:$=>R?.mightContain($)??!1}),O}(a,t.Ce,this.Ge.ht(),l,h))}}}}ut(t){let e=t.Ce.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e,a,l;try{a=Wt(r).toUint8Array()}catch(h){if(h instanceof jr)return He("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new ao(a,s,o)}catch(h){return He(h instanceof be?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){let r=this.Ge.getRemoteKeysForTarget(e),s=0;return r.forEach(o=>{let a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.et(e,o,null),s++)}),s}Tt(t){let e=new Map;this.ze.forEach((o,a)=>{let l=this.ot(a);if(l){if(o.current&&Yi(l.target)){let h=new M(l.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Dt.newNoDocument(h,t))}o.Be&&(e.set(a,o.ke()),o.qe())}});let r=j();this.He.forEach((o,a)=>{let l=!0;a.forEachWhile(h=>{let f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.je.forEach((o,a)=>a.setReadTime(t));let s=new Kr(t,e,this.Ye,this.je,r);return this.je=Jt(),this.Je=Nr(),this.He=Nr(),this.Ye=new tt(q),s}Xe(t,e){if(!this.rt(t))return;let r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;let s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){let e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Hr,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new lt(q),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new lt(q),this.Je=this.Je.insert(t,e)),e}rt(t){let e=this.ot(t)!==null;return e||N("WatchChangeAggregator","Detected inactive target",t),e}ot(t){let e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Hr),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}};function Nr(){return new tt(M.comparator)}function Ju(){return new tt(M.comparator)}var Dm={asc:"ASCENDING",desc:"DESCENDING"},Vm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},xm={and:"AND",or:"OR"},uo=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function lo(n,t){return n.useProto3Json||ws(t)?t:{value:t}}function Jr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function uh(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Nm(n,t){return Jr(n,t.toTimestamp())}function Mt(n){return W(!!n,49232),B.fromTimestamp(function(e){let r=Qt(e);return new it(r.seconds,r.nanos)}(n))}function Da(n,t){return ho(n,t).canonicalString()}function ho(n,t){let e=function(s){return new Y(["projects",s.projectId,"databases",s.database])}(n).child("documents");return t===void 0?e:e.child(t)}function lh(n){let t=Y.fromString(n);return W(ph(t),10190,{key:t.toString()}),t}function fo(n,t){return Da(n.databaseId,t.path)}function Si(n,t){let e=lh(t);if(e.get(1)!==n.databaseId.projectId)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new V(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(dh(e))}function hh(n,t){return Da(n.databaseId,t)}function km(n){let t=lh(n);return t.length===4?Y.emptyPath():dh(t)}function mo(n){return new Y(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function dh(n){return W(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Xu(n,t,e){return{name:fo(n,t),fields:e.value.mapValue.fields}}function Om(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:F(39313,{state:f})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=function(f,m){return f.useProto3Json?(W(m===void 0||typeof m=="string",58123),pt.fromBase64String(m||"")):(W(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),pt.fromUint8Array(m||new Uint8Array))}(n,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&function(f){let m=f.code===void 0?S.UNKNOWN:ch(f.code);return new V(m,f.message||"")}(a);e=new Wr(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=Si(n,r.document.name),o=Mt(r.document.updateTime),a=r.document.createTime?Mt(r.document.createTime):B.min(),l=new vt({mapValue:{fields:r.document.fields}}),h=Dt.newFoundDocument(s,o,a,l),f=r.targetIds||[],m=r.removedTargetIds||[];e=new Ke(f,m,h.key,h)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=Si(n,r.document),o=r.readTime?Mt(r.readTime):B.min(),a=Dt.newNoDocument(s,o),l=r.removedTargetIds||[];e=new Ke([],l,a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=Si(n,r.document),o=r.removedTargetIds||[];e=new Ke([],o,s,null)}else{if(!("filter"in t))return F(11601,{Rt:t});{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:o}=r,a=new oo(s,o),l=r.targetId;e=new Qr(l,a)}}return e}function Mm(n,t){let e;if(t instanceof xe)e={update:Xu(n,t.key,t.value)};else if(t instanceof on)e={delete:fo(n,t.key)};else if(t instanceof Lt)e={update:Xu(n,t.key,t.data),updateMask:$m(t.fieldMask)};else{if(!(t instanceof no))return F(16599,{Vt:t.type});e={verify:fo(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(o,a){let l=a.transform;if(l instanceof nn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof fe)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ve)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof rn)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw F(20930,{transform:a.transform})}(0,r))),t.precondition.isNone||(e.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Nm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:F(27497)}(n,t.precondition)),e}function Fm(n,t){return n&&n.length>0?(W(t!==void 0,14353),n.map(e=>function(s,o){let a=s.updateTime?Mt(s.updateTime):Mt(o);return a.isEqual(B.min())&&(a=Mt(o)),new eo(a,s.transformResults||[])}(e,t))):[]}function Lm(n,t){return{documents:[hh(n,t.path)]}}function Bm(n,t){let e={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=hh(n,s);let o=function(f){if(f.length!==0)return mh(Vt.create(f,"and"))}(t.filters);o&&(e.structuredQuery.where=o);let a=function(f){if(f.length!==0)return f.map(m=>function(A){return{field:ze(A.field),direction:jm(A.dir)}}(m))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let l=lo(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(t.endAt)),{ft:e,parent:s}}function Um(n){let t=km(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){W(r===1,65062);let m=e.from[0];m.allDescendants?s=m.collectionId:t=t.child(m.collectionId)}let o=[];e.where&&(o=function(E){let A=fh(E);return A instanceof Vt&&$l(A)?A.getFilters():[A]}(e.where));let a=[];e.orderBy&&(a=function(E){return E.map(A=>function(k){return new De(Ge(k.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(A))}(e.orderBy));let l=null;e.limit&&(l=function(E){let A;return A=typeof E=="object"?E.value:E,ws(A)?null:A}(e.limit));let h=null;e.startAt&&(h=function(E){let A=!!E.before,R=E.values||[];return new tn(R,A)}(e.startAt));let f=null;return e.endAt&&(f=function(E){let A=!E.before,R=E.values||[];return new tn(R,A)}(e.endAt)),hm(t,s,a,o,l,"F",h,f)}function qm(n,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function fh(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Ge(e.unaryFilter.field);return rt.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=Ge(e.unaryFilter.field);return rt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Ge(e.unaryFilter.field);return rt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Ge(e.unaryFilter.field);return rt.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(n):n.fieldFilter!==void 0?function(e){return rt.create(Ge(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return Vt.create(e.compositeFilter.filters.map(r=>fh(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(e.compositeFilter.op))}(n):F(30097,{filter:n})}function jm(n){return Dm[n]}function zm(n){return Vm[n]}function Gm(n){return xm[n]}function ze(n){return{fieldPath:n.canonicalString()}}function Ge(n){return At.fromServerFormat(n.fieldPath)}function mh(n){return n instanceof rt?function(e){if(e.op==="=="){if(Bu(e.value))return{unaryFilter:{field:ze(e.field),op:"IS_NAN"}};if(Lu(e.value))return{unaryFilter:{field:ze(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Bu(e.value))return{unaryFilter:{field:ze(e.field),op:"IS_NOT_NAN"}};if(Lu(e.value))return{unaryFilter:{field:ze(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ze(e.field),op:zm(e.op),value:e.value}}}(n):n instanceof Vt?function(e){let r=e.getFilters().map(s=>mh(s));return r.length===1?r[0]:{compositeFilter:{op:Gm(e.op),filters:r}}}(n):F(54877,{filter:n})}function $m(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ph(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Yn=class n{constructor(t,e,r,s,o=B.min(),a=B.min(),l=pt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var po=class{constructor(t){this.yt=t}};function Km(n){let t=Um({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?$r(t,t.limit,"L"):t}var Xr=class{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(X(t.integerValue));else if("doubleValue"in t){let r=X(t.doubleValue);isNaN(r)?this.Ft(e,13):(this.Ft(e,15),Qn(r)?e.Mt(0):e.Mt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Ft(e,20),typeof r=="string"&&(r=Qt(r)),e.xt(`${r.seconds||""}`),e.Mt(r.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(Wt(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Ft(e,45),e.Mt(r.latitude||0),e.Mt(r.longitude||0)}else"mapValue"in t?jl(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):ql(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):F(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){let r=t.fields||{};this.Ft(e,55);for(let s of Object.keys(r))this.Ot(s,e),this.Ct(r[s],e)}kt(t,e){let r=t.fields||{};this.Ft(e,53);let s=Xe,o=r[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(X(o)),this.Ot(s,e),this.Ct(r[s],e)}Qt(t,e){let r=t.values||[];this.Ft(e,50);for(let s of r)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),M.fromName(t).path.forEach(r=>{this.Ft(e,60),this.Ut(r,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}};Xr.Kt=new Xr;var go=class{constructor(){this.Cn=new yo}addToCollectionParentIndex(t,e){return this.Cn.add(e),P.resolve()}getCollectionParents(t,e){return P.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return P.resolve()}deleteFieldIndex(t,e){return P.resolve()}deleteAllFieldIndexes(t){return P.resolve()}createTargetIndexes(t,e){return P.resolve()}getDocumentsMatchingTarget(t,e){return P.resolve(null)}getIndexType(t,e){return P.resolve(0)}getFieldIndexes(t,e){return P.resolve([])}getNextCollectionGroupToUpdate(t){return P.resolve(null)}getMinOffset(t,e){return P.resolve(Ce.min())}getMinOffsetFromCollectionGroup(t,e){return P.resolve(Ce.min())}updateCollectionGroup(t,e,r){return P.resolve()}updateIndexEntries(t,e){return P.resolve()}},yo=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new lt(Y.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new lt(Y.comparator)).toArray()}};var $g=new Uint8Array(0);var Yu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},gh=41943040,St=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};St.DEFAULT_COLLECTION_PERCENTILE=10,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,St.DEFAULT=new St(gh,St.DEFAULT_COLLECTION_PERCENTILE,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),St.DISABLED=new St(-1,0,0);var Zn=class n{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var Zu="LruGarbageCollector",yh=1048576;function tl([n,t],[e,r]){let s=q(n,e);return s===0?q(t,r):s}var _o=class{constructor(t){this.Ir=t,this.buffer=new lt(tl),this.Er=0}dr(){return++this.Er}Ar(t){let e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();tl(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},wo=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){N(Zu,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>C(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){dn(e)?N(Zu,"Ignoring IndexedDB error during garbage collection: ",e):yield hn(e)}yield this.Vr(3e5)}))}},Eo=class{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return P.resolve(Ea.ce);let r=new _o(e);return this.mr.forEachTarget(t,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(t,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Yu)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yu):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,a,l,h,f,m=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(E=>(E>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),s=this.params.maximumSequenceNumbersToCollect):s=E,a=Date.now(),this.nthSequenceNumber(t,s))).next(E=>(r=E,l=Date.now(),this.removeTargets(t,r,e))).next(E=>(o=E,h=Date.now(),this.removeOrphanedDocuments(t,r))).next(E=>(f=Date.now(),qe()<=z.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${E} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:E})))}};function Qm(n,t){return new Eo(n,t)}var Io=class{constructor(){this.changes=new Ht(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Dt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?P.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var To=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var vo=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&Gn(r.mutation,s,Rt.empty(),it.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,j()).next(()=>r))}getLocalViewOfDocuments(t,e,r=j()){let s=Ae();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(o=>{let a=Un();return o.forEach((l,h)=>{a=a.insert(l,h.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let r=Ae();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,j()))}populateOverlays(t,e,r){let s=[];return r.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((a,l)=>{e.set(a,l)})})}computeViews(t,e,r,s){let o=Jt(),a=zn(),l=function(){return zn()}();return e.forEach((h,f)=>{let m=r.get(f.key);s.has(f.key)&&(m===void 0||m.mutation instanceof Lt)?o=o.insert(f.key,f):m!==void 0?(a.set(f.key,m.mutation.getFieldMask()),Gn(m.mutation,f,m.mutation.getFieldMask(),it.now())):a.set(f.key,Rt.empty())}),this.recalculateAndSaveOverlays(t,o).next(h=>(h.forEach((f,m)=>a.set(f,m)),e.forEach((f,m)=>l.set(f,new To(m,a.get(f)??null))),l))}recalculateAndSaveOverlays(t,e){let r=zn(),s=new tt((a,l)=>a-l),o=j();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let l of a)l.keys().forEach(h=>{let f=e.get(h);if(f===null)return;let m=r.get(h)||Rt.empty();m=l.applyToLocalView(f,m),r.set(h,m);let E=(s.get(l.batchId)||j()).add(h);s=s.insert(l.batchId,E)})}).next(()=>{let a=[],l=s.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),f=h.key,m=h.value,E=th();m.forEach(A=>{if(!o.has(A)){let R=oh(e.get(A),r.get(A));R!==null&&E.set(A,R),o=o.add(A)}}),a.push(this.documentOverlayCache.saveOverlays(t,f,E))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Hl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(o=>{let a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):P.resolve(Ae()),l=Kn,h=o;return a.next(f=>P.forEach(f,(m,E)=>(l<E.largestBatchId&&(l=E.largestBatchId),o.get(m)?P.resolve():this.remoteDocumentCache.getEntry(t,m).next(A=>{h=h.insert(m,A)}))).next(()=>this.populateOverlays(t,f,o)).next(()=>this.computeViews(t,h,f,j())).next(m=>({batchId:l,changes:Zl(m)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(r=>{let s=Un();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let o=e.collectionGroup,a=Un();return this.indexManager.getCollectionParents(t,o).next(l=>P.forEach(l,h=>{let f=function(E,A){return new de(A,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)}(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,r,s).next(m=>{m.forEach((E,A)=>{a=a.insert(E,A)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s))).next(a=>{o.forEach((h,f)=>{let m=f.getKey();a.get(m)===null&&(a=a.insert(m,Dt.newInvalidDocument(m)))});let l=Un();return a.forEach((h,f)=>{let m=o.get(h);m!==void 0&&Gn(m.mutation,f,Rt.empty(),it.now()),Ts(e,f)&&(l=l.insert(h,f))}),l})}};var Ao=class{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return P.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:Mt(s.createTime)}}(e)),P.resolve()}getNamedQuery(t,e){return P.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(s){return{name:s.name,query:Km(s.bundledQuery),readTime:Mt(s.readTime)}}(e)),P.resolve()}};var bo=class{constructor(){this.overlays=new tt(M.comparator),this.qr=new Map}getOverlay(t,e){return P.resolve(this.overlays.get(e))}getOverlays(t,e){let r=Ae();return P.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,o)=>{this.St(t,e,o)}),P.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.qr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.qr.delete(r)),P.resolve()}getOverlaysForCollection(t,e,r){let s=Ae(),o=e.length+1,a=new M(e.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){let h=l.getNext().value,f=h.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return P.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new tt((f,m)=>f-m),a=this.overlays.getIterator();for(;a.hasNext();){let f=a.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>r){let m=o.get(f.largestBatchId);m===null&&(m=Ae(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}let l=Ae(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,m)=>l.set(f,m)),!(l.size()>=s)););return P.resolve(l)}St(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new io(e,r));let o=this.qr.get(e);o===void 0&&(o=j(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}};var So=class{constructor(){this.sessionToken=pt.EMPTY_BYTE_STRING}getSessionToken(t){return P.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,P.resolve()}};var tr=class{constructor(){this.Qr=new lt(nt.$r),this.Ur=new lt(nt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){let r=new nt(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Gr(new nt(t,e))}zr(t,e){t.forEach(r=>this.removeReference(r,e))}jr(t){let e=new M(new Y([])),r=new nt(e,t),s=new nt(e,t+1),o=[];return this.Ur.forEachInRange([r,s],a=>{this.Gr(a),o.push(a.key)}),o}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){let e=new M(new Y([])),r=new nt(e,t),s=new nt(e,t+1),o=j();return this.Ur.forEachInRange([r,s],a=>{o=o.add(a.key)}),o}containsKey(t){let e=new nt(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},nt=class{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return M.comparator(t.key,e.key)||q(t.Yr,e.Yr)}static Kr(t,e){return q(t.Yr,e.Yr)||M.comparator(t.key,e.key)}};var Ro=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new lt(nt.$r)}checkEmpty(t){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new ro(o,e,r,s);this.mutationQueue.push(a);for(let l of s)this.Zr=this.Zr.add(new nt(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return P.resolve(a)}lookupMutationBatch(t,e){return P.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.ei(r),o=s<0?0:s;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?Ia:this.tr-1)}getAllMutationBatches(t){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new nt(e,0),s=new nt(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],a=>{let l=this.Xr(a.Yr);o.push(l)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new lt(q);return e.forEach(s=>{let o=new nt(s,0),a=new nt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],l=>{r=r.add(l.Yr)})}),P.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,o=r;M.isDocumentKey(o)||(o=o.child(""));let a=new nt(new M(o),0),l=new lt(q);return this.Zr.forEachWhile(h=>{let f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(l=l.add(h.Yr)),!0)},a),P.resolve(this.ti(l))}ti(t){let e=[];return t.forEach(r=>{let s=this.Xr(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){W(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return P.forEach(e.mutations,s=>{let o=new nt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Zr=r})}ir(t){}containsKey(t,e){let r=new nt(e,0),s=this.Zr.firstAfterOrEqual(r);return P.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,P.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){let e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Po=class{constructor(t){this.ri=t,this.docs=function(){return new tt(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return P.resolve(r?r.document.mutableCopy():Dt.newInvalidDocument(e))}getEntries(t,e){let r=Jt();return e.forEach(s=>{let o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Dt.newInvalidDocument(s))}),P.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Jt(),a=e.path,l=new M(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:f,value:{document:m}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||Kf($f(m),r)<=0||(s.has(m.key)||Ts(e,m))&&(o=o.insert(m.key,m.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(t,e,r,s){F(9500)}ii(t,e){return P.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Co(this)}getSize(t){return P.resolve(this.size)}},Co=class extends Io{constructor(t){super(),this.Nr=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)}),P.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}};var Do=class{constructor(t){this.persistence=t,this.si=new Ht(e=>Sa(e),Ra),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.oi=0,this._i=new tr,this.targetCount=0,this.ai=Zn.ur()}forEachTarget(t,e){return this.si.forEach((r,s)=>e(s)),P.resolve()}getLastRemoteSnapshotVersion(t){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return P.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),P.resolve()}Pr(t){this.si.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.ai=new Zn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,P.resolve()}updateTargetData(t,e){return this.Pr(e),P.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,P.resolve()}removeTargets(t,e,r){let s=0,o=[];return this.si.forEach((a,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),P.waitFor(o).next(()=>s)}getTargetCount(t){return P.resolve(this.targetCount)}getTargetData(t,e){let r=this.si.get(e)||null;return P.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),P.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);let s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(a=>{o.push(s.markPotentiallyOrphaned(t,a))}),P.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),P.resolve()}getMatchingKeysForTargetId(t,e){let r=this._i.Hr(e);return P.resolve(r)}containsKey(t,e){return P.resolve(this._i.containsKey(e))}};var Yr=class{constructor(t,e){this.ui={},this.overlays={},this.ci=new Ea(0),this.li=!1,this.li=!0,this.hi=new So,this.referenceDelegate=t(this),this.Pi=new Do(this),this.indexManager=new go,this.remoteDocumentCache=function(s){return new Po(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new po(e),this.Ii=new Ao(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new bo,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new Ro(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){N("MemoryPersistence","Starting transaction:",t);let s=new Vo(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(o=>this.referenceDelegate.di(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ai(t,e){return P.or(Object.values(this.ui).map(r=>()=>r.containsKey(t,e)))}},Vo=class extends Bi{constructor(t){super(),this.currentSequenceNumber=t}},xo=class n{constructor(t){this.persistence=t,this.Ri=new tr,this.Vi=null}static mi(t){return new n(t)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),P.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),P.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(s=>this.fi.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.fi.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,r=>{let s=M.fromPath(r);return this.gi(t,s).next(o=>{o||e.removeEntry(s,B.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return P.or([()=>P.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}},Zr=class n{constructor(t,e){this.persistence=t,this.pi=new Ht(r=>Jf(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Qm(this,e)}static mi(t,e){return new n(t,e)}Ei(){}di(t){return P.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){let e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}wr(t){let e=0;return this.pr(t,r=>{e++}).next(()=>e)}pr(t,e){return P.forEach(this.pi,(r,s)=>this.br(t,r,s).next(o=>o?P.resolve():e(s)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,a=>this.br(t,a,e).next(l=>{l||(r++,o.removeEntry(a,B.min()))})).next(()=>o.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),P.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),P.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),P.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),P.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Or(t.data.value)),e}br(t,e,r){return P.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.pi.get(e);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var No=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=j(),s=j();for(let o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new n(t,e.fromCache,r,s)}};var ko=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Oo=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return iu()?8:Wf(Sr())>0?6:4}()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){let o={result:null};return this.ys(t,e).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ws(t,e,s,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new ko;return this.Ss(t,e,a).next(l=>{if(o.result=l,this.Vs)return this.bs(t,e,a,l.size)})}).next(()=>o.result)}bs(t,e,r,s){return r.documentReadCount<this.fs?(qe()<=z.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",je(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(qe()<=z.DEBUG&&N("QueryEngine","Query:",je(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(qe()<=z.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",je(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ot(e))):P.resolve())}ys(t,e){if(zu(e))return P.resolve(null);let r=Ot(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=$r(e,null,"F"),r=Ot(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{let a=j(...o);return this.ps.getDocuments(t,a).next(l=>this.indexManager.getMinOffset(t,r).next(h=>{let f=this.Ds(e,l);return this.Cs(e,f,a,h.readTime)?this.ys(t,$r(e,null,"F")):this.vs(t,f,e,h)}))})))}ws(t,e,r,s){return zu(e)||s.isEqual(B.min())?P.resolve(null):this.ps.getDocuments(t,r).next(o=>{let a=this.Ds(e,o);return this.Cs(e,a,r,s)?P.resolve(null):(qe()<=z.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),je(e)),this.vs(t,a,e,Gf(s,Kn)).next(l=>l))})}Ds(t,e){let r=new lt(Xl(t));return e.forEach((s,o)=>{Ts(t,o)&&(r=r.add(o))}),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return qe()<=z.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",je(e)),this.ps.getDocumentsMatchingQuery(t,e,Ce.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next(o=>(e.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Va="LocalStore",Wm=3e8,Mo=class{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new tt(q),this.xs=new Ht(o=>Sa(o),Ra),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new vo(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}};function Hm(n,t,e,r){return new Mo(n,t,e,r)}function _h(n,t){return C(this,null,function*(){let e=L(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],l=[],h=j();for(let f of s){a.push(f.batchId);for(let m of f.mutations)h=h.add(m.key)}for(let f of o){l.push(f.batchId);for(let m of f.mutations)h=h.add(m.key)}return e.localDocuments.getDocuments(r,h).next(f=>({Ls:f,removedBatchIds:a,addedBatchIds:l}))})})})}function Jm(n,t){let e=L(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return function(l,h,f,m){let E=f.batch,A=E.keys(),R=P.resolve();return A.forEach(k=>{R=R.next(()=>m.getEntry(h,k)).next(O=>{let x=f.docVersions.get(k);W(x!==null,48541),O.version.compareTo(x)<0&&(E.applyToRemoteDocument(O,f),O.isValidDocument()&&(O.setReadTime(f.commitVersion),m.addEntry(O)))})}),R.next(()=>l.mutationQueue.removeMutationBatch(h,E))}(e,r,t,o).next(()=>o.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let h=j();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h}(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function wh(n){let t=L(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function Xm(n,t){let e=L(n),r=t.snapshotVersion,s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;let l=[];t.targetChanges.forEach((m,E)=>{let A=s.get(E);if(!A)return;l.push(e.Pi.removeMatchingKeys(o,m.removedDocuments,E).next(()=>e.Pi.addMatchingKeys(o,m.addedDocuments,E)));let R=A.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(E)!==null?R=R.withResumeToken(pt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):m.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(m.resumeToken,r)),s=s.insert(E,R),function(O,x,$){return O.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=Wm?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(A,R,m)&&l.push(e.Pi.updateTargetData(o,R))});let h=Jt(),f=j();if(t.documentUpdates.forEach(m=>{t.resolvedLimboDocuments.has(m)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,m))}),l.push(Ym(o,a,t.documentUpdates).next(m=>{h=m.ks,f=m.qs})),!r.isEqual(B.min())){let m=e.Pi.getLastRemoteSnapshotVersion(o).next(E=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(m)}return P.waitFor(l).next(()=>a.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(e.Ms=s,o))}function Ym(n,t,e){let r=j(),s=j();return e.forEach(o=>r=r.add(o)),t.getEntries(n,r).next(o=>{let a=Jt();return e.forEach((l,h)=>{let f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(B.min())?(t.removeEntry(l,h.readTime),a=a.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(h),a=a.insert(l,h)):N(Va,"Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{ks:a,qs:s}})}function Zm(n,t){let e=L(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=Ia),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function tp(n,t){let e=L(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.Pi.getTargetData(r,t).next(o=>o?(s=o,P.resolve(s)):e.Pi.allocateTargetId(r).next(a=>(s=new Yn(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=e.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r})}function Fo(n,t,e){return C(this,null,function*(){let r=L(n),s=r.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!dn(a))throw a;N(Va,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)})}function el(n,t,e){let r=L(n),s=B.min(),o=j();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,f,m){let E=L(h),A=E.xs.get(m);return A!==void 0?P.resolve(E.Ms.get(A)):E.Pi.getTargetData(f,m)}(r,a,Ot(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next(h=>{o=h})}).next(()=>r.Fs.getDocumentsMatchingQuery(a,t,e?s:B.min(),e?o:j())).next(l=>(ep(r,fm(t),l),{documents:l,Qs:o})))}function ep(n,t,e){let r=n.Os.get(t)||B.min();e.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Os.set(t,r)}var ts=class{constructor(){this.activeTargetIds=wm()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Lo=class{constructor(){this.Mo=new ts,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new ts,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Bo=class{Oo(t){}shutdown(){}};var nl="ConnectivityMonitor",es=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){N(nl,"Network connectivity changed: AVAILABLE");for(let t of this.qo)t(0)}ko(){N(nl,"Network connectivity changed: UNAVAILABLE");for(let t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var kr=null;function Uo(){return kr===null?kr=function(){return 268435456+Math.round(2147483648*Math.random())}():kr++,"0x"+kr.toString(16)}var Ri="RestConnection",np={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},qo=class{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Hn?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){let a=Uo(),l=this.zo(t,e.toUriEncodedString());N(Ri,`Sending RPC '${t}' ${a}:`,l,r);let h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);let{host:f}=new URL(l),m=On(f);return this.Jo(t,l,h,r,m).then(E=>(N(Ri,`Received RPC '${t}' ${a}: `,E),E),E=>{throw He(Ri,`RPC '${t}' ${a} failed with error: `,E,"url: ",l,"request:",r),E})}Ho(t,e,r,s,o,a){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ln}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}zo(t,e){let r=np[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}};var jo=class{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}};var mt="WebChannelConnection",zo=class extends qo{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){let a=Uo();return new Promise((l,h)=>{let f=new Ei;f.setWithCredentials(!0),f.listenOnce(Ii.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case Bn.NO_ERROR:let E=f.getResponseJson();N(mt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(E)),l(E);break;case Bn.TIMEOUT:N(mt,`RPC '${t}' ${a} timed out`),h(new V(S.DEADLINE_EXCEEDED,"Request time out"));break;case Bn.HTTP_ERROR:let A=f.getStatus();if(N(mt,`RPC '${t}' ${a} failed with status:`,A,"response text:",f.getResponseText()),A>0){let R=f.getResponseJson();Array.isArray(R)&&(R=R[0]);let k=R?.error;if(k&&k.status&&k.message){let O=function($){let K=$.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(K)>=0?K:S.UNKNOWN}(k.status);h(new V(O,k.message))}else h(new V(S.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new V(S.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:t,streamId:a,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{N(mt,`RPC '${t}' ${a} completed.`)}});let m=JSON.stringify(s);N(mt,`RPC '${t}' ${a} sending request:`,s),f.send(e,"POST",m,r,15)})}T_(t,e,r){let s=Uo(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Ai(),l=vi(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;let m=o.join("");N(mt,`Creating RPC '${t}' stream ${s}: ${m}`,h);let E=a.createWebChannel(m,h);this.I_(E);let A=!1,R=!1,k=new jo({Yo:x=>{R?N(mt,`Not sending because RPC '${t}' stream ${s} is closed:`,x):(A||(N(mt,`Opening RPC '${t}' stream ${s} transport.`),E.open(),A=!0),N(mt,`RPC '${t}' stream ${s} sending:`,x),E.send(x))},Zo:()=>E.close()}),O=(x,$,K)=>{x.listen($,Q=>{try{K(Q)}catch(gt){setTimeout(()=>{throw gt},0)}})};return O(E,Ue.EventType.OPEN,()=>{R||(N(mt,`RPC '${t}' stream ${s} transport opened.`),k.o_())}),O(E,Ue.EventType.CLOSE,()=>{R||(R=!0,N(mt,`RPC '${t}' stream ${s} transport closed`),k.a_(),this.E_(E))}),O(E,Ue.EventType.ERROR,x=>{R||(R=!0,He(mt,`RPC '${t}' stream ${s} transport errored. Name:`,x.name,"Message:",x.message),k.a_(new V(S.UNAVAILABLE,"The operation could not be completed")))}),O(E,Ue.EventType.MESSAGE,x=>{if(!R){let $=x.data[0];W(!!$,16349);let K=$,Q=K?.error||K[0]?.error;if(Q){N(mt,`RPC '${t}' stream ${s} received error:`,Q);let gt=Q.status,wt=function(p){let y=et[p];if(y!==void 0)return ch(y)}(gt),at=Q.message;wt===void 0&&(wt=S.INTERNAL,at="Unknown error status: "+gt+" with message "+Q.message),R=!0,k.a_(new V(wt,at)),E.close()}else N(mt,`RPC '${t}' stream ${s} received:`,$),k.u_($)}}),O(l,Ti.STAT_EVENT,x=>{x.stat===Vr.PROXY?N(mt,`RPC '${t}' stream ${s} detected buffering proxy`):x.stat===Vr.NOPROXY&&N(mt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{k.__()},0),k}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}};function Pi(){return typeof document<"u"?document:null}function vs(n){return new uo(n,!0)}var ns=class{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();let e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&N("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var rl="PersistentStream",rs=class{constructor(t,e,r,s,o,a,l,h){this.Mi=t,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ns(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return C(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}k_(){return C(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return C(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(Kt(e.toString()),Kt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.r_(e)})}K_(){}auth(){this.state=1;let t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===e&&this.G_(r,s)},r=>{t(()=>{let s=new V(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(t,e){let r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(()=>C(this,null,function*(){this.state=0,this.start()}))}z_(t){return N(rl,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(N(rl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Go=class extends rs{constructor(t,e,r,s,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();let e=Om(this.serializer,t),r=function(o){if(!("targetChange"in o))return B.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?Mt(a.readTime):B.min()}(t);return this.listener.H_(e,r)}Y_(t){let e={};e.database=mo(this.serializer),e.addTarget=function(o,a){let l,h=a.target;if(l=Yi(h)?{documents:Lm(o,h)}:{query:Bm(o,h).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=uh(o,a.resumeToken);let f=lo(o,a.expectedCount);f!==null&&(l.expectedCount=f)}else if(a.snapshotVersion.compareTo(B.min())>0){l.readTime=Jr(o,a.snapshotVersion.toTimestamp());let f=lo(o,a.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,t);let r=qm(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){let e={};e.database=mo(this.serializer),e.removeTarget=t,this.q_(e)}},$o=class extends rs{constructor(t,e,r,s,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return W(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,W(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){W(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();let e=Fm(t.writeResults,t.commitTime),r=Mt(t.commitTime);return this.listener.na(r,e)}ra(){let t={};t.database=mo(this.serializer),this.q_(t)}ea(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Mm(this.serializer,r))};this.q_(e)}};var Ko=class{},Qo=class extends Ko{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Go(t,ho(e,r),s,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(S.UNKNOWN,o.toString())})}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Ho(t,ho(e,r),s,a,l,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new V(S.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},Wo=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Kt(e),this.aa=!1):N("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Ne="RemoteStore",Ho=class{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo(a=>{r.enqueueAndForget(()=>C(this,null,function*(){Oe(this)&&(N(Ne,"Restarting streams for network reachability change."),yield function(h){return C(this,null,function*(){let f=L(h);f.Ea.add(4),yield sr(f),f.Ra.set("Unknown"),f.Ea.delete(4),yield As(f)})}(this))}))}),this.Ra=new Wo(r,s)}};function As(n){return C(this,null,function*(){if(Oe(n))for(let t of n.da)yield t(!0)})}function sr(n){return C(this,null,function*(){for(let t of n.da)yield t(!1)})}function Eh(n,t){let e=L(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Oa(e)?ka(e):fn(e).O_()&&Na(e,t))}function xa(n,t){let e=L(n),r=fn(e);e.Ia.delete(t),r.O_()&&Ih(e,t),e.Ia.size===0&&(r.O_()?r.L_():Oe(e)&&e.Ra.set("Unknown"))}function Na(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}fn(n).Y_(t)}function Ih(n,t){n.Va.Ue(t),fn(n).Z_(t)}function ka(n){n.Va=new co({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),fn(n).start(),n.Ra.ua()}function Oa(n){return Oe(n)&&!fn(n).x_()&&n.Ia.size>0}function Oe(n){return L(n).Ea.size===0}function Th(n){n.Va=void 0}function rp(n){return C(this,null,function*(){n.Ra.set("Online")})}function sp(n){return C(this,null,function*(){n.Ia.forEach((t,e)=>{Na(n,t)})})}function ip(n,t){return C(this,null,function*(){Th(n),Oa(n)?(n.Ra.ha(t),ka(n)):n.Ra.set("Unknown")})}function op(n,t,e){return C(this,null,function*(){if(n.Ra.set("Online"),t instanceof Wr&&t.state===2&&t.cause)try{yield function(s,o){return C(this,null,function*(){let a=o.cause;for(let l of o.targetIds)s.Ia.has(l)&&(yield s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})}(n,t)}catch(r){N(Ne,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield ss(n,r)}else if(t instanceof Ke?n.Va.Ze(t):t instanceof Qr?n.Va.st(t):n.Va.tt(t),!e.isEqual(B.min()))try{let r=yield wh(n.localStore);e.compareTo(r)>=0&&(yield function(o,a){let l=o.Va.Tt(a);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){let m=o.Ia.get(f);m&&o.Ia.set(f,m.withResumeToken(h.resumeToken,a))}}),l.targetMismatches.forEach((h,f)=>{let m=o.Ia.get(h);if(!m)return;o.Ia.set(h,m.withResumeToken(pt.EMPTY_BYTE_STRING,m.snapshotVersion)),Ih(o,h);let E=new Yn(m.target,h,f,m.sequenceNumber);Na(o,E)}),o.remoteSyncer.applyRemoteEvent(l)}(n,e))}catch(r){N(Ne,"Failed to raise snapshot:",r),yield ss(n,r)}})}function ss(n,t,e){return C(this,null,function*(){if(!dn(t))throw t;n.Ea.add(1),yield sr(n),n.Ra.set("Offline"),e||(e=()=>wh(n.localStore)),n.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){N(Ne,"Retrying IndexedDB access"),yield e(),n.Ea.delete(1),yield As(n)}))})}function vh(n,t){return t().catch(e=>ss(n,e,t))}function bs(n){return C(this,null,function*(){let t=L(n),e=me(t),r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Ia;for(;ap(t);)try{let s=yield Zm(t.localStore,r);if(s===null){t.Ta.length===0&&e.L_();break}r=s.batchId,cp(t,s)}catch(s){yield ss(t,s)}Ah(t)&&bh(t)})}function ap(n){return Oe(n)&&n.Ta.length<10}function cp(n,t){n.Ta.push(t);let e=me(n);e.O_()&&e.X_&&e.ea(t.mutations)}function Ah(n){return Oe(n)&&!me(n).x_()&&n.Ta.length>0}function bh(n){me(n).start()}function up(n){return C(this,null,function*(){me(n).ra()})}function lp(n){return C(this,null,function*(){let t=me(n);for(let e of n.Ta)t.ea(e.mutations)})}function hp(n,t,e){return C(this,null,function*(){let r=n.Ta.shift(),s=so.from(r,t,e);yield vh(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield bs(n)})}function dp(n,t){return C(this,null,function*(){t&&me(n).X_&&(yield function(r,s){return C(this,null,function*(){if(function(a){return Sm(a)&&a!==S.ABORTED}(s.code)){let o=r.Ta.shift();me(r).B_(),yield vh(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield bs(r)}})}(n,t)),Ah(n)&&bh(n)})}function sl(n,t){return C(this,null,function*(){let e=L(n);e.asyncQueue.verifyOperationInProgress(),N(Ne,"RemoteStore received new credentials");let r=Oe(e);e.Ea.add(3),yield sr(e),r&&e.Ra.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),yield As(e)})}function fp(n,t){return C(this,null,function*(){let e=L(n);t?(e.Ea.delete(2),yield As(e)):t||(e.Ea.add(2),yield sr(e),e.Ra.set("Unknown"))})}function fn(n){return n.ma||(n.ma=function(e,r,s){let o=L(e);return o.sa(),new Go(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Xo:rp.bind(null,n),t_:sp.bind(null,n),r_:ip.bind(null,n),H_:op.bind(null,n)}),n.da.push(t=>C(this,null,function*(){t?(n.ma.B_(),Oa(n)?ka(n):n.Ra.set("Unknown")):(yield n.ma.stop(),Th(n))}))),n.ma}function me(n){return n.fa||(n.fa=function(e,r,s){let o=L(e);return o.sa(),new $o(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:up.bind(null,n),r_:dp.bind(null,n),ta:lp.bind(null,n),na:hp.bind(null,n)}),n.da.push(t=>C(this,null,function*(){t?(n.fa.B_(),yield bs(n)):(yield n.fa.stop(),n.Ta.length>0&&(N(Ne,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var Jo=class n{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new $t,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){let a=Date.now()+r,l=new n(t,e,a,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ma(n,t){if(Kt("AsyncQueue",`${t}: ${n}`),dn(n))return new V(S.UNAVAILABLE,`${t}: ${n}`);throw n}var is=class n{static emptySet(t){return new n(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||M.comparator(e.key,r.key):(e,r)=>M.comparator(e.key,r.key),this.keyedMap=Un(),this.sortedSet=new tt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var os=class{constructor(){this.ga=new tt(M.comparator)}track(t){let e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):F(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){let t=[];return this.ga.inorderTraversal((e,r)=>{t.push(r)}),t}},an=class n{constructor(t,e,r,s,o,a,l,h,f){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(t,e,r,s,o){let a=[];return e.forEach(l=>{a.push({type:0,doc:l})}),new n(t,e,is.emptySet(e),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Is(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}};var Xo=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}},Yo=class{constructor(){this.queries=il(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){let s=L(e),o=s.queries;s.queries=il(),o.forEach((a,l)=>{for(let h of l.Sa)h.onError(r)})})(this,new V(S.ABORTED,"Firestore shutting down"))}};function il(){return new Ht(n=>Jl(n),Is)}function mp(n,t){return C(this,null,function*(){let e=L(n),r=3,s=t.query,o=e.queries.get(s);o?!o.ba()&&t.Da()&&(r=2):(o=new Xo,r=t.Da()?0:1);try{switch(r){case 0:o.wa=yield e.onListen(s,!0);break;case 1:o.wa=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(a){let l=Ma(a,`Initialization of query '${je(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&Fa(e)})}function pp(n,t){return C(this,null,function*(){let e=L(n),r=t.query,s=3,o=e.queries.get(r);if(o){let a=o.Sa.indexOf(t);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function gp(n,t){let e=L(n),r=!1;for(let s of t){let o=s.query,a=e.queries.get(o);if(a){for(let l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&Fa(e)}function yp(n,t,e){let r=L(n),s=r.queries.get(t);if(s)for(let o of s.Sa)o.onError(e);r.queries.delete(t)}function Fa(n){n.Ca.forEach(t=>{t.next()})}var Zo,ol;(ol=Zo||(Zo={})).Ma="default",ol.Cache="cache";var ta=class{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new an(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;let r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;let e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=an.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Zo.Cache}};var as=class{constructor(t){this.key=t}},cs=class{constructor(t){this.key=t}},ea=class{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=j(),this.mutatedKeys=j(),this.eu=Xl(t),this.tu=new is(this.eu)}get nu(){return this.Ya}ru(t,e){let r=e?e.iu:new os,s=e?e.tu:this.tu,o=e?e.mutatedKeys:this.mutatedKeys,a=s,l=!1,h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((m,E)=>{let A=s.get(m),R=Ts(this.query,E)?E:null,k=!!A&&this.mutatedKeys.has(A.key),O=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),x=!1;A&&R?A.data.isEqual(R.data)?k!==O&&(r.track({type:3,doc:R}),x=!0):this.su(A,R)||(r.track({type:2,doc:R}),x=!0,(h&&this.eu(R,h)>0||f&&this.eu(R,f)<0)&&(l=!0)):!A&&R?(r.track({type:0,doc:R}),x=!0):A&&!R&&(r.track({type:1,doc:A}),x=!0,(h||f)&&(l=!0)),x&&(R?(a=a.add(R),o=O?o.add(m):o.delete(m)):(a=a.delete(m),o=o.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),o=o.delete(m.key),r.track({type:1,doc:m})}return{tu:a,iu:r,Cs:l,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){let o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;let a=t.iu.ya();a.sort((m,E)=>function(R,k){let O=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:x})}};return O(R)-O(k)}(m.type,E.type)||this.eu(m.doc,E.doc)),this.ou(r),s=s??!1;let l=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,f=h!==this.Za;return this.Za=h,a.length!==0||f?{snapshot:new an(this.query,t.tu,o,a,t.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new os,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=t.current)}_u(){if(!this.current)return[];let t=this.Xa;this.Xa=j(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});let e=[];return t.forEach(r=>{this.Xa.has(r)||e.push(new cs(r))}),this.Xa.forEach(r=>{t.has(r)||e.push(new as(r))}),e}cu(t){this.Ya=t.Qs,this.Xa=j();let e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return an.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},La="SyncEngine",na=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},ra=class{constructor(t){this.key=t,this.hu=!1}},sa=class{constructor(t,e,r,s,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Ht(l=>Jl(l),Is),this.Iu=new Map,this.Eu=new Set,this.du=new tt(M.comparator),this.Au=new Map,this.Ru=new tr,this.Vu={},this.mu=new Map,this.fu=Zn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function _p(n,t,e=!0){return C(this,null,function*(){let r=Vh(n),s,o=r.Tu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=yield Sh(r,t,e,!0),s})}function wp(n,t){return C(this,null,function*(){let e=Vh(n);yield Sh(e,t,!0,!1)})}function Sh(n,t,e,r){return C(this,null,function*(){let s=yield tp(n.localStore,Ot(t)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e),l;return r&&(l=yield Ep(n,t,o,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&Eh(n.remoteStore,s),l})}function Ep(n,t,e,r,s){return C(this,null,function*(){n.pu=(E,A,R)=>function(O,x,$,K){return C(this,null,function*(){let Q=x.view.ru($);Q.Cs&&(Q=yield el(O.localStore,x.query,!1).then(({documents:w})=>x.view.ru(w,Q)));let gt=K&&K.targetChanges.get(x.targetId),wt=K&&K.targetMismatches.get(x.targetId)!=null,at=x.view.applyChanges(Q,O.isPrimaryClient,gt,wt);return cl(O,x.targetId,at.au),at.snapshot})}(n,E,A,R);let o=yield el(n.localStore,t,!0),a=new ea(t,o.Qs),l=a.ru(o.documents),h=Xn.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),f=a.applyChanges(l,n.isPrimaryClient,h);cl(n,e,f.au);let m=new na(t,e,a);return n.Tu.set(t,m),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),f.snapshot})}function Ip(n,t,e){return C(this,null,function*(){let r=L(n),s=r.Tu.get(t),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter(a=>!Is(a,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Fo(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&xa(r.remoteStore,s.targetId),ia(r,s.targetId)}).catch(hn))):(ia(r,s.targetId),yield Fo(r.localStore,s.targetId,!0))})}function Tp(n,t){return C(this,null,function*(){let e=L(n),r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),xa(e.remoteStore,r.targetId))})}function vp(n,t,e){return C(this,null,function*(){let r=Dp(n);try{let s=yield function(a,l){let h=L(a),f=it.now(),m=l.reduce((R,k)=>R.add(k.key),j()),E,A;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let k=Jt(),O=j();return h.Ns.getEntries(R,m).next(x=>{k=x,k.forEach(($,K)=>{K.isValidDocument()||(O=O.add($))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,k)).next(x=>{E=x;let $=[];for(let K of l){let Q=bm(K,E.get(K.key).overlayedDocument);Q!=null&&$.push(new Lt(K.key,Q,zl(Q.value.mapValue),bt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,f,$,l)}).next(x=>{A=x;let $=x.applyToLocalDocumentSet(E,O);return h.documentOverlayCache.saveOverlays(R,x.batchId,$)})}).then(()=>({batchId:A.batchId,changes:Zl(E)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,h){let f=a.Vu[a.currentUser.toKey()];f||(f=new tt(q)),f=f.insert(l,h),a.Vu[a.currentUser.toKey()]=f}(r,s.batchId,e),yield ir(r,s.changes),yield bs(r.remoteStore)}catch(s){let o=Ma(s,"Failed to persist write");e.reject(o)}})}function Rh(n,t){return C(this,null,function*(){let e=L(n);try{let r=yield Xm(e.localStore,t);t.targetChanges.forEach((s,o)=>{let a=e.Au.get(o);a&&(W(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?W(a.hu,14607):s.removedDocuments.size>0&&(W(a.hu,42227),a.hu=!1))}),yield ir(e,r,t)}catch(r){yield hn(r)}})}function al(n,t,e){let r=L(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.Tu.forEach((o,a)=>{let l=a.view.va(t);l.snapshot&&s.push(l.snapshot)}),function(a,l){let h=L(a);h.onlineState=l;let f=!1;h.queries.forEach((m,E)=>{for(let A of E.Sa)A.va(l)&&(f=!0)}),f&&Fa(h)}(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Ap(n,t,e){return C(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(t,"rejected",e);let s=r.Au.get(t),o=s&&s.key;if(o){let a=new tt(M.comparator);a=a.insert(o,Dt.newNoDocument(o,B.min()));let l=j().add(o),h=new Kr(B.min(),new Map,new tt(q),a,l);yield Rh(r,h),r.du=r.du.remove(o),r.Au.delete(t),Ba(r)}else yield Fo(r.localStore,t,!1).then(()=>ia(r,t,e)).catch(hn)})}function bp(n,t){return C(this,null,function*(){let e=L(n),r=t.batch.batchId;try{let s=yield Jm(e.localStore,t);Ch(e,r,null),Ph(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield ir(e,s)}catch(s){yield hn(s)}})}function Sp(n,t,e){return C(this,null,function*(){let r=L(n);try{let s=yield function(a,l){let h=L(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,l).next(E=>(W(E!==null,37113),m=E.keys(),h.mutationQueue.removeMutationBatch(f,E))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(r.localStore,t);Ch(r,t,e),Ph(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield ir(r,s)}catch(s){yield hn(s)}})}function Ph(n,t){(n.mu.get(t)||[]).forEach(e=>{e.resolve()}),n.mu.delete(t)}function Ch(n,t,e){let r=L(n),s=r.Vu[r.currentUser.toKey()];if(s){let o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function ia(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach(r=>{n.Ru.containsKey(r)||Dh(n,r)})}function Dh(n,t){n.Eu.delete(t.path.canonicalString());let e=n.du.get(t);e!==null&&(xa(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),Ba(n))}function cl(n,t,e){for(let r of e)r instanceof as?(n.Ru.addReference(r.key,t),Rp(n,r)):r instanceof cs?(N(La,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||Dh(n,r.key)):F(19791,{wu:r})}function Rp(n,t){let e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(N(La,"New document in limbo: "+e),n.Eu.add(r),Ba(n))}function Ba(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let t=n.Eu.values().next().value;n.Eu.delete(t);let e=new M(Y.fromString(t)),r=n.fu.next();n.Au.set(r,new ra(e)),n.du=n.du.insert(e,r),Eh(n.remoteStore,new Yn(Ot(Pa(e.path)),r,"TargetPurposeLimboResolution",Ea.ce))}}function ir(n,t,e){return C(this,null,function*(){let r=L(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((l,h)=>{a.push(r.pu(h,t,e).then(f=>{if((f||e)&&r.isPrimaryClient){let m=f?!f.fromCache:e?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,m?"current":"not-current")}if(f){s.push(f);let m=No.As(h.targetId,f);o.push(m)}}))}),yield Promise.all(a),r.Pu.H_(s),yield function(h,f){return C(this,null,function*(){let m=L(h);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",E=>P.forEach(f,A=>P.forEach(A.Es,R=>m.persistence.referenceDelegate.addReference(E,A.targetId,R)).next(()=>P.forEach(A.ds,R=>m.persistence.referenceDelegate.removeReference(E,A.targetId,R)))))}catch(E){if(!dn(E))throw E;N(Va,"Failed to update sequence numbers: "+E)}for(let E of f){let A=E.targetId;if(!E.fromCache){let R=m.Ms.get(A),k=R.snapshotVersion,O=R.withLastLimboFreeSnapshotVersion(k);m.Ms=m.Ms.insert(A,O)}}})}(r.localStore,o))})}function Pp(n,t){return C(this,null,function*(){let e=L(n);if(!e.currentUser.isEqual(t)){N(La,"User change. New user:",t.toKey());let r=yield _h(e.localStore,t);e.currentUser=t,function(o,a){o.mu.forEach(l=>{l.forEach(h=>{h.reject(new V(S.CANCELLED,a))})}),o.mu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield ir(e,r.Ls)}})}function Cp(n,t){let e=L(n),r=e.Au.get(t);if(r&&r.hu)return j().add(r.key);{let s=j(),o=e.Iu.get(t);if(!o)return s;for(let a of o){let l=e.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function Vh(n){let t=L(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Rh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ap.bind(null,t),t.Pu.H_=gp.bind(null,t.eventManager),t.Pu.yu=yp.bind(null,t.eventManager),t}function Dp(n){let t=L(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=bp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Sp.bind(null,t),t}var xh=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){this.serializer=vs(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,r){return null}Mu(e,r){return null}vu(e){return Hm(this.persistence,new Oo,e.initialUser,this.serializer)}Cu(e){return new Yr(xo.mi,this.serializer)}Du(e){return new Lo}terminate(){return C(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),oa=class extends xh{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){W(this.persistence.referenceDelegate instanceof Zr,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new wo(r,t.asyncQueue,e)}Cu(t){let e=this.cacheSizeBytes!==void 0?St.withCacheSize(this.cacheSizeBytes):St.DEFAULT;return new Yr(r=>Zr.mi(r,e),this.serializer)}};var Vp=(()=>{class n{initialize(e,r){return C(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>al(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Pp.bind(null,this.syncEngine),yield fp(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Yo}()}createDatastore(e){let r=vs(e.databaseInfo.databaseId),s=function(a){return new zo(a)}(e.databaseInfo);return function(a,l,h,f){return new Qo(a,l,h,f)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,o,a,l,h){return new Ho(s,o,a,l,h)}(this.localStore,this.datastore,e.asyncQueue,r=>al(this.syncEngine,r,0),function(){return es.v()?new es:new Bo}())}createSyncEngine(e,r){return function(o,a,l,h,f,m,E){let A=new sa(o,a,l,h,f,m);return E&&(A.gu=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}terminate(){return C(this,null,function*(){yield function(r){return C(this,null,function*(){let s=L(r);N(Ne,"RemoteStore shutting down."),s.Ea.add(5),yield sr(s),s.Aa.shutdown(),s.Ra.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var aa=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Kt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var pe="FirestoreClient",ca=class{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=ut.UNAUTHENTICATED,this.clientId=$n.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>C(this,null,function*(){N(pe,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(N(pe,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new $t;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=Ma(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Ci(n,t){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),N(pe,"Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(s=>C(this,null,function*(){r.isEqual(s)||(yield _h(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function ul(n,t){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield xp(n);N(pe,"Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>sl(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>sl(t.remoteStore,s)),n._onlineComponents=t})}function xp(n){return C(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){N(pe,"Using user provided OfflineComponentProvider");try{yield Ci(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;He("Error using user provided cache. Falling back to memory cache: "+e),yield Ci(n,new xh)}}else N(pe,"Using default OfflineComponentProvider"),yield Ci(n,new oa(void 0));return n._offlineComponents})}function Nh(n){return C(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(N(pe,"Using user provided OnlineComponentProvider"),yield ul(n,n._uninitializedComponentsProvider._online)):(N(pe,"Using default OnlineComponentProvider"),yield ul(n,new Vp))),n._onlineComponents})}function Np(n){return Nh(n).then(t=>t.syncEngine)}function ll(n){return C(this,null,function*(){let t=yield Nh(n),e=t.eventManager;return e.onListen=_p.bind(null,t.syncEngine),e.onUnlisten=Ip.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=wp.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Tp.bind(null,t.syncEngine),e})}function kh(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var hl=new Map;var Oh="firestore.googleapis.com",dl=!0,us=class{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new V(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Oh,this.ssl=dl}else this.host=t.host,this.ssl=t.ssl??dl;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=gh;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<yh)throw new V(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}jf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=kh(t.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new V(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},cn=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new us({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new V(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new us(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Vi;switch(r.type){case"firstParty":return new Oi(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return C(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=hl.get(e);r&&(N("ComponentProvider","Removing Datastore"),hl.delete(e),r.terminate())}(this),Promise.resolve()}};function kp(n,t,e,r={}){n=Ct(n,cn);let s=On(t),o=n._getSettings(),a=Vn(dt({},o),{emulatorOptions:n._getEmulatorOptions()}),l=`${t}:${e}`;s&&(ei(`https://${l}`),su("Firestore",!0)),o.host!==Oh&&o.host!==l&&He("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Vn(dt({},o),{host:l,ssl:s,emulatorOptions:r});if(!se(h,a)&&(n._setSettings(h),r.mockUserToken)){let f,m;if(typeof r.mockUserToken=="string")f=r.mockUserToken,m=ut.MOCK_USER;else{f=ru(r.mockUserToken,n._app?.options.projectId);let E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new V(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new ut(E)}n._authCredentials=new xi(new Lr(f,m))}}var ge=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},ht=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ae(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(rr(e,n._jsonSchema))return new n(t,r||null,new M(Y.fromString(e.referencePath)))}};ht._jsonSchemaVersion="firestore/documentReference/1.0",ht._jsonSchema={type:st("string",ht._jsonSchemaVersion),referencePath:st("string")};var ae=class n extends ge{constructor(t,e,r){super(t,e,Pa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ht(this.firestore,null,new M(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function Kg(n,t,...e){if(n=Tt(n),wl("collection","path",t),n instanceof cn){let r=Y.fromString(t,...e);return Du(r),new ae(n,null,r)}{if(!(n instanceof ht||n instanceof ae))throw new V(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Y.fromString(t,...e));return Du(r),new ae(n.firestore,null,r)}}function Op(n,t,...e){if(n=Tt(n),arguments.length===1&&(t=$n.newId()),wl("doc","path",t),n instanceof cn){let r=Y.fromString(t,...e);return Cu(r),new ht(n,null,new M(r))}{if(!(n instanceof ht||n instanceof ae))throw new V(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Y.fromString(t,...e));return Cu(r),new ht(n.firestore,n instanceof ae?n.converter:null,new M(r))}}var fl="AsyncQueue",ls=class{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ns(this,"async_queue_retry"),this._c=()=>{let r=Pi();r&&N(fl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;let e=Pi();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;let e=Pi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});let e=new $t;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}lc(){return C(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!dn(t))throw t;N(fl,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(t){let e=this.ac.then(()=>(this.rc=!0,t().catch(r=>{throw this.nc=r,this.rc=!1,Kt("INTERNAL UNHANDLED ERROR: ",ml(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);let s=Jo.createAndSchedule(this,t,e,r,o=>this.hc(o));return this.tc.push(s),s}uc(){this.nc&&F(47125,{Pc:ml(this.nc)})}verifyOperationInProgress(){}Tc(){return C(this,null,function*(){let t;do t=this.ac,yield t;while(t!==this.ac)})}Ic(t){for(let e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){let e=this.tc.indexOf(t);this.tc.splice(e,1)}};function ml(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function pl(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let s=e;for(let o of r)if(o in s&&typeof s[o]=="function")return!0;return!1}(n,["next","error","complete"])}var Bt=class extends cn{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new ls,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return C(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new ls(t),this._firestoreClient=void 0,yield t}})}};function Mh(n,t,e){e||(e=Hn);let r=yi(n,"firestore");if(r.isInitialized(e)){let s=r.getImmediate({identifier:e}),o=r.getOptions(e);if(se(o,t))return s;throw new V(S.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new V(S.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<yh)throw new V(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&On(t.host)&&ei(t.host),r.initialize({options:t,instanceIdentifier:e})}function Fh(n,t){let e=typeof n=="object"?n:Cr(),r=typeof n=="string"?n:t||Hn,s=yi(e,"firestore").getImmediate({identifier:r});if(!s._initialized){let o=nu("firestore");o&&kp(s,...o)}return s}function Ua(n){if(n._terminated)throw new V(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Mp(n),n._firestoreClient}function Mp(n){let t=n._freezeSettings(),e=function(s,o,a,l){return new Ui(s,o,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,kh(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)}(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new ca(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&function(s){let o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}}(n._componentsProvider))}var ce=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(pt.fromBase64String(t))}catch(e){throw new V(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(pt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(rr(t,n._jsonSchema))return n.fromBase64String(t.bytes)}};ce._jsonSchemaVersion="firestore/bytes/1.0",ce._jsonSchema={type:st("string",ce._jsonSchemaVersion),bytes:st("string")};var ke=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new V(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new At(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var un=class{constructor(t){this._methodName=t}};var ue=class n{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new V(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new V(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(t){if(rr(t,n._jsonSchema))return new n(t.latitude,t.longitude)}};ue._jsonSchemaVersion="firestore/geoPoint/1.0",ue._jsonSchema={type:st("string",ue._jsonSchemaVersion),latitude:st("number"),longitude:st("number")};var le=class n{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,t._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(rr(t,n._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new n(t.vectorValues);throw new V(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};le._jsonSchemaVersion="firestore/vectorValue/1.0",le._jsonSchema={type:st("string",le._jsonSchemaVersion),vectorValues:st("object")};var Fp=/^__.*__$/,ua=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Lt(t,this.data,this.fieldMask,e,this.fieldTransforms):new xe(t,this.data,e,this.fieldTransforms)}},hs=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Lt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Lh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:n})}}var ds=class n{constructor(t,e,r,s,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new n(dt(dt({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){let e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){let e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return ms(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(Lh(this.Ac)&&Fp.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}},la=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||vs(t)}Cc(t,e,r,s=!1){return new ds({Ac:t,methodName:e,Dc:r,path:At.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function or(n){let t=n._freezeSettings(),e=vs(n._databaseId);return new la(n._databaseId,!!t.ignoreUndefinedProperties,e)}function qa(n,t,e,r,s,o={}){let a=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);ja("Data must be an object, but it was:",a,r);let l=qh(r,a),h,f;if(o.merge)h=new Rt(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){let m=[];for(let E of o.mergeFields){let A=da(t,E,e);if(!a.contains(A))throw new V(S.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);zh(m,A)||m.push(A)}h=new Rt(m),f=a.fieldTransforms.filter(E=>h.covers(E.field))}else h=null,f=a.fieldTransforms;return new ua(new vt(l),h,f)}var fs=class n extends un{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function Lp(n,t,e){return new ds({Ac:3,Dc:t.settings.Dc,methodName:n._methodName,fc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var ha=class n extends un{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=Lp(this,t,!0),r=this.vc.map(o=>mn(o,e)),s=new fe(r);return new to(t.path,s)}isEqual(t){return t instanceof n&&se(this.vc,t.vc)}};function Bh(n,t,e,r){let s=n.Cc(1,t,e);ja("Data must be an object, but it was:",s,r);let o=[],a=vt.empty();ye(r,(h,f)=>{let m=za(t,h,e);f=Tt(f);let E=s.yc(m);if(f instanceof fs)o.push(m);else{let A=mn(f,E);A!=null&&(o.push(m),a.set(m,A))}});let l=new Rt(o);return new hs(a,l,s.fieldTransforms)}function Uh(n,t,e,r,s,o){let a=n.Cc(1,t,e),l=[da(t,r,e)],h=[s];if(o.length%2!=0)throw new V(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let A=0;A<o.length;A+=2)l.push(da(t,o[A])),h.push(o[A+1]);let f=[],m=vt.empty();for(let A=l.length-1;A>=0;--A)if(!zh(f,l[A])){let R=l[A],k=h[A];k=Tt(k);let O=a.yc(R);if(k instanceof fs)f.push(R);else{let x=mn(k,O);x!=null&&(f.push(R),m.set(R,x))}}let E=new Rt(f);return new hs(m,E,a.fieldTransforms)}function Bp(n,t,e,r=!1){return mn(e,n.Cc(r?4:3,t))}function mn(n,t){if(jh(n=Tt(n)))return ja("Unsupported field value:",t,n),qh(n,t);if(n instanceof un)return function(r,s){if(!Lh(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return function(r,s){let o=[],a=0;for(let l of r){let h=mn(l,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(n,t)}return function(r,s){if((r=Tt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Em(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=it.fromDate(r);return{timestampValue:Jr(s.serializer,o)}}if(r instanceof it){let o=new it(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Jr(s.serializer,o)}}if(r instanceof ue)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ce)return{bytesValue:uh(s.serializer,r._byteString)};if(r instanceof ht){let o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Da(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof le)return function(a,l){return{mapValue:{fields:{[va]:{stringValue:Aa},[Xe]:{arrayValue:{values:a.toArray().map(f=>{if(typeof f!="number")throw l.Sc("VectorValues must only contain numeric values.");return Ca(l.serializer,f)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${_s(r)}`)}(n,t)}function qh(n,t){let e={};return Ol(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ye(n,(r,s)=>{let o=mn(s,t.mc(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function jh(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof it||n instanceof ue||n instanceof ce||n instanceof ht||n instanceof un||n instanceof le)}function ja(n,t,e){if(!jh(e)||!El(e)){let r=_s(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function da(n,t,e){if((t=Tt(t))instanceof ke)return t._internalPath;if(typeof t=="string")return za(n,t);throw ms("Field path arguments must be of type string or ",n,!1,void 0,e)}var Up=new RegExp("[~\\*/\\[\\]]");function za(n,t,e){if(t.search(Up)>=0)throw ms(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new ke(...t.split("."))._internalPath}catch{throw ms(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function ms(n,t,e,r,s){let o=r&&!r.isEmpty(),a=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new V(S.INVALID_ARGUMENT,l+n+h)}function zh(n,t){return n.some(e=>e.isEqual(t))}var ps=class{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ht(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new fa(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Ss("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},fa=class extends ps{data(){return super.data()}};function Ss(n,t){return typeof t=="string"?za(n,t):t instanceof ke?t._internalPath:t._delegate._internalPath}function qp(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new V(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var er=class{},nr=class extends er{};function Qg(n,t,...e){let r=[];t instanceof er&&r.push(t),r=r.concat(e),function(o){let a=o.filter(h=>h instanceof ma).length,l=o.filter(h=>h instanceof gs).length;if(a>1||a>0&&l>0)throw new V(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let s of r)n=s._apply(n);return n}var gs=class n extends nr{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return Gh(t._query,e),new ge(t.firestore,t.converter,Zi(t._query,e))}_parse(t){let e=or(t.firestore);return function(o,a,l,h,f,m,E){let A;if(f.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new V(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){yl(E,m);let k=[];for(let O of E)k.push(gl(h,o,O));A={arrayValue:{values:k}}}else A=gl(h,o,E)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||yl(E,m),A=Bp(l,a,E,m==="in"||m==="not-in");return rt.create(f,m,A)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Wg(n,t,e){let r=t,s=Ss("where",n);return gs._create(s,r,e)}var ma=class n extends er{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:Vt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(s,o){let a=s,l=o.getFlattenedFilters();for(let h of l)Gh(a,h),a=Zi(a,h)}(t._query,e),new ge(t.firestore,t.converter,Zi(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var pa=class n extends nr{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(s,o,a){if(s.startAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new V(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new De(o,a)}(t._query,this._field,this._direction);return new ge(t.firestore,t.converter,function(s,o){let a=s.explicitOrderBy.concat([o]);return new de(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}};function Hg(n,t="asc"){let e=t,r=Ss("orderBy",n);return pa._create(r,e)}var ga=class n extends nr{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){return new ge(t.firestore,t.converter,$r(t._query,this._limit,this._limitType))}};function Jg(n){return zf("limit",n),ga._create("limit",n,"F")}function gl(n,t,e){if(typeof(e=Tt(e))=="string"){if(e==="")throw new V(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Hl(t)&&e.indexOf("/")!==-1)throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(Y.fromString(e));if(!M.isDocumentKey(r))throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fu(n,new M(r))}if(e instanceof ht)return Fu(n,e._key);throw new V(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_s(e)}.`)}function yl(n,t){if(!Array.isArray(n)||n.length===0)throw new V(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Gh(n,t){let e=function(s,o){for(let a of s)for(let l of a.getFlattenedFilters())if(o.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new V(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var ya=class{convertValue(t,e="none"){switch(he(t)){case 0:return null;case 1:return t.booleanValue;case 2:return X(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Wt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return ye(t,(s,o)=>{r[s]=this.convertValue(o,e)}),r}convertVectorValue(t){let e=t.fields?.[Xe].arrayValue?.values?.map(r=>X(r.doubleValue));return new le(e)}convertGeoPoint(t){return new ue(X(t.latitude),X(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=Es(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Wn(t));default:return null}}convertTimestamp(t){let e=Qt(t);return new it(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=Y.fromString(t);W(ph(r),9688,{name:t});let s=new zr(r.get(1),r.get(3)),o=new M(r.popFirst(5));return s.isEqual(e)||Kt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function Ga(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var Se=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Re=class n extends ps{constructor(t,e,r,s,o,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Qe(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(Ss("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=n._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};Re._jsonSchemaVersion="firestore/documentSnapshot/1.0",Re._jsonSchema={type:st("string",Re._jsonSchemaVersion),bundleSource:st("string","DocumentSnapshot"),bundleName:st("string"),bundle:st("string")};var Qe=class extends Re{data(t={}){return super.data(t)}},We=class n{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Se(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Qe(this._firestore,this._userDataWriter,r.key,r,new Se(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new V(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{let h=new Qe(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Se(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let h=new Qe(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Se(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter),f=-1,m=-1;return l.type!==0&&(f=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),m=a.indexOf(l.doc.key)),{type:jp(l.type),doc:h,oldIndex:f,newIndex:m}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=n._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=$n.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],r=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function jp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:n})}}We._jsonSchemaVersion="firestore/querySnapshot/1.0",We._jsonSchema={type:st("string",We._jsonSchemaVersion),bundleSource:st("string","QuerySnapshot"),bundleName:st("string"),bundle:st("string")};var ys=class extends ya{constructor(t){super(),this.firestore=t}convertBytes(t){return new ce(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ht(this.firestore,null,e)}};function Xg(n,t,e){n=Ct(n,ht);let r=Ct(n.firestore,Bt),s=Ga(n.converter,t,e);return ar(r,[qa(or(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,bt.none())])}function Yg(n,t,e,...r){n=Ct(n,ht);let s=Ct(n.firestore,Bt),o=or(s),a;return a=typeof(t=Tt(t))=="string"||t instanceof ke?Uh(o,"updateDoc",n._key,t,e,r):Bh(o,"updateDoc",n._key,t),ar(s,[a.toMutation(n._key,bt.exists(!0))])}function Zg(n){return ar(Ct(n.firestore,Bt),[new on(n._key,bt.none())])}function ty(n,t){let e=Ct(n.firestore,Bt),r=Op(n),s=Ga(n.converter,t);return ar(e,[qa(or(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,bt.exists(!1))]).then(()=>r)}function ey(n,...t){n=Tt(n);let e={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||pl(t[r])||(e=t[r++]);let s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(pl(t[r])){let h=t[r];t[r]=h.next?.bind(h),t[r+1]=h.error?.bind(h),t[r+2]=h.complete?.bind(h)}let o,a,l;if(n instanceof ht)a=Ct(n.firestore,Bt),l=Pa(n._key.path),o={next:h=>{t[r]&&t[r](zp(a,n,h))},error:t[r+1],complete:t[r+2]};else{let h=Ct(n,ge);a=Ct(h.firestore,Bt),l=h._query;let f=new ys(a);o={next:m=>{t[r]&&t[r](new We(a,f,h,m))},error:t[r+1],complete:t[r+2]},qp(n._query)}return function(f,m,E,A){let R=new aa(A),k=new ta(m,R,E);return f.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return mp(yield ll(f),k)})),()=>{R.Nu(),f.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return pp(yield ll(f),k)}))}}(Ua(a),l,s,o)}function ar(n,t){return function(r,s){let o=new $t;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return vp(yield Np(r),s,o)})),o.promise}(Ua(n),t)}function zp(n,t,e){let r=e.docs.get(t._key),s=new ys(n);return new Re(n,s,t._key,r,new Se(e.hasPendingWrites,e.fromCache),t.converter)}var _a=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=or(t)}set(t,e,r){this._verifyNotCommitted();let s=Di(t,this._firestore),o=Ga(s.converter,e,r),a=qa(this._dataReader,"WriteBatch.set",s._key,o,s.converter!==null,r);return this._mutations.push(a.toMutation(s._key,bt.none())),this}update(t,e,r,...s){this._verifyNotCommitted();let o=Di(t,this._firestore),a;return a=typeof(e=Tt(e))=="string"||e instanceof ke?Uh(this._dataReader,"WriteBatch.update",o._key,e,r,s):Bh(this._dataReader,"WriteBatch.update",o._key,e),this._mutations.push(a.toMutation(o._key,bt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Di(t,this._firestore);return this._mutations=this._mutations.concat(new on(e._key,bt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Di(n,t){if((n=Tt(n)).firestore!==t)throw new V(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function ny(...n){return new ha("arrayUnion",n)}function ry(n){return Ua(n=Ct(n,Bt)),new _a(n,t=>ar(n,t))}(function(t,e=!0){(function(s){ln=s})(Eu),Fn(new qt("firestore",(r,{instanceIdentifier:s,options:o})=>{let a=r.getProvider("app").getImmediate(),l=new Bt(new Ni(r.getProvider("auth-internal")),new Mi(a,r.getProvider("app-check-internal")),function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new V(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zr(f.options.projectId,m)}(a,s),a);return o=dt({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),oe(Su,Ru,t),oe(Su,Ru,"esm2020")})();var Gp="firebase",$p="12.6.0";oe(Gp,$p,"app");var py=(()=>{class n{constructor(){Iu().length>0?(this.app=Cr(),this.db=Fh(this.app)):(this.app=_i(Wc.firebaseConfig),this.db=Mh(this.app,{experimentalForceLongPolling:!0}))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=Qc({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{tu as a,Rd as b,Wp as c,On as d,ei as e,su as f,Sr as g,Hp as h,Jp as i,Xp as j,Yp as k,Zp as l,ni as m,ou as n,tg as o,Ut as p,kn as q,eg as r,se as s,ng as t,rg as u,Tt as v,qt as w,z as x,Be as y,fu as z,fg as A,Fn as B,yi as C,wu as D,Eu as E,Cr as F,oe as G,it as H,Kg as I,Op as J,Qg as K,Wg as L,Hg as M,Jg as N,Xg as O,Yg as P,Zg as Q,ty as R,ey as S,ny as T,ry as U,py as V};
