import{a as l}from"./chunk-B45BWZAU.js";import{M as u,P as h,U as p,g as m,ic as d,o as a}from"./chunk-7NWFEXXR.js";import{a as i,b as n}from"./chunk-7QOE2ANW.js";var I=(()=>{class s{constructor(t){this.http=t,this.apiUrl=d.apiUrl,this.customersSubject=new m([]),this.customers$=this.customersSubject.asObservable()}loadCustomers(){this.fetchCustomers()}loadInitialData(){this.fetchCustomers()}getCurrentUser(){return localStorage.getItem("jjm_user_id")||"guest"}reloadData(){this.loadInitialData()}fetchCustomers(){let t=this.getCurrentUser();!t||t==="guest"||this.http.get(`${this.apiUrl}/customers?userId=${t}`).subscribe({next:e=>this.customersSubject.next(e),error:e=>console.error("Error fetching customers:",e)})}getCustomers(){return this.customers$}getCustomerByName(t){return this.http.get(`${this.apiUrl}/customers?name=${encodeURIComponent(t)}`).pipe(a(e=>e.map(r=>n(i({},r),{phoneNumber:r.phoneNumber,deliveryAddress:"***",gpsCoordinates:"***",userId:"***"}))))}addCustomer(t){let e=i({userId:this.getCurrentUser()},t);return this.http.post(`${this.apiUrl}/customers`,e).pipe(u({next:r=>{let o=this.customersSubject.value;this.customersSubject.next([...o,r])},error:r=>console.error("Error adding customer:",r)}))}updateCustomer(t,e){return this.http.put(`${this.apiUrl}/customers/${t}`,e).pipe(u({next:()=>{let o=this.customersSubject.value.map(c=>c.id===t?i(i({},c),e):c);this.customersSubject.next(o)},error:r=>console.error("Error updating customer:",r)}))}deleteCustomer(t){return this.http.delete(`${this.apiUrl}/customers/${t}`).pipe(u({next:()=>{let r=this.customersSubject.value.filter(o=>o.id!==t);this.customersSubject.next(r)},error:e=>console.error("Error deleting customer:",e)}))}getCustomerById(t){return this.customersSubject.value.find(e=>e.id===t)}static{this.\u0275fac=function(e){return new(e||s)(p(l))}}static{this.\u0275prov=h({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{I as a};
