<div class="logs-container">
  <!-- Header Section -->
  <header class="page-header">
    <div class="header-content">
      <div class="header-title-section">
        <h1 class="page-title">Activity Logs</h1>
        <p class="page-subtitle">Track and audit all system modifications over time.</p>
      </div>
      <div class="header-actions">
        <button class="btn-secondary" (click)="refreshLogs()">
          <span class="material-icon">refresh</span>
          <span class="btn-text">Refresh</span>
        </button>
        <button class="btn-primary" (click)="exportLogs()">
          <span class="material-icon">download</span>
          <span class="btn-text">Export Log</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Filters Toolbar -->
  <div class="filters-toolbar">
    <div class="filters-left">
      <div class="search-box">
        <span class="material-icon search-icon">search</span>
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange()"
          placeholder="Search by ID, User, or Action..."
          class="search-input"
        />
      </div>
      <div class="filter-chips">
        <div class="filter-dropdown">
          <select [(ngModel)]="selectedEntityType" (ngModelChange)="onFilterChange()" class="filter-select">
            <option value="all">Module: All</option>
            <ng-container *ngFor="let type of entityTypes">
              <option *ngIf="type !== 'all'" [value]="type">
                {{ type | titlecase }}
              </option>
            </ng-container>
          </select>
        </div>
        <div class="filter-dropdown">
          <select [(ngModel)]="selectedAction" (ngModelChange)="onFilterChange()" class="filter-select">
            <option value="all">Action: All</option>
            <ng-container *ngFor="let action of actions">
              <option *ngIf="action !== 'all'" [value]="action">
                {{ action | titlecase }}
              </option>
            </ng-container>
          </select>
        </div>
      </div>
    </div>
    <div class="results-count">
      Showing <span class="bold">{{ showingFrom }}-{{ showingTo }}</span> of <span class="bold">{{ filteredLogs.length }}</span> events
    </div>
  </div>

  <!-- Logs Table -->
  <div class="table-container">
    <table class="logs-table">
      <thead>
        <tr>
          <th class="col-timestamp">Timestamp</th>
          <th class="col-user">User</th>
          <th class="col-store">Store</th>
          <th class="col-action">Action</th>
          <th class="col-module">Module</th>
          <th class="col-target">Entity</th>
          <th class="col-view">View</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let log of paginatedLogs" class="log-row">
          <td class="timestamp-cell">
            <span class="timestamp">{{ formatTimestamp(log.timestamp) }}</span>
          </td>
          <td class="user-cell">
            <div class="user-info">
              <div class="user-avatar">
                <span class="material-icon">person</span>
              </div>
              <div class="user-details">
                <span class="user-name">{{ log.userName || log.userId || 'System' }}</span>
              </div>
            </div>
          </td>
          <td class="store-cell">
            <div class="store-badge">
              <span class="material-icon">storefront</span>
              <span class="store-name">{{ getStoreName(log) }}</span>
            </div>
          </td>
          <td class="action-cell">
            <span
              class="action-badge"
              [attr.data-action]="getActionColor(log.action)"
            >
              <span class="material-icon action-icon">{{ getActionIcon(log.action) }}</span>
              {{ log.action | titlecase }}
            </span>
          </td>
          <td class="module-cell">
            <div class="module-info">
              <span class="material-icon">{{ getEntityIcon(log.entityType) }}</span>
              <span>{{ log.entityType | titlecase }}</span>
            </div>
          </td>
          <td class="target-cell">
            <span class="entity-name">{{ log.entityName || getLogDetails(log) || 'â€”' }}</span>
          </td>
          <td class="view-cell">
            <button class="view-btn" (click)="viewLogDetails(log)">
              <span class="material-icon">chevron_right</span>
            </button>
          </td>
        </tr>
        <tr *ngIf="paginatedLogs.length === 0">
          <td colspan="7" class="empty-row">
            <div class="empty-state">
              <span class="material-icon">history</span>
              <p>No activity logs found</p>
              <button class="btn-refresh" (click)="refreshLogs()">Refresh Logs</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination-bar">
    <div class="page-size-control">
      <span class="page-size-label">Rows per page:</span>
      <select [(ngModel)]="pageSize" (ngModelChange)="applyFilters()" class="page-size-select">
        <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
      </select>
    </div>
    <div class="pagination-controls">
      <button class="pagination-btn" [disabled]="currentPage === 1" (click)="prevPage()">
        <span class="material-icon">chevron_left</span>
      </button>
      <div class="page-numbers">
        <ng-container *ngFor="let page of getPageNumbers()">
          <span *ngIf="page < 0" class="page-ellipsis">...</span>
          <button
            *ngIf="page > 0"
            class="page-btn"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
        </ng-container>
      </div>
      <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
        <span class="material-icon">chevron_right</span>
      </button>
    </div>
  </div>

  <!-- Cleanup Action -->
  <div class="cleanup-section">
    <button class="btn-cleanup" (click)="cleanupOldLogs()">
      <span class="material-icon">auto_delete</span>
      Cleanup Old Logs (30+ days)
    </button>
  </div>
</div>
