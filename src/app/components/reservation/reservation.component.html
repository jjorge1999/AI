<div class="reservation-page">
  <div class="reservation-container">
    <div class="reservation-header">
      <h2>ðŸ“… Make a Reservation</h2>
      <p>Reserve items for pickup or delivery.</p>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="success-alert">
      <div class="success-icon">âœ…</div>
      <p>{{ successMessage }}</p>
    </div>

    <!-- Reservation Form -->
    <div *ngIf="!successMessage" class="reservation-form">
      <!-- 1. Customer Details -->
      <section class="form-section">
        <h3>ðŸ“‹ Customer Information</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="name">Full Name *</label>
            <input
              type="text"
              id="name"
              [(ngModel)]="customerName"
              class="form-input"
              placeholder="Enter your name"
              required
            />
          </div>
          <div class="form-group">
            <label for="contact">Phone Number *</label>
            <input
              type="text"
              id="contact"
              [(ngModel)]="customerContact"
              class="form-input"
              placeholder="Phone number"
              required
            />
          </div>
          <div class="form-group full-width" style="grid-column: 1 / -1">
            <label for="address">Delivery Address *</label>
            <input
              type="text"
              id="address"
              [(ngModel)]="customerAddress"
              class="form-input"
              placeholder="Street, City, Province"
              required
            />
          </div>
          <div class="form-group full-width" style="grid-column: 1 / -1">
            <label for="payment">Payment Option (Optional)</label>
            <select
              id="payment"
              [(ngModel)]="paymentOption"
              class="form-input"
              style="height: 42px"
            >
              <option value="" selected>Select Payment Method</option>
              <option *ngFor="let opt of paymentOptions" [value]="opt">
                {{ opt }}
              </option>
            </select>
          </div>
        </div>

        <h3 style="margin-top: var(--space-lg)">ðŸšš Pickup/Delivery Date</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="date">Date *</label>
            <input
              type="date"
              id="date"
              [(ngModel)]="pickupDate"
              class="form-input"
              required
            />
          </div>
          <div class="form-group">
            <label for="time">Time</label>
            <input
              type="time"
              id="time"
              [(ngModel)]="pickupTime"
              class="form-input"
            />
          </div>
        </div>
      </section>

      <!-- 2. Select Products -->
      <section class="form-section">
        <h3>Select Items</h3>
        <div class="product-grid">
          <div class="product-card" *ngFor="let p of products">
            <div class="card-image">
              <img
                *ngIf="p.imageUrl"
                [src]="p.imageUrl"
                [alt]="p.name"
                loading="lazy"
              />
              <div *ngIf="!p.imageUrl" class="placeholder-img">ðŸ“¦</div>
            </div>
            <div class="card-content">
              <h4 class="card-title">{{ p.name }}</h4>
              <div class="card-meta">
                <span class="price">â‚±{{ p.price | number : "1.2-2" }}</span>
                <span class="stock" [class.low]="p.quantity < 10"
                  >Stock: {{ p.quantity }}</span
                >
              </div>

              <div class="card-actions">
                <div class="qty-control">
                  <button
                    type="button"
                    class="qty-btn"
                    (click)="decrementQty(p)"
                  >
                    -
                  </button>
                  <input
                    type="number"
                    [value]="getQty(p)"
                    (input)="manualQty(p, $event)"
                    class="qty-input-sm"
                    min="1"
                    [max]="p.quantity"
                  />
                  <button
                    type="button"
                    class="qty-btn"
                    (click)="incrementQty(p)"
                  >
                    +
                  </button>
                </div>
                <button class="btn-add-card" (click)="addToOrder(p)">
                  Add
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 3. Order Summary -->
      <section
        class="form-section summary-section"
        *ngIf="orderItems.length > 0"
      >
        <h3>Order Summary</h3>
        <div class="order-list">
          <div
            class="order-item"
            *ngFor="let item of orderItems; let i = index"
          >
            <div class="item-info">
              <span class="item-name">{{ item.product.name }}</span>
              <span class="item-details"
                >{{ item.quantity }} x â‚±{{
                  item.product.price | number : "1.2-2"
                }}</span
              >
            </div>
            <div class="item-total">
              â‚±{{ item.product.price * item.quantity | number : "1.2-2" }}
              <button
                class="btn-remove"
                (click)="removeFromOrder(i)"
                title="Remove"
              >
                âœ•
              </button>
            </div>
          </div>
        </div>
        
        <!-- Price Breakdown Preview -->
        <div class="price-breakdown">
          <div class="breakdown-row">
            <span class="breakdown-label">Net Subtotal</span>
            <span class="breakdown-value">â‚±{{ subTotal | number : "1.2-2" }}</span>
          </div>
          <div class="breakdown-row">
             <span class="breakdown-label">VAT (12% Inclusive)</span>
             <span class="breakdown-value">â‚±{{ taxAmount | number : "1.2-2" }}</span>
          </div>
          <div class="breakdown-divider"></div>
        </div>

        <div class="order-total">
          <span>Total Amount:</span>
          <span class="total-price">â‚±{{ totalAmount | number : "1.2-2" }}</span>
        </div>

        <div class="form-group">
          <label for="notes">Additional Notes</label>
          <textarea
            id="notes"
            [(ngModel)]="notes"
            rows="3"
            class="form-textarea"
            placeholder="Any special requests?"
          ></textarea>
        </div>

        <div class="actions">
          <button
            class="btn-submit"
            (click)="submitReservation()"
            [disabled]="isSubmitting"
          >
            {{ isSubmitting ? "Submitting..." : "Confirm Reservation" }}
          </button>
        </div>
      </section>

      <div class="empty-cart-msg" *ngIf="orderItems.length === 0">
        <p>Your cart is empty. Add items above.</p>
      </div>
    </div>
  </div>
</div>
