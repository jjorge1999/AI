<div class="relative flex h-auto min-h-screen w-full flex-col bg-gray-50 dark:bg-[#101822] text-gray-900 dark:text-white font-display transition-colors duration-200">
    <!-- TopNavBar -->
    <header class="flex items-center justify-between whitespace-nowrap border-b border-gray-200 dark:border-gray-700 px-6 lg:px-10 py-4 bg-white dark:bg-[#101822] z-20 sticky top-0 transition-colors duration-200">
        <div class="flex items-center gap-4 text-blue-600 dark:text-[#1269e2]">
            <div class="size-6 text-current">
                <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                    <path clip-rule="evenodd" d="M24 0.757355L47.2426 24L24 47.2426L0.757355 24L24 0.757355ZM21 35.7574V12.2426L9.24264 24L21 35.7574Z" fill="currentColor" fill-rule="evenodd"></path>
                </svg>
            </div>
            <h2 class="text-gray-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">JJM Inventory</h2>
        </div>
        <div class="flex flex-1 justify-end gap-8">
            <div (click)="goBack()" class="flex items-center gap-2 group cursor-pointer text-gray-500 dark:text-[#92a9c9] hover:text-blue-600 dark:hover:text-white transition-colors">
                <span class="material-symbols-outlined text-xl">arrow_back</span>
                <span class="text-sm font-medium leading-normal">Back to Login</span>
            </div>
        </div>
    </header>

    <div class="layout-container flex h-full grow flex-col">
        <div class="flex flex-1 justify-center py-5 px-4 lg:px-8">
            <div class="layout-content-container flex flex-col max-w-[1200px] flex-1 w-full">
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Left Column: Form Steps -->
                    <div class="flex-1 flex flex-col gap-8 min-w-0">
                        <!-- Page Heading -->
                        <div class="flex flex-col gap-2">
                            <h1 class="text-gray-900 dark:text-white text-3xl md:text-4xl font-black leading-tight tracking-[-0.033em]">New Reservation</h1>
                            <p class="text-gray-500 dark:text-[#92a9c9] text-base font-normal leading-normal">Select items and schedule your pickup in 3 simple steps.</p>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="flex flex-col gap-3">
                            <div class="flex gap-6 justify-between items-center">
                                <p class="text-gray-900 dark:text-white text-base font-medium leading-normal">Current Progress</p>
                                <span class="text-gray-500 dark:text-[#92a9c9] text-sm bg-gray-200 dark:bg-[#233348] px-2 py-1 rounded">Step {{ currentStep }} of 3</span>
                            </div>
                            <div class="rounded-full bg-gray-200 dark:bg-[#324867] h-2 overflow-hidden">
                                <div class="h-full bg-blue-600 dark:bg-[#1269e2] rounded-full transition-all duration-300" [style.width.%]="progressPercentage"></div>
                            </div>
                        </div>

                        <!-- Step 1: Item Selection -->
                        <section class="flex flex-col gap-6 pb-8 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span class="flex items-center justify-center w-6 h-6 rounded-full bg-blue-600 dark:bg-[#1269e2] text-xs text-white">1</span>
                                    Select Product
                                </h3>
                            </div>
                            <!-- Search Bar -->
                            <div class="w-full">
                                <label class="flex flex-col h-12 w-full">
                                    <div class="flex w-full flex-1 items-stretch rounded-lg h-full border border-gray-300 dark:border-gray-600 focus-within:border-blue-600 dark:focus-within:border-[#1269e2]/50 transition-colors bg-white dark:bg-[#233348]">
                                        <div class="text-gray-400 dark:text-[#92a9c9] flex items-center justify-center pl-4">
                                            <span class="material-symbols-outlined">search</span>
                                        </div>
                                        <input [(ngModel)]="searchQuery" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-0 border-none bg-transparent h-full placeholder:text-gray-400 dark:placeholder:text-[#92a9c9] px-4 pl-2 text-base font-normal leading-normal transition-all" placeholder="Search products by name or category..." />
                                    </div>
                                </label>
                            </div>
                            <!-- Items List -->
                            <div class="flex flex-col gap-3 max-h-[500px] overflow-y-auto pr-2">
                                <div *ngFor="let product of filteredProducts" class="flex items-center gap-4 bg-white dark:bg-[#1a2432] px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-600 hover:border-blue-600 dark:hover:border-[#1269e2]/30 transition-all shadow-sm">
                                    <div class="bg-center bg-no-repeat bg-cover rounded-lg size-16 shrink-0 relative overflow-hidden bg-gray-100 dark:bg-gray-800">
                                        <img [src]="product.imageUrl || 'assets/placeholder.jpg'" alt="{{product.name}}" class="w-full h-full object-cover" />
                                        <div class="absolute inset-0 bg-black/5 dark:bg-black/10"></div>
                                    </div>
                                    <div class="flex flex-col justify-center flex-1 min-w-0">
                                        <div class="flex justify-between items-start">
                                            <p class="text-gray-900 dark:text-white text-base font-medium leading-normal line-clamp-1">{{ product.name }}</p>
                                            <span [class]="product.quantity > 0 ? 'text-emerald-600 dark:text-emerald-400 bg-emerald-100 dark:bg-emerald-400/10' : 'text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-400/10'" class="text-xs font-medium px-2 py-0.5 rounded-full whitespace-nowrap">
                                                {{ product.quantity > 0 ? 'In Stock' : 'Out of Stock' }}
                                            </span>
                                        </div>
                                        <p class="text-gray-500 dark:text-[#92a9c9] text-sm font-normal leading-normal line-clamp-1">Available: {{ product.quantity }} units • {{ product.category }}</p>
                                    </div>
                                    <div class="shrink-0 flex items-center gap-3">
                                        <button (click)="decreaseCart(product)" class="size-8 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-[#233348] text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-[#324867] transition-colors">
                                            <span class="material-symbols-outlined text-sm">remove</span>
                                        </button>
                                        <span class="text-gray-900 dark:text-white font-medium w-4 text-center">{{ getCartQty(product) }}</span>
                                        <button (click)="increaseCart(product)" class="size-8 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-[#233348] text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-[#324867] transition-colors">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>
                                <div *ngIf="filteredProducts.length === 0" class="text-center p-4 text-gray-500 dark:text-[#92a9c9]">
                                    No products found.
                                </div>
                            </div>
                        </section>

                        <!-- Step 2: Logistics -->
                        <section class="flex flex-col gap-6 pt-8 border-t border-gray-300 dark:border-gray-700 pb-8 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span class="flex items-center justify-center w-6 h-6 rounded-full bg-blue-600 dark:bg-[#1269e2] text-xs text-white">2</span>
                                    Schedule Delivery
                                </h3>
                            </div>
                            <div class="flex flex-col gap-6">
                                <!-- Date Inputs -->
                                <div class="flex flex-col gap-6">
                                    <div class="flex gap-4">
                                        <label class="flex flex-col gap-1.5 flex-1">
                                            <span class="text-sm font-medium text-gray-500 dark:text-[#92a9c9]">Delivery Date</span>
                                            <div class="flex items-center bg-white dark:bg-[#233348] rounded-lg px-3 h-12 border border-gray-300 dark:border-gray-600 focus-within:border-blue-600 dark:focus-within:border-[#1269e2]/50 transition-colors">
                                                <span class="material-symbols-outlined text-gray-400 dark:text-[#92a9c9] mr-3">calendar_today</span>
                                                <input [(ngModel)]="pickupDate" (ngModelChange)="onDateChange()" class="bg-transparent border-none text-gray-900 dark:text-white w-full focus:ring-0 p-0 text-sm" type="date" />
                                            </div>
                                        </label>
                                        <label class="flex flex-col gap-1.5 w-36">
                                            <span class="text-sm font-medium text-gray-500 dark:text-[#92a9c9]">Time</span>
                                            <div class="flex items-center bg-white dark:bg-[#233348] rounded-lg px-3 h-12 border border-gray-300 dark:border-gray-600 focus-within:border-blue-600 dark:focus-within:border-[#1269e2]/50 transition-colors">
                                                <span class="material-symbols-outlined text-gray-400 dark:text-[#92a9c9] mr-2">schedule</span>
                                                <input [(ngModel)]="pickupTime" class="bg-transparent border-none text-gray-900 dark:text-white w-full focus:ring-0 p-0 text-sm" type="time" />
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="bg-white dark:bg-[#1a2432] rounded-xl p-4 border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <div class="flex justify-between items-center mb-4">
                                        <span class="text-gray-900 dark:text-white font-medium">{{ calendarDate | date:'MMMM yyyy' }}</span>
                                        <div class="flex gap-1">
                                            <button (click)="changeMonth(-1)" class="p-1 hover:bg-gray-100 dark:hover:bg-[#324867] rounded"><span class="material-symbols-outlined text-sm text-gray-500 dark:text-[#92a9c9]">chevron_left</span></button>
                                            <button (click)="changeMonth(1)" class="p-1 hover:bg-gray-100 dark:hover:bg-[#324867] rounded"><span class="material-symbols-outlined text-sm text-gray-500 dark:text-[#92a9c9]">chevron_right</span></button>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-7 gap-1 text-center text-xs mb-2 text-gray-400 dark:text-[#92a9c9]">
                                        <div>Su</div><div>Mo</div><div>Tu</div><div>We</div><div>Th</div><div>Fr</div><div>Sa</div>
                                    </div>
                                    <div class="grid grid-cols-7 gap-1 text-center text-sm">
                                        <div *ngFor="let day of calendarDays" 
                                             class="p-1 rounded cursor-default"
                                             [ngClass]="{
                                                'text-gray-300 dark:text-[#324867]': !day.isCurrentMonth,
                                                'text-gray-900 dark:text-white': day.isCurrentMonth && !day.isSelected,
                                                'bg-blue-600 dark:bg-[#1269e2] text-white': day.isSelected
                                             }">
                                             {{ day.day }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Address & Payment -->
                            <div class="flex flex-col gap-6">
                                <label class="flex flex-col gap-1.5 w-full">
                                    <span class="text-sm font-medium text-gray-500 dark:text-[#92a9c9]">Delivery Address</span>
                                    <div class="flex gap-2">
                                        <div class="flex flex-1 items-center bg-white dark:bg-[#233348] rounded-lg px-3 h-12 border border-gray-300 dark:border-gray-600 focus-within:border-blue-600 dark:focus-within:border-[#1269e2]/50 transition-colors">
                                            <span class="material-symbols-outlined text-gray-400 dark:text-[#92a9c9] mr-3">location_on</span>
                                            <input [(ngModel)]="customerAddress" class="bg-transparent border-none text-gray-900 dark:text-white w-full focus:ring-0 p-0 text-sm" placeholder="Enter delivery address" type="text" />
                                        </div>
                                        <button (click)="getLocation()" [disabled]="isLocationLoading" class="h-12 px-4 bg-blue-600 dark:bg-[#1269e2] hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2 transition-colors whitespace-nowrap">
                                            <span *ngIf="isLocationLoading" class="material-symbols-outlined animate-spin text-sm">refresh</span>
                                            <span *ngIf="!isLocationLoading" class="material-symbols-outlined text-sm">my_location</span>
                                            <span class="hidden sm:inline">Use My Location</span>
                                        </button>
                                    </div>
                                </label>

                                <label class="flex flex-col gap-1.5 w-full">
                                    <span class="text-sm font-medium text-gray-500 dark:text-[#92a9c9]">Payment Option (Optional)</span>
                                    <div class="flex items-center bg-white dark:bg-[#233348] rounded-lg px-3 h-12 border border-gray-300 dark:border-gray-600 focus-within:border-blue-600 dark:focus-within:border-[#1269e2]/50 transition-colors">
                                        <span class="material-symbols-outlined text-gray-400 dark:text-[#92a9c9] mr-3">payments</span>
                                        <select [(ngModel)]="paymentOption" class="themed-select bg-white dark:bg-[#233348] border-none text-gray-900 dark:text-white w-full focus:ring-0 p-0 text-sm cursor-pointer">
                                            <option value="" disabled selected class="bg-white dark:bg-[#233348] text-gray-900 dark:text-white">Select Payment Method</option>
                                            <option *ngFor="let opt of paymentOptions" [value]="opt" class="bg-white dark:bg-[#233348] text-gray-900 dark:text-white">{{ opt }}</option>
                                        </select>
                                    </div>
                                </label>
                            </div>
                        </section>
                        <!-- Step 3: Contact Info -->
                        <section class="flex flex-col gap-6">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span class="flex items-center justify-center w-6 h-6 rounded-full bg-blue-600 dark:bg-[#1269e2] text-xs text-white">3</span>
                                    Your Details
                                </h3>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <label class="flex flex-col gap-1.5">
                                    <span class="text-sm font-medium text-gray-500 dark:text-[#92a9c9]">Full Name</span>
                                    <input [(ngModel)]="customerName" class="bg-white dark:bg-[#233348] border border-gray-300 dark:border-gray-600 focus:border-blue-600 dark:focus:border-[#1269e2]/50 rounded-lg px-4 h-12 text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-[#92a9c9]/50 focus:ring-0 transition-colors" placeholder="e.g. Jane Doe" type="text"/>
                                </label>
                                <label class="flex flex-col gap-1.5">
                                    <span class="text-sm font-medium text-gray-500 dark:text-[#92a9c9]">Phone Number</span>
                                    <input [(ngModel)]="customerContact" class="bg-white dark:bg-[#233348] border border-gray-300 dark:border-gray-600 focus:border-blue-600 dark:focus:border-[#1269e2]/50 rounded-lg px-4 h-12 text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-[#92a9c9]/50 focus:ring-0 transition-colors" placeholder="+1 (555) 000-0000" type="tel"/>
                                </label>
                            </div>
                        </section>
                    </div>
                    <!-- Right Column: Summary Sticky -->
                    <div class="w-full lg:w-[360px] shrink-0">
                        <div class="sticky top-24 flex flex-col gap-6 z-10">
                            <div class="bg-white dark:bg-[#1a2432] border border-gray-200 dark:border-gray-600 rounded-xl p-6 shadow-xl flex flex-col gap-6">
                                <div class="flex justify-between items-center border-b border-dashed remove-top border-gray-200 dark:border-gray-600 pb-4">
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">Summary</h3>
                                    <span class="text-xs font-medium text-gray-500 dark:text-[#92a9c9] bg-gray-100 dark:bg-[#233348] px-2 py-1 rounded">ID: #RES-8921</span>
                                </div>
                                <div class="flex flex-col gap-4">
                                    <div *ngIf="orderItems.length === 0" class="text-sm text-gray-500 dark:text-[#92a9c9] text-center">No items selected</div>
                                    <div *ngFor="let item of orderItems" class="flex justify-between items-start text-sm">
                                        <div class="flex flex-col gap-1">
                                            <span class="text-gray-900 dark:text-white font-medium">{{ item.product.name }}</span>
                                            <span class="text-gray-500 dark:text-[#92a9c9] text-xs">x{{ item.quantity }} Unit</span>
                                        </div>
                                        <span class="text-gray-900 dark:text-white font-medium">₱{{ (item.product.price * item.quantity) | number:'1.2-2' }}</span>
                                    </div>
                                    <div *ngIf="orderItems.length > 0" class="flex justify-between items-start text-sm font-bold pt-2 border-b border-dashed remove-bottom border-gray-200 dark:border-gray-600">
                                        <span class="text-gray-900 dark:text-white">Total</span>
                                        <span class="text-gray-900 dark:text-white">₱{{ totalAmount | number:'1.2-2' }}</span>
                                    </div>
                                </div>
                                <div class="border-t border-dashed remove-bottom border-gray-200 dark:border-gray-600 py-4 flex flex-col gap-3">
                                    <div class="flex items-center gap-3">
                                        <span class="material-symbols-outlined text-blue-600 dark:text-[#1269e2] text-xl">event</span>
                                        <div class="flex flex-col">
                                            <span class="text-xs text-gray-500 dark:text-[#92a9c9]">Delivery</span>
                                            <span class="text-sm font-medium text-gray-900 dark:text-white">{{ pickupDate || 'Select Date' }} {{ pickupTime }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-3">
                                    <button (click)="submitReservation()" [disabled]="isSubmitting || orderItems.length === 0" class="w-full h-12 bg-blue-600 dark:bg-[#1269e2] hover:bg-blue-700 dark:hover:bg-[#1269e2]/90 text-white font-bold rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                        <span *ngIf="!isSubmitting">Confirm Reservation</span>
                                        <span *ngIf="isSubmitting">Processing...</span>
                                        <span *ngIf="!isSubmitting" class="material-symbols-outlined text-sm">arrow_forward</span>
                                    </button>
                                    <p class="text-xs text-center text-gray-500 dark:text-[#92a9c9]">By confirming, you agree to the product usage policy.</p>
                                </div>
                            </div>
                            <!-- Need Help Card -->
                            <div class="bg-[#151f2b] border border-gray-200 dark:border-gray-600 rounded-xl p-4 flex items-start gap-3">
                                <div class="bg-[#233348] p-2 rounded-lg text-[#92a9c9] shrink-0">
                                    <span class="material-symbols-outlined">support_agent</span>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-white">Need special product?</p>
                                    <a class="text-xs text-blue-500 dark:text-[#1269e2] hover:underline mt-1 inline-block" href="#">Open Chat</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
