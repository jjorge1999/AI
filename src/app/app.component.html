<!-- Public / Login Section -->
<div *ngIf="!isLoggedIn" class="public-container">
  <router-outlet></router-outlet>
</div>

<!-- Main Application with Sidebar Layout -->
<div *ngIf="isLoggedIn" class="app-layout">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="isSidebarCollapsed" [class.mobile-open]="isMobileSidebarOpen">
    <div class="sidebar-content">
      <!-- Logo/User Section -->
      <div class="sidebar-header">
        <div class="user-profile">
          <div class="user-avatar">
            <span class="avatar-text">{{ getUserInitials() }}</span>
          </div>
          <div class="user-info" *ngIf="!isSidebarCollapsed">
            <h1 class="user-name">{{ userFullName }}</h1>
            <p class="user-role">{{ userRole === 'admin' ? 'Administrator' : 'Staff Member' }}</p>
          </div>
        </div>
        
        <!-- Actions moved from footer -->
        <div class="header-actions-row" [class.compact]="isSidebarCollapsed" style="margin-top: 1rem;">
          <button class="action-btn theme-btn" (click)="toggleTheme()" [title]="isDarkTheme ? 'Light Mode' : 'Dark Mode'">
            <span class="material-icon">{{ isDarkTheme ? 'light_mode' : 'dark_mode' }}</span>
            <span class="action-label" *ngIf="!isSidebarCollapsed">{{ isDarkTheme ? 'Light' : 'Dark' }}</span>
          </button>
          <button class="action-btn vision-btn" (click)="toggleVisionAid()" title="Vision Aid">
            <span class="material-icon">visibility</span>
            <span class="action-label" *ngIf="!isSidebarCollapsed">Vision</span>
          </button>
          <button class="action-btn logout-btn" (click)="logout()" title="Logout">
            <span class="material-icon">logout</span>
            <span class="action-label" *ngIf="!isSidebarCollapsed">Logout</span>
          </button>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="sidebar-nav">
        <a 
          class="nav-item" 
          [class.active]="activeTab === 'home'"
          (click)="setActiveTab('home'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'home'">dashboard</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Dashboard</span>
        </a>
        <a 
          class="nav-item" 
          [class.active]="activeTab === 'add-product'"
          (click)="setActiveTab('add-product'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'add-product'">add_box</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Add Product</span>
        </a>
        <a 
          class="nav-item" 
          [class.active]="activeTab === 'inventory'"
          (click)="setActiveTab('inventory'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'inventory'">inventory_2</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Inventory</span>
        </a>
        <a 
          class="nav-item" 
          [class.active]="activeTab === 'sell'"
          (click)="setActiveTab('sell'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'sell'">point_of_sale</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Point of Sale</span>
        </a>
        <a 
          class="nav-item" 
          [class.active]="activeTab === 'customers'"
          (click)="setActiveTab('customers'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'customers'">groups</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Customers</span>
        </a>
        <a 
          class="nav-item" 
          [class.active]="activeTab === 'expenses'"
          (click)="setActiveTab('expenses'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'expenses'">receipt_long</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Expenses</span>
        </a>
        <a 
          class="nav-item" 
          [class.active]="activeTab === 'reports'"
          (click)="setActiveTab('reports'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'reports'">bar_chart</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Analytics</span>
        </a>
        <a 
          class="nav-item" 
          [class.active]="activeTab === 'logs'"
          (click)="setActiveTab('logs'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'logs'">history</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Activity Logs</span>
        </a>
        <a 
          class="nav-item chat-nav-item" 
          [class.active]="isChatOpen"
          (click)="toggleChat(); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="isChatOpen">chat</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">Messages</span>
          <span class="chat-badge" *ngIf="totalUnreadMessages > 0 && !isSidebarCollapsed">{{ totalUnreadMessages }}</span>
          <span class="chat-dot" *ngIf="totalUnreadMessages > 0 && isSidebarCollapsed"></span>
        </a>
        <a 
          *ngIf="userRole === 'admin'"
          class="nav-item" 
          [class.active]="activeTab === 'users'"
          (click)="setActiveTab('users'); closeMobileSidebar()"
        >
          <span class="material-icon" [class.fill]="activeTab === 'users'">manage_accounts</span>
          <span class="nav-label" *ngIf="!isSidebarCollapsed">User Management</span>
        </a>
      </nav>


    </div>
  </aside>

  <!-- Mobile Sidebar Overlay -->
  <div class="sidebar-overlay" [class.visible]="isMobileSidebarOpen" (click)="closeMobileSidebar()"></div>

  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Top Header Bar -->
    <header class="top-header">
      <div class="header-left">
        <button class="menu-toggle" (click)="toggleMobileSidebar()">
          <span class="material-icon">menu</span>
        </button>
        <button class="sidebar-collapse-btn" (click)="toggleSidebarCollapse()">
          <span class="material-icon">{{ isSidebarCollapsed ? 'chevron_right' : 'chevron_left' }}</span>
        </button>
        <h2 class="page-title">{{ getPageTitle() }}</h2>
      </div>
      <div class="header-right">
        <!-- Quick Actions -->
        <div class="header-actions">
          <button class="notification-btn" title="Notifications">
            <span class="material-icon">notifications</span>
            <span class="notification-dot" *ngIf="totalUnreadMessages > 0"></span>
          </button>
          <button class="add-item-btn" (click)="setActiveTab('add-product')">
            <span class="material-icon">add</span>
            <span class="btn-text">Add Item</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Scrollable Content Area -->
    <div class="content-area">
      <div class="content-wrapper">
        <!-- Home Tab -->
        <div class="content-pane" *ngIf="activeTab === 'home'">
          <app-landing></app-landing>
        </div>
        <!-- Add Product Tab -->
        <div class="content-pane" *ngIf="activeTab === 'add-product'">
          <app-product-form></app-product-form>
        </div>
        <!-- Sell Tab -->
        <div class="content-pane" *ngIf="activeTab === 'sell'">
          <app-pos-calculator></app-pos-calculator>
        </div>
        <!-- Inventory Tab -->
        <div class="content-pane" *ngIf="activeTab === 'inventory'">
          <app-inventory-list></app-inventory-list>
        </div>
        <!-- Customers Tab -->
        <div class="content-pane" *ngIf="activeTab === 'customers'">
          <app-customer-form></app-customer-form>
        </div>
        <!-- Expenses Tab -->
        <div class="content-pane" *ngIf="activeTab === 'expenses'">
          <app-expenses></app-expenses>
        </div>
        <!-- Reports Tab -->
        <div class="content-pane" *ngIf="activeTab === 'reports'">
          <app-reports></app-reports>
        </div>
        <!-- Activity Logs Tab -->
        <div class="content-pane" *ngIf="activeTab === 'logs'">
          <app-activity-logs></app-activity-logs>
        </div>
        <!-- User Management Tab -->
        <div class="content-pane" *ngIf="activeTab === 'users' && userRole === 'admin'">
          <app-user-management></app-user-management>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Floating Chat Widget (Always Visible) -->
<div class="chat-widget">
  <button 
    class="chat-toggle-button" 
    (click)="toggleChat()"
    [class.active]="isChatOpen"
    title="Open Chat"
  >
    <span class="chat-icon">ðŸ’¬</span>
    <span class="chat-label">Chat</span>
  </button>
  
  <span class="notification-badge" *ngIf="totalUnreadMessages > 0">{{ totalUnreadMessages }}</span>
  
  <div class="chat-modal" [class.open]="isChatOpen">
    <div class="chat-modal-content">
      <app-chat 
        [isOpen]="isChatOpen" 
        (totalUnreadCountChange)="totalUnreadMessages = $event"
      ></app-chat>
    </div>
    <button class="chat-modal-close" (click)="toggleChat()" title="Close Chat">âœ•</button>
  </div>
</div>

<!-- Global Dialog Component -->
<app-dialog></app-dialog>

<!-- Global Loading Indicator -->
<app-loading></app-loading>
