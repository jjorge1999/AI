import{o as ee}from"./chunk-UGCVPWLH.js";import{a as $}from"./chunk-YXQWA23Y.js";import{a as U,b as L,e as Y,h as G,i as H,j as J,m as K,n as X}from"./chunk-IQNO2F6Q.js";import{a as j,d as Z}from"./chunk-BHAFHNJ3.js";import{Aa as c,Ba as S,E as T,Mb as F,Nb as W,Pa as x,Qb as B,R as D,Ra as p,Sb as Q,Ta as N,Va as i,W as V,Wa as n,Xa as I,Ya as M,Za as h,_a as d,aa as R,db as o,e as O,eb as k,f as E,fb as g,gb as A,ia as l,ib as v,ja as m,jb as _,kb as f,mb as z,nb as b,pb as y,s as P,wa as q}from"./chunk-MNIEKAC2.js";var te=(()=>{class a{constructor(e){this.http=e,this.apiUrl=Z.apiUrl}addReservation(e){return O(this,null,function*(){return yield P(this.http.post(`${this.apiUrl}/reservations`,e)),"reservation-submitted"})}static{this.\u0275fac=function(r){return new(r||a)(V(j))}}static{this.\u0275prov=D({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function re(a,u){if(a&1&&(i(0,"div",5)(1,"div",6),o(2,"\u2705"),n(),i(3,"p"),o(4),n()()),a&2){let e=d();c(4),k(e.successMessage)}}function oe(a,u){if(a&1&&(i(0,"option",31),o(1),n()),a&2){let e=u.$implicit;p("value",e),c(),g(" ",e," ")}}function ae(a,u){if(a&1&&I(0,"img",46),a&2){let e=d().$implicit;p("src",e.imageUrl,q)("alt",e.name)}}function se(a,u){a&1&&(i(0,"div",47),o(1,"\u{1F4E6}"),n())}function ce(a,u){if(a&1){let e=M();i(0,"div",32)(1,"div",33),x(2,ae,1,2,"img",34)(3,se,2,0,"div",35),n(),i(4,"div",36)(5,"h4",37),o(6),n(),i(7,"div",38)(8,"span",39),o(9),b(10,"number"),n(),i(11,"span",40),o(12),n()(),i(13,"div",41)(14,"div",42)(15,"button",43),h("click",function(){let t=l(e).$implicit,s=d(2);return m(s.decrementQty(t))}),o(16," - "),n(),i(17,"input",44),h("input",function(t){let s=l(e).$implicit,w=d(2);return m(w.manualQty(s,t))}),n(),i(18,"button",43),h("click",function(){let t=l(e).$implicit,s=d(2);return m(s.incrementQty(t))}),o(19," + "),n()(),i(20,"button",45),h("click",function(){let t=l(e).$implicit,s=d(2);return m(s.addToOrder(t))}),o(21," Add "),n()()()()}if(a&2){let e=u.$implicit,r=d(2);c(2),p("ngIf",e.imageUrl),c(),p("ngIf",!e.imageUrl),c(3),k(e.name),c(3),g("\u20B1",y(10,9,e.price,"1.2-2"),""),c(2),N("low",e.quantity<10),c(),g("Stock: ",e.quantity,""),c(5),p("value",r.getQty(e))("max",e.quantity)}}function de(a,u){if(a&1){let e=M();i(0,"div",62)(1,"div",63)(2,"span",64),o(3),n(),i(4,"span",65),o(5),b(6,"number"),n()(),i(7,"div",66),o(8),b(9,"number"),i(10,"button",67),h("click",function(){let t=l(e).index,s=d(3);return m(s.removeFromOrder(t))}),o(11," \u2715 "),n()()()}if(a&2){let e=u.$implicit;c(3),k(e.product.name),c(2),A("",e.quantity," x \u20B1",y(6,4,e.product.price,"1.2-2"),""),c(3),g(" \u20B1",y(9,7,e.product.price*e.quantity,"1.2-2")," ")}}function le(a,u){if(a&1){let e=M();i(0,"section",48)(1,"h3"),o(2,"Order Summary"),n(),i(3,"div",49),x(4,de,12,10,"div",50),n(),i(5,"div",51)(6,"div",52)(7,"span",53),o(8,"Net Subtotal"),n(),i(9,"span",54),o(10),b(11,"number"),n()(),i(12,"div",52)(13,"span",53),o(14,"VAT (12% Inclusive)"),n(),i(15,"span",54),o(16),b(17,"number"),n()(),I(18,"div",55),n(),i(19,"div",56)(20,"span"),o(21,"Total Amount:"),n(),i(22,"span",57),o(23),b(24,"number"),n()(),i(25,"div",10)(26,"label",58),o(27,"Additional Notes"),n(),i(28,"textarea",59),f("ngModelChange",function(t){l(e);let s=d(2);return _(s.notes,t)||(s.notes=t),m(t)}),n()(),i(29,"div",60)(30,"button",61),h("click",function(){l(e);let t=d(2);return m(t.submitReservation())}),o(31),n()()()}if(a&2){let e=d(2);c(4),p("ngForOf",e.orderItems),c(6),g("\u20B1",y(11,7,e.subTotal,"1.2-2"),""),c(6),g("\u20B1",y(17,10,e.taxAmount,"1.2-2"),""),c(7),g("\u20B1",y(24,13,e.totalAmount,"1.2-2"),""),c(5),v("ngModel",e.notes),c(2),p("disabled",e.isSubmitting),c(),g(" ",e.isSubmitting?"Submitting...":"Confirm Reservation"," ")}}function me(a,u){a&1&&(i(0,"div",68)(1,"p"),o(2,"Your cart is empty. Add items above."),n()())}function pe(a,u){if(a&1){let e=M();i(0,"div",7)(1,"section",8)(2,"h3"),o(3,"\u{1F4CB} Customer Information"),n(),i(4,"div",9)(5,"div",10)(6,"label",11),o(7,"Full Name *"),n(),i(8,"input",12),f("ngModelChange",function(t){l(e);let s=d();return _(s.customerName,t)||(s.customerName=t),m(t)}),n()(),i(9,"div",10)(10,"label",13),o(11,"Phone Number *"),n(),i(12,"input",14),f("ngModelChange",function(t){l(e);let s=d();return _(s.customerContact,t)||(s.customerContact=t),m(t)}),n()(),i(13,"div",15)(14,"label",16),o(15,"Delivery Address *"),n(),i(16,"input",17),f("ngModelChange",function(t){l(e);let s=d();return _(s.customerAddress,t)||(s.customerAddress=t),m(t)}),n()(),i(17,"div",15)(18,"label",18),o(19,"Payment Option (Optional)"),n(),i(20,"select",19),f("ngModelChange",function(t){l(e);let s=d();return _(s.paymentOption,t)||(s.paymentOption=t),m(t)}),i(21,"option",20),o(22,"Select Payment Method"),n(),x(23,oe,2,2,"option",21),n()()(),i(24,"h3",22),o(25,"\u{1F69A} Pickup/Delivery Date"),n(),i(26,"div",9)(27,"div",10)(28,"label",23),o(29,"Date *"),n(),i(30,"input",24),f("ngModelChange",function(t){l(e);let s=d();return _(s.pickupDate,t)||(s.pickupDate=t),m(t)}),n()(),i(31,"div",10)(32,"label",25),o(33,"Time"),n(),i(34,"input",26),f("ngModelChange",function(t){l(e);let s=d();return _(s.pickupTime,t)||(s.pickupTime=t),m(t)}),n()()()(),i(35,"section",8)(36,"h3"),o(37,"Select Items"),n(),i(38,"div",27),x(39,ce,22,12,"div",28),n()(),x(40,le,32,16,"section",29)(41,me,3,0,"div",30),n()}if(a&2){let e=d();c(8),v("ngModel",e.customerName),c(4),v("ngModel",e.customerContact),c(4),v("ngModel",e.customerAddress),c(4),v("ngModel",e.paymentOption),c(3),p("ngForOf",e.paymentOptions),c(7),v("ngModel",e.pickupDate),c(4),v("ngModel",e.pickupTime),c(5),p("ngForOf",e.products),c(),p("ngIf",e.orderItems.length>0),c(),p("ngIf",e.orderItems.length===0)}}var Oe=(()=>{class a{constructor(e,r,t){this.inventoryService=e,this.reservationService=r,this.customerService=t,this.products=[],this.subscriptions=new E,this.customerName="",this.customerContact="",this.customerAddress="",this.notes="",this.paymentOption="",this.paymentOptions=["Cash on Delivery","Gcash","Bank Transfer"],this.pickupDate="",this.pickupTime="",this.orderItems=[],this.selectedProduct=null,this.selectedQuantity=1,this.isSubmitting=!1,this.successMessage="",this.tempQuantities={}}ngOnInit(){let e=new Date;e.setDate(e.getDate()+1),this.pickupDate=e.toISOString().split("T")[0],this.loadProducts()}ngOnDestroy(){this.subscriptions.unsubscribe()}loadProducts(){this.inventoryService.loadProducts(),this.subscriptions.add(this.inventoryService.getProducts().subscribe(e=>{this.products=e.filter(r=>r.quantity>0)}))}getQty(e){return this.tempQuantities[e.id]||1}incrementQty(e){let r=this.getQty(e);r<e.quantity&&(this.tempQuantities[e.id]=r+1)}decrementQty(e){let r=this.getQty(e);r>1&&(this.tempQuantities[e.id]=r-1)}manualQty(e,r){let t=parseInt(r.target.value,10);!isNaN(t)&&t>=1&&t<=e.quantity&&(this.tempQuantities[e.id]=t)}addToOrder(e){let r=this.getQty(e),t=this.orderItems.find(w=>w.product.id===e.id),s=t?t.quantity:0;if(s+r>e.quantity){alert(`Cannot add more. You already have ${s} in cart. Max stock is ${e.quantity}.`);return}t?t.quantity+=r:this.orderItems.push({product:e,quantity:r}),this.tempQuantities[e.id]=1}removeFromOrder(e){this.orderItems.splice(e,1)}get totalAmount(){return this.orderItems.reduce((e,r)=>e+r.product.price*r.quantity,0)}get subTotal(){return this.totalAmount/1.12}get taxAmount(){return this.totalAmount-this.subTotal}submitReservation(){return O(this,null,function*(){if(this.orderItems.length===0||!this.customerName||!this.customerContact||!this.pickupDate||!this.customerAddress){alert("Please fill in all required fields and add items to your reservation.");return}this.isSubmitting=!0;try{let e=new Date(this.pickupDate+(this.pickupTime?"T"+this.pickupTime:"T00:00:00")),r=`Payment: ${this.paymentOption||"Not Specified"}

${this.notes}`;(yield P(this.customerService.getCustomers().pipe(T(1)))).find(C=>C.phoneNumber===this.customerContact)||this.customerService.addCustomer({name:this.customerName,phoneNumber:this.customerContact,deliveryAddress:this.customerAddress}),yield this.reservationService.addReservation({customerName:this.customerName,customerContact:this.customerContact,customerAddress:this.customerAddress,reservationDate:new Date,pickupDate:e,status:"pending",items:this.orderItems.map(C=>({productId:C.product.id,productName:C.product.name,quantity:C.quantity,price:C.product.price})),totalAmount:this.totalAmount,notes:r});let w={name:this.customerName,phoneNumber:this.customerContact,address:this.customerAddress,gpsCoordinates:"",expiresAt:Date.now()+2*60*60*1e3};localStorage.setItem("chatCustomerInfo",JSON.stringify(w)),localStorage.setItem("chatUserName",this.customerName),this.successMessage="Reservation submitted successfully! We will contact you shortly. You can now chat with us!",this.resetForm()}catch(e){console.error("Error submitting reservation",e),alert("Failed to submit reservation. Please try again.")}finally{this.isSubmitting=!1}})}resetForm(){this.orderItems=[],this.customerName="",this.customerContact="",this.customerAddress="",this.paymentOption="",this.notes="",this.selectedProduct=null,this.pickupTime=""}static{this.\u0275fac=function(r){return new(r||a)(S(ee),S(te),S($))}}static{this.\u0275cmp=R({type:a,selectors:[["app-reservation"]],standalone:!0,features:[z],decls:9,vars:2,consts:[[1,"reservation-page"],[1,"reservation-container"],[1,"reservation-header"],["class","success-alert",4,"ngIf"],["class","reservation-form",4,"ngIf"],[1,"success-alert"],[1,"success-icon"],[1,"reservation-form"],[1,"form-section"],[1,"form-grid"],[1,"form-group"],["for","name"],["type","text","id","name","placeholder","Enter your name","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","contact"],["type","text","id","contact","placeholder","Phone number","required","",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-group","full-width",2,"grid-column","1 / -1"],["for","address"],["type","text","id","address","placeholder","Street, City, Province","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","payment"],["id","payment",1,"form-input",2,"height","42px",3,"ngModelChange","ngModel"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],[2,"margin-top","var(--space-lg)"],["for","date"],["type","date","id","date","required","",1,"form-input",3,"ngModelChange","ngModel"],["for","time"],["type","time","id","time",1,"form-input",3,"ngModelChange","ngModel"],[1,"product-grid"],["class","product-card",4,"ngFor","ngForOf"],["class","form-section summary-section",4,"ngIf"],["class","empty-cart-msg",4,"ngIf"],[3,"value"],[1,"product-card"],[1,"card-image"],["loading","lazy",3,"src","alt",4,"ngIf"],["class","placeholder-img",4,"ngIf"],[1,"card-content"],[1,"card-title"],[1,"card-meta"],[1,"price"],[1,"stock"],[1,"card-actions"],[1,"qty-control"],["type","button",1,"qty-btn",3,"click"],["type","number","min","1",1,"qty-input-sm",3,"input","value","max"],[1,"btn-add-card",3,"click"],["loading","lazy",3,"src","alt"],[1,"placeholder-img"],[1,"form-section","summary-section"],[1,"order-list"],["class","order-item",4,"ngFor","ngForOf"],[1,"price-breakdown"],[1,"breakdown-row"],[1,"breakdown-label"],[1,"breakdown-value"],[1,"breakdown-divider"],[1,"order-total"],[1,"total-price"],["for","notes"],["id","notes","rows","3","placeholder","Any special requests?",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"actions"],[1,"btn-submit",3,"click","disabled"],[1,"order-item"],[1,"item-info"],[1,"item-name"],[1,"item-details"],[1,"item-total"],["title","Remove",1,"btn-remove",3,"click"],[1,"empty-cart-msg"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),o(4,"\u{1F4C5} Make a Reservation"),n(),i(5,"p"),o(6,"Reserve items for pickup or delivery."),n()(),x(7,re,5,1,"div",3)(8,pe,42,10,"div",4),n()()),r&2&&(c(7),p("ngIf",t.successMessage),c(),p("ngIf",!t.successMessage))},dependencies:[Q,F,W,B,X,H,J,U,G,L,K,Y],styles:[".reservation-page[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:var(--space-md);background:var(--color-bg);background-image:radial-gradient(var(--color-border) 1px,transparent 1px);background-size:20px 20px}.reservation-container[_ngcontent-%COMP%]{width:100%;max-width:800px;background:var(--color-surface);border-radius:var(--radius-xl);box-shadow:0 4px 6px #0000001a;overflow:hidden;border:1px solid var(--color-border)}.reservation-header[_ngcontent-%COMP%]{padding:var(--space-xl) var(--space-lg);background:linear-gradient(135deg,var(--color-primary),var(--color-primary-dark));color:#fff;text-align:center}.reservation-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:var(--space-md);color:#fff}.reservation-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{opacity:.9;font-size:1.1rem}.reservation-form[_ngcontent-%COMP%]{padding:var(--space-xl)}.form-section[_ngcontent-%COMP%]{margin-bottom:var(--space-2xl);padding-bottom:var(--space-lg);border-bottom:1px solid var(--color-border)}.form-section[_ngcontent-%COMP%]:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:var(--color-text);margin-bottom:var(--space-md);text-transform:uppercase;letter-spacing:.5px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--space-md)}.form-group[_ngcontent-%COMP%]{margin-bottom:var(--space-md)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:var(--space-xs);color:var(--color-text);font-weight:500}.form-input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%], .form-textarea[_ngcontent-%COMP%]{width:100%;padding:var(--space-sm);border:1px solid var(--color-border);border-radius:var(--radius-md);background:var(--color-bg);color:var(--color-text);font-size:1rem;transition:border-color .2s}.form-input[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus, .form-textarea[_ngcontent-%COMP%]:focus{border-color:var(--color-primary);outline:none;box-shadow:0 0 0 3px #2563eb1a}.product-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:var(--space-sm);max-height:500px;overflow-y:auto;padding-right:4px}.product-card[_ngcontent-%COMP%]{background:var(--color-surface);border:1px solid var(--color-border);border-radius:var(--radius-md);overflow:hidden;transition:transform .2s,box-shadow .2s;display:flex;flex-direction:column}.product-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.card-image[_ngcontent-%COMP%]{height:100px;background:var(--color-bg);display:flex;align-items:center;justify-content:center;overflow:hidden}.card-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.placeholder-img[_ngcontent-%COMP%]{font-size:2rem;opacity:.5}.card-content[_ngcontent-%COMP%]{padding:var(--space-sm);flex:1;display:flex;flex-direction:column}.card-title[_ngcontent-%COMP%]{margin:0 0 2px;font-size:.9rem;font-weight:600;color:var(--color-text)}.card-meta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-sm);font-size:.8rem}.price[_ngcontent-%COMP%]{font-weight:700;color:var(--color-primary)}.stock[_ngcontent-%COMP%]{color:var(--color-text-muted)}.stock.low[_ngcontent-%COMP%]{color:var(--color-warning)}.card-actions[_ngcontent-%COMP%]{margin-top:auto;display:flex;flex-direction:column;gap:6px;align-items:stretch}.qty-control[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border:1px solid var(--color-border);border-radius:4px;overflow:hidden;background:var(--color-bg)}.qty-btn[_ngcontent-%COMP%]{background:var(--color-bg);border:none;width:24px;height:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem;z-index:2}.qty-btn[_ngcontent-%COMP%]:hover{background:var(--color-border)}.qty-input-sm[_ngcontent-%COMP%]{width:30px;border:none;text-align:center;font-size:.85rem;padding:0;height:24px;appearance:textfield}.qty-input-sm[_ngcontent-%COMP%]::-webkit-outer-spin-button, .qty-input-sm[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.btn-add-card[_ngcontent-%COMP%]{flex:1;background:var(--color-primary);color:#fff;border:none;border-radius:4px;height:26px;font-weight:600;cursor:pointer;transition:background .2s;font-size:.85rem}.btn-add-card[_ngcontent-%COMP%]:hover{background:var(--color-primary-dark)}.summary-section[_ngcontent-%COMP%]{background:var(--color-bg);padding:var(--space-lg);border-radius:var(--radius-lg)}.order-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--space-sm);margin-bottom:var(--space-lg)}.order-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--space-sm);background:var(--color-surface);border-radius:var(--radius-md);border:1px solid var(--color-border)}.item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.item-name[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text)}.item-details[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-muted)}.item-total[_ngcontent-%COMP%]{font-weight:600;color:var(--color-primary);display:flex;align-items:center;gap:var(--space-sm)}.btn-remove[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;border:none;background:var(--color-danger);color:#fff;font-size:.75rem;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.8;transition:.2s}.btn-remove[_ngcontent-%COMP%]:hover{opacity:1;transform:scale(1.1)}.order-total[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:var(--space-md);border-top:2px dashed var(--color-border);margin-bottom:var(--space-lg);font-size:1.25rem;font-weight:700;color:var(--color-text)}.total-price[_ngcontent-%COMP%]{color:var(--color-primary)}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.btn-submit[_ngcontent-%COMP%]{padding:var(--space-md) var(--space-2xl);background:var(--color-primary);color:#fff;border:none;border-radius:var(--radius-md);font-size:1.1rem;font-weight:600;cursor:pointer;box-shadow:0 4px 6px #0000001a;transition:transform .2s,box-shadow .2s}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 12px #00000026}.btn-submit[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:wait}.empty-cart-msg[_ngcontent-%COMP%]{text-align:center;padding:var(--space-2xl);color:var(--color-text-muted);font-style:italic}.success-alert[_ngcontent-%COMP%]{text-align:center;padding:var(--space-3xl) var(--space-xl)}.success-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:var(--space-md)}.success-alert[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.25rem;color:var(--color-text);margin-bottom:var(--space-xl)}.btn-primary[_ngcontent-%COMP%]{padding:var(--space-md) var(--space-xl);background:var(--color-primary);color:#fff;border:none;border-radius:var(--radius-md);font-weight:600;cursor:pointer}@media (max-width: 640px){.reservation-page[_ngcontent-%COMP%]{padding:0}.reservation-container[_ngcontent-%COMP%]{border-radius:0;min-height:100vh;border:none}.add-item-row[_ngcontent-%COMP%]{flex-wrap:wrap}.btn-add[_ngcontent-%COMP%]{width:100%;margin-bottom:0}}.price-breakdown[_ngcontent-%COMP%]{margin-bottom:var(--space-md);padding:var(--space-md) 0}.breakdown-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:var(--space-sm);font-size:.95rem;color:var(--color-text-muted)}.breakdown-label[_ngcontent-%COMP%]{font-weight:500}.breakdown-value[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text)}.breakdown-divider[_ngcontent-%COMP%]{height:1px;background-color:var(--color-border);margin-top:var(--space-md)}.order-total[_ngcontent-%COMP%]{border-top:none;padding-top:0}"]})}}return a})();export{Oe as a};
